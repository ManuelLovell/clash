(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var A=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class ae{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return A(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return A(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return A(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return A(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return A(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return A(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return A(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return A(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:n}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return n.indexOf(t)>-1})}getConnectionId(){return A(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=n=>{t(n.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var C=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class ce{constructor(t){this.messageBus=t}reset(){return C(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return C(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return C(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return C(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return C(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return C(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return C(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return C(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return C(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return C(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return C(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function ue(s){return typeof s.id=="string"}var yt={exports:{}},X=typeof Reflect=="object"?Reflect:null,Dt=X&&typeof X.apply=="function"?X.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},Q;X&&typeof X.ownKeys=="function"?Q=X.ownKeys:Object.getOwnPropertySymbols?Q=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Q=function(t){return Object.getOwnPropertyNames(t)};function de(s){console&&console.warn&&console.warn(s)}var jt=Number.isNaN||function(t){return t!==t};function _(){_.init.call(this)}yt.exports=_;yt.exports.once=_e;_.EventEmitter=_;_.prototype._events=void 0;_.prototype._eventsCount=0;_.prototype._maxListeners=void 0;var Lt=10;function nt(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return Lt},set:function(s){if(typeof s!="number"||s<0||jt(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");Lt=s}});_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};_.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||jt(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Yt(s){return s._maxListeners===void 0?_.defaultMaxListeners:s._maxListeners}_.prototype.getMaxListeners=function(){return Yt(this)};_.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var d=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw d.context=r,d}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")Dt(l,this,e);else for(var c=l.length,a=Qt(l,c),n=0;n<c;++n)Dt(a[n],this,e);return!0};function Kt(s,t,e,n){var i,o,r;if(nt(e),o=s._events,o===void 0?(o=s._events=Object.create(null),s._eventsCount=0):(o.newListener!==void 0&&(s.emit("newListener",t,e.listener?e.listener:e),o=s._events),r=o[t]),r===void 0)r=o[t]=e,++s._eventsCount;else if(typeof r=="function"?r=o[t]=n?[e,r]:[r,e]:n?r.unshift(e):r.push(e),i=Yt(s),i>0&&r.length>i&&!r.warned){r.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=s,d.type=t,d.count=r.length,de(d)}return s}_.prototype.addListener=function(t,e){return Kt(this,t,e,!1)};_.prototype.on=_.prototype.addListener;_.prototype.prependListener=function(t,e){return Kt(this,t,e,!0)};function le(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zt(s,t,e){var n={fired:!1,wrapFn:void 0,target:s,type:t,listener:e},i=le.bind(n);return i.listener=e,n.wrapFn=i,i}_.prototype.once=function(t,e){return nt(e),this.on(t,zt(this,t,e)),this};_.prototype.prependOnceListener=function(t,e){return nt(e),this.prependListener(t,zt(this,t,e)),this};_.prototype.removeListener=function(t,e){var n,i,o,r,d;if(nt(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){d=n[r].listener,o=r;break}if(o<0)return this;o===0?n.shift():he(n,o),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,d||e)}return this};_.prototype.off=_.prototype.removeListener;_.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),r;for(i=0;i<o.length;++i)r=o[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function Zt(s,t,e){var n=s._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?fe(i):Qt(i,i.length)}_.prototype.listeners=function(t){return Zt(this,t,!0)};_.prototype.rawListeners=function(t){return Zt(this,t,!1)};_.listenerCount=function(s,t){return typeof s.listenerCount=="function"?s.listenerCount(t):qt.call(s,t)};_.prototype.listenerCount=qt;function qt(s){var t=this._events;if(t!==void 0){var e=t[s];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?Q(this._events):[]};function Qt(s,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=s[n];return e}function he(s,t){for(;t+1<s.length;t++)s[t]=s[t+1];s.pop()}function fe(s){for(var t=new Array(s.length),e=0;e<t.length;++e)t[e]=s[e].listener||s[e];return t}function _e(s,t){return new Promise(function(e,n){function i(r){s.removeListener(t,o),n(r)}function o(){typeof s.removeListener=="function"&&s.removeListener("error",i),e([].slice.call(arguments))}Jt(s,t,o,{once:!0}),t!=="error"&&Ee(s,i,{once:!0})})}function Ee(s,t,e){typeof s.on=="function"&&Jt(s,"error",t,e)}function Jt(s,t,e,n){if(typeof s.on=="function")n.once?s.once(t,e):s.on(t,e);else if(typeof s.addEventListener=="function")s.addEventListener(t,function i(o){n.once&&s.removeEventListener(t,i),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var Oe=yt.exports;let z;const Te=new Uint8Array(16);function ye(){if(!z&&(z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!z))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return z(Te)}const y=[];for(let s=0;s<256;++s)y.push((s+256).toString(16).slice(1));function pe(s,t=0){return y[s[t+0]]+y[s[t+1]]+y[s[t+2]]+y[s[t+3]]+"-"+y[s[t+4]]+y[s[t+5]]+"-"+y[s[t+6]]+y[s[t+7]]+"-"+y[s[t+8]]+y[s[t+9]]+"-"+y[s[t+10]]+y[s[t+11]]+y[s[t+12]]+y[s[t+13]]+y[s[t+14]]+y[s[t+15]]}const ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mt={randomUUID:ve};function te(s,t,e){if(Mt.randomUUID&&!t&&!s)return Mt.randomUUID();s=s||{};const n=s.random||(s.rng||ye)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){e=e||0;for(let i=0;i<16;++i)t[e+i]=n[i];return t}return pe(n)}class Ae extends Oe.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=n=>{const i=n.data;if(n.origin===this.targetOrigin&&ue(i)){if(i.id==="OBR_READY"){this.ready=!0;const o=i.data;this.ref=o.ref,this.userId=o.userId}this.emit(i.id,i.data)}},this.send=(n,i,o)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:n,data:i,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(n,i,o=5e3)=>{const r=`_${te()}`;return this.send(n,i,r),Promise.race([new Promise((d,l)=>{const c=this;function a(E){c.off(`${n}_RESPONSE${r}`,a),c.off(`${n}_ERROR${r}`,u),d(E)}function u(E){c.off(`${n}_RESPONSE${r}`,a),c.off(`${n}_ERROR${r}`,u),l(E)}this.on(`${n}_RESPONSE${r}`,a),this.on(`${n}_ERROR${r}`,u)}),new Promise((d,l)=>window.setTimeout(()=>l(new Error(`Message ${n} took longer than ${o}ms to get a result`)),o))])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var wt=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class ge{constructor(t){this.messageBus=t}show(t,e){return wt(this,void 0,void 0,function*(){const{id:n}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return n})}close(t){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var U=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class me{constructor(t){this.messageBus=t}getColor(){return U(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return U(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return U(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=n=>{t(n.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var g=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ie{constructor(t){this.messageBus=t}getDpi(){return g(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return g(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return g(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return g(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return g(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return g(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return g(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,n){return g(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:n});return i})}getDistance(t,e){return g(this,void 0,void 0,function*(){const{distance:n}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return n})}onChange(t){const e=n=>{t(n.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var Z=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ne{constructor(t){this.messageBus=t}undo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Z(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return Z(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}function p(s){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+s+(e.length?" "+e.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function P(s){return!!s&&!!s[R]}function M(s){var t;return!!s&&(function(e){if(!e||typeof e!="object")return!1;var n=Object.getPrototypeOf(e);if(n===null)return!0;var i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===we}(s)||Array.isArray(s)||!!s[F]||!!(!((t=s.constructor)===null||t===void 0)&&t[F])||it(s)||ot(s))}function W(s,t,e){e===void 0&&(e=!1),w(s)===0?(e?Object.keys:Nt)(s).forEach(function(n){e&&typeof n=="symbol"||t(n,s[n],s)}):s.forEach(function(n,i){return t(i,n,s)})}function w(s){var t=s[R];return t?t.i>3?t.i-4:t.i:Array.isArray(s)?1:it(s)?2:ot(s)?3:0}function Y(s,t){return w(s)===2?s.has(t):Object.prototype.hasOwnProperty.call(s,t)}function J(s,t){return w(s)===2?s.get(t):s[t]}function ee(s,t,e){var n=w(s);n===2?s.set(t,e):n===3?s.add(e):s[t]=e}function Be(s,t){return s===t?s!==0||1/s==1/t:s!=s&&t!=t}function it(s){return Le&&s instanceof Map}function ot(s){return Me&&s instanceof Set}function b(s){return s.o||s.t}function pt(s){if(Array.isArray(s))return Array.prototype.slice.call(s);var t=be(s);delete t[R];for(var e=Nt(t),n=0;n<e.length;n++){var i=e[n],o=t[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:s[i]})}return Object.create(Object.getPrototypeOf(s),t)}function vt(s,t){return t===void 0&&(t=!1),At(s)||P(s)||!M(s)||(w(s)>1&&(s.set=s.add=s.clear=s.delete=Re),Object.freeze(s),t&&W(s,function(e,n){return vt(n,!0)},!0)),s}function Re(){p(2)}function At(s){return s==null||typeof s!="object"||Object.isFrozen(s)}function L(s){var t=Et[s];return t||p(18,s),t}function Se(s,t){Et[s]||(Et[s]=t)}function bt(){return K}function rt(s,t){t&&(L("Patches"),s.u=[],s.s=[],s.v=t)}function tt(s){ht(s),s.p.forEach(Ce),s.p=null}function ht(s){s===K&&(K=s.l)}function xt(s){return K={p:[],l:K,h:s,m:!0,_:0}}function Ce(s){var t=s[R];t.i===0||t.i===1?t.j():t.g=!0}function at(s,t){t._=t.p.length;var e=t.p[0],n=s!==void 0&&s!==e;return t.h.O||L("ES5").S(t,s,n),n?(e[R].P&&(tt(t),p(4)),M(s)&&(s=et(t,s),t.l||st(t,s)),t.u&&L("Patches").M(e[R].t,s,t.u,t.s)):s=et(t,e,[]),tt(t),t.u&&t.v(t.u,t.s),s!==It?s:void 0}function et(s,t,e){if(At(t))return t;var n=t[R];if(!n)return W(t,function(d,l){return Pt(s,n,t,d,l,e)},!0),t;if(n.A!==s)return t;if(!n.P)return st(s,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=pt(n.k):n.o,o=i,r=!1;n.i===3&&(o=new Set(i),i.clear(),r=!0),W(o,function(d,l){return Pt(s,n,i,d,l,e,r)}),st(s,i,!1),e&&s.u&&L("Patches").N(n,e,s.u,s.s)}return n.o}function Pt(s,t,e,n,i,o,r){if(P(i)){var d=et(s,i,o&&t&&t.i!==3&&!Y(t.R,n)?o.concat(n):void 0);if(ee(e,n,d),!P(d))return;s.m=!1}else r&&e.add(i);if(M(i)&&!At(i)){if(!s.h.D&&s._<1)return;et(s,i),t&&t.A.l||st(s,i)}}function st(s,t,e){e===void 0&&(e=!1),!s.l&&s.h.D&&s.m&&vt(t,e)}function ct(s,t){var e=s[R];return(e?b(e):s)[t]}function Gt(s,t){if(t in s)for(var e=Object.getPrototypeOf(s);e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}}function ft(s){s.P||(s.P=!0,s.l&&ft(s.l))}function ut(s){s.o||(s.o=pt(s.t))}function _t(s,t,e){var n=it(t)?L("MapSet").F(t,e):ot(t)?L("MapSet").T(t,e):s.O?function(i,o){var r=Array.isArray(i),d={i:r?1:0,A:o?o.A:bt(),P:!1,I:!1,R:{},l:o,t:i,k:null,o:null,j:null,C:!1},l=d,c=Ot;r&&(l=[d],c=k);var a=Proxy.revocable(l,c),u=a.revoke,E=a.proxy;return d.k=E,d.j=u,E}(t,e):L("ES5").J(t,e);return(e?e.A:bt()).p.push(n),n}function De(s){return P(s)||p(22,s),function t(e){if(!M(e))return e;var n,i=e[R],o=w(e);if(i){if(!i.P&&(i.i<4||!L("ES5").K(i)))return i.t;i.I=!0,n=Ut(e,o),i.I=!1}else n=Ut(e,o);return W(n,function(r,d){i&&J(i.t,r)===d||ee(n,r,t(d))}),o===3?new Set(n):n}(s)}function Ut(s,t){switch(t){case 2:return new Map(s);case 3:return Array.from(s)}return pt(s)}function gt(){function s(n){if(!M(n))return n;if(Array.isArray(n))return n.map(s);if(it(n))return new Map(Array.from(n.entries()).map(function(r){return[r[0],s(r[1])]}));if(ot(n))return new Set(Array.from(n).map(s));var i=Object.create(Object.getPrototypeOf(n));for(var o in n)i[o]=s(n[o]);return Y(n,F)&&(i[F]=n[F]),i}function t(n){return P(n)?s(n):n}var e="add";Se("Patches",{$:function(n,i){return i.forEach(function(o){for(var r=o.path,d=o.op,l=n,c=0;c<r.length-1;c++){var a=w(l),u=r[c];typeof u!="string"&&typeof u!="number"&&(u=""+u),a!==0&&a!==1||u!=="__proto__"&&u!=="constructor"||p(24),typeof l=="function"&&u==="prototype"&&p(24),typeof(l=J(l,u))!="object"&&p(15,r.join("/"))}var E=w(l),f=s(o.value),O=r[r.length-1];switch(d){case"replace":switch(E){case 2:return l.set(O,f);case 3:p(16);default:return l[O]=f}case e:switch(E){case 1:return O==="-"?l.push(f):l.splice(O,0,f);case 2:return l.set(O,f);case 3:return l.add(f);default:return l[O]=f}case"remove":switch(E){case 1:return l.splice(O,1);case 2:return l.delete(O);case 3:return l.delete(o.value);default:return delete l[O]}default:p(17,d)}}),n},N:function(n,i,o,r){switch(n.i){case 0:case 4:case 2:return function(d,l,c,a){var u=d.t,E=d.o;W(d.R,function(f,O){var T=J(u,f),I=J(E,f),N=O?Y(u,f)?"replace":e:"remove";if(T!==I||N!=="replace"){var B=l.concat(f);c.push(N==="remove"?{op:N,path:B}:{op:N,path:B,value:I}),a.push(N===e?{op:"remove",path:B}:N==="remove"?{op:e,path:B,value:t(T)}:{op:"replace",path:B,value:t(T)})}})}(n,i,o,r);case 5:case 1:return function(d,l,c,a){var u=d.t,E=d.R,f=d.o;if(f.length<u.length){var O=[f,u];u=O[0],f=O[1];var T=[a,c];c=T[0],a=T[1]}for(var I=0;I<u.length;I++)if(E[I]&&f[I]!==u[I]){var N=l.concat([I]);c.push({op:"replace",path:N,value:t(f[I])}),a.push({op:"replace",path:N,value:t(u[I])})}for(var B=u.length;B<f.length;B++){var G=l.concat([B]);c.push({op:e,path:G,value:t(f[B])})}u.length<f.length&&a.push({op:"replace",path:l.concat(["length"]),value:u.length})}(n,i,o,r);case 3:return function(d,l,c,a){var u=d.t,E=d.o,f=0;u.forEach(function(O){if(!E.has(O)){var T=l.concat([f]);c.push({op:"remove",path:T,value:O}),a.unshift({op:e,path:T,value:O})}f++}),f=0,E.forEach(function(O){if(!u.has(O)){var T=l.concat([f]);c.push({op:e,path:T,value:O}),a.unshift({op:"remove",path:T,value:O})}f++})}(n,i,o,r)}},M:function(n,i,o,r){o.push({op:"replace",path:[],value:i===It?void 0:i}),r.push({op:"replace",path:[],value:n})}})}var Vt,K,mt=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Le=typeof Map<"u",Me=typeof Set<"u",$t=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",It=mt?Symbol.for("immer-nothing"):((Vt={})["immer-nothing"]=!0,Vt),F=mt?Symbol.for("immer-draftable"):"__$immer_draftable",R=mt?Symbol.for("immer-state"):"__$immer_state",we=""+Object.prototype.constructor,Nt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:Object.getOwnPropertyNames,be=Object.getOwnPropertyDescriptors||function(s){var t={};return Nt(s).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(s,e)}),t},Et={},Ot={get:function(s,t){if(t===R)return s;var e=b(s);if(!Y(e,t))return function(i,o,r){var d,l=Gt(o,r);return l?"value"in l?l.value:(d=l.get)===null||d===void 0?void 0:d.call(i.k):void 0}(s,e,t);var n=e[t];return s.I||!M(n)?n:n===ct(s.t,t)?(ut(s),s.o[t]=_t(s.A.h,n,s)):n},has:function(s,t){return t in b(s)},ownKeys:function(s){return Reflect.ownKeys(b(s))},set:function(s,t,e){var n=Gt(b(s),t);if(n?.set)return n.set.call(s.k,e),!0;if(!s.P){var i=ct(b(s),t),o=i?.[R];if(o&&o.t===e)return s.o[t]=e,s.R[t]=!1,!0;if(Be(e,i)&&(e!==void 0||Y(s.t,t)))return!0;ut(s),ft(s)}return s.o[t]===e&&(e!==void 0||t in s.o)||Number.isNaN(e)&&Number.isNaN(s.o[t])||(s.o[t]=e,s.R[t]=!0),!0},deleteProperty:function(s,t){return ct(s.t,t)!==void 0||t in s.t?(s.R[t]=!1,ut(s),ft(s)):delete s.R[t],s.o&&delete s.o[t],!0},getOwnPropertyDescriptor:function(s,t){var e=b(s),n=Reflect.getOwnPropertyDescriptor(e,t);return n&&{writable:!0,configurable:s.i!==1||t!=="length",enumerable:n.enumerable,value:e[t]}},defineProperty:function(){p(11)},getPrototypeOf:function(s){return Object.getPrototypeOf(s.t)},setPrototypeOf:function(){p(12)}},k={};W(Ot,function(s,t){k[s]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),k.deleteProperty=function(s,t){return k.set.call(this,s,t,void 0)},k.set=function(s,t,e){return Ot.set.call(this,s[0],t,e,s[0])};var xe=function(){function s(e){var n=this;this.O=$t,this.D=!0,this.produce=function(i,o,r){if(typeof i=="function"&&typeof o!="function"){var d=o;o=i;var l=n;return function(T){var I=this;T===void 0&&(T=d);for(var N=arguments.length,B=Array(N>1?N-1:0),G=1;G<N;G++)B[G-1]=arguments[G];return l.produce(T,function(re){var Ct;return(Ct=o).call.apply(Ct,[I,re].concat(B))})}}var c;if(typeof o!="function"&&p(6),r!==void 0&&typeof r!="function"&&p(7),M(i)){var a=xt(n),u=_t(n,i,void 0),E=!0;try{c=o(u),E=!1}finally{E?tt(a):ht(a)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(T){return rt(a,r),at(T,a)},function(T){throw tt(a),T}):(rt(a,r),at(c,a))}if(!i||typeof i!="object"){if((c=o(i))===void 0&&(c=i),c===It&&(c=void 0),n.D&&vt(c,!0),r){var f=[],O=[];L("Patches").M(i,c,f,O),r(f,O)}return c}p(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(c){for(var a=arguments.length,u=Array(a>1?a-1:0),E=1;E<a;E++)u[E-1]=arguments[E];return n.produceWithPatches(c,function(f){return i.apply(void 0,[f].concat(u))})};var r,d,l=n.produce(i,o,function(c,a){r=c,d=a});return typeof Promise<"u"&&l instanceof Promise?l.then(function(c){return[c,r,d]}):[l,r,d]},typeof e?.useProxies=="boolean"&&this.setUseProxies(e.useProxies),typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=s.prototype;return t.createDraft=function(e){M(e)||p(8),P(e)&&(e=De(e));var n=xt(this),i=_t(this,e,void 0);return i[R].C=!0,ht(n),i},t.finishDraft=function(e,n){var i=e&&e[R],o=i.A;return rt(o,n),at(void 0,o)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!$t&&p(20),this.O=e},t.applyPatches=function(e,n){var i;for(i=n.length-1;i>=0;i--){var o=n[i];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}i>-1&&(n=n.slice(i+1));var r=L("Patches").$;return P(e)?r(e,n):this.produce(e,function(d){return r(d,n)})},s}(),S=new xe;S.produce;var Bt=S.produceWithPatches.bind(S);S.setAutoFreeze.bind(S);S.setUseProxies.bind(S);S.applyPatches.bind(S);S.createDraft.bind(S);S.finishDraft.bind(S);var V=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};gt();class Pe{constructor(t){this.messageBus=t}getItems(t){return V(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e){return V(this,void 0,void 0,function*(){let n;this.isItemArray(t)?n=t:n=yield this.getItems(t);const[i,o]=Bt(n,e),r=i.map(d=>({id:d.id,type:d.type}));for(const d of o){const[l,c]=d.path;typeof l=="number"&&typeof c=="string"&&(r[l][c]=i[l][c])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:r})})}addItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return V(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return V(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=n=>{t(n.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var $=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};gt();class Ge{constructor(t){this.messageBus=t}getItems(t){return $(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}updateItems(t,e,n){return $(this,void 0,void 0,function*(){const i=yield this.getItems(t),[o,r]=Bt(i,e),d=o.map(l=>({id:l.id,type:l.type}));for(const l of r){const[c,a]=l.path;typeof c=="number"&&typeof a=="string"&&(d[c][a]=o[c][a])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:d,fastUpdate:n})})}addItems(t){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return $(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return $(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=n=>{t(n.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var dt=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ue{constructor(t){this.messageBus=t,this.grid=new Ie(t),this.fog=new me(t),this.history=new Ne(t),this.items=new Pe(t),this.local=new Ge(t)}isReady(){return dt(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=n=>{t(n.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return dt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return dt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=n=>{t(n.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function j(s){return s.map(t=>Object.assign(Object.assign({},t),{icon:t.icon.startsWith("http")?t.icon:`${window.location.origin}${t.icon}`}))}function se(s){return Object.assign(Object.assign({},s),{url:s.url.startsWith("http")?s.url:`${window.location.origin}${s.url}`})}var Ht=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ve{constructor(t){this.contextMenus={},this.handleClick=e=>{const n=this.contextMenus[e.id];n&&n.onClick(e.context,e.elementId)},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return Ht(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:j(t.icons)}),this.contextMenus[t.id]=t})}remove(t){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var D=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class $e{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const n=this.tools[e.id];if(n)if(n.onClick){const i=n.onClick(e.context,e.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var n;const i=this.toolActions[e.id];i&&((n=i.onClick)===null||n===void 0||n.call(i,e.context,e.elementId))},this.handleToolModeClick=e=>{const n=this.toolModes[e.id];if(n)if(n.onClick){const i=n.onClick(e.context,e.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const n=this.toolModes[e.id];if(n)if(n.onToolClick){const i=n.onToolClick(e.context,e.event);Promise.resolve(i).then(o=>{o&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const n=this.toolModes[e.id];if(n)if(n.onToolDoubleClick){const i=n.onToolDoubleClick(e.context,e.event);Promise.resolve(i).then(o=>{o&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolDown)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolMove=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolMove)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolUp=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolUp)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolDragStart)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolDragMove)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolDragEnd)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onToolDragCancel)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeKeyDown=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onKeyDown)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeKeyUp=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onKeyUp)===null||n===void 0||n.call(i,e.context,e.event))},this.handleToolModeActivate=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onActivate)===null||n===void 0||n.call(i,e.context))},this.handleToolModeDeactivate=e=>{var n;const i=this.toolModes[e.id];i&&((n=i.onDeactivate)===null||n===void 0||n.call(i,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:j(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return D(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:j(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:j(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}}var H=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class He{constructor(t){this.messageBus=t}open(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},se(t)))})}close(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return H(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return H(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var Xt=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Xe{constructor(t){this.messageBus=t}open(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},se(t)))})}close(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var m=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class We{constructor(t){this.messageBus=t}getWidth(){return m(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return m(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return m(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return m(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return m(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return m(this,void 0,void 0,function*(){const e=j([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return m(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return m(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return m(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=n=>{t(n.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var ke=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};gt();class Fe{constructor(t){this.messageBus=t}startItemInteraction(t){return ke(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t});let n=t;return[r=>{const[d,l]=Bt(n,r);return n=d,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:e,patches:l}),d},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:e})}]})}}var je=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ye{constructor(t){this.messageBus=t}getPlayers(){return je(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=n=>{t(n.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var lt=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ke{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return lt(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return lt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=n=>{t(n.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=n=>{t(n.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var ze=globalThis&&globalThis.__awaiter||function(s,t,e,n){function i(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function d(a){try{c(n.next(a))}catch(u){r(u)}}function l(a){try{c(n.throw(a))}catch(u){r(u)}}function c(a){a.done?o(a.value):i(a.value).then(d,l)}c((n=n.apply(s,t||[])).next())})};class Ze{constructor(t){this.messageBus=t}getTheme(){return ze(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=n=>{t(n.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}class ne{constructor(t){this._item={createdUserId:t.id,id:te(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class qe extends ne{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}style(t){return this._style=t,this.self()}backgroundColor(t){return this._style.backgroundColor=t,this.self()}backgroundOpacity(t){return this._style.backgroundOpacity=t,this.self()}cornerRadius(t){return this._style.cornerRadius=t,this.self()}pointerWidth(t){return this._style.pointerWidth=t,this.self()}pointerHeight(t){return this._style.pointerHeight=t,this.self()}pointerDirection(t){return this._style.pointerDirection=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class Qe extends ne{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}const Je=typeof atob=="function",Rt=typeof Buffer=="function",Wt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",es=Array.prototype.slice.call(ts),q=(s=>{let t={};return s.forEach((e,n)=>t[e]=n),t})(es),ss=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,x=String.fromCharCode.bind(String),kt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):s=>new Uint8Array(Array.prototype.slice.call(s,0)),ie=s=>s.replace(/[^A-Za-z0-9\+\/]/g,""),ns=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,is=s=>{switch(s.length){case 4:var t=(7&s.charCodeAt(0))<<18|(63&s.charCodeAt(1))<<12|(63&s.charCodeAt(2))<<6|63&s.charCodeAt(3),e=t-65536;return x((e>>>10)+55296)+x((e&1023)+56320);case 3:return x((15&s.charCodeAt(0))<<12|(63&s.charCodeAt(1))<<6|63&s.charCodeAt(2));default:return x((31&s.charCodeAt(0))<<6|63&s.charCodeAt(1))}},os=s=>s.replace(ns,is),rs=s=>{if(s=s.replace(/\s+/g,""),!ss.test(s))throw new TypeError("malformed base64.");s+="==".slice(2-(s.length&3));let t,e="",n,i;for(let o=0;o<s.length;)t=q[s.charAt(o++)]<<18|q[s.charAt(o++)]<<12|(n=q[s.charAt(o++)])<<6|(i=q[s.charAt(o++)]),e+=n===64?x(t>>16&255):i===64?x(t>>16&255,t>>8&255):x(t>>16&255,t>>8&255,t&255);return e},oe=Je?s=>atob(ie(s)):Rt?s=>Buffer.from(s,"base64").toString("binary"):rs,as=Rt?s=>kt(Buffer.from(s,"base64")):s=>kt(oe(s).split("").map(t=>t.charCodeAt(0))),cs=Rt?s=>Buffer.from(s,"base64").toString("utf8"):Wt?s=>Wt.decode(as(s)):s=>os(oe(s)),us=s=>ie(s.replace(/[-_]/g,t=>t=="-"?"+":"/")),ds=s=>cs(us(s));function ls(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",n="";if(t){const o=ds(t).split(" ");o.length===2&&(e=o[0],n=o[1])}return{origin:e,roomId:n}}var Ft;(function(s){s[s.MOVE=0]="MOVE",s[s.LINE=1]="LINE",s[s.QUAD=2]="QUAD",s[s.CONIC=3]="CONIC",s[s.CUBIC=4]="CUBIC",s[s.CLOSE=5]="CLOSE"})(Ft||(Ft={}));const Tt=ls(),v=new Ae(Tt.origin,Tt.roomId),hs=new ce(v),St=new ae(v),fs=new Ye(v),_s=new ge(v),Es=new Ue(v),Os=new Ve(v),Ts=new $e(v),ys=new He(v),ps=new Xe(v),vs=new We(v),As=new Fe(v),gs=new Ke(v),ms=new Ze(v),Is={onReady:s=>{v.ready?s():v.once("OBR_READY",()=>s())},get isReady(){return v.ready},viewport:hs,player:St,party:fs,notification:_s,scene:Es,contextMenu:Os,tool:Ts,popover:ys,modal:ps,action:vs,interaction:As,room:gs,theme:ms,isAvailable:!!Tt.origin};function Ns(){return new qe(St)}function Bs(){return new Qe(St)}class h{static EXTENSIONID="com.battle-system.clash";static DISCORDID="com.battle-system.discord";static DICEWINDOW="com.battle-system.dicewindow";static EXTENSIONSUBMENUID="com.battle-system.clash-submenu";static EXTENSIONWHATSNEW="com.battle-system.clash-whatsnew";static EXTENSIONSCENEID="com.battle-system.clash-scene";static EXTENSIONLOGID="com.battle-system.clash-chatlog";static SETTINGSID="0be56e49-9551-40c1-8847-e620470c33dc";static MULTISHEETID="999999999";static LABEL="56d6b2c4-cd17-11ed-afa1-0242ac120002";static OPEN5EAPI="https://api.open5e.com/monsters/?format=json&search=";static OBRBLUE="rgba(30, 34, 49, 0.5)";static DICENOTATION=/(\d+)[dD](\d+)(.*)$/i;static DICEMODIFIER=/([+-])(\d+)/;static PARENTHESESMATCH=/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g;static PLUSMATCH=/\s(\+\d+)\s/g;static ALPHANUMERICTEXTMATCH=/\s[\da-zA-Z]$/;static VERSION="whatsnew-clash-202";static MAINAPP=document.querySelector("#clash-main-body-app");static MAINLOAD=document.querySelector("#clash-main-body-loading");static MAINDISABLED=document.querySelector("#clash-main-disabled");static MAINSETTINGS=document.querySelector("#clash-main-body-settings");static MAINLOG=document.querySelector("#clash-main-body-log");static BASELIST=`
    <div id="contextMenu" class="context-menu" style="display: none">
        <ul id="playerListing"></ul>
    </div>
    <table id="clashGMTable">
        <thead id="clashGMViewHeader">
            <tr class="row-view-header"></tr>
        </thead>
        <tbody id="clashGMViewBody"></tbody>
    </table>
    <footer id="ClashGMViewFooter">
        <div id="clashGMViewButtons">
            <table id="footerTable" class="no-line-height">
                <tr>
                    <td id="previousContainer"></td>
                    <td id="roundCounter" colspan="4"></td>
                    <td id="nextContainer"></td>
                </tr>
                <tr>
                    <td id="showLogContainer" colspan="3"></td>
                    <td id="settingsContainer" colspan="3"></td>
                </tr>
            </table>
        </div>
    </footer>
    `;static PLAYERLIST=`
    <table id="clashPLTable">
        <thead id="clashPLViewHeader">
            <tr class="row-view-header"></tr>
        </thead>
        <tbody id="clashPLViewBody"></tbody>
    </table>
    <footer id="ClashPLViewFooter">
        <div id="clashPLViewButtons">
            <table id="footerTable" class="no-line-height">
                <tr class="player-footer-row">
                    <td id="showLogContainer"></td>
                    <td id="roundCounter"></td>
                    <td id="disableAutoFocus">
                        <label class="switch" id="settingnoFocusContainer">
                            <span class="slider round"></span>
                        </label> AutoFocus
                    </td>
                </tr>
            </table>
        </div>
    </footer>
    `;static ROLLLOG=`
    <div id="logContainer">
        <section id="rollLogContainer" class="roll-log">
            <ul id="rollLog">
            </ul>
        </section>
        <footer>
            <span id="rollLogReturnContainer"></span>
        </footer>
    </div>`}class Rs{static HIDEHP=`${h.EXTENSIONID}/setting_hidehp`;static HIDEALL=`${h.EXTENSIONID}/setting_hideall`;static HIDEHPBAR=`${h.EXTENSIONID}/setting_hpbar`;static HIDEENEMYINFO=`${h.EXTENSIONID}/setting_hide_enemy_info`;static HPBARNUMBERS=`${h.EXTENSIONID}/setting_hpbar_numbers`;static DISABLELABEL=`${h.EXTENSIONID}/setting_disablelabel`;static DISABLEFOCUS=`${h.EXTENSIONID}/setting_disablefocus`;static REVERSELIST=`${h.EXTENSIONID}/setting_reverselist`;static RUMBLELOG=`${h.EXTENSIONID}/setting_rumblelog`;static VISUALDICE=`${h.EXTENSIONID}/setting_visualdice`;static DICENOTIFICATION=`${h.EXTENSIONID}/setting_dicenotification`;static DICEEVERYONE=`${h.EXTENSIONID}/setting_dicetoall`;static TURNTEXT=`${h.EXTENSIONID}/setting_turntext`;static HPROW=`${h.EXTENSIONID}/setting_hpcol`;static ROLLERROW=`${h.EXTENSIONID}/setting_rollercol`;static TEMPHPROW=`${h.EXTENSIONID}/setting_tempcol`;static ACROW=`${h.EXTENSIONID}/setting_accol`;static MOVEROW=`${h.EXTENSIONID}/setting_movecol`;static BLOCKROW=`${h.EXTENSIONID}/setting_blockcol`;static TURNCOUNT=`${h.EXTENSIONID}/setting_turncounter`;static ROUNDCOUNT=`${h.EXTENSIONID}/setting_roundcounter`}class Ss{static HPBAR=`${h.EXTENSIONID}/hpbar_active`;static ONLIST=`${h.EXTENSIONID}/clash`;static ID=`${h.EXTENSIONID}/clash_id`;static OWNERID=`${h.EXTENSIONID}/clash_ownerid`;static INITIATIVE=`${h.EXTENSIONID}/clash_initiative`;static ISMONSTER=`${h.EXTENSIONID}/clash_isMonster`;static TEMPHP=`${h.EXTENSIONID}/clash_tempHP`;static CURRENTHP=`${h.EXTENSIONID}/clash_currentHP`;static MAXHP=`${h.EXTENSIONID}/clash_maxHP`;static ARMORCLASS=`${h.EXTENSIONID}/clash_armorClass`;static UNITNAME=`${h.EXTENSIONID}/clash_unitName`;static UNITTYPE=`${h.EXTENSIONID}/clash_unitType`;static UNITSIZE=`${h.EXTENSIONID}/clash_unitSize`;static STRSCORE=`${h.EXTENSIONID}/clash_strScore`;static STRSAVE=`${h.EXTENSIONID}/clash_strSave`;static DEXSCORE=`${h.EXTENSIONID}/clash_dexScore`;static DEXSAVE=`${h.EXTENSIONID}/clash_dexSave`;static CONSCORE=`${h.EXTENSIONID}/clash_conScore`;static CONSAVE=`${h.EXTENSIONID}/clash_conSave`;static INTSCORE=`${h.EXTENSIONID}/clash_intScore`;static INTSAVE=`${h.EXTENSIONID}/clash_intSave`;static WISSCORE=`${h.EXTENSIONID}/clash_wisScore`;static WISSAVE=`${h.EXTENSIONID}/clash_wisSave`;static CHASCORE=`${h.EXTENSIONID}/clash_chaScore`;static CHASAVE=`${h.EXTENSIONID}/clash_chaSave`;static DAMAGEVULNERABILITIES=`${h.EXTENSIONID}/clash_damageVulnerabilities`;static DAMAGEIMMUNITIES=`${h.EXTENSIONID}/clash_damageImmunities`;static DAMAGERESISTANCES=`${h.EXTENSIONID}/clash_damageResistances`;static CONDITIONIMMUNITIES=`${h.EXTENSIONID}/clash_conditionImmunities`;static CHALLENGERATING=`${h.EXTENSIONID}/clash_challengeRating`;static EXPERIENCEPOINTS=`${h.EXTENSIONID}/clash_experiencePoints`;static ALIGNMENT=`${h.EXTENSIONID}/clash_alignment`;static STANDARDACTIONS=`${h.EXTENSIONID}/clash_standardActions`;static LEGENDARYACTIONS=`${h.EXTENSIONID}/clash_legendaryActions`;static SPECIALABILITIES=`${h.EXTENSIONID}/clash_specialAbilities`;static SPELLACTIONS=`${h.EXTENSIONID}/clash_spellActions`;static REACTIONS=`${h.EXTENSIONID}/clash_reactions`;static SPELLLIST=`${h.EXTENSIONID}/clash_spellList`;static SENSES=`${h.EXTENSIONID}/clash_senses`;static SKILLS=`${h.EXTENSIONID}/clash_skills`;static LANGUAGES=`${h.EXTENSIONID}/clash_languages`;static SPEEDWALK=`${h.EXTENSIONID}/clash_speedWalk`;static SPEEDFLY=`${h.EXTENSIONID}/clash_speedFly`;static SPEEDCLIMB=`${h.EXTENSIONID}/clash_speedClimb`;static SPEEDBURROW=`${h.EXTENSIONID}/clash_speedBurrow`;static SPEEDSWIM=`${h.EXTENSIONID}/clash_speedSwim`}export{h as C,Is as O,Rs as S,Ss as U,Bs as a,Ns as b};
