import{O as c,U as p,S as y,C as E}from"./clashConstants-0f9588e3.js";c.onReady(async()=>{const h=window.location.search,r=new URLSearchParams(h).get("unitid"),f=await c.scene.items.getItems([r]),C=await c.scene.getMetadata();if(f.length>0){const m=document.getElementById("clashEffectsTableBody"),u=document.getElementById("clashEffectsButtons"),s=f[0].metadata[p.EFFECTS],i=C[y.ROUNDCOUNT]??1;for(let t=0;t<5;t++)I(m,t);if(s?.length>0)for(let t=0;t<s.length;t++){const n=document.getElementById(`nameInput_${t}`),e=document.getElementById(`roundInput_${t}`),a=document.getElementById(`startInput_${t}`);n.value=s[t].Name,n.disabled=!0,n.dataset.name=s[t].Name,e.value=(s[t].EndingRound-i).toString(),e.disabled=!0,a.textContent=s[t].StartOfTurn,a.disabled=!0}const d=document.createElement("input");d.type="button",d.id="effectSaveButton",d.value="Save Effects",d.classList.add("footer-button"),d.title="Save all changes to effects",d.onclick=async function(){const t=[];for(let n=0;n<5;n++){const e=document.getElementById(`nameInput_${n}`),a=document.getElementById(`roundInput_${n}`),o=document.getElementById(`startInput_${n}`);if(e&&e.value!=="")if(e.disabled===!0){const l=s.find(g=>g.Name===e.value);l&&t.push(l)}else{const l={Name:e.value,EndingRound:i+(parseInt(a.value)??1),Rounds:parseInt(a.value)??1,StartOfTurn:o.textContent};t.push(l)}}t.length>0?await c.scene.items.updateItems([r],n=>{for(const e of n)e.metadata[p.EFFECTS]=t}):t.length===0&&s.length>0&&await c.scene.items.updateItems([r],n=>{for(const e of n)e.metadata[p.EFFECTS]=void 0}),await c.popover.close(E.EXTENSIONEFFECTSID)},u.appendChild(d)}else await c.popover.close(E.EXTENSIONEFFECTSID);function I(m,u){const s=m.insertRow(),i=s.insertCell(),d=s.insertCell(),t=s.insertCell(),n=s.insertCell(),e=document.createElement("input");e.type="text",e.id=`nameInput_${u}`,e.style.width="120px",e.style.height="20px",i.appendChild(e);const a=document.createElement("input");a.type="number",a.maxLength=2,a.width=2,a.style.width="40px",a.style.height="20px",a.id=`roundInput_${u}`,d.appendChild(a);const o=document.createElement("button");o.textContent="Start",o.style.width="100%",o.style.cursor="pointer",o.id=`startInput_${u}`,o.style.height="100%",o.onclick=()=>{o.textContent==="Start"?o.textContent="End":o.textContent="Start"},t.appendChild(o);const l=document.createElement("button");l.textContent="Clear",l.id=`clearButton_${u}`,l.style.height="100%",l.style.cursor="pointer",l.onclick=()=>{e.value="",e.disabled=!1,e.dataset.name="",a.value="",a.disabled=!1,o.textContent="Start",o.disabled=!1},n.appendChild(l)}});
