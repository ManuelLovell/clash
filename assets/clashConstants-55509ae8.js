(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();var v=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class re{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return v(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return v(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return v(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return v(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return v(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return v(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return v(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return v(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(t)>-1})}getConnectionId(){return v(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=s=>{t(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var R=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class le{constructor(t){this.messageBus=t}reset(){return R(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return R(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return R(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return R(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return R(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return R(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return R(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function ce(i){return typeof i.id=="string"}var gt={exports:{}},$=typeof Reflect=="object"?Reflect:null,Bt=$&&typeof $.apply=="function"?$.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},Z;$&&typeof $.ownKeys=="function"?Z=$.ownKeys:Object.getOwnPropertySymbols?Z=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Z=function(t){return Object.getOwnPropertyNames(t)};function he(i){console&&console.warn&&console.warn(i)}var Yt=Number.isNaN||function(t){return t!==t};function y(){y.init.call(this)}gt.exports=y;gt.exports.once=ye;y.EventEmitter=y;y.prototype._events=void 0;y.prototype._eventsCount=0;y.prototype._maxListeners=void 0;var Ct=10;function st(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return Ct},set:function(i){if(typeof i!="number"||i<0||Yt(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Ct=i}});y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};y.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Yt(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function jt(i){return i._maxListeners===void 0?y.defaultMaxListeners:i._maxListeners}y.prototype.getMaxListeners=function(){return jt(this)};y.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var o=t==="error",n=this._events;if(n!==void 0)o=o&&n.error===void 0;else if(!o)return!1;if(o){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var h=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw h.context=a,h}var u=n[t];if(u===void 0)return!1;if(typeof u=="function")Bt(u,this,e);else for(var l=u.length,r=Zt(u,l),s=0;s<l;++s)Bt(r[s],this,e);return!0};function Kt(i,t,e,s){var o,n,a;if(st(e),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),n=i._events),a=n[t]),a===void 0)a=n[t]=e,++i._eventsCount;else if(typeof a=="function"?a=n[t]=s?[e,a]:[a,e]:s?a.unshift(e):a.push(e),o=jt(i),o>0&&a.length>o&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=i,h.type=t,h.count=a.length,he(h)}return i}y.prototype.addListener=function(t,e){return Kt(this,t,e,!1)};y.prototype.on=y.prototype.addListener;y.prototype.prependListener=function(t,e){return Kt(this,t,e,!0)};function ue(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zt(i,t,e){var s={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},o=ue.bind(s);return o.listener=e,s.wrapFn=o,o}y.prototype.once=function(t,e){return st(e),this.on(t,zt(this,t,e)),this};y.prototype.prependOnceListener=function(t,e){return st(e),this.prependListener(t,zt(this,t,e)),this};y.prototype.removeListener=function(t,e){var s,o,n,a,h;if(st(e),o=this._events,o===void 0)return this;if(s=o[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(n=-1,a=s.length-1;a>=0;a--)if(s[a]===e||s[a].listener===e){h=s[a].listener,n=a;break}if(n<0)return this;n===0?s.shift():de(s,n),s.length===1&&(o[t]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",t,h||e)}return this};y.prototype.off=y.prototype.removeListener;y.prototype.removeAllListeners=function(t){var e,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var n=Object.keys(s),a;for(o=0;o<n.length;++o)a=n[o],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this};function qt(i,t,e){var s=i._events;if(s===void 0)return[];var o=s[t];return o===void 0?[]:typeof o=="function"?e?[o.listener||o]:[o]:e?fe(o):Zt(o,o.length)}y.prototype.listeners=function(t){return qt(this,t,!0)};y.prototype.rawListeners=function(t){return qt(this,t,!1)};y.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):Jt.call(i,t)};y.prototype.listenerCount=Jt;function Jt(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?Z(this._events):[]};function Zt(i,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=i[s];return e}function de(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function fe(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function ye(i,t){return new Promise(function(e,s){function o(a){i.removeListener(t,n),s(a)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",o),e([].slice.call(arguments))}Qt(i,t,n,{once:!0}),t!=="error"&&Ee(i,o,{once:!0})})}function Ee(i,t,e){typeof i.on=="function"&&Qt(i,"error",t,e)}function Qt(i,t,e,s){if(typeof i.on=="function")s.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function o(n){s.once&&i.removeEventListener(t,o),e(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var pe=gt.exports;let z;const me=new Uint8Array(16);function ge(){if(!z&&(z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!z))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return z(me)}const g=[];for(let i=0;i<256;++i)g.push((i+256).toString(16).slice(1));function _e(i,t=0){return g[i[t+0]]+g[i[t+1]]+g[i[t+2]]+g[i[t+3]]+"-"+g[i[t+4]]+g[i[t+5]]+"-"+g[i[t+6]]+g[i[t+7]]+"-"+g[i[t+8]]+g[i[t+9]]+"-"+g[i[t+10]]+g[i[t+11]]+g[i[t+12]]+g[i[t+13]]+g[i[t+14]]+g[i[t+15]]}const Te=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dt={randomUUID:Te};function te(i,t,e){if(Dt.randomUUID&&!t&&!i)return Dt.randomUUID();i=i||{};const s=i.random||(i.rng||ge)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(let o=0;o<16;++o)t[e+o]=s[o];return t}return _e(s)}class ve extends pe.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const o=s.data;if(s.origin===this.targetOrigin&&ce(o)){if(o.id==="OBR_READY"){this.ready=!0;const n=o.data;this.ref=n.ref,this.userId=n.userId}this.emit(o.id,o.data)}},this.send=(s,o,n)=>{var a;if(!this.ref)throw Error("Unable to send message: not ready");(a=window.parent)===null||a===void 0||a.postMessage({id:s,data:o,ref:this.ref,nonce:n},this.targetOrigin)},this.sendAsync=(s,o,n=5e3)=>{const a=`_${te()}`;return this.send(s,o,a),Promise.race([new Promise((h,u)=>{const l=this;function r(E){l.off(`${s}_RESPONSE${a}`,r),l.off(`${s}_ERROR${a}`,c),h(E)}function c(E){l.off(`${s}_RESPONSE${a}`,r),l.off(`${s}_ERROR${a}`,c),u(E)}this.on(`${s}_RESPONSE${a}`,r),this.on(`${s}_ERROR${a}`,c)}),new Promise((h,u)=>window.setTimeout(()=>u(new Error(`Message ${s} took longer than ${n}ms to get a result`)),n))])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Lt=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Oe{constructor(t){this.messageBus=t}show(t,e){return Lt(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return s})}close(t){return Lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var G=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Ie{constructor(t){this.messageBus=t}getColor(){return G(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return G(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return G(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=s=>{t(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var O=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class we{constructor(t){this.messageBus=t}getDpi(){return O(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return O(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return O(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return O(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return O(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return O(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return O(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return O(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,s){return O(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:s});return o})}getDistance(t,e){return O(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return s})}onChange(t){const e=s=>{t(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var q=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Se{constructor(t){this.messageBus=t}undo(){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return q(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return q(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}function _(i){for(var t=arguments.length,e=Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+i+(e.length?" "+e.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function x(i){return!!i&&!!i[b]}function D(i){var t;return!!i&&(function(e){if(!e||typeof e!="object")return!1;var s=Object.getPrototypeOf(e);if(s===null)return!0;var o=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===Le}(i)||Array.isArray(i)||!!i[W]||!!(!((t=i.constructor)===null||t===void 0)&&t[W])||ot(i)||nt(i))}function X(i,t,e){e===void 0&&(e=!1),L(i)===0?(e?Object.keys:St)(i).forEach(function(s){e&&typeof s=="symbol"||t(s,i[s],i)}):i.forEach(function(s,o){return t(o,s,i)})}function L(i){var t=i[b];return t?t.i>3?t.i-4:t.i:Array.isArray(i)?1:ot(i)?2:nt(i)?3:0}function j(i,t){return L(i)===2?i.has(t):Object.prototype.hasOwnProperty.call(i,t)}function Q(i,t){return L(i)===2?i.get(t):i[t]}function ee(i,t,e){var s=L(i);s===2?i.set(t,e):s===3?i.add(e):i[t]=e}function Ae(i,t){return i===t?i!==0||1/i==1/t:i!=i&&t!=t}function ot(i){return Ce&&i instanceof Map}function nt(i){return De&&i instanceof Set}function k(i){return i.o||i.t}function _t(i){if(Array.isArray(i))return Array.prototype.slice.call(i);var t=ke(i);delete t[b];for(var e=St(t),s=0;s<e.length;s++){var o=e[s],n=t[o];n.writable===!1&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[o]={configurable:!0,writable:!0,enumerable:n.enumerable,value:i[o]})}return Object.create(Object.getPrototypeOf(i),t)}function Tt(i,t){return t===void 0&&(t=!1),vt(i)||x(i)||!D(i)||(L(i)>1&&(i.set=i.add=i.clear=i.delete=be),Object.freeze(i),t&&X(i,function(e,s){return Tt(s,!0)},!0)),i}function be(){_(2)}function vt(i){return i==null||typeof i!="object"||Object.isFrozen(i)}function C(i){var t=Et[i];return t||_(18,i),t}function Ne(i,t){Et[i]||(Et[i]=t)}function kt(){return K}function at(i,t){t&&(C("Patches"),i.u=[],i.s=[],i.v=t)}function tt(i){dt(i),i.p.forEach(Re),i.p=null}function dt(i){i===K&&(K=i.l)}function Mt(i){return K={p:[],l:K,h:i,m:!0,_:0}}function Re(i){var t=i[b];t.i===0||t.i===1?t.j():t.g=!0}function rt(i,t){t._=t.p.length;var e=t.p[0],s=i!==void 0&&i!==e;return t.h.O||C("ES5").S(t,i,s),s?(e[b].P&&(tt(t),_(4)),D(i)&&(i=et(t,i),t.l||it(t,i)),t.u&&C("Patches").M(e[b].t,i,t.u,t.s)):i=et(t,e,[]),tt(t),t.u&&t.v(t.u,t.s),i!==wt?i:void 0}function et(i,t,e){if(vt(t))return t;var s=t[b];if(!s)return X(t,function(h,u){return xt(i,s,t,h,u,e)},!0),t;if(s.A!==i)return t;if(!s.P)return it(i,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=s.i===4||s.i===5?s.o=_t(s.k):s.o,n=o,a=!1;s.i===3&&(n=new Set(o),o.clear(),a=!0),X(n,function(h,u){return xt(i,s,o,h,u,e,a)}),it(i,o,!1),e&&i.u&&C("Patches").N(s,e,i.u,i.s)}return s.o}function xt(i,t,e,s,o,n,a){if(x(o)){var h=et(i,o,n&&t&&t.i!==3&&!j(t.R,s)?n.concat(s):void 0);if(ee(e,s,h),!x(h))return;i.m=!1}else a&&e.add(o);if(D(o)&&!vt(o)){if(!i.h.D&&i._<1)return;et(i,o),t&&t.A.l||it(i,o)}}function it(i,t,e){e===void 0&&(e=!1),!i.l&&i.h.D&&i.m&&Tt(t,e)}function lt(i,t){var e=i[b];return(e?k(e):i)[t]}function Pt(i,t){if(t in i)for(var e=Object.getPrototypeOf(i);e;){var s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Object.getPrototypeOf(e)}}function ft(i){i.P||(i.P=!0,i.l&&ft(i.l))}function ct(i){i.o||(i.o=_t(i.t))}function yt(i,t,e){var s=ot(t)?C("MapSet").F(t,e):nt(t)?C("MapSet").T(t,e):i.O?function(o,n){var a=Array.isArray(o),h={i:a?1:0,A:n?n.A:kt(),P:!1,I:!1,R:{},l:n,t:o,k:null,o:null,j:null,C:!1},u=h,l=pt;a&&(u=[h],l=F);var r=Proxy.revocable(u,l),c=r.revoke,E=r.proxy;return h.k=E,h.j=c,E}(t,e):C("ES5").J(t,e);return(e?e.A:kt()).p.push(s),s}function Be(i){return x(i)||_(22,i),function t(e){if(!D(e))return e;var s,o=e[b],n=L(e);if(o){if(!o.P&&(o.i<4||!C("ES5").K(o)))return o.t;o.I=!0,s=Gt(e,n),o.I=!1}else s=Gt(e,n);return X(s,function(a,h){o&&Q(o.t,a)===h||ee(s,a,t(h))}),n===3?new Set(s):s}(i)}function Gt(i,t){switch(t){case 2:return new Map(i);case 3:return Array.from(i)}return _t(i)}function Ot(){function i(s){if(!D(s))return s;if(Array.isArray(s))return s.map(i);if(ot(s))return new Map(Array.from(s.entries()).map(function(a){return[a[0],i(a[1])]}));if(nt(s))return new Set(Array.from(s).map(i));var o=Object.create(Object.getPrototypeOf(s));for(var n in s)o[n]=i(s[n]);return j(s,W)&&(o[W]=s[W]),o}function t(s){return x(s)?i(s):s}var e="add";Ne("Patches",{$:function(s,o){return o.forEach(function(n){for(var a=n.path,h=n.op,u=s,l=0;l<a.length-1;l++){var r=L(u),c=a[l];typeof c!="string"&&typeof c!="number"&&(c=""+c),r!==0&&r!==1||c!=="__proto__"&&c!=="constructor"||_(24),typeof u=="function"&&c==="prototype"&&_(24),typeof(u=Q(u,c))!="object"&&_(15,a.join("/"))}var E=L(u),f=i(n.value),p=a[a.length-1];switch(h){case"replace":switch(E){case 2:return u.set(p,f);case 3:_(16);default:return u[p]=f}case e:switch(E){case 1:return p==="-"?u.push(f):u.splice(p,0,f);case 2:return u.set(p,f);case 3:return u.add(f);default:return u[p]=f}case"remove":switch(E){case 1:return u.splice(p,1);case 2:return u.delete(p);case 3:return u.delete(n.value);default:return delete u[p]}default:_(17,h)}}),s},N:function(s,o,n,a){switch(s.i){case 0:case 4:case 2:return function(h,u,l,r){var c=h.t,E=h.o;X(h.R,function(f,p){var m=Q(c,f),w=Q(E,f),S=p?j(c,f)?"replace":e:"remove";if(m!==w||S!=="replace"){var A=u.concat(f);l.push(S==="remove"?{op:S,path:A}:{op:S,path:A,value:w}),r.push(S===e?{op:"remove",path:A}:S==="remove"?{op:e,path:A,value:t(m)}:{op:"replace",path:A,value:t(m)})}})}(s,o,n,a);case 5:case 1:return function(h,u,l,r){var c=h.t,E=h.R,f=h.o;if(f.length<c.length){var p=[f,c];c=p[0],f=p[1];var m=[r,l];l=m[0],r=m[1]}for(var w=0;w<c.length;w++)if(E[w]&&f[w]!==c[w]){var S=u.concat([w]);l.push({op:"replace",path:S,value:t(f[w])}),r.push({op:"replace",path:S,value:t(c[w])})}for(var A=c.length;A<f.length;A++){var P=u.concat([A]);l.push({op:e,path:P,value:t(f[A])})}c.length<f.length&&r.push({op:"replace",path:u.concat(["length"]),value:c.length})}(s,o,n,a);case 3:return function(h,u,l,r){var c=h.t,E=h.o,f=0;c.forEach(function(p){if(!E.has(p)){var m=u.concat([f]);l.push({op:"remove",path:m,value:p}),r.unshift({op:e,path:m,value:p})}f++}),f=0,E.forEach(function(p){if(!c.has(p)){var m=u.concat([f]);l.push({op:e,path:m,value:p}),r.unshift({op:"remove",path:m,value:p})}f++})}(s,o,n,a)}},M:function(s,o,n,a){n.push({op:"replace",path:[],value:o===wt?void 0:o}),a.push({op:"replace",path:[],value:s})}})}var Ut,K,It=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Ce=typeof Map<"u",De=typeof Set<"u",Vt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",wt=It?Symbol.for("immer-nothing"):((Ut={})["immer-nothing"]=!0,Ut),W=It?Symbol.for("immer-draftable"):"__$immer_draftable",b=It?Symbol.for("immer-state"):"__$immer_state",Le=""+Object.prototype.constructor,St=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Object.getOwnPropertyNames,ke=Object.getOwnPropertyDescriptors||function(i){var t={};return St(i).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(i,e)}),t},Et={},pt={get:function(i,t){if(t===b)return i;var e=k(i);if(!j(e,t))return function(o,n,a){var h,u=Pt(n,a);return u?"value"in u?u.value:(h=u.get)===null||h===void 0?void 0:h.call(o.k):void 0}(i,e,t);var s=e[t];return i.I||!D(s)?s:s===lt(i.t,t)?(ct(i),i.o[t]=yt(i.A.h,s,i)):s},has:function(i,t){return t in k(i)},ownKeys:function(i){return Reflect.ownKeys(k(i))},set:function(i,t,e){var s=Pt(k(i),t);if(s?.set)return s.set.call(i.k,e),!0;if(!i.P){var o=lt(k(i),t),n=o?.[b];if(n&&n.t===e)return i.o[t]=e,i.R[t]=!1,!0;if(Ae(e,o)&&(e!==void 0||j(i.t,t)))return!0;ct(i),ft(i)}return i.o[t]===e&&(e!==void 0||t in i.o)||Number.isNaN(e)&&Number.isNaN(i.o[t])||(i.o[t]=e,i.R[t]=!0),!0},deleteProperty:function(i,t){return lt(i.t,t)!==void 0||t in i.t?(i.R[t]=!1,ct(i),ft(i)):delete i.R[t],i.o&&delete i.o[t],!0},getOwnPropertyDescriptor:function(i,t){var e=k(i),s=Reflect.getOwnPropertyDescriptor(e,t);return s&&{writable:!0,configurable:i.i!==1||t!=="length",enumerable:s.enumerable,value:e[t]}},defineProperty:function(){_(11)},getPrototypeOf:function(i){return Object.getPrototypeOf(i.t)},setPrototypeOf:function(){_(12)}},F={};X(pt,function(i,t){F[i]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),F.deleteProperty=function(i,t){return F.set.call(this,i,t,void 0)},F.set=function(i,t,e){return pt.set.call(this,i[0],t,e,i[0])};var Me=function(){function i(e){var s=this;this.O=Vt,this.D=!0,this.produce=function(o,n,a){if(typeof o=="function"&&typeof n!="function"){var h=n;n=o;var u=s;return function(m){var w=this;m===void 0&&(m=h);for(var S=arguments.length,A=Array(S>1?S-1:0),P=1;P<S;P++)A[P-1]=arguments[P];return u.produce(m,function(ae){var Rt;return(Rt=n).call.apply(Rt,[w,ae].concat(A))})}}var l;if(typeof n!="function"&&_(6),a!==void 0&&typeof a!="function"&&_(7),D(o)){var r=Mt(s),c=yt(s,o,void 0),E=!0;try{l=n(c),E=!1}finally{E?tt(r):dt(r)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(m){return at(r,a),rt(m,r)},function(m){throw tt(r),m}):(at(r,a),rt(l,r))}if(!o||typeof o!="object"){if((l=n(o))===void 0&&(l=o),l===wt&&(l=void 0),s.D&&Tt(l,!0),a){var f=[],p=[];C("Patches").M(o,l,f,p),a(f,p)}return l}_(21,o)},this.produceWithPatches=function(o,n){if(typeof o=="function")return function(l){for(var r=arguments.length,c=Array(r>1?r-1:0),E=1;E<r;E++)c[E-1]=arguments[E];return s.produceWithPatches(l,function(f){return o.apply(void 0,[f].concat(c))})};var a,h,u=s.produce(o,n,function(l,r){a=l,h=r});return typeof Promise<"u"&&u instanceof Promise?u.then(function(l){return[l,a,h]}):[u,a,h]},typeof e?.useProxies=="boolean"&&this.setUseProxies(e.useProxies),typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=i.prototype;return t.createDraft=function(e){D(e)||_(8),x(e)&&(e=Be(e));var s=Mt(this),o=yt(this,e,void 0);return o[b].C=!0,dt(s),o},t.finishDraft=function(e,s){var o=e&&e[b],n=o.A;return at(n,s),rt(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!Vt&&_(20),this.O=e},t.applyPatches=function(e,s){var o;for(o=s.length-1;o>=0;o--){var n=s[o];if(n.path.length===0&&n.op==="replace"){e=n.value;break}}o>-1&&(s=s.slice(o+1));var a=C("Patches").$;return x(e)?a(e,s):this.produce(e,function(h){return a(h,s)})},i}(),N=new Me;N.produce;var At=N.produceWithPatches.bind(N);N.setAutoFreeze.bind(N);N.setUseProxies.bind(N);N.applyPatches.bind(N);N.createDraft.bind(N);N.finishDraft.bind(N);var U=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};Ot();class xe{constructor(t){this.messageBus=t}getItems(t){return U(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e){return U(this,void 0,void 0,function*(){let s;this.isItemArray(t)?s=t:s=yield this.getItems(t);const[o,n]=At(s,e),a=o.map(h=>({id:h.id,type:h.type}));for(const h of n){const[u,l]=h.path;typeof u=="number"&&typeof l=="string"&&(a[u][l]=o[u][l])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:a})})}addItems(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return U(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return U(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var V=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};Ot();class Pe{constructor(t){this.messageBus=t}getItems(t){return V(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}updateItems(t,e,s){return V(this,void 0,void 0,function*(){const o=yield this.getItems(t),[n,a]=At(o,e),h=n.map(u=>({id:u.id,type:u.type}));for(const u of a){const[l,r]=u.path;typeof l=="number"&&typeof r=="string"&&(h[l][r]=n[l][r])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:h,fastUpdate:s})})}addItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return V(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return V(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var ht=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Ge{constructor(t){this.messageBus=t,this.grid=new we(t),this.fog=new Ie(t),this.history=new Se(t),this.items=new xe(t),this.local=new Pe(t)}isReady(){return ht(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=s=>{t(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return ht(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function Y(i){return i.map(t=>Object.assign(Object.assign({},t),{icon:t.icon.startsWith("http")?t.icon:`${window.location.origin}${t.icon}`}))}function ie(i){return Object.assign(Object.assign({},i),{url:i.url.startsWith("http")?i.url:`${window.location.origin}${i.url}`})}var Ht=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Ue{constructor(t){this.contextMenus={},this.handleClick=e=>{const s=this.contextMenus[e.id];s&&s.onClick(e.context,e.elementId)},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return Ht(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:Y(t.icons)}),this.contextMenus[t.id]=t})}remove(t){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var B=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Ve{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const s=this.tools[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(n=>{n&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var s;const o=this.toolActions[e.id];o&&((s=o.onClick)===null||s===void 0||s.call(o,e.context,e.elementId))},this.handleToolModeClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(n=>{n&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolClick){const o=s.onToolClick(e.context,e.event);Promise.resolve(o).then(n=>{n&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolDoubleClick){const o=s.onToolDoubleClick(e.context,e.event);Promise.resolve(o).then(n=>{n&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragStart)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragEnd)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragCancel)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeActivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onActivate)===null||s===void 0||s.call(o,e.context))},this.handleToolModeDeactivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onDeactivate)===null||s===void 0||s.call(o,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:Y(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return B(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:Y(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:Y(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}}var H=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class He{constructor(t){this.messageBus=t}open(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ie(t)))})}close(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return H(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return H(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var $t=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class $e{constructor(t){this.messageBus=t}open(t){return $t(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ie(t)))})}close(t){return $t(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var I=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Xe{constructor(t){this.messageBus=t}getWidth(){return I(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return I(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return I(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return I(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return I(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return I(this,void 0,void 0,function*(){const e=Y([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return I(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return I(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=s=>{t(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var Fe=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};Ot();class We{constructor(t){this.messageBus=t}startItemInteraction(t){return Fe(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t});let s=t;return[a=>{const[h,u]=At(s,a);return s=h,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:e,patches:u}),h},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:e})}]})}}var Ye=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class je{constructor(t){this.messageBus=t}getPlayers(){return Ye(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=s=>{t(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var ut=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class Ke{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return ut(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return ut(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=s=>{t(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var ze=globalThis&&globalThis.__awaiter||function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function h(r){try{l(s.next(r))}catch(c){a(c)}}function u(r){try{l(s.throw(r))}catch(c){a(c)}}function l(r){r.done?n(r.value):o(r.value).then(h,u)}l((s=s.apply(i,t||[])).next())})};class qe{constructor(t){this.messageBus=t}getTheme(){return ze(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=s=>{t(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}class se{constructor(t){this._item={createdUserId:t.id,id:te(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class Je extends se{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}style(t){return this._style=t,this.self()}backgroundColor(t){return this._style.backgroundColor=t,this.self()}backgroundOpacity(t){return this._style.backgroundOpacity=t,this.self()}cornerRadius(t){return this._style.cornerRadius=t,this.self()}pointerWidth(t){return this._style.pointerWidth=t,this.self()}pointerHeight(t){return this._style.pointerHeight=t,this.self()}pointerDirection(t){return this._style.pointerDirection=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class Ze extends se{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}const Qe=typeof atob=="function",bt=typeof Buffer=="function",Xt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const ti="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ei=Array.prototype.slice.call(ti),J=(i=>{let t={};return i.forEach((e,s)=>t[e]=s),t})(ei),ii=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,M=String.fromCharCode.bind(String),Ft=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),oe=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),si=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,oi=i=>{switch(i.length){case 4:var t=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),e=t-65536;return M((e>>>10)+55296)+M((e&1023)+56320);case 3:return M((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return M((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},ni=i=>i.replace(si,oi),ai=i=>{if(i=i.replace(/\s+/g,""),!ii.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let t,e="",s,o;for(let n=0;n<i.length;)t=J[i.charAt(n++)]<<18|J[i.charAt(n++)]<<12|(s=J[i.charAt(n++)])<<6|(o=J[i.charAt(n++)]),e+=s===64?M(t>>16&255):o===64?M(t>>16&255,t>>8&255):M(t>>16&255,t>>8&255,t&255);return e},ne=Qe?i=>atob(oe(i)):bt?i=>Buffer.from(i,"base64").toString("binary"):ai,ri=bt?i=>Ft(Buffer.from(i,"base64")):i=>Ft(ne(i).split("").map(t=>t.charCodeAt(0))),li=bt?i=>Buffer.from(i,"base64").toString("utf8"):Xt?i=>Xt.decode(ri(i)):i=>ni(ne(i)),ci=i=>oe(i.replace(/[-_]/g,t=>t=="-"?"+":"/")),hi=i=>li(ci(i));function ui(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",s="";if(t){const n=hi(t).split(" ");n.length===2&&(e=n[0],s=n[1])}return{origin:e,roomId:s}}var Wt;(function(i){i[i.MOVE=0]="MOVE",i[i.LINE=1]="LINE",i[i.QUAD=2]="QUAD",i[i.CONIC=3]="CONIC",i[i.CUBIC=4]="CUBIC",i[i.CLOSE=5]="CLOSE"})(Wt||(Wt={}));const mt=ui(),T=new ve(mt.origin,mt.roomId),di=new le(T),Nt=new re(T),fi=new je(T),yi=new Oe(T),Ei=new Ge(T),pi=new Ue(T),mi=new Ve(T),gi=new He(T),_i=new $e(T),Ti=new Xe(T),vi=new We(T),Oi=new Ke(T),Ii=new qe(T),wi={onReady:i=>{T.ready?i():T.once("OBR_READY",()=>i())},get isReady(){return T.ready},viewport:di,player:Nt,party:fi,notification:yi,scene:Ei,contextMenu:pi,tool:mi,popover:gi,modal:_i,action:Ti,interaction:vi,room:Oi,theme:Ii,isAvailable:!!mt.origin};function Si(){return new Je(Nt)}function Ai(){return new Ze(Nt)}class d{static VERSION="whatsnew-clash-240";static EXTENSIONID="com.battle-system.clash";static DISCORDID="com.battle-system.discord";static DICEWINDOW="com.battle-system.dicewindow";static BONESID="com.battle-system.bones";static EXTENSIONSUBMENUID="com.battle-system.clash-submenu";static EXTENSIONEFFECTSID="com.battle-system.clash-effects";static EXTENSIONWHATSNEW="com.battle-system.clash-whatsnew";static EXTENSIONSCENEID="com.battle-system.clash-scene";static EXTENSIONLOGID="com.battle-system.clash-chatlog";static SETTINGSID="0be56e49-9551-40c1-8847-e620470c33dc";static MULTISHEETID="999999999";static LABEL="56d6b2c4-cd17-11ed-afa1-0242ac120002";static OPEN5EAPI="https://api.open5e.com/monsters/?format=json&search=";static OBRBLUE="rgba(30, 34, 49, 0.5)";static DICENOTATION=/(\d+)[dD](\d+)(.*)$/i;static DICEMODIFIER=/([+-])(\d+)/;static PARENTHESESMATCH=/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g;static PLUSMATCH=/\s?((?<!\d)\+\d+)\s?/g;static ALPHANUMERICTEXTMATCH=/\s[\da-zA-Z]$/;static MAINAPP=document.querySelector("#clash-main-body-app");static MAINLOAD=document.querySelector("#clash-main-body-loading");static MAINDISABLED=document.querySelector("#clash-main-disabled");static MAINSETTINGS=document.querySelector("#clash-main-body-settings");static MAINHELP=document.querySelector("#clash-main-body-help");static MAINLOG=document.querySelector("#clash-main-body-log");static ADJECTIVES=["Grizzled","Wily","Stoic","Mellow","Pensive","Shrewd","Cautious","Hardy","Nimble","Tenacious","Gritty","Tolerant","Hardy","Adroit","Resilient","Slight","Stout","Durable","Subtle","Sober","Clever","Brave","Calm","Wise","Cunning","Alert","Swift","Agile","Loyal","Sturdy","Stable","Sneaky","Clever","Resourceful","Shady","Stalwart","Vigilant","Staunch","Fierce","Vigorous","Robust","Fearless","Dauntless","Resolute","Sagacious","Prudent","Judicious","Astute","Savvy","Sharp","Quick","Witty","Smart","Snippy","Crafty","Deft","Sly","Artful","Clever","Sneering","Tough","Rugged","Solid","Strong","Sturdy","Tough","Gritty","Rough","Hardened","Burly","Muscular","Brawny","Rowdy","Forceful","Snorting","Potent","Martial","Speckled","Mottled","Disheveled"];static BASELIST=`
    <div id="contextMenu" class="context-menu" style="display: none">
        <ul id="playerListing"></ul>
    </div>
    <table id="clashGMTable">
        <thead id="clashGMViewHeader">
            <tr class="row-view-header"></tr>
        </thead>
        <tbody id="clashGMViewBody"></tbody>
    </table>
    <footer id="ClashGMViewFooter">
        <div id="clashGMViewButtons">
            <table id="footerTable" class="no-line-height">
                <tr>
                    <td id="previousContainer"></td>
                    <td id="roundCounter" colspan="4"></td>
                    <td id="nextContainer"></td>
                </tr>
                <tr>
                    <td id="showLogContainer" colspan="2"></td>
                    <td id="showHelpContainer" colspan="2"></td>
                    <td id="settingsContainer" colspan="2"></td>
                </tr>
            </table>
        </div>
    </footer>
    `;static PLAYERLIST=`
    <table id="clashPLTable">
        <thead id="clashPLViewHeader">
            <tr class="row-view-header"></tr>
        </thead>
        <tbody id="clashPLViewBody"></tbody>
    </table>
    <footer id="ClashPLViewFooter">
        <div id="clashPLViewButtons">
            <table id="footerTable" class="no-line-height">
                <tr class="player-footer-row">
                    <td id="showLogContainer"></td>
                    <td id="showHelpContainer"></td>
                    <td id="roundCounter"></td>
                    <td id="disableAutoFocus">
                        <label class="switch" id="settingnoFocusContainer">
                            <span class="slider round"></span>
                        </label> AutoFocus
                    </td>
                </tr>
            </table>
        </div>
    </footer>
    `;static ROLLLOG=`
    <div id="logContainer">
        <section id="rollLogContainer" class="roll-log">
            <ul id="rollLog">
            </ul>
        </section>
        <footer>
            <span id="rollLogReturnContainer"></span>
        </footer>
    </div>`;static MARKDOWNHELP=`
<a id="clash"></a><h1 style="text-align: center;">Clash! Help</h1>
<details open>
  <summary>Table of Contents</summary>
  <ol>
    <li><a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#start-token">Adding a token to the List</a></li>
        <li><a href="#start-remove">Removing a token from the List</a></li>
        <li><a href="#start-stats">Adding stats to a token</a></li>
        <li><a href="#start-turns">Changing Turns and Resetting the List</a></li>
      </ul></li>
      <li><a href="#using-the-stat-blocks">Using the Stat Blocks</a>
      <ul>
        <li><a href="#stat-values">Editting Values</a></li>
        <li><a href="#stat-dice">Adding Clickable Dice Values</a></li>
        <li><a href="#stat-skills">Adding Skills to the Block</a></li>
        <li><a href="#stat-buttons">Stat Block Buttons</a></li>
      </ul></li>
      <li><a href="#importing-stat-blocks">Importing Stat Blocks</a>
      <ul>
        <li><a href="#import-open">Importing monster info from Open5e</a></li>
        <li><a href="#import-json">Importing monster info from Custom JSON</a></li>
        <li><a href="#import-chatgpt">Importing monster info from ChatGPT</a></li>
      </ul></li>
       <li><a href="#using-the-collectionsearch">Using the Collection/Search</a>
      <ul>
        <li><a href="#search-save">Saving a monster to your Collection</a></li>
        <li><a href="#search-load">Loading monster from your Collection</a></li>
        <li><a href="#search-remove">Removing a monster from your Collection</a></li>
        <li><a href="#search-favorite">How favorites work in your Collection</a></li>
      </ul></li>
      <li><a href="#using-the-effects-column">Using the Effects Column</a>
      <ul>
        <li><a href="#effects-setup">Setting an Effect</a></li>
        <li><a href="#effects-work">How Effects work</a></li>
      </ul></li>
      <li><a href="#navigating-the-settings-page">Navigating the Settings Page</a>
      <ul>
        <li><a href="#settings-backups">Backing Up/Loading and Deleting your Collection</a></li>
        <li><a href="#settings-clearlist">Difference between Resetting the List and Clearing it</a></li>
        <li><a href="#settings-configuration">Configuring your Combat Tracker Columns</a></li>
        <li><a href="#settings-playerview">Controlling the Player View</a></li>
      </ul></li>
      <li><a href="#configuring-how-dice-work">Configuring how Dice work</a>
      <ul>
        <li><a href="#dice-rumble">Rumble! Integration</a></li>
        <li><a href="#dice-bones">Bones! Integration</a></li>
        <li><a href="#dice-clash">Self-View-Only Clash 3d Rolls</a></li>
        <li><a href="#dice-text">Text Results</a></li>
        <li><a href="#dice-discord">Discord Logging</a></li>
      </ul></li>
    <li><a href="#player-input">Player Input</a></li>
    <ul>
        <li><a href="#player-values">Updating Values as a Player</a></li>
        <li><a href="#player-focus">Toggling Auto-Focus for Turn Changes</a></li>
        <li><a href="#player-why">Why Players cannot see/use Stat Blocks</a></li>
      </ul>
    <li><a href="#tips-and-tricks">Tips and Tricks</a></li>
    <ul>
        <li><a href="#tip-math">Quick-Math!</a></li>
        <li><a href="#tip-autoload">Auto-Loading Stats for a Token</a></li>
        <li><a href="#tip-mass">Mass Edit a group of tokens at one time</a></li>
        <li><a href="#tip-assign">Assigning Token Owner through Clash!</a></li>
        <li><a href="#tip-group">Group-Roll Initiative for 'Monsters'</a></li>
      </ul>
    <li><a href="#support">Support</a></li>
  </ol>
</details>


## Getting Started
#### <a id="start-token"></a>1.  Adding a token to the list
When you first open up a fresh scene, your List will be blank.  To get some units on the list, you will need to drag the tokens into the scene and then right-click that token.  This will open up the context menu, and from there you can click 'Add to Initiative'.
<i>Note: All information for tokens in-play are saved to the scene in Clash.</i>
From here, you can freely edit any of the values on the list - directly on the list. Just start typing, and Clash will save as you go. If you want a quick-way to roll initiative, just click the dice icon next to the unit's name and it will roll a D20 (Or whatever dice type you specified in settings) for you!
<i> Note: As a helpful shortcut, double-clicking on a unit in the list will focus the camera on wherever that token is.</i>
![color view](https://battle-system.com/owlbear/clash-docs/clash-start-token.png)
#### <a id="start-token"></a>2.  Removing a token from the list
Once a token has been added to the List, the same button on the context menu will be replaced with a "Remove from List".
You can also right-click the unit in the List itself and select 'Remove Unit'.
![color view](https://battle-system.com/owlbear/clash-docs/clash-start-remove.png)
#### <a id="start-stats"></a>3.  Adding stats to a token
Suppose you want to start adding some information to a token - in the form of a stat block.  If the unit has been added to the list, you can click the right-triangle to open up that unit's stat block. You can also right-click a token and select 'View Info' - even if the unit is not on the list. This is a mini-window showing all information for that particular token.

![color view](https://battle-system.com/owlbear/clash-docs/clash-start-stats.png)
Unlike the Combat Tracker List, this does not auto-save as you edit information. So be sure to click the Save button when you are done editing (the DISK icon in the top right).

![color view](https://battle-system.com/owlbear/clash-docs/clash-start-stats-two.png)

#### <a id="start-turns"></a>4. Changing Turns and Resetting the List
You can change the current turn by clicking on the 'Next' button. (Or 'Previous' if you goofed up.)
If you have not disabled Camera Focus in the settings, your camera should shift to that unit.
If you have not disabled the Turn Label in the settings, your turn-message-label should point to that unit.
If you are using effects, this will increment it's counter that it uses to check if it's expired or not.

When you are done with combat, or just simply want to start fresh - you can click Settings and 'Reset Initiative List'.  This will put all HP back to maximum and reset all initiative's to one.
![color view](https://battle-system.com/owlbear/clash-docs/clash-start-turns.png)
<p align="right">(<a href="#clash">back to top</a>)</p>

## Using the Stat Blocks
#### <a id="stat-values"></a>1.  Editing Values
You should be able to edit any value in white. For certain values (Like Ability Scores or Saving Throws) you will need to right-click (Or long-press on mobile) to click "Edit Value".  That is because these values are 'Rollable Values' that when normally clicked will perform a roll instead!
![color view](https://battle-system.com/owlbear/clash-docs/clash-stat-values.png)
#### <a id="stat-dice"></a>2.  Adding Clickable Dice Values
For the Ability Scores and Saving Throws, simply clicking 'Edit Value' and changing the number is all the updating you'll need.  No need for roller syntax here to make them work.  For all else...
##### Roller Buttons/Syntax 
If you want to add those types of clickable values to your Actions, you can do so in the format of dice notation.
For damage/checks rolls:  (#d#) or (#d# + #) - For example (1d4) or (2d6 + 2).  The parenthesis are needed.
For attack rolls: Just PLUS and the number.  For example, +10. No parenthesis. This will roll a 1d20+10.
If you click away from the field you are editing, the card should refresh and your roller button will be available.
![color view](https://battle-system.com/owlbear/clash-docs/clash-stat-dice.png)
#### <a id="stat-skills"></a>3.  Adding Skills to the block
You can add as many skills as you want to the stat block using the Plus icon next to each header. This will add a new item to each category, with a Name and Description input.  
<i> Note: If you added one too many, just <b>delete</b> the text in the name/description inputs and it'll go away after saving.</i>
![color view](https://battle-system.com/owlbear/clash-docs/clash-stat-skills.png)
#### <a id="stat-buttons"></a>4.  Stat Block Buttons
There are a few buttons at the top of each stat-block to manipulate them.
![color view](https://battle-system.com/owlbear/clash-docs/clash-stat-buttons.png)
1. The Pin: This will 'pin' the stat block window to the top right of the screen, for easy access in case you need to reference the block often.  Only one window can be pinned at a time, and they can't be dragged around (limitation I can't do anything about currently).
2. The Favorite Button: This will toggle the 'Favorite' on a stat-block, so that when it is saved to the collection it will be in the Favorites section. (Which in short means it'll always be shown in the Search list, without needing to search for quick reference).
3. The Save-To-Collection Button: This will save the current unit's Stat Block to your collection, where you will be able to access it via Search.  There are benefits to having an item in your collection, like Auto-Loading and Easy Importing.
4. The Export to JSON Button: This will copy a JSON block of the current unit's stat block to your clipboard.  From there you can send it to someone else, or paste it into a text editor so that you may freely edit it.  You can re-import JSON items via the Import Custom JSON button below.
5. The Save Button: This saves your block information.  Be sure to save before closing the window, or else your changes will be lost.
6. The Close Button: The stat blocks do not close when you click away (To avoid randomly losing data), so use this to close the window.
<p align="right">(<a href="#clash">back to top</a>)</p>

## Importing the Stat Blocks
#### <a id="import-open"></a>1. Importing from Open5e
To access the Open5e search data, click on 'Search Monster Data' on the bottom left of a stat block.

By default, Clash! uses the <a href="#clash">Open5e</a> database to access SRD DND5e information.  Specifically SRD information, because I do not want to be sued and I will not be adding access to 'pirated' material.  Whenever you use Search, Open5e will return results by default - along with any information you might have in your Collection that matches the query.
![color view](https://battle-system.com/owlbear/clash-docs/clash-import-open5e.png)
To import, simply click on the 'Import' button. The slugs on the left dictate one book the information comes from.

<i>Note: Clash does not pull over EVERY informational field. Some things are left a bit fuzzy, as it's information one would rarely use while running a game.  Or simply the information doesn't exist on the data that is pulled back. </i>

#### <a id="import-custom"></a>2. Importing Custom JSON
To access the Custom Import screen, click on 'Import Custom JSON' on the bottom right of a stat block.

If you have never used this before, the easiest way to get to grips with it would be to search for an Open5e monster, save it, then click the 'Export to JSON' at the top of a stat block. This will give you an example JSON to play with. From there you can edit it in a text editor, and then paste it into this screen for import.

This is also where you will be pasting the information you get from ChatGPT, if you are using that option.
![color view](https://battle-system.com/owlbear/clash-docs/clash-import-custom.png)

#### <a id="import-chatgpt"></a>3.  Importing information from ChatGPT
This uses the Import Custom JSON option, but leverages chat GPT.  The instructions shown in this image are also shown on the Import Custom JSON screen.  clicking the 'Template Prompt' button will give you information to paste into ChatGPT, which can be surprisingly good at getting quick ideas on the table - especially for homebrew.
The information returned should be a JSON block that can be directly pasted into Clash!
![color view](https://battle-system.com/owlbear/clash-docs/clash-import-gpt.png)
As a quick example, I took the prompt and asked for a "Ninja Dinosaur". This is the result, after being imported.
![color view](https://battle-system.com/owlbear/clash-docs/clash-import-gpt2.png)
Clickable actions and all!
<p align="right">(<a href="#clash">back to top</a>)</p>

## Using the Collection/Search
#### <a id="search-save"></a>1. Saving a monster to your Collection
![color view](https://battle-system.com/owlbear/clash-docs/clash-search-save.png)
To save the current block to your collection, click on the Folder with a Down-arrow Icon.  This will save whichever the current block is, along with the current stats.  If you have something in your collection with the same name when you do this, it will overwrite the previous one.
<i> Note #1: Multiples of the same name CAN exist if they are made by different users (have different authors on the slug)</i>
<i> Note #2: If you have the 'Favorite' button toggled when you do this, the item will also be favorited.  Saving again with the 'Favorite' button off will unfavorite the item.</i>
#### <a id="search-load"></a>2. Loading a monster from your Collection
![color view](https://battle-system.com/owlbear/clash-docs/clash-search-load.png)
To load a creature from your Collection to the currently open stat block, go to 'Search' and type in the name of the block you're looking for. (If it's favorited, it should already be shown right away.)  Clicking the Import button will complete the process.
<i> Note: The 'slug' for Collection items will always say '[Collection]' along with the name of the user who created it.  So if you import someone else's Collection or creatures, the items should be tagged appropriately.</i>
#### <a id="search-remove"></a>3. Removing a monster from your Collection
To remove a creature from your Collection, just search for it as if you were looking to load it and click on the 'X' button on that list. That will remove the creature.
#### <a id="search-favorite"></a>4. How favorites work in your Collection
When a block has been favorited, it's more of a 'bookmark' so that you don't have to search to find it.  Say you have an expansive collection of 1000s of monsters - but for the next few months you're running a space-themed campaign that only uses 10 of them quite constantly.  You can 'favorite' those 10 blocks so that when you click the search button, they are front and center and you don't need to do a query to find them.

<p align="right">(<a href="#clash">back to top</a>)</p>

## Using the Effects Column

When the Effect column is on, you can set it to remind you when effects expire during combat.
#### <a id="effects-setup"></a>1 Setting an Effect
When you click on the 'Sparkle Icon' for a unit, the Effects popup will open. On here you can set up to 5 effects for the tracker to follow. The steps are;
1. Type the name of the Effect to be tracked.
2. Input the amount of rounds this effect will last for.
3. Click the toggle to show if this effect ends at the start of their turn (when the turn becomes theirs), or at the end of their turn (when the turn is on the next person).
![color view](https://battle-system.com/owlbear/clash-docs/clash-effects-setup.png)

After that, click 'Save Effects' for it to be active.
After an Effect has been saved, you will be unable to edit it when you go back in to the Effects pop-up. It'll have a black outline on the inputs.  It can only be 'cleared' at this point, if needed.
#### <a id="effects-work"></a>2. How Effects Work
A unit with active effects is indicated by the sparkle icon being orange.
![color view](https://battle-system.com/owlbear/clash-docs/clash-effects-setup2.png)
You can click the sparkle to see what effects a unit has ongoing, or mouse-over it to see what they are an when they end.
![color view](https://battle-system.com/owlbear/clash-docs/clash-effects-setup3.png)
When an effect expires (via the turn-order progressing) a pop-up will alert everyone that it is over and the sparkle will remove it's orange hue.
![color view](https://battle-system.com/owlbear/clash-docs/clash-effects-setup4.png)

<p align="right">(<a href="#clash">back to top</a>)</p>

## Navigating the Settings Page

#### <a id="settings-backups"></a>1. Backing Up/Loading/Deleting your Collection
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-backups.png)
At times you will want to keep a back-up of your data, or perhaps you want to use it on another machine. Maybe share it with a friend?  You can do so in the Settings.
The <b>EXPORT</b> button will download your entire collection to a text file on your machine.
The <b>IMPORT</b> button let's you choose a text file on your machine that contains Clash! JSON data
<i>Note: Be sure to select "Unfavorite" if you do not want any of the imported items coming in as Favorites.</i>
The <b>DELETE</b> button will erase your entire Collection, starting you from scratch. Use with care, there is no undo.

<i>Note: The Collection part of Clash! is saved locally on your machine.  So if you have cookies disabled, localstorage disabled or anything that would stop data from being saved to your machine - it will not work.
There should be a warning at the top of Clash! if it detects this.</i>
#### <a id="settings-clearlist"></a>2. Difference with Reset and Clear List
Resetting the list will put all unit's HP back to maximum, set their Initiative to 1 and put the Turn and Round back to 1.
This is useful for testing, or starting a fresh combat with your players if they still exist on the list.
Clearing the list will remove all units from it, and also set the turn/round back to 1.
#### <a id="settings-configuration"></a>3. Configuring the Combat Tracker Columns
Clash! is working towards a more game agnostic approach, so the columns that are show on the List are fairly customizable.  You can have your setup as simple or complex as you like.
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-simple.png)
Initiative and Name columns are always shown by default, but you can add..
- Health: Minimum and Maximum inputs. (These support quick math, so if the value was 40 and you typed in -15, it will change to 25.)
- Temporary Health: For the games that use this one, handy to have instead of overlaying it on health.
- Armor: As a quick reference field to see a unit's armor class at a glance.
- Movement: A quick reference to see what a unit's fastest move speed is for moving the token about. You can also mouse-over this field to see all of their movement options.
- Effects: This enables the Effects column, which has a more detailed explanation <a href="#using-the-effects-column">above</a>. It's used for tracking when effects expire.
- Elevation: This will show an arrow and number on the token, indicating if it's above or below regular elevation. (Ie; 60)
- Roller: This enables the 'quick roll' column, which are the dice icons you can click to roll initiative.
- Stat Block: This enables the triangle buttons on the right side of a unit, to access their stat block.
Changing these columns will also change the columns player's have access to.  Having fewer columns will also shrink the window itself, minimizing it's onscreen footprint.

#### <a id="settings-playerview"></a>4. Controlling the Player View
Clash! at it's heart is a GM tool, but there are some options to allow player input in order to make a GM's life easier.  While the list is active for players, they are able to input values for all of their own units in realtime.
So when you ask everyone to roll Initiative - they can input the numbers themselves, instead of you waiting for each person to tell you. All tokens a player owns will be outlined in their color, and have enabled inputs.
Or they can add their armor class value, so you have a quick reference to know if they have a chance of being hit.
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-playerview.png)
The options are;
- Disable Player Initiative List: This outright blocks players from using the list at all. It replaces it with an image.
- Hide Enemy Information on Player Initiative List: This will make it so that players are unable to see any of the enemies stats on the list, as the GM can.  They will still be able to see their own token's information though.
- Disable HP Colors on Player Initiative List: By default, as an enemy's HP gets lower Clash! will change the color of their name to give the players an visual indication of 'how bad' the enemy is doing. (So they don't keep asking you.) It changes to yellow around 50%, and then red at around 25%.  Turning this on will stop that, keeping them guessing.
- Disable HP Bars on Tokens: When enabled, HP bars will no longer be drawn on each token in the Initiative List.
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-bars.png)
- Show HP Numbers instead of Bar: If you do not like the look of the bars and want to give the players hard numbers to look at, this option will show them exactly what the enemies HP is.
- Reverse Initiative Order: Some systems use a Reverse Initiative.  This is for them.
- Show Names on Token: By enabling this, Clash! will write the name it has saved on to the token. (By default, no names are written on tokens at all.) <i>Note: Clash! caches the name of a token when it's been added to the list for the first time. This is to allow for players who like to write conditions/effects on a token during play, without compromising the name on the list.</i>
- Descriptor Names for Duplicates: For people who <b>LOVE FUN</b>, when a duplicate name is detected in the list it will be renamed from a list of adjectives in Clash.  So instead of 'Goblin 1, Goblin 2, etc' you'll get 'Goblin, Mighty Goblin, Daring Goblin, etc'.
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-desc.png)
- Disable Turn Label: This will remove the small message label that appears on a token when it is their turn.
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-label.png)
- Add Dex to Intiative Rolls: This will add whatever the unit's DEX modifier is to their Initiative Rolls.  Clash! only supports adding DEX to rolls at this point, as Feat support would .. be a pain.
- Initiative Dice: Some systems do not use a D20 system for Initiative. Changing this number will allow you to set whatever dice it is that your system uses.
<p align="right">(<a href="#clash">back to top</a>)</p>

## Configuring how Dice work

#### <a id="dice-rumble"></a>1. Rumble! Integration
If you have the Rumble! extension in your room, you can have it so Clash! log it's dice rolls through Rumble for your party to see. They will be displayed in the chat log there.
![color view](https://battle-system.com/owlbear/clash-docs/clash-dice-rumble.png)
#### <a id="dice-bones"></a>2. Bones! Integration
If you have the Bones! extension in your room, you can have it so all of your rolls are done through their instead. Similar to the Rumble! extension, your players will be able to view the rolls still. Just displayed as Bones! does, with a notification popup in the bottom left (for you and your party to see) and the 3d dice overlay.
![color view](https://battle-system.com/owlbear/clash-docs/clash-dice-bones.png)
#### <a id="dice-clash"></a>3. Self-View-Only Clash 3D Rolls
If you just want to see the visual dice for yourself without enabling any other extensions, you can turn on the Clash! 3D dice and it will display a window of your rolls on the bottom right.
![color view](https://battle-system.com/owlbear/clash-docs/clash-dice-clash.png)
#### <a id="dice-text"></a>4. Text Result Rolls
If you're someone who wants speed, you can forgo all of the 3d dice rolling and opt for the text results.  This will just show an OBR notification pop-up at the top of the screen with your dice results.  You can use the setting directly below this one to also have it shown to the entire party.
#### <a id="dice-discord"></a>5. Discord Logging
If you're using Discord and would like a log of all your rolls exported directly to a channel on your server, you can add your webhook URL here and Clash will drop text results of all rolls it does to your channel.
<i>Note: If you are having your rolls done through Bones!, this will not work as the actual roll is being done in that extension. Not Clash.</i>
<p align="right">(<a href="#clash">back to top</a>)</p>

## Player Input

#### <a id="player-values"></a>1. Updating Values as a Player
As a player, your view is a little different from the GM. (Possibly a lot more, depending on the settings the GM has enabled.)
If allowed, you are able to toggle the values for tokens that you own and they'll be updated in realtime for everyone to see.
<i>The exception here is Movement Speeds, as this is data that is set via the Stat Block.</i>
![color view](https://battle-system.com/owlbear/clash-docs/clash-settings-playerview.png)
#### <a id="player-focus"></a>2. Toggling Auto-Focus for Turn Changes
From the player view, if you want to have the screen shift to the token when the turn changes, click the toggle and your camera will focus as needed.
![color view](https://battle-system.com/owlbear/clash-docs/clash-player-focus.png)
#### <a id="player-why"></a>3. Why Players cannot see/use Stat Blocks
You may have noticed at this point that player's are unable to access the Stat Block part of Clash!.
This is on purpose, as I see Clash as a GM tool - not a everything-and-a-kitchen-sink tool. Player sheets tend to be a lot more complicated than the amount of information that I'd want to fit into a stat block, not to mention the upkeep on them would be miserably tedious.
Tokens are also saved to the -scene-, so you would need to drag that information around between every scene that you went to.  In short, it might work for a handful of people but it would be a nightmare for others.
I decided to go the approach of leaving Clash to focus on what it is, and I have another extension I'm working on called Chronicle! that will be handling the player sheet side of things.  It's not in the OBR store as of yet, as I'm still tinkering with remote storage and the like. Though if you're curious, you can visit the OBR Discord for a link.

<p align="right">(<a href="#clash">back to top</a>)</p>

## Tips and Tricks
#### <a id="tip-math"></a>1. Quick-Math!
So you don't want to do math. I get it.  For HP values, you can type in the adjustments and Clash will do the rest.  So if they have '100' hp, you type in '-25' and it'll update itself to '75' when you unfocus the element or hit enter.
![color view](https://battle-system.com/owlbear/clash-docs/clash-tips-math.gif)
#### <a id="tip-autoload"></a>2. Auto-Loading Stats for a Token
Once a goblin, always a goblin.  Using the collection and some standard naming, you can make your tokens automatically have the correct stat block.
First: You want to make sure your tokens have the correct names by default. (So if you dragged an image in, and it's name is still "ImageXYZ.png" - you want to make sure it's changed to 'Fighter' - or whatever you're using).
Second: You want to make a stat block for 'Fighter' (making certain the name matches the token name) and save that to your collection.
That's it!  Now when you drag in a 'Fighter' token, it should automatically have the stats you're looking for.
![color view](https://battle-system.com/owlbear/clash-docs/clash-tips-load.gif)
#### <a id="tip-mass"></a>3. Mass-Edit a group of tokens at one time
If you select a group of tokens at once, you can update them in one swoop by right-clicking one to go to the context menu and selecting 'View Info' (You may notice the icon looks a little different).
This will bring up a modified version of the stat block that will save the stats to all tokens at once. 
![color view](https://battle-system.com/owlbear/clash-docs/clash-tips-mass.png)
#### <a id="tip-assign"></a>4. - Assigning Token Owner through Clash
Normally in Owlbear Rodeo, you would need to turn on Player Permissions in order to set the ownership of a specific token.  Using Clash, you can do this even faster via the List.  Whenever you right-click a token in the combat tracker, you'll see a list of players currently in the room.  Select any one of their names to assign the token to them.
![color view](https://battle-system.com/owlbear/clash-docs/clash-tips-owner.png)
#### <a id="tip-group"></a>5. Group-Roll Initiative for 'Monsters
If you click the name of a monster in the List, it'll turn purple.  What this signifies is that particular unit is a 'monster', and when you click on the group roller button (the purple dice up top) it will roll initiative for them all at once.
![color view](https://battle-system.com/owlbear/clash-docs/clash-tips-group.gif)

<p align="right">(<a href="#clash">back to top</a>)</p>

## Support

If you have questions, please join the [Owlbear Rodeo Discord](https://discord.gg/UY8AXjhzhe).

Or you can reach out to me at manuel@battle-system.com.

<p align="right">(<a href="#clash">back to top</a>)</p>
    `}class bi{static HIDEHP=`${d.EXTENSIONID}/setting_hidehp`;static HIDEALL=`${d.EXTENSIONID}/setting_hideall`;static HIDEHPBAR=`${d.EXTENSIONID}/setting_hpbar`;static HIDEENEMYINFO=`${d.EXTENSIONID}/setting_hide_enemy_info`;static HPBARNUMBERS=`${d.EXTENSIONID}/setting_hpbar_numbers`;static DISABLELABEL=`${d.EXTENSIONID}/setting_disablelabel`;static DISABLEFOCUS=`${d.EXTENSIONID}/setting_disablefocus`;static REVERSELIST=`${d.EXTENSIONID}/setting_reverselist`;static RUMBLELOG=`${d.EXTENSIONID}/setting_rumblelog`;static BONESROLL=`${d.EXTENSIONID}/setting_bonesroll`;static VISUALDICE=`${d.EXTENSIONID}/setting_visualdice`;static DICENOTIFICATION=`${d.EXTENSIONID}/setting_dicenotification`;static DICEEVERYONE=`${d.EXTENSIONID}/setting_dicetoall`;static DISCORDHOOK=`${d.EXTENSIONID}/setting_discordhook`;static DISCORDURL=`${d.EXTENSIONID}/setting_discordurl`;static TURNTEXT=`${d.EXTENSIONID}/setting_turntext`;static NAMELABELS=`${d.EXTENSIONID}/setting_namelabel`;static RANDOMNAME=`${d.EXTENSIONID}/setting_randomname`;static INITIATIVEDICE=`${d.EXTENSIONID}/setting_initdice`;static INITBONUS=`${d.EXTENSIONID}/setting_initbonus`;static HPROW=`${d.EXTENSIONID}/setting_hpcol`;static ROLLERROW=`${d.EXTENSIONID}/setting_rollercol`;static TEMPHPROW=`${d.EXTENSIONID}/setting_tempcol`;static ACROW=`${d.EXTENSIONID}/setting_accol`;static MOVEROW=`${d.EXTENSIONID}/setting_movecol`;static BLOCKROW=`${d.EXTENSIONID}/setting_blockcol`;static EFXROW=`${d.EXTENSIONID}/setting_efxcol`;static ELEVATEROW=`${d.EXTENSIONID}/setting_elevcol`;static TURNCOUNT=`${d.EXTENSIONID}/setting_turncounter`;static ROUNDCOUNT=`${d.EXTENSIONID}/setting_roundcounter`}class Ni{static HPBAR=`${d.EXTENSIONID}/hpbar_active`;static ONLIST=`${d.EXTENSIONID}/clash`;static ID=`${d.EXTENSIONID}/clash_id`;static OWNERID=`${d.EXTENSIONID}/clash_ownerid`;static INITIATIVE=`${d.EXTENSIONID}/clash_initiative`;static ISMONSTER=`${d.EXTENSIONID}/clash_isMonster`;static TEMPHP=`${d.EXTENSIONID}/clash_tempHP`;static CURRENTHP=`${d.EXTENSIONID}/clash_currentHP`;static MAXHP=`${d.EXTENSIONID}/clash_maxHP`;static ARMORCLASS=`${d.EXTENSIONID}/clash_armorClass`;static UNITNAME=`${d.EXTENSIONID}/clash_unitName`;static UNITTYPE=`${d.EXTENSIONID}/clash_unitType`;static UNITSIZE=`${d.EXTENSIONID}/clash_unitSize`;static STRSCORE=`${d.EXTENSIONID}/clash_strScore`;static STRSAVE=`${d.EXTENSIONID}/clash_strSave`;static DEXSCORE=`${d.EXTENSIONID}/clash_dexScore`;static DEXSAVE=`${d.EXTENSIONID}/clash_dexSave`;static CONSCORE=`${d.EXTENSIONID}/clash_conScore`;static CONSAVE=`${d.EXTENSIONID}/clash_conSave`;static INTSCORE=`${d.EXTENSIONID}/clash_intScore`;static INTSAVE=`${d.EXTENSIONID}/clash_intSave`;static WISSCORE=`${d.EXTENSIONID}/clash_wisScore`;static WISSAVE=`${d.EXTENSIONID}/clash_wisSave`;static CHASCORE=`${d.EXTENSIONID}/clash_chaScore`;static CHASAVE=`${d.EXTENSIONID}/clash_chaSave`;static DAMAGEVULNERABILITIES=`${d.EXTENSIONID}/clash_damageVulnerabilities`;static DAMAGEIMMUNITIES=`${d.EXTENSIONID}/clash_damageImmunities`;static DAMAGERESISTANCES=`${d.EXTENSIONID}/clash_damageResistances`;static CONDITIONIMMUNITIES=`${d.EXTENSIONID}/clash_conditionImmunities`;static CHALLENGERATING=`${d.EXTENSIONID}/clash_challengeRating`;static EXPERIENCEPOINTS=`${d.EXTENSIONID}/clash_experiencePoints`;static ALIGNMENT=`${d.EXTENSIONID}/clash_alignment`;static STANDARDACTIONS=`${d.EXTENSIONID}/clash_standardActions`;static LEGENDARYACTIONS=`${d.EXTENSIONID}/clash_legendaryActions`;static SPECIALABILITIES=`${d.EXTENSIONID}/clash_specialAbilities`;static SPELLACTIONS=`${d.EXTENSIONID}/clash_spellActions`;static REACTIONS=`${d.EXTENSIONID}/clash_reactions`;static SPELLLIST=`${d.EXTENSIONID}/clash_spellList`;static SENSES=`${d.EXTENSIONID}/clash_senses`;static SKILLS=`${d.EXTENSIONID}/clash_skills`;static LANGUAGES=`${d.EXTENSIONID}/clash_languages`;static SPEEDWALK=`${d.EXTENSIONID}/clash_speedWalk`;static SPEEDFLY=`${d.EXTENSIONID}/clash_speedFly`;static SPEEDCLIMB=`${d.EXTENSIONID}/clash_speedClimb`;static SPEEDBURROW=`${d.EXTENSIONID}/clash_speedBurrow`;static SPEEDSWIM=`${d.EXTENSIONID}/clash_speedSwim`;static ELEVATION=`${d.EXTENSIONID}/clash_elevation`;static EFFECTS=`${d.EXTENSIONID}/clash_effects`}export{d as C,wi as O,bi as S,Ni as U,Ai as a,Si as b};
