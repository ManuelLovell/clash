import{C as Q,O as $,S as U,U as D,b as gs,a as Hr}from"./clashConstants-c8ada5a8.js";var hr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function vs(r){return r.type==="CURVE"}function ws(r){return r.type==="IMAGE"}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Je=Object.keys,ut=Array.isArray;function pt(r,e){return typeof e!="object"||Je(e).forEach(function(n){r[n]=e[n]}),r}typeof Promise>"u"||Ve.Promise||(Ve.Promise=Promise);const Hn=Object.getPrototypeOf,_s={}.hasOwnProperty;function St(r,e){return _s.call(r,e)}function In(r,e){typeof e=="function"&&(e=e(Hn(r))),(typeof Reflect>"u"?Je:Reflect.ownKeys)(e).forEach(n=>{Yt(r,n,e[n])})}const ia=Object.defineProperty;function Yt(r,e,n,t){ia(r,e,pt(n&&St(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},t))}function En(r){return{from:function(e){return r.prototype=Object.create(e.prototype),Yt(r.prototype,"constructor",r),{extend:In.bind(null,r.prototype)}}}}const Es=Object.getOwnPropertyDescriptor;function Ei(r,e){let n;return Es(r,e)||(n=Hn(r))&&Ei(n,e)}const As=[].slice;function _r(r,e,n){return As.call(r,e,n)}function aa(r,e){return e(r)}function Rn(r){if(!r)throw new Error("Assertion Failed")}function sa(r){Ve.setImmediate?setImmediate(r):setTimeout(r,0)}function ua(r,e){return r.reduce((n,t,i)=>{var s=e(t,i);return s&&(n[s[0]]=s[1]),n},{})}function Xt(r,e){if(St(r,e))return r[e];if(!e)return r;if(typeof e!="string"){for(var n=[],t=0,i=e.length;t<i;++t){var s=Xt(r,e[t]);n.push(s)}return n}var u=e.indexOf(".");if(u!==-1){var h=r[e.substr(0,u)];return h===void 0?void 0:Xt(h,e.substr(u+1))}}function Ft(r,e,n){if(r&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(r)))if(typeof e!="string"&&"length"in e){Rn(typeof n!="string"&&"length"in n);for(var t=0,i=e.length;t<i;++t)Ft(r,e[t],n[t])}else{var s=e.indexOf(".");if(s!==-1){var u=e.substr(0,s),h=e.substr(s+1);if(h==="")n===void 0?ut(r)&&!isNaN(parseInt(u))?r.splice(u,1):delete r[u]:r[u]=n;else{var c=r[u];c&&St(r,u)||(c=r[u]={}),Ft(c,h,n)}}else n===void 0?ut(r)&&!isNaN(parseInt(e))?r.splice(e,1):delete r[e]:r[e]=n}}function oa(r){var e={};for(var n in r)St(r,n)&&(e[n]=r[n]);return e}const Ss=[].concat;function da(r){return Ss.apply([],r)}const ca="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(da([8,16,32,64].map(r=>["Int","Uint","Float"].map(e=>e+r+"Array")))).filter(r=>Ve[r]),Cs=ca.map(r=>Ve[r]);ua(ca,r=>[r,!0]);let en=null;function Jn(r){en=typeof WeakMap<"u"&&new WeakMap;const e=Xr(r);return en=null,e}function Xr(r){if(!r||typeof r!="object")return r;let e=en&&en.get(r);if(e)return e;if(ut(r)){e=[],en&&en.set(r,e);for(var n=0,t=r.length;n<t;++n)e.push(Xr(r[n]))}else if(Cs.indexOf(r.constructor)>=0)e=r;else{const s=Hn(r);for(var i in e=s===Object.prototype?{}:Object.create(s),en&&en.set(r,e),r)St(r,i)&&(e[i]=Xr(r[i]))}return e}const{toString:Is}={};function Jr(r){return Is.call(r).slice(8,-1)}const Zr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Os=typeof Zr=="symbol"?function(r){var e;return r!=null&&(e=r[Zr])&&e.apply(r)}:function(){return null},_n={};function zt(r){var e,n,t,i;if(arguments.length===1){if(ut(r))return r.slice();if(this===_n&&typeof r=="string")return[r];if(i=Os(r)){for(n=[];!(t=i.next()).done;)n.push(t.value);return n}if(r==null)return[r];if(typeof(e=r.length)=="number"){for(n=new Array(e);e--;)n[e]=r[e];return n}return[r]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Ai=typeof Symbol<"u"?r=>r[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Ut=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function la(r,e){Ut=r,fa=e}var fa=()=>!0;const Ts=!new Error("").stack;function gn(){if(Ts)try{throw gn.arguments,new Error}catch(r){return r}return new Error}function Qr(r,e){var n=r.stack;return n?(e=e||0,n.indexOf(r.name)===0&&(e+=(r.name+r.message).split(`
`).length),n.split(`
`).slice(e).filter(fa).map(t=>`
`+t).join("")):""}var ha=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Si=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ha),ks={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function An(r,e){this._e=gn(),this.name=r,this.message=e}function pa(r,e){return r+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,t,i)=>i.indexOf(n)===t).join(`
`)}function Er(r,e,n,t){this._e=gn(),this.failures=e,this.failedKeys=t,this.successCount=n,this.message=pa(r,e)}function Fn(r,e){this._e=gn(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=pa(r,e)}En(An).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Qr(this._e,2))}},toString:function(){return this.name+": "+this.message}}),En(Er).from(An),En(Fn).from(An);var Ci=Si.reduce((r,e)=>(r[e]=e+"Error",r),{});const Ds=An;var le=Si.reduce((r,e)=>{var n=e+"Error";function t(i,s){this._e=gn(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=ks[e]||n,this.inner=null)}return En(t).from(Ds),r[e]=t,r},{});le.Syntax=SyntaxError,le.Type=TypeError,le.Range=RangeError;var ji=ha.reduce((r,e)=>(r[e+"Error"]=le[e],r),{}),pr=Si.reduce((r,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(r[e+"Error"]=le[e]),r),{});function Fe(){}function Un(r){return r}function Ps(r,e){return r==null||r===Un?e:function(n){return e(r(n))}}function pn(r,e){return function(){r.apply(this,arguments),e.apply(this,arguments)}}function Bs(r,e){return r===Fe?e:function(){var n=r.apply(this,arguments);n!==void 0&&(arguments[0]=n);var t=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return t&&(this.onsuccess=this.onsuccess?pn(t,this.onsuccess):t),i&&(this.onerror=this.onerror?pn(i,this.onerror):i),s!==void 0?s:n}}function Rs(r,e){return r===Fe?e:function(){r.apply(this,arguments);var n=this.onsuccess,t=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?pn(n,this.onsuccess):n),t&&(this.onerror=this.onerror?pn(t,this.onerror):t)}}function Ns(r,e){return r===Fe?e:function(n){var t=r.apply(this,arguments);pt(n,t);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?pn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?pn(s,this.onerror):s),t===void 0?u===void 0?void 0:u:pt(t,u)}}function Fs(r,e){return r===Fe?e:function(){return e.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Ii(r,e){return r===Fe?e:function(){var n=r.apply(this,arguments);if(n&&typeof n.then=="function"){for(var t=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(t,s)})}return e.apply(this,arguments)}}pr.ModifyError=Er,pr.DexieError=An,pr.BulkError=Fn;var Vn={};const ma=100,[ei,Ar,ti]=typeof Promise>"u"?[]:(()=>{let r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,Hn(r),r];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Hn(e),r]})(),ya=Ar&&Ar.then,mr=ei&&ei.constructor,Oi=!!ti;var ni=!1,js=ti?()=>{ti.then(rr)}:Ve.setImmediate?setImmediate.bind(null,rr):Ve.MutationObserver?()=>{var r=document.createElement("div");new MutationObserver(()=>{rr(),r=null}).observe(r,{attributes:!0}),r.setAttribute("i","1")}:()=>{setTimeout(rr,0)},jn=function(r,e){Nn.push([r,e]),Sr&&(js(),Sr=!1)},ri=!0,Sr=!0,ln=[],yr=[],ii=null,ai=Un,Sn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xi,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(r=>{try{xi(r[0],r[1])}catch{}})}},ue=Sn,Nn=[],fn=0,gr=[];function te(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Fe,this._lib=!1;var e=this._PSD=ue;if(Ut&&(this._stackHolder=gn(),this._prev=null,this._numPrev=0),typeof r!="function"){if(r!==Vn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ui(this,this._value))}this._state=null,this._value=null,++e.ref,ba(this,r)}const si={get:function(){var r=ue,e=Cr;function n(t,i){var s=!r.global&&(r!==ue||e!==Cr);const u=s&&!Jt();var h=new te((c,b)=>{Ti(this,new ga(Ir(t,r,s,u),Ir(i,r,s,u),c,b,r))});return Ut&&_a(h,this),h}return n.prototype=Vn,n},set:function(r){Yt(this,"then",r&&r.prototype===Vn?si:{get:function(){return r},set:si.set})}};function ga(r,e,n,t,i){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=t,this.psd=i}function ba(r,e){try{e(n=>{if(r._state===null){if(n===r)throw new TypeError("A promise cannot be resolved with itself.");var t=r._lib&&Zn();n&&typeof n.then=="function"?ba(r,(i,s)=>{n instanceof te?n._then(i,s):n.then(i,s)}):(r._state=!0,r._value=n,va(r)),t&&Qn()}},ui.bind(null,r))}catch(n){ui(r,n)}}function ui(r,e){if(yr.push(e),r._state===null){var n=r._lib&&Zn();e=ai(e),r._state=!1,r._value=e,Ut&&e!==null&&typeof e=="object"&&!e._promise&&function(t,i,s){try{t.apply(null,s)}catch(u){i&&i(u)}}(()=>{var t=Ei(e,"stack");e._promise=r,Yt(e,"stack",{get:()=>ni?t&&(t.get?t.get.apply(e):t.value):r.stack})}),function(t){ln.some(i=>i._value===t._value)||ln.push(t)}(r),va(r),n&&Qn()}}function va(r){var e=r._listeners;r._listeners=[];for(var n=0,t=e.length;n<t;++n)Ti(r,e[n]);var i=r._PSD;--i.ref||i.finalize(),fn===0&&(++fn,jn(()=>{--fn==0&&ki()},[]))}function Ti(r,e){if(r._state!==null){var n=r._state?e.onFulfilled:e.onRejected;if(n===null)return(r._state?e.resolve:e.reject)(r._value);++e.psd.ref,++fn,jn(Ms,[n,r,e])}else r._listeners.push(e)}function Ms(r,e,n){try{ii=e;var t,i=e._value;e._state?t=r(i):(yr.length&&(yr=[]),t=r(i),yr.indexOf(i)===-1&&function(s){for(var u=ln.length;u;)if(ln[--u]._value===s._value)return void ln.splice(u,1)}(e)),n.resolve(t)}catch(s){n.reject(s)}finally{ii=null,--fn==0&&ki(),--n.psd.ref||n.psd.finalize()}}function wa(r,e,n){if(e.length===n)return e;var t="";if(r._state===!1){var i,s,u=r._value;u!=null?(i=u.name||"Error",s=u.message||u,t=Qr(u,0)):(i=u,s=""),e.push(i+(s?": "+s:"")+t)}return Ut&&((t=Qr(r._stackHolder,2))&&e.indexOf(t)===-1&&e.push(t),r._prev&&wa(r._prev,e,n)),e}function _a(r,e){var n=e?e._numPrev+1:0;n<100&&(r._prev=e,r._numPrev=n)}function rr(){Zn()&&Qn()}function Zn(){var r=ri;return ri=!1,Sr=!1,r}function Qn(){var r,e,n;do for(;Nn.length>0;)for(r=Nn,Nn=[],n=r.length,e=0;e<n;++e){var t=r[e];t[0].apply(null,t[1])}while(Nn.length>0);ri=!0,Sr=!0}function ki(){var r=ln;ln=[],r.forEach(t=>{t._PSD.onunhandled.call(null,t._value,t)});for(var e=gr.slice(0),n=e.length;n;)e[--n]()}function ir(r){return new te(Vn,!1,r)}function $e(r,e){var n=ue;return function(){var t=Zn(),i=ue;try{return rn(n,!0),r.apply(this,arguments)}catch(s){e&&e(s)}finally{rn(i,!1),t&&Qn()}}}In(te.prototype,{then:si,_then:function(r,e){Ti(this,new ga(null,null,r,e,ue))},catch:function(r){if(arguments.length===1)return this.then(null,r);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,t=>t instanceof e?n(t):ir(t)):this.then(null,t=>t&&t.name===e?n(t):ir(t))},finally:function(r){return this.then(e=>(r(),e),e=>(r(),ir(e)))},stack:{get:function(){if(this._stack)return this._stack;try{ni=!0;var r=wa(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=r),r}finally{ni=!1}}},timeout:function(r,e){return r<1/0?new te((n,t)=>{var i=setTimeout(()=>t(new le.Timeout(e)),r);this.then(n,t).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Yt(te.prototype,Symbol.toStringTag,"Dexie.Promise"),Sn.env=Ea(),In(te,{all:function(){var r=zt.apply(null,arguments).map(ar);return new te(function(e,n){r.length===0&&e([]);var t=r.length;r.forEach((i,s)=>te.resolve(i).then(u=>{r[s]=u,--t||e(r)},n))})},resolve:r=>{if(r instanceof te)return r;if(r&&typeof r.then=="function")return new te((n,t)=>{r.then(n,t)});var e=new te(Vn,!0,r);return _a(e,ii),e},reject:ir,race:function(){var r=zt.apply(null,arguments).map(ar);return new te((e,n)=>{r.map(t=>te.resolve(t).then(e,n))})},PSD:{get:()=>ue,set:r=>ue=r},totalEchoes:{get:()=>Cr},newPSD:nn,usePSD:Dn,scheduler:{get:()=>jn,set:r=>{jn=r}},rejectionMapper:{get:()=>ai,set:r=>{ai=r}},follow:(r,e)=>new te((n,t)=>nn((i,s)=>{var u=ue;u.unhandleds=[],u.onunhandled=s,u.finalize=pn(function(){(function(h){function c(){h(),gr.splice(gr.indexOf(c),1)}gr.push(c),++fn,jn(()=>{--fn==0&&ki()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},u.finalize),r()},e,n,t))}),mr&&(mr.allSettled&&Yt(te,"allSettled",function(){const r=zt.apply(null,arguments).map(ar);return new te(e=>{r.length===0&&e([]);let n=r.length;const t=new Array(n);r.forEach((i,s)=>te.resolve(i).then(u=>t[s]={status:"fulfilled",value:u},u=>t[s]={status:"rejected",reason:u}).then(()=>--n||e(t)))})}),mr.any&&typeof AggregateError<"u"&&Yt(te,"any",function(){const r=zt.apply(null,arguments).map(ar);return new te((e,n)=>{r.length===0&&n(new AggregateError([]));let t=r.length;const i=new Array(t);r.forEach((s,u)=>te.resolve(s).then(h=>e(h),h=>{i[u]=h,--t||n(new AggregateError(i))}))})}));const st={awaits:0,echoes:0,id:0};var Ls=0,br=[],Ur=0,Cr=0,xs=0;function nn(r,e,n,t){var i=ue,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++xs;var u=Sn.env;s.env=Oi?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject,nthen:Mi(u.nthen,s),gthen:Mi(u.gthen,s)}:{},e&&pt(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=Dn(s,r,n,t);return s.ref===0&&s.finalize(),h}function kn(){return st.id||(st.id=++Ls),++st.awaits,st.echoes+=ma,st.id}function Jt(){return!!st.awaits&&(--st.awaits==0&&(st.id=0),st.echoes=st.awaits*ma,!0)}function ar(r){return st.echoes&&r&&r.constructor===mr?(kn(),r.then(e=>(Jt(),e),e=>(Jt(),Qe(e)))):r}function Hs(r){++Cr,st.echoes&&--st.echoes!=0||(st.echoes=st.id=0),br.push(ue),rn(r,!0)}function Us(){var r=br[br.length-1];br.pop(),rn(r,!1)}function rn(r,e){var n=ue;if((e?!st.echoes||Ur++&&r===ue:!Ur||--Ur&&r===ue)||Aa(e?Hs.bind(null,r):Us),r!==ue&&(ue=r,n===Sn&&(Sn.env=Ea()),Oi)){var t=Sn.env.Promise,i=r.env;Ar.then=i.nthen,t.prototype.then=i.gthen,(n.global||r.global)&&(Object.defineProperty(Ve,"Promise",i.PromiseProp),t.all=i.all,t.race=i.race,t.resolve=i.resolve,t.reject=i.reject,i.allSettled&&(t.allSettled=i.allSettled),i.any&&(t.any=i.any))}}function Ea(){var r=Ve.Promise;return Oi?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(Ve,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject,nthen:Ar.then,gthen:r.prototype.then}:{}}function Dn(r,e,n,t,i){var s=ue;try{return rn(r,!0),e(n,t,i)}finally{rn(s,!1)}}function Aa(r){ya.call(ei,r)}function Ir(r,e,n,t){return typeof r!="function"?r:function(){var i=ue;n&&kn(),rn(e,!0);try{return r.apply(this,arguments)}finally{rn(i,!1),t&&Aa(Jt)}}}function Mi(r,e){return function(n,t){return r.call(this,Ir(n,e),Ir(t,e))}}(""+ya).indexOf("[native code]")===-1&&(kn=Jt=Fe);const Li="unhandledrejection";function xi(r,e){var n;try{n=e.onuncatched(r)}catch{}if(n!==!1)try{var t,i={promise:e,reason:r};if(Ve.document&&document.createEvent?((t=document.createEvent("Event")).initEvent(Li,!0,!0),pt(t,i)):Ve.CustomEvent&&pt(t=new CustomEvent(Li,{detail:i}),i),t&&Ve.dispatchEvent&&(dispatchEvent(t),!Ve.PromiseRejectionEvent&&Ve.onunhandledrejection))try{Ve.onunhandledrejection(t)}catch{}Ut&&t&&!t.defaultPrevented&&console.warn(`Unhandled rejection: ${r.stack||r}`)}catch{}}var Qe=te.reject;function oi(r,e,n,t){if(r.idbdb&&(r._state.openComplete||ue.letThrough||r._vip)){var i=r._createTransaction(e,n,r._dbSchema);try{i.create(),r._state.PR1398_maxLoop=3}catch(s){return s.name===Ci.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>oi(r,e,n,t))):Qe(s)}return i._promise(e,(s,u)=>nn(()=>(ue.trans=i,t(s,u,i)))).then(s=>i._completion.then(()=>s))}if(r._state.openComplete)return Qe(new le.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._options.autoOpen)return Qe(new le.DatabaseClosed);r.open().catch(Fe)}return r._state.dbReadyPromise.then(()=>oi(r,e,n,t))}const Hi="3.2.4",cn=String.fromCharCode(65535),di=-1/0,$t="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Sa="String expected.",Mn=[],Rr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Vs=Rr,Ks=Rr,Ca=r=>!/(dexie\.js|dexie\.min\.js)/.test(r),Nr="__dbnames",Vr="readonly",Kr="readwrite";function mn(r,e){return r?e?function(){return r.apply(this,arguments)&&e.apply(this,arguments)}:r:e}const Ia={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function sr(r){return typeof r!="string"||/\./.test(r)?e=>e:e=>(e[r]===void 0&&r in e&&delete(e=Jn(e))[r],e)}class $s{_trans(e,n,t){const i=this._tx||ue.trans,s=this.name;function u(c,b,p){if(!p.schema[s])throw new le.NotFound("Table "+s+" not part of transaction");return n(p.idbtrans,p)}const h=Zn();try{return i&&i.db===this.db?i===ue.trans?i._promise(e,u,t):nn(()=>i._promise(e,u,t),{trans:i,transless:ue.transless||ue}):oi(this.db,e,[this.name],u)}finally{h&&Qn()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",t=>this.core.get({trans:t,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ut(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=Je(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const t=this.schema.indexes.concat(this.schema.primKey).filter(b=>b.compound&&n.every(p=>b.keyPath.indexOf(p)>=0)&&b.keyPath.every(p=>n.indexOf(p)>=0))[0];if(t&&this.db._maxKey!==cn)return this.where(t.name).equals(t.keyPath.map(b=>e[b]));!t&&Ut&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function u(b,p){try{return s.cmp(b,p)===0}catch{return!1}}const[h,c]=n.reduce(([b,p],y)=>{const w=i[y],T=e[y];return[b||w,b||!w?mn(p,w&&w.multi?R=>{const S=Xt(R,y);return ut(S)&&S.some(O=>u(T,O))}:R=>u(T,Xt(R,y))):p]},[null,null]);return h?this.where(h.name).equals(e[h.keyPath]).filter(c):t?this.filter(c):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ut(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=t=>{if(!t)return t;const i=Object.create(e.prototype);for(var s in t)if(St(t,s))try{i[s]=t[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){pt(this,e)})}add(e,n){const{auto:t,keyPath:i}=this.schema.primKey;let s=e;return i&&t&&(s=sr(i)(e)),this._trans("readwrite",u=>this.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})).then(u=>u.numFailures?te.reject(u.failures[0]):u.lastResult).then(u=>{if(i)try{Ft(e,i,u)}catch{}return u})}update(e,n){if(typeof e!="object"||ut(e))return this.where(":id").equals(e).modify(n);{const t=Xt(e,this.schema.primKey.keyPath);if(t===void 0)return Qe(new le.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?Je(n).forEach(i=>{Ft(e,i,n[i])}):n(e,{value:e,primKey:t})}catch{}return this.where(":id").equals(t).modify(n)}}put(e,n){const{auto:t,keyPath:i}=this.schema.primKey;let s=e;return i&&t&&(s=sr(i)(e)),this._trans("readwrite",u=>this.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})).then(u=>u.numFailures?te.reject(u.failures[0]):u.lastResult).then(u=>{if(i)try{Ft(e,i,u)}catch{}return u})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?te.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Ia})).then(e=>e.numFailures?te.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(t=>t.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,t){const i=Array.isArray(n)?n:void 0,s=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",u=>{const{auto:h,keyPath:c}=this.schema.primKey;if(c&&i)throw new le.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new le.InvalidArgument("Arguments objects and keys must have the same length");const b=e.length;let p=c&&h?e.map(sr(c)):e;return this.core.mutate({trans:u,type:"add",keys:i,values:p,wantResults:s}).then(({numFailures:y,results:w,lastResult:T,failures:R})=>{if(y===0)return s?w:T;throw new Fn(`${this.name}.bulkAdd(): ${y} of ${b} operations failed`,R)})})}bulkPut(e,n,t){const i=Array.isArray(n)?n:void 0,s=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",u=>{const{auto:h,keyPath:c}=this.schema.primKey;if(c&&i)throw new le.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new le.InvalidArgument("Arguments objects and keys must have the same length");const b=e.length;let p=c&&h?e.map(sr(c)):e;return this.core.mutate({trans:u,type:"put",keys:i,values:p,wantResults:s}).then(({numFailures:y,results:w,lastResult:T,failures:R})=>{if(y===0)return s?w:T;throw new Fn(`${this.name}.bulkPut(): ${y} of ${b} operations failed`,R)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:e})).then(({numFailures:t,lastResult:i,failures:s})=>{if(t===0)return i;throw new Fn(`${this.name}.bulkDelete(): ${t} of ${n} operations failed`,s)})}}function Ln(r){var e={},n=function(u,h){if(h){for(var c=arguments.length,b=new Array(c-1);--c;)b[c-1]=arguments[c];return e[u].subscribe.apply(null,b),r}if(typeof u=="string")return e[u]};n.addEventType=s;for(var t=1,i=arguments.length;t<i;++t)s(arguments[t]);return n;function s(u,h,c){if(typeof u!="object"){var b;h||(h=Fs),c||(c=Fe);var p={subscribers:[],fire:c,subscribe:function(y){p.subscribers.indexOf(y)===-1&&(p.subscribers.push(y),p.fire=h(p.fire,y))},unsubscribe:function(y){p.subscribers=p.subscribers.filter(function(w){return w!==y}),p.fire=p.subscribers.reduce(h,c)}};return e[u]=n[u]=p,p}Je(b=u).forEach(function(y){var w=b[y];if(ut(w))s(y,b[y][0],b[y][1]);else{if(w!=="asap")throw new le.InvalidArgument("Invalid event config");var T=s(y,Un,function(){for(var R=arguments.length,S=new Array(R);R--;)S[R]=arguments[R];T.subscribers.forEach(function(O){sa(function(){O.apply(null,S)})})})}})}}function Pn(r,e){return En(e).from({prototype:r}),e}function vn(r,e){return!(r.filter||r.algorithm||r.or)&&(e?r.justLimit:!r.replayFilter)}function $r(r,e){r.filter=mn(r.filter,e)}function Wr(r,e,n){var t=r.replayFilter;r.replayFilter=t?()=>mn(t(),e()):e,r.justLimit=n&&!t}function vr(r,e){if(r.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(r.index);if(!n)throw new le.Schema("KeyPath "+r.index+" on object store "+e.name+" is not indexed");return n}function Ui(r,e,n){const t=vr(r,e.schema);return e.openCursor({trans:n,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:t,range:r.range}})}function ur(r,e,n,t){const i=r.replayFilter?mn(r.filter,r.replayFilter()):r.filter;if(r.or){const s={},u=(h,c,b)=>{if(!i||i(c,b,w=>c.stop(w),w=>c.fail(w))){var p=c.primaryKey,y=""+p;y==="[object ArrayBuffer]"&&(y=""+new Uint8Array(p)),St(s,y)||(s[y]=!0,e(h,c,b))}};return Promise.all([r.or._iterate(u,n),Vi(Ui(r,t,n),r.algorithm,u,!r.keysOnly&&r.valueMapper)])}return Vi(Ui(r,t,n),mn(r.algorithm,i),e,!r.keysOnly&&r.valueMapper)}function Vi(r,e,n,t){var i=$e(t?(s,u,h)=>n(t(s),u,h):n);return r.then(s=>{if(s)return s.start(()=>{var u=()=>s.continue();e&&!e(s,h=>u=h,h=>{s.stop(h),u=Fe},h=>{s.fail(h),u=Fe})||i(s.value,s,h=>u=h),u()})})}function ht(r,e){try{const n=Ki(r),t=Ki(e);if(n!==t)return n==="Array"?1:t==="Array"?-1:n==="binary"?1:t==="binary"?-1:n==="string"?1:t==="string"?-1:n==="Date"?1:t!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return r>e?1:r<e?-1:0;case"binary":return function(i,s){const u=i.length,h=s.length,c=u<h?u:h;for(let b=0;b<c;++b)if(i[b]!==s[b])return i[b]<s[b]?-1:1;return u===h?0:u<h?-1:1}($i(r),$i(e));case"Array":return function(i,s){const u=i.length,h=s.length,c=u<h?u:h;for(let b=0;b<c;++b){const p=ht(i[b],s[b]);if(p!==0)return p}return u===h?0:u<h?-1:1}(r,e)}}catch{}return NaN}function Ki(r){const e=typeof r;if(e!=="object")return e;if(ArrayBuffer.isView(r))return"binary";const n=Jr(r);return n==="ArrayBuffer"?"binary":n}function $i(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}class Ws{_read(e,n){var t=this._ctx;return t.error?t.table._trans(null,Qe.bind(null,t.error)):t.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Qe.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=mn(n.algorithm,e)}_iterate(e,n){return ur(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),t=Object.create(this._ctx);return e&&pt(t,e),n._ctx=t,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(t=>ur(n,e,t,n.table.core))}count(e){return this._read(n=>{const t=this._ctx,i=t.table.core;if(vn(t,!0))return i.count({trans:n,query:{index:vr(t,i.schema),range:t.range}}).then(u=>Math.min(u,t.limit));var s=0;return ur(t,()=>(++s,!1),n,i).then(()=>s)}).then(e)}sortBy(e,n){const t=e.split(".").reverse(),i=t[0],s=t.length-1;function u(b,p){return p?u(b[t[p]],p-1):b[i]}var h=this._ctx.dir==="next"?1:-1;function c(b,p){var y=u(b,s),w=u(p,s);return y<w?-h:y>w?h:0}return this.toArray(function(b){return b.sort(c)}).then(n)}toArray(e){return this._read(n=>{var t=this._ctx;if(t.dir==="next"&&vn(t,!0)&&t.limit>0){const{valueMapper:i}=t,s=vr(t,t.table.core.schema);return t.table.core.query({trans:n,limit:t.limit,values:!0,query:{index:s,range:t.range}}).then(({result:u})=>i?u.map(i):u)}{const i=[];return ur(t,s=>i.push(s),n,t.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,vn(n)?Wr(n,()=>{var t=e;return(i,s)=>t===0||(t===1?(--t,!1):(s(()=>{i.advance(t),t=0}),!1))}):Wr(n,()=>{var t=e;return()=>--t<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wr(this._ctx,()=>{var n=e;return function(t,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(e,n){return $r(this._ctx,function(t,i,s){return!e(t.value)||(i(s),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,t;return $r(this._ctx,function(i){return e(i.value)}),n=this._ctx,t=e,n.isMatch=mn(n.isMatch,t),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(t,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(t,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var t=[];return this.each(function(i,s){t.push(s.key)}).then(function(){return t}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&vn(n,!0)&&n.limit>0)return this._read(i=>{var s=vr(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var t=[];return this.each(function(i,s){t.push(s.primaryKey)}).then(function(){return t}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var t={};return $r(this._ctx,function(i){var s=i.primaryKey.toString(),u=St(t,s);return t[s]=!0,!u}),this}modify(e){var n=this._ctx;return this._write(t=>{var i;if(typeof e=="function")i=e;else{var s=Je(e),u=s.length;i=function(S){for(var O=!1,P=0;P<u;++P){var C=s[P],N=e[C];Xt(S,C)!==N&&(Ft(S,C,N),O=!0)}return O}}const h=n.table.core,{outbound:c,extractKey:b}=h.schema.primaryKey,p=this.db._options.modifyChunkSize||200,y=[];let w=0;const T=[],R=(S,O)=>{const{failures:P,numFailures:C}=O;w+=S-C;for(let N of Je(P))y.push(P[N])};return this.clone().primaryKeys().then(S=>{const O=P=>{const C=Math.min(p,S.length-P);return h.getMany({trans:t,keys:S.slice(P,P+C),cache:"immutable"}).then(N=>{const a=[],o=[],d=c?[]:null,l=[];for(let m=0;m<C;++m){const _=N[m],I={value:Jn(_),primKey:S[P+m]};i.call(I,I.value,I)!==!1&&(I.value==null?l.push(S[P+m]):c||ht(b(_),b(I.value))===0?(o.push(I.value),c&&d.push(S[P+m])):(l.push(S[P+m]),a.push(I.value)))}const g=vn(n)&&n.limit===1/0&&(typeof e!="function"||e===zr)&&{index:n.index,range:n.range};return Promise.resolve(a.length>0&&h.mutate({trans:t,type:"add",values:a}).then(m=>{for(let _ in m.failures)l.splice(parseInt(_),1);R(a.length,m)})).then(()=>(o.length>0||g&&typeof e=="object")&&h.mutate({trans:t,type:"put",keys:d,values:o,criteria:g,changeSpec:typeof e!="function"&&e}).then(m=>R(o.length,m))).then(()=>(l.length>0||g&&e===zr)&&h.mutate({trans:t,type:"delete",keys:l,criteria:g}).then(m=>R(l.length,m))).then(()=>S.length>P+C&&O(P+p))})};return O(0).then(()=>{if(y.length>0)throw new Er("Error modifying one or more objects",y,w,T);return S.length})})})}delete(){var e=this._ctx,n=e.range;return vn(e)&&(e.isPrimKey&&!Ks||n.type===3)?this._write(t=>{const{primaryKey:i}=e.table.core.schema,s=n;return e.table.core.count({trans:t,query:{index:i,range:s}}).then(u=>e.table.core.mutate({trans:t,type:"deleteRange",range:s}).then(({failures:h,lastResult:c,results:b,numFailures:p})=>{if(p)throw new Er("Could not delete some values",Object.keys(h).map(y=>h[y]),u-p);return u-p}))}):this.modify(zr)}}const zr=(r,e)=>e.value=null;function zs(r,e){return r<e?-1:r===e?0:1}function qs(r,e){return r>e?-1:r===e?0:1}function Et(r,e,n){var t=r instanceof Ta?new r.Collection(r):r;return t._ctx.error=n?new n(e):new TypeError(e),t}function wn(r){return new r.Collection(r,()=>Oa("")).limit(0)}function Gs(r,e,n,t,i,s){for(var u=Math.min(r.length,t.length),h=-1,c=0;c<u;++c){var b=e[c];if(b!==t[c])return i(r[c],n[c])<0?r.substr(0,c)+n[c]+n.substr(c+1):i(r[c],t[c])<0?r.substr(0,c)+t[c]+n.substr(c+1):h>=0?r.substr(0,h)+e[h]+n.substr(h+1):null;i(r[c],b)<0&&(h=c)}return u<t.length&&s==="next"?r+n.substr(r.length):u<r.length&&s==="prev"?r.substr(0,n.length):h<0?null:r.substr(0,h)+t[h]+n.substr(h+1)}function or(r,e,n,t){var i,s,u,h,c,b,p,y=n.length;if(!n.every(S=>typeof S=="string"))return Et(r,Sa);function w(S){i=function(P){return P==="next"?C=>C.toUpperCase():C=>C.toLowerCase()}(S),s=function(P){return P==="next"?C=>C.toLowerCase():C=>C.toUpperCase()}(S),u=S==="next"?zs:qs;var O=n.map(function(P){return{lower:s(P),upper:i(P)}}).sort(function(P,C){return u(P.lower,C.lower)});h=O.map(function(P){return P.upper}),c=O.map(function(P){return P.lower}),b=S,p=S==="next"?"":t}w("next");var T=new r.Collection(r,()=>Qt(h[0],c[y-1]+t));T._ondirectionchange=function(S){w(S)};var R=0;return T._addAlgorithm(function(S,O,P){var C=S.key;if(typeof C!="string")return!1;var N=s(C);if(e(N,c,R))return!0;for(var a=null,o=R;o<y;++o){var d=Gs(C,N,h[o],c[o],u,b);d===null&&a===null?R=o+1:(a===null||u(a,d)>0)&&(a=d)}return O(a!==null?function(){S.continue(a+p)}:P),!1}),T}function Qt(r,e,n,t){return{type:2,lower:r,upper:e,lowerOpen:n,upperOpen:t}}function Oa(r){return{type:1,lower:r,upper:r}}class Ta{get Collection(){return this._ctx.table.db.Collection}between(e,n,t,i){t=t!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(t||i)&&(!t||!i)?wn(this):new this.Collection(this,()=>Qt(e,n,!t,!i))}catch{return Et(this,$t)}}equals(e){return e==null?Et(this,$t):new this.Collection(this,()=>Oa(e))}above(e){return e==null?Et(this,$t):new this.Collection(this,()=>Qt(e,void 0,!0))}aboveOrEqual(e){return e==null?Et(this,$t):new this.Collection(this,()=>Qt(e,void 0,!1))}below(e){return e==null?Et(this,$t):new this.Collection(this,()=>Qt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Et(this,$t):new this.Collection(this,()=>Qt(void 0,e))}startsWith(e){return typeof e!="string"?Et(this,Sa):this.between(e,e+cn,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):or(this,(n,t)=>n.indexOf(t[0])===0,[e],cn)}equalsIgnoreCase(e){return or(this,(n,t)=>n===t[0],[e],"")}anyOfIgnoreCase(){var e=zt.apply(_n,arguments);return e.length===0?wn(this):or(this,(n,t)=>t.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=zt.apply(_n,arguments);return e.length===0?wn(this):or(this,(n,t)=>t.some(i=>n.indexOf(i)===0),e,cn)}anyOf(){const e=zt.apply(_n,arguments);let n=this._cmp;try{e.sort(n)}catch{return Et(this,$t)}if(e.length===0)return wn(this);const t=new this.Collection(this,()=>Qt(e[0],e[e.length-1]));t._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return t._addAlgorithm((s,u,h)=>{const c=s.key;for(;n(c,e[i])>0;)if(++i,i===e.length)return u(h),!1;return n(c,e[i])===0||(u(()=>{s.continue(e[i])}),!1)}),t}notEqual(e){return this.inAnyRange([[di,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=zt.apply(_n,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Et(this,$t)}const n=e.reduce((t,i)=>t?t.concat([[t[t.length-1][1],i]]):[[di,i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const t=this._cmp,i=this._ascending,s=this._descending,u=this._min,h=this._max;if(e.length===0)return wn(this);if(!e.every(C=>C[0]!==void 0&&C[1]!==void 0&&i(C[0],C[1])<=0))return Et(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",le.InvalidArgument);const c=!n||n.includeLowers!==!1,b=n&&n.includeUppers===!0;let p,y=i;function w(C,N){return y(C[0],N[0])}try{p=e.reduce(function(C,N){let a=0,o=C.length;for(;a<o;++a){const d=C[a];if(t(N[0],d[1])<0&&t(N[1],d[0])>0){d[0]=u(d[0],N[0]),d[1]=h(d[1],N[1]);break}}return a===o&&C.push(N),C},[]),p.sort(w)}catch{return Et(this,$t)}let T=0;const R=b?C=>i(C,p[T][1])>0:C=>i(C,p[T][1])>=0,S=c?C=>s(C,p[T][0])>0:C=>s(C,p[T][0])>=0;let O=R;const P=new this.Collection(this,()=>Qt(p[0][0],p[p.length-1][1],!c,!b));return P._ondirectionchange=C=>{C==="next"?(O=R,y=i):(O=S,y=s),p.sort(w)},P._addAlgorithm((C,N,a)=>{for(var o=C.key;O(o);)if(++T,T===p.length)return N(a),!1;return!!function(d){return!R(d)&&!S(d)}(o)||(this._cmp(o,p[T][1])===0||this._cmp(o,p[T][0])===0||N(()=>{y===i?C.continue(p[T][0]):C.continue(p[T][1])}),!1)}),P}startsWithAnyOf(){const e=zt.apply(_n,arguments);return e.every(n=>typeof n=="string")?e.length===0?wn(this):this.inAnyRange(e.map(n=>[n,n+cn])):Et(this,"startsWithAnyOf() only works with strings")}}function Lt(r){return $e(function(e){return Kn(e),r(e.target.error),!1})}function Kn(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}const $n="storagemutated",tn="x-storagemutated-1",an=Ln(null,$n);class Ys{_lock(){return Rn(!ue.global),++this._reculock,this._reculock!==1||ue.global||(ue.lockOwnerFor=this),this}_unlock(){if(Rn(!ue.global),--this._reculock==0)for(ue.global||(ue.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Dn(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&ue.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,t=this.db._state.dbOpenError;if(Rn(!this.idbtrans),!e&&!n)switch(t&&t.name){case"DatabaseClosedError":throw new le.DatabaseClosed(t);case"MissingAPIError":throw new le.MissingAPI(t.message,t);default:throw new le.OpenFailed(t)}if(!this.active)throw new le.TransactionInactive;return Rn(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=$e(i=>{Kn(i),this._reject(e.error)}),e.onabort=$e(i=>{Kn(i),this.active&&this._reject(new le.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=$e(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&an.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,t){if(e==="readwrite"&&this.mode!=="readwrite")return Qe(new le.ReadOnly("Transaction is readonly"));if(!this.active)return Qe(new le.TransactionInactive);if(this._locked())return new te((s,u)=>{this._blockedFuncs.push([()=>{this._promise(e,n,t).then(s,u)},ue])});if(t)return nn(()=>{var s=new te((u,h)=>{this._lock();const c=n(u,h,this);c&&c.then&&c.then(u,h)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new te((s,u)=>{var h=n(s,u,this);h&&h.then&&h.then(s,u)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const t=te.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>t);else{n._waitingFor=t,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var s=n._waitingFor;return new te((u,h)=>{t.then(c=>n._waitingQueue.push($e(u.bind(null,c))),c=>n._waitingQueue.push($e(h.bind(null,c)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new le.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(St(n,e))return n[e];const t=this.schema[e];if(!t)throw new le.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,t,this);return i.core=this.db.core.table(e),n[e]=i,i}}function ci(r,e,n,t,i,s,u){return{name:r,keyPath:e,unique:n,multi:t,auto:i,compound:s,src:(n&&!u?"&":"")+(t?"*":"")+(i?"++":"")+ka(e)}}function ka(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Da(r,e,n){return{name:r,primKey:e,indexes:n,mappedClass:null,idxByName:ua(n,t=>[t.name,t])}}let Wn=r=>{try{return r.only([[]]),Wn=()=>[[]],[[]]}catch{return Wn=()=>cn,cn}};function li(r){return r==null?()=>{}:typeof r=="string"?function(e){return e.split(".").length===1?t=>t[e]:t=>Xt(t,e)}(r):e=>Xt(e,r)}function Wi(r){return[].slice.call(r)}let Xs=0;function xn(r){return r==null?":id":typeof r=="string"?r:`[${r.join("+")}]`}function Js(r,e,n){function t(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:b,upper:p,lowerOpen:y,upperOpen:w}=c;return b===void 0?p===void 0?null:e.upperBound(p,!!w):p===void 0?e.lowerBound(b,!!y):e.bound(b,p,!!y,!!w)}const{schema:i,hasGetAll:s}=function(c,b){const p=Wi(c.objectStoreNames);return{schema:{name:c.name,tables:p.map(y=>b.objectStore(y)).map(y=>{const{keyPath:w,autoIncrement:T}=y,R=ut(w),S=w==null,O={},P={name:y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:S,compound:R,keyPath:w,autoIncrement:T,unique:!0,extractKey:li(w)},indexes:Wi(y.indexNames).map(C=>y.index(C)).map(C=>{const{name:N,unique:a,multiEntry:o,keyPath:d}=C,l={name:N,compound:ut(d),keyPath:d,unique:a,multiEntry:o,extractKey:li(d)};return O[xn(d)]=l,l}),getIndexByKeyPath:C=>O[xn(C)]};return O[":id"]=P.primaryKey,w!=null&&(O[xn(w)]=P.primaryKey),P})},hasGetAll:p.length>0&&"getAll"in b.objectStore(p[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(r,n),u=i.tables.map(c=>function(b){const p=b.name;return{name:p,schema:b,mutate:function({trans:y,type:w,keys:T,values:R,range:S}){return new Promise((O,P)=>{O=$e(O);const C=y.objectStore(p),N=C.keyPath==null,a=w==="put"||w==="add";if(!a&&w!=="delete"&&w!=="deleteRange")throw new Error("Invalid operation type: "+w);const{length:o}=T||R||{length:1};if(T&&R&&T.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(o===0)return O({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const l=[],g=[];let m=0;const _=V=>{++m,Kn(V)};if(w==="deleteRange"){if(S.type===4)return O({numFailures:m,failures:g,results:[],lastResult:void 0});S.type===3?l.push(d=C.clear()):l.push(d=C.delete(t(S)))}else{const[V,F]=a?N?[R,T]:[R,null]:[T,null];if(a)for(let j=0;j<o;++j)l.push(d=F&&F[j]!==void 0?C[w](V[j],F[j]):C[w](V[j])),d.onerror=_;else for(let j=0;j<o;++j)l.push(d=C[w](V[j])),d.onerror=_}const I=V=>{const F=V.target.result;l.forEach((j,W)=>j.error!=null&&(g[W]=j.error)),O({numFailures:m,failures:g,results:w==="delete"?T:l.map(j=>j.result),lastResult:F})};d.onerror=V=>{_(V),I(V)},d.onsuccess=I})},getMany:({trans:y,keys:w})=>new Promise((T,R)=>{T=$e(T);const S=y.objectStore(p),O=w.length,P=new Array(O);let C,N=0,a=0;const o=l=>{const g=l.target;P[g._pos]=g.result,++a===N&&T(P)},d=Lt(R);for(let l=0;l<O;++l)w[l]!=null&&(C=S.get(w[l]),C._pos=l,C.onsuccess=o,C.onerror=d,++N);N===0&&T(P)}),get:({trans:y,key:w})=>new Promise((T,R)=>{T=$e(T);const S=y.objectStore(p).get(w);S.onsuccess=O=>T(O.target.result),S.onerror=Lt(R)}),query:function(y){return w=>new Promise((T,R)=>{T=$e(T);const{trans:S,values:O,limit:P,query:C}=w,N=P===1/0?void 0:P,{index:a,range:o}=C,d=S.objectStore(p),l=a.isPrimaryKey?d:d.index(a.name),g=t(o);if(P===0)return T({result:[]});if(y){const m=O?l.getAll(g,N):l.getAllKeys(g,N);m.onsuccess=_=>T({result:_.target.result}),m.onerror=Lt(R)}else{let m=0;const _=O||!("openKeyCursor"in l)?l.openCursor(g):l.openKeyCursor(g),I=[];_.onsuccess=V=>{const F=_.result;return F?(I.push(O?F.value:F.primaryKey),++m===P?T({result:I}):void F.continue()):T({result:I})},_.onerror=Lt(R)}})}(s),openCursor:function({trans:y,values:w,query:T,reverse:R,unique:S}){return new Promise((O,P)=>{O=$e(O);const{index:C,range:N}=T,a=y.objectStore(p),o=C.isPrimaryKey?a:a.index(C.name),d=R?S?"prevunique":"prev":S?"nextunique":"next",l=w||!("openKeyCursor"in o)?o.openCursor(t(N),d):o.openKeyCursor(t(N),d);l.onerror=Lt(P),l.onsuccess=$e(g=>{const m=l.result;if(!m)return void O(null);m.___id=++Xs,m.done=!1;const _=m.continue.bind(m);let I=m.continuePrimaryKey;I&&(I=I.bind(m));const V=m.advance.bind(m),F=()=>{throw new Error("Cursor not stopped")};m.trans=y,m.stop=m.continue=m.continuePrimaryKey=m.advance=()=>{throw new Error("Cursor not started")},m.fail=$e(P),m.next=function(){let j=1;return this.start(()=>j--?this.continue():this.stop()).then(()=>this)},m.start=j=>{const W=new Promise((H,q)=>{H=$e(H),l.onerror=Lt(q),m.fail=q,m.stop=X=>{m.stop=m.continue=m.continuePrimaryKey=m.advance=F,H(X)}}),A=()=>{if(l.result)try{j()}catch(H){m.fail(H)}else m.done=!0,m.start=()=>{throw new Error("Cursor behind last entry")},m.stop()};return l.onsuccess=$e(H=>{l.onsuccess=A,A()}),m.continue=_,m.continuePrimaryKey=I,m.advance=V,A(),W},O(m)},P)})},count({query:y,trans:w}){const{index:T,range:R}=y;return new Promise((S,O)=>{const P=w.objectStore(p),C=T.isPrimaryKey?P:P.index(T.name),N=t(R),a=N?C.count(N):C.count();a.onsuccess=$e(o=>S(o.target.result)),a.onerror=Lt(O)})}}}(c)),h={};return u.forEach(c=>h[c.name]=c),{stack:"dbcore",transaction:r.transaction.bind(r),table(c){if(!h[c])throw new Error(`Table '${c}' not found`);return h[c]},MIN_KEY:-1/0,MAX_KEY:Wn(e),schema:i}}function fi({_novip:r},e){const n=e.db,t=function(i,s,{IDBKeyRange:u,indexedDB:h},c){return{dbcore:function(p,y){return y.reduce((w,{create:T})=>({...w,...T(w)}),p)}(Js(s,u,c),i.dbcore)}}(r._middlewares,n,r._deps,e);r.core=t.dbcore,r.tables.forEach(i=>{const s=i.name;r.core.schema.tables.some(u=>u.name===s)&&(i.core=r.core.table(s),r[s]instanceof r.Table&&(r[s].core=i.core))})}function Or({_novip:r},e,n,t){n.forEach(i=>{const s=t[i];e.forEach(u=>{const h=Ei(u,i);(!h||"value"in h&&h.value===void 0)&&(u===r.Transaction.prototype||u instanceof r.Transaction?Yt(u,i,{get(){return this.table(i)},set(c){ia(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):u[i]=new r.Table(i,s))})})}function hi({_novip:r},e){e.forEach(n=>{for(let t in n)n[t]instanceof r.Table&&delete n[t]})}function Zs(r,e){return r._cfg.version-e._cfg.version}function Qs(r,e,n,t){const i=r._dbSchema,s=r._createTransaction("readwrite",r._storeNames,i);s.create(n),s._completion.catch(t);const u=s._reject.bind(s),h=ue.transless||ue;nn(()=>{ue.trans=s,ue.transless=h,e===0?(Je(i).forEach(c=>{qr(n,c,i[c].primKey,i[c].indexes)}),fi(r,n),te.follow(()=>r.on.populate.fire(s)).catch(u)):function({_novip:c},b,p,y){const w=[],T=c._versions;let R=c._dbSchema=mi(c,c.idbdb,y),S=!1;const O=T.filter(C=>C._cfg.version>=b);function P(){return w.length?te.resolve(w.shift()(p.idbtrans)).then(P):te.resolve()}return O.forEach(C=>{w.push(()=>{const N=R,a=C._cfg.dbschema;yi(c,N,y),yi(c,a,y),R=c._dbSchema=a;const o=Pa(N,a);o.add.forEach(l=>{qr(y,l[0],l[1].primKey,l[1].indexes)}),o.change.forEach(l=>{if(l.recreate)throw new le.Upgrade("Not yet support for changing primary key");{const g=y.objectStore(l.name);l.add.forEach(m=>pi(g,m)),l.change.forEach(m=>{g.deleteIndex(m.name),pi(g,m)}),l.del.forEach(m=>g.deleteIndex(m))}});const d=C._cfg.contentUpgrade;if(d&&C._cfg.version>b){fi(c,y),p._memoizedTables={},S=!0;let l=oa(a);o.del.forEach(I=>{l[I]=N[I]}),hi(c,[c.Transaction.prototype]),Or(c,[c.Transaction.prototype],Je(l),l),p.schema=l;const g=Ai(d);let m;g&&kn();const _=te.follow(()=>{if(m=d(p),m&&g){var I=Jt.bind(null,null);m.then(I,I)}});return m&&typeof m.then=="function"?te.resolve(m):_.then(()=>m)}}),w.push(N=>{(!S||!Vs)&&function(a,o){[].slice.call(o.db.objectStoreNames).forEach(d=>a[d]==null&&o.db.deleteObjectStore(d))}(C._cfg.dbschema,N),hi(c,[c.Transaction.prototype]),Or(c,[c.Transaction.prototype],c._storeNames,c._dbSchema),p.schema=c._dbSchema})}),P().then(()=>{var C,N;N=y,Je(C=R).forEach(a=>{N.db.objectStoreNames.contains(a)||qr(N,a,C[a].primKey,C[a].indexes)})})}(r,e,s,n).catch(u)})}function Pa(r,e){const n={del:[],add:[],change:[]};let t;for(t in r)e[t]||n.del.push(t);for(t in e){const i=r[t],s=e[t];if(i){const u={name:t,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Rr)u.recreate=!0,n.change.push(u);else{const h=i.idxByName,c=s.idxByName;let b;for(b in h)c[b]||u.del.push(b);for(b in c){const p=h[b],y=c[b];p?p.src!==y.src&&u.change.push(y):u.add.push(y)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}else n.add.push([t,s])}return n}function qr(r,e,n,t){const i=r.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return t.forEach(s=>pi(i,s)),i}function pi(r,e){r.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function mi(r,e,n){const t={};return _r(e.objectStoreNames,0).forEach(i=>{const s=n.objectStore(i);let u=s.keyPath;const h=ci(ka(u),u||"",!1,!1,!!s.autoIncrement,u&&typeof u!="string",!0),c=[];for(let p=0;p<s.indexNames.length;++p){const y=s.index(s.indexNames[p]);u=y.keyPath;var b=ci(y.name,u,!!y.unique,!!y.multiEntry,!1,u&&typeof u!="string",!1);c.push(b)}t[i]=Da(i,h,c)}),t}function yi({_novip:r},e,n){const t=n.db.objectStoreNames;for(let i=0;i<t.length;++i){const s=t[i],u=n.objectStore(s);r._hasGetAll="getAll"in u;for(let h=0;h<u.indexNames.length;++h){const c=u.indexNames[h],b=u.index(c).keyPath,p=typeof b=="string"?b:"["+_r(b).join("+")+"]";if(e[s]){const y=e[s].idxByName[p];y&&(y.name=c,delete e[s].idxByName[p],e[s].idxByName[c]=y)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Ve.WorkerGlobalScope&&Ve instanceof Ve.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}class eu{_parseStoresSpec(e,n){Je(e).forEach(t=>{if(e[t]!==null){var i=e[t].split(",").map((u,h)=>{const c=(u=u.trim()).replace(/([&*]|\+\+)/g,""),b=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return ci(c,b||null,/\&/.test(u),/\*/.test(u),/\+\+/.test(u),ut(b),h===0)}),s=i.shift();if(s.multi)throw new le.Schema("Primary key cannot be multi-valued");i.forEach(u=>{if(u.auto)throw new le.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new le.Schema("Index must have a name and cannot be an empty string")}),n[t]=Da(t,s,i)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?pt(this._cfg.storesSource,e):e;const t=n._versions,i={};let s={};return t.forEach(u=>{pt(i,u._cfg.storesSource),s=u._cfg.dbschema={},u._parseStoresSpec(i,s)}),n._dbSchema=s,hi(n,[n._allTables,n,n.Transaction.prototype]),Or(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Je(s),s),n._storeNames=Je(s),this}upgrade(e){return this._cfg.contentUpgrade=Ii(this._cfg.contentUpgrade||Fe,e),this}}function Di(r,e){let n=r._dbNamesDB;return n||(n=r._dbNamesDB=new hn(Nr,{addons:[],indexedDB:r,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Pi(r){return r&&typeof r.databases=="function"}function gi(r){return nn(function(){return ue.letThrough=!0,r()})}function tu(){var r;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};r=setInterval(n,100),n()}).finally(function(){return clearInterval(r)}):Promise.resolve()}function nu(r){const e=r._state,{indexedDB:n}=r._deps;if(e.isBeingOpened||r.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Qe(e.dbOpenError):r);Ut&&(e.openCanceller._stackHolder=gn()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const t=e.openCanceller;function i(){if(e.openCanceller!==t)throw new le.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,u=null,h=!1;return te.race([t,(typeof navigator>"u"?te.resolve():tu()).then(()=>new te((c,b)=>{if(i(),!n)throw new le.MissingAPI;const p=r.name,y=e.autoSchema?n.open(p):n.open(p,Math.round(10*r.verno));if(!y)throw new le.MissingAPI;y.onerror=Lt(b),y.onblocked=$e(r._fireOnBlocked),y.onupgradeneeded=$e(w=>{if(u=y.transaction,e.autoSchema&&!r._options.allowEmptyDB){y.onerror=Kn,u.abort(),y.result.close();const R=n.deleteDatabase(p);R.onsuccess=R.onerror=$e(()=>{b(new le.NoSuchDatabase(`Database ${p} doesnt exist`))})}else{u.onerror=Lt(b);var T=w.oldVersion>Math.pow(2,62)?0:w.oldVersion;h=T<1,r._novip.idbdb=y.result,Qs(r,T/10,u,b)}},b),y.onsuccess=$e(()=>{u=null;const w=r._novip.idbdb=y.result,T=_r(w.objectStoreNames);if(T.length>0)try{const S=w.transaction((R=T).length===1?R[0]:R,"readonly");e.autoSchema?function({_novip:O},P,C){O.verno=P.version/10;const N=O._dbSchema=mi(0,P,C);O._storeNames=_r(P.objectStoreNames,0),Or(O,[O._allTables],Je(N),N)}(r,w,S):(yi(r,r._dbSchema,S),function(O,P){const C=Pa(mi(0,O.idbdb,P),O._dbSchema);return!(C.add.length||C.change.some(N=>N.add.length||N.change.length))}(r,S)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),fi(r,S)}catch{}var R;Mn.push(r),w.onversionchange=$e(S=>{e.vcFired=!0,r.on("versionchange").fire(S)}),w.onclose=$e(S=>{r.on("close").fire(S)}),h&&function({indexedDB:S,IDBKeyRange:O},P){!Pi(S)&&P!==Nr&&Di(S,O).put({name:P}).catch(Fe)}(r._deps,p),c()},b)}))]).then(()=>(i(),e.onReadyBeingFired=[],te.resolve(gi(()=>r.on.ready.fire(r.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let b=e.onReadyBeingFired.reduce(Ii,Fe);return e.onReadyBeingFired=[],te.resolve(gi(()=>b(r.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>r).catch(c=>{e.dbOpenError=c;try{u&&u.abort()}catch{}return t===e.openCanceller&&r._close(),Qe(c)}).finally(()=>{e.openComplete=!0,s()})}function bi(r){var e=s=>r.next(s),n=i(e),t=i(s=>r.throw(s));function i(s){return u=>{var h=s(u),c=h.value;return h.done?c:c&&typeof c.then=="function"?c.then(n,t):ut(c)?Promise.all(c).then(n,t):n(c)}}return i(e)()}function ru(r,e,n){var t=arguments.length;if(t<2)throw new le.InvalidArgument("Too few arguments");for(var i=new Array(t-1);--t;)i[t-1]=arguments[t];return n=i.pop(),[r,da(i),n]}function Ba(r,e,n,t,i){return te.resolve().then(()=>{const s=ue.transless||ue,u=r._createTransaction(e,n,r._dbSchema,t),h={trans:u,transless:s};if(t)u.idbtrans=t.idbtrans;else try{u.create(),r._state.PR1398_maxLoop=3}catch(y){return y.name===Ci.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>Ba(r,e,n,null,i))):Qe(y)}const c=Ai(i);let b;c&&kn();const p=te.follow(()=>{if(b=i.call(u,u),b)if(c){var y=Jt.bind(null,null);b.then(y,y)}else typeof b.next=="function"&&typeof b.throw=="function"&&(b=bi(b))},h);return(b&&typeof b.then=="function"?te.resolve(b).then(y=>u.active?y:Qe(new le.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):p.then(()=>b)).then(y=>(t&&u._resolve(),u._completion.then(()=>y))).catch(y=>(u._reject(y),Qe(y)))})}function dr(r,e,n){const t=ut(r)?r.slice():[r];for(let i=0;i<n;++i)t.push(e);return t}const iu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return{...r,table(e){const n=r.table(e),{schema:t}=n,i={},s=[];function u(p,y,w){const T=xn(p),R=i[T]=i[T]||[],S=p==null?0:typeof p=="string"?1:p.length,O=y>0,P={...w,isVirtual:O,keyTail:y,keyLength:S,extractKey:li(p),unique:!O&&w.unique};return R.push(P),P.isPrimaryKey||s.push(P),S>1&&u(S===2?p[0]:p.slice(0,S-1),y+1,w),R.sort((C,N)=>C.keyTail-N.keyTail),P}const h=u(t.primaryKey.keyPath,0,t.primaryKey);i[":id"]=[h];for(const p of t.indexes)u(p.keyPath,0,p);function c(p){const y=p.query.index;return y.isVirtual?{...p,query:{index:y,range:(w=p.query.range,T=y.keyTail,{type:w.type===1?2:w.type,lower:dr(w.lower,w.lowerOpen?r.MAX_KEY:r.MIN_KEY,T),lowerOpen:!0,upper:dr(w.upper,w.upperOpen?r.MIN_KEY:r.MAX_KEY,T),upperOpen:!0})}}:p;var w,T}return{...n,schema:{...t,primaryKey:h,indexes:s,getIndexByKeyPath:function(p){const y=i[xn(p)];return y&&y[0]}},count:p=>n.count(c(p)),query:p=>n.query(c(p)),openCursor(p){const{keyTail:y,isVirtual:w,keyLength:T}=p.query.index;return w?n.openCursor(c(p)).then(R=>R&&function(S){return Object.create(S,{continue:{value:function(P){P!=null?S.continue(dr(P,p.reverse?r.MAX_KEY:r.MIN_KEY,y)):p.unique?S.continue(S.key.slice(0,T).concat(p.reverse?r.MIN_KEY:r.MAX_KEY,y)):S.continue()}},continuePrimaryKey:{value(P,C){S.continuePrimaryKey(dr(P,r.MAX_KEY,y),C)}},primaryKey:{get:()=>S.primaryKey},key:{get(){const P=S.key;return T===1?P[0]:P.slice(0,T)}},value:{get:()=>S.value}})}(R)):n.openCursor(p)}}}}}};function Bi(r,e,n,t){return n=n||{},t=t||"",Je(r).forEach(i=>{if(St(e,i)){var s=r[i],u=e[i];if(typeof s=="object"&&typeof u=="object"&&s&&u){const h=Jr(s);h!==Jr(u)?n[t+i]=e[i]:h==="Object"?Bi(s,u,n,t+i+"."):s!==u&&(n[t+i]=e[i])}else s!==u&&(n[t+i]=e[i])}else n[t+i]=void 0}),Je(e).forEach(i=>{St(r,i)||(n[t+i]=e[i])}),n}const au={stack:"dbcore",name:"HooksMiddleware",level:2,create:r=>({...r,table(e){const n=r.table(e),{primaryKey:t}=n.schema;return{...n,mutate(s){const u=ue.trans,{deleting:h,creating:c,updating:b}=u.table(e).hook;switch(s.type){case"add":if(c.fire===Fe)break;return u._promise("readwrite",()=>p(s),!0);case"put":if(c.fire===Fe&&b.fire===Fe)break;return u._promise("readwrite",()=>p(s),!0);case"delete":if(h.fire===Fe)break;return u._promise("readwrite",()=>p(s),!0);case"deleteRange":if(h.fire===Fe)break;return u._promise("readwrite",()=>function(w){return y(w.trans,w.range,1e4)}(s),!0)}return n.mutate(s);function p(w){const T=ue.trans,R=w.keys||function(S,O){return O.type==="delete"?O.keys:O.keys||O.values.map(S.extractKey)}(t,w);if(!R)throw new Error("Keys missing");return(w=w.type==="add"||w.type==="put"?{...w,keys:R}:{...w}).type!=="delete"&&(w.values=[...w.values]),w.keys&&(w.keys=[...w.keys]),function(S,O,P){return O.type==="add"?Promise.resolve([]):S.getMany({trans:O.trans,keys:P,cache:"immutable"})}(n,w,R).then(S=>{const O=R.map((P,C)=>{const N=S[C],a={onerror:null,onsuccess:null};if(w.type==="delete")h.fire.call(a,P,N,T);else if(w.type==="add"||N===void 0){const o=c.fire.call(a,P,w.values[C],T);P==null&&o!=null&&(P=o,w.keys[C]=P,t.outbound||Ft(w.values[C],t.keyPath,P))}else{const o=Bi(N,w.values[C]),d=b.fire.call(a,o,P,N,T);if(d){const l=w.values[C];Object.keys(d).forEach(g=>{St(l,g)?l[g]=d[g]:Ft(l,g,d[g])})}}return a});return n.mutate(w).then(({failures:P,results:C,numFailures:N,lastResult:a})=>{for(let o=0;o<R.length;++o){const d=C?C[o]:R[o],l=O[o];d==null?l.onerror&&l.onerror(P[o]):l.onsuccess&&l.onsuccess(w.type==="put"&&S[o]?w.values[o]:d)}return{failures:P,results:C,numFailures:N,lastResult:a}}).catch(P=>(O.forEach(C=>C.onerror&&C.onerror(P)),Promise.reject(P)))})}function y(w,T,R){return n.query({trans:w,values:!1,query:{index:t,range:T},limit:R}).then(({result:S})=>p({type:"delete",keys:S,trans:w}).then(O=>O.numFailures>0?Promise.reject(O.failures[0]):S.length<R?{failures:[],numFailures:0,lastResult:void 0}:y(w,{...T,lower:S[S.length-1],lowerOpen:!0},R)))}}}}})};function Ra(r,e,n){try{if(!e||e.keys.length<r.length)return null;const t=[];for(let i=0,s=0;i<e.keys.length&&s<r.length;++i)ht(e.keys[i],r[s])===0&&(t.push(n?Jn(e.values[i]):e.values[i]),++s);return t.length===r.length?t:null}catch{return null}}const su={stack:"dbcore",level:-1,create:r=>({table:e=>{const n=r.table(e);return{...n,getMany:t=>{if(!t.cache)return n.getMany(t);const i=Ra(t.keys,t.trans._cache,t.cache==="clone");return i?te.resolve(i):n.getMany(t).then(s=>(t.trans._cache={keys:t.keys,values:t.cache==="clone"?Jn(s):s},s))},mutate:t=>(t.type!=="add"&&(t.trans._cache=null),n.mutate(t))}}})};function Ri(r){return!("from"in r)}const Wt=function(r,e){if(!this){const n=new Wt;return r&&"d"in r&&pt(n,r),n}pt(this,arguments.length?{d:1,from:r,to:arguments.length>1?e:r}:{d:0})};function zn(r,e,n){const t=ht(e,n);if(isNaN(t))return;if(t>0)throw RangeError();if(Ri(r))return pt(r,{from:e,to:n,d:1});const i=r.l,s=r.r;if(ht(n,r.from)<0)return i?zn(i,e,n):r.l={from:e,to:n,d:1,l:null,r:null},zi(r);if(ht(e,r.to)>0)return s?zn(s,e,n):r.r={from:e,to:n,d:1,l:null,r:null},zi(r);ht(e,r.from)<0&&(r.from=e,r.l=null,r.d=s?s.d+1:1),ht(n,r.to)>0&&(r.to=n,r.r=null,r.d=r.l?r.l.d+1:1);const u=!r.r;i&&!r.l&&Tr(r,i),s&&u&&Tr(r,s)}function Tr(r,e){Ri(e)||function n(t,{from:i,to:s,l:u,r:h}){zn(t,i,s),u&&n(t,u),h&&n(t,h)}(r,e)}function uu(r,e){const n=vi(e);let t=n.next();if(t.done)return!1;let i=t.value;const s=vi(r);let u=s.next(i.from),h=u.value;for(;!t.done&&!u.done;){if(ht(h.from,i.to)<=0&&ht(h.to,i.from)>=0)return!0;ht(i.from,h.from)<0?i=(t=n.next(h.from)).value:h=(u=s.next(i.from)).value}return!1}function vi(r){let e=Ri(r)?null:{s:0,n:r};return{next(n){const t=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,t)for(;e.n.l&&ht(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!t||ht(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function zi(r){var e,n;const t=(((e=r.r)===null||e===void 0?void 0:e.d)||0)-(((n=r.l)===null||n===void 0?void 0:n.d)||0),i=t>1?"r":t<-1?"l":"";if(i){const s=i==="r"?"l":"r",u={...r},h=r[i];r.from=h.from,r.to=h.to,r[i]=h[i],u[i]=h[s],r[s]=u,u.d=qi(u)}r.d=qi(r)}function qi({r,l:e}){return(r?e?Math.max(r.d,e.d):r.d:e?e.d:0)+1}In(Wt.prototype,{add(r){return Tr(this,r),this},addKey(r){return zn(this,r,r),this},addKeys(r){return r.forEach(e=>zn(this,e,e)),this},[Zr](){return vi(this)}});const ou={stack:"dbcore",level:0,create:r=>{const e=r.schema.name,n=new Wt(r.MIN_KEY,r.MAX_KEY);return{...r,table:t=>{const i=r.table(t),{schema:s}=i,{primaryKey:u}=s,{extractKey:h,outbound:c}=u,b={...i,mutate:w=>{const T=w.trans,R=T.mutatedParts||(T.mutatedParts={}),S=d=>{const l=`idb://${e}/${t}/${d}`;return R[l]||(R[l]=new Wt)},O=S(""),P=S(":dels"),{type:C}=w;let[N,a]=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[[],w.values]:[];const o=w.trans._cache;return i.mutate(w).then(d=>{if(ut(N)){C!=="delete"&&(N=d.results),O.addKeys(N);const l=Ra(N,o);l||C==="add"||P.addKeys(N),(l||a)&&function(g,m,_,I){function V(F){const j=g(F.name||"");function W(H){return H!=null?F.extractKey(H):null}const A=H=>F.multiEntry&&ut(H)?H.forEach(q=>j.addKey(q)):j.addKey(H);(_||I).forEach((H,q)=>{const X=_&&W(_[q]),me=I&&W(I[q]);ht(X,me)!==0&&(X!=null&&A(X),me!=null&&A(me))})}m.indexes.forEach(V)}(S,s,l,a)}else if(N){const l={from:N.lower,to:N.upper};P.add(l),O.add(l)}else O.add(n),P.add(n),s.indexes.forEach(l=>S(l.name).add(n));return d})}},p=({query:{index:w,range:T}})=>{var R,S;return[w,new Wt((R=T.lower)!==null&&R!==void 0?R:r.MIN_KEY,(S=T.upper)!==null&&S!==void 0?S:r.MAX_KEY)]},y={get:w=>[u,new Wt(w.key)],getMany:w=>[u,new Wt().addKeys(w.keys)],count:p,query:p,openCursor:p};return Je(y).forEach(w=>{b[w]=function(T){const{subscr:R}=ue;if(R){const S=a=>{const o=`idb://${e}/${t}/${a}`;return R[o]||(R[o]=new Wt)},O=S(""),P=S(":dels"),[C,N]=y[w](T);if(S(C.name||"").add(N),!C.isPrimaryKey){if(w!=="count"){const a=w==="query"&&c&&T.values&&i.query({...T,values:!1});return i[w].apply(this,arguments).then(o=>{if(w==="query"){if(c&&T.values)return a.then(({result:l})=>(O.addKeys(l),o));const d=T.values?o.result.map(h):o.result;T.values?O.addKeys(d):P.addKeys(d)}else if(w==="openCursor"){const d=o,l=T.values;return d&&Object.create(d,{key:{get:()=>(P.addKey(d.primaryKey),d.key)},primaryKey:{get(){const g=d.primaryKey;return P.addKey(g),g}},value:{get:()=>(l&&O.addKey(d.primaryKey),d.value)}})}return o})}P.add(n)}}return i[w].apply(this,arguments)}}),b}}}};class hn{constructor(e,n){this._middlewares={},this.verno=0;const t=hn.dependencies;this._options=n={addons:hn.addons,autoOpen:!0,indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Fe,dbReadyPromise:null,cancelOpen:Fe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var u;s.dbReadyPromise=new te(h=>{s.dbReadyResolve=h}),s.openCanceller=new te((h,c)=>{s.cancelOpen=c}),this._state=s,this.name=e,this.on=Ln(this,"populate","blocked","versionchange","close",{ready:[Ii,Fe]}),this.on.ready.subscribe=aa(this.on.ready.subscribe,h=>(c,b)=>{hn.vip(()=>{const p=this._state;if(p.openComplete)p.dbOpenError||te.resolve().then(c),b&&h(c);else if(p.onReadyBeingFired)p.onReadyBeingFired.push(c),b&&h(c);else{h(c);const y=this;b||h(function w(){y.on.ready.unsubscribe(c),y.on.ready.unsubscribe(w)})}})}),this.Collection=(u=this,Pn(Ws.prototype,function(h,c){this.db=u;let b=Ia,p=null;if(c)try{b=c()}catch(R){p=R}const y=h._ctx,w=y.table,T=w.hook.reading.fire;this._ctx={table:w,index:y.index,isPrimKey:!y.index||w.schema.primKey.keyPath&&y.index===w.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:p,or:y.or,valueMapper:T!==Un?T:null}})),this.Table=function(h){return Pn($s.prototype,function(c,b,p){this.db=h,this._tx=p,this.name=c,this.schema=b,this.hook=h._allTables[c]?h._allTables[c].hook:Ln(null,{creating:[Bs,Fe],reading:[Ps,Un],updating:[Ns,Fe],deleting:[Rs,Fe]})})}(this),this.Transaction=function(h){return Pn(Ys.prototype,function(c,b,p,y,w){this.db=h,this.mode=c,this.storeNames=b,this.schema=p,this.chromeTransactionDurability=y,this.idbtrans=null,this.on=Ln(this,"complete","error","abort"),this.parent=w||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te((T,R)=>{this._resolve=T,this._reject=R}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},T=>{var R=this.active;return this.active=!1,this.on.error.fire(T),this.parent?this.parent._reject(T):R&&this.idbtrans&&this.idbtrans.abort(),Qe(T)})})}(this),this.Version=function(h){return Pn(eu.prototype,function(c){this.db=h,this._cfg={version:c,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(h){return Pn(Ta.prototype,function(c,b,p){this.db=h,this._ctx={table:c,index:b===":id"?null:b,or:p};const y=h._deps.indexedDB;if(!y)throw new le.MissingAPI;this._cmp=this._ascending=y.cmp.bind(y),this._descending=(w,T)=>y.cmp(T,w),this._max=(w,T)=>y.cmp(w,T)>0?w:T,this._min=(w,T)=>y.cmp(w,T)<0?w:T,this._IDBKeyRange=h._deps.IDBKeyRange})}(this),this.on("versionchange",h=>{h.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",h=>{!h.newVersion||h.newVersion<h.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${h.oldVersion/10}`)}),this._maxKey=Wn(n.IDBKeyRange),this._createTransaction=(h,c,b,p)=>new this.Transaction(h,c,b,this._options.chromeTransactionDurability,p),this._fireOnBlocked=h=>{this.on("blocked").fire(h),Mn.filter(c=>c.name===this.name&&c!==this&&!c._state.vcFired).map(c=>c.on("versionchange").fire(h))},this.use(iu),this.use(au),this.use(ou),this.use(su),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(h=>h(this))}version(e){if(isNaN(e)||e<.1)throw new le.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new le.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var t=n.filter(i=>i._cfg.version===e)[0];return t||(t=new this.Version(e),n.push(t),n.sort(Zs),t.stores({}),this._state.autoSchema=!1,t)}_whenReady(e){return this.idbdb&&(this._state.openComplete||ue.letThrough||this._vip)?e():new te((n,t)=>{if(this._state.openComplete)return t(new le.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new le.DatabaseClosed);this.open().catch(Fe)}this._state.dbReadyPromise.then(n,t)}).then(e)}use({stack:e,create:n,level:t,name:i}){i&&this.unuse({stack:e,name:i});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:t??10,name:i}),s.sort((u,h)=>u.level-h.level),this}unuse({stack:e,name:n,create:t}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>t?i.create!==t:!!n&&i.name!==n)),this}open(){return nu(this)}_close(){const e=this._state,n=Mn.indexOf(this);if(n>=0&&Mn.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new te(t=>{e.dbReadyResolve=t}),e.openCanceller=new te((t,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new le.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new te((t,i)=>{const s=()=>{this.close();var u=this._deps.indexedDB.deleteDatabase(this.name);u.onsuccess=$e(()=>{(function({indexedDB:h,IDBKeyRange:c},b){!Pi(h)&&b!==Nr&&Di(h,c).delete(b).catch(Fe)})(this._deps,this.name),t()}),u.onerror=Lt(i),u.onblocked=this._fireOnBlocked};if(e)throw new le.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Je(this._allTables).map(e=>this._allTables[e])}transaction(){const e=ru.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,t){let i=ue.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const s=e.indexOf("?")!==-1;let u,h;e=e.replace("!","").replace("?","");try{if(h=n.map(b=>{var p=b instanceof this.Table?b.name:b;if(typeof p!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return p}),e=="r"||e===Vr)u=Vr;else{if(e!="rw"&&e!=Kr)throw new le.InvalidArgument("Invalid transaction mode: "+e);u=Kr}if(i){if(i.mode===Vr&&u===Kr){if(!s)throw new le.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&h.forEach(b=>{if(i&&i.storeNames.indexOf(b)===-1){if(!s)throw new le.SubTransaction("Table "+b+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(b){return i?i._promise(null,(p,y)=>{y(b)}):Qe(b)}const c=Ba.bind(null,this,u,h,i,t);return i?i._promise(u,c,"lock"):ue.trans?Dn(ue.transless,()=>this._whenReady(c)):this._whenReady(c)}table(e){if(!St(this._allTables,e))throw new le.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const du=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class cu{constructor(e){this._subscribe=e}subscribe(e,n,t){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:t})}[du](){return this}}function Na(r,e){return Je(e).forEach(n=>{Tr(r[n]||(r[n]=new Wt),e[n])}),r}function lu(r){let e,n=!1;const t=new cu(i=>{const s=Ai(r);let u=!1,h={},c={};const b={get closed(){return u},unsubscribe:()=>{u=!0,an.storagemutated.unsubscribe(T)}};i.start&&i.start(b);let p=!1,y=!1;function w(){return Je(c).some(S=>h[S]&&uu(h[S],c[S]))}const T=S=>{Na(h,S),w()&&R()},R=()=>{if(p||u)return;h={};const S={},O=function(P){s&&kn();const C=()=>nn(r,{subscr:P,trans:null}),N=ue.trans?Dn(ue.transless,C):C();return s&&N.then(Jt,Jt),N}(S);y||(an($n,T),y=!0),p=!0,Promise.resolve(O).then(P=>{n=!0,e=P,p=!1,u||(w()?R():(h={},c=S,i.next&&i.next(P)))},P=>{p=!1,n=!1,i.error&&i.error(P),b.unsubscribe()})};return R(),b});return t.hasValue=()=>n,t.getValue=()=>e,t}let wi;try{wi={indexedDB:Ve.indexedDB||Ve.mozIndexedDB||Ve.webkitIndexedDB||Ve.msIndexedDB,IDBKeyRange:Ve.IDBKeyRange||Ve.webkitIDBKeyRange}}catch{wi={indexedDB:null,IDBKeyRange:null}}const on=hn;function wr(r){let e=Gt;try{Gt=!0,an.storagemutated.fire(r)}finally{Gt=e}}In(on,{...pr,delete:r=>new on(r,{addons:[]}).delete(),exists:r=>new on(r,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(r){try{return function({indexedDB:e,IDBKeyRange:n}){return Pi(e)?Promise.resolve(e.databases()).then(t=>t.map(i=>i.name).filter(i=>i!==Nr)):Di(e,n).toCollection().primaryKeys()}(on.dependencies).then(r)}catch{return Qe(new le.MissingAPI)}},defineClass:()=>function(r){pt(this,r)},ignoreTransaction:r=>ue.trans?Dn(ue.transless,r):r(),vip:gi,async:function(r){return function(){try{var e=bi(r.apply(this,arguments));return e&&typeof e.then=="function"?e:te.resolve(e)}catch(n){return Qe(n)}}},spawn:function(r,e,n){try{var t=bi(r.apply(n,e||[]));return t&&typeof t.then=="function"?t:te.resolve(t)}catch(i){return Qe(i)}},currentTransaction:{get:()=>ue.trans||null},waitFor:function(r,e){const n=te.resolve(typeof r=="function"?on.ignoreTransaction(r):r).timeout(e||6e4);return ue.trans?ue.trans.waitFor(n):n},Promise:te,debug:{get:()=>Ut,set:r=>{la(r,r==="dexie"?()=>!0:Ca)}},derive:En,extend:pt,props:In,override:aa,Events:Ln,on:an,liveQuery:lu,extendObservabilitySet:Na,getByKeyPath:Xt,setByKeyPath:Ft,delByKeyPath:function(r,e){typeof e=="string"?Ft(r,e,void 0):"length"in e&&[].map.call(e,function(n){Ft(r,n,void 0)})},shallowClone:oa,deepClone:Jn,getObjectDiff:Bi,cmp:ht,asap:sa,minKey:di,addons:[],connections:Mn,errnames:Ci,dependencies:wi,semVer:Hi,version:Hi.split(".").map(r=>parseInt(r)).reduce((r,e,n)=>r+e/Math.pow(10,2*n))}),on.maxKey=Wn(on.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(an($n,r=>{if(!Gt){let e;Rr?(e=document.createEvent("CustomEvent"),e.initCustomEvent(tn,!0,!0,r)):e=new CustomEvent(tn,{detail:r}),Gt=!0,dispatchEvent(e),Gt=!1}}),addEventListener(tn,({detail:r})=>{Gt||wr(r)}));let Gt=!1;if(typeof BroadcastChannel<"u"){const r=new BroadcastChannel(tn);typeof r.unref=="function"&&r.unref(),an($n,e=>{Gt||r.postMessage(e)}),r.onmessage=e=>{e.data&&wr(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){an($n,e=>{try{Gt||(typeof localStorage<"u"&&localStorage.setItem(tn,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:tn,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===tn){const n=JSON.parse(e.newValue);n&&wr(n.changedParts)}});const r=self.document&&navigator.serviceWorker;r&&r.addEventListener("message",function({data:e}){e&&e.type===tn&&wr(e.changedParts)})}te.rejectionMapper=function(r,e){if(!r||r instanceof An||r instanceof TypeError||r instanceof SyntaxError||!r.name||!ji[r.name])return r;var n=new ji[r.name](e||r.message,r);return"stack"in r&&Yt(n,"stack",{get:function(){return this.inner.stack}}),n},la(Ut,Ca);const Vt={AbortError:"A request was aborted, for example through a call to IDBTransaction.abort.",ConstraintError:"A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.",DataCloneError:"The data being stored could not be cloned by the internal structured cloning algorithm.",DataError:"Data provided to an operation does not meet requirements.",InvalidAccessError:"An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.",InvalidStateError:"An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.",NotFoundError:"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",ReadOnlyError:'The mutating operation was attempted in a "readonly" transaction.',TransactionInactiveError:"A request was placed against a transaction which is currently not active, or which is finished.",VersionError:"An attempt was made to open a database using a lower version than the existing version."};class _i extends Error{constructor(e=Vt.AbortError){super(),this.name="AbortError",this.message=e}}class sn extends Error{constructor(e=Vt.ConstraintError){super(),this.name="ConstraintError",this.message=e}}class fu extends Error{constructor(e=Vt.DataCloneError){super(),this.name="DataCloneError",this.message=e}}class rt extends Error{constructor(e=Vt.DataError){super(),this.name="DataError",this.message=e}}class kr extends Error{constructor(e=Vt.InvalidAccessError){super(),this.name="InvalidAccessError",this.message=e}}class we extends Error{constructor(e=Vt.InvalidStateError){super(),this.name="InvalidStateError",this.message=e}}class qn extends Error{constructor(e=Vt.NotFoundError){super(),this.name="NotFoundError",this.message=e}}class Gn extends Error{constructor(e=Vt.ReadOnlyError){super(),this.name="ReadOnlyError",this.message=e}}class xt extends Error{constructor(e=Vt.TransactionInactiveError){super(),this.name="TransactionInactiveError",this.message=e}}class hu extends Error{constructor(e=Vt.VersionError){super(),this.name="VersionError",this.message=e}}const Re=(r,e)=>{if(typeof r=="number"){if(isNaN(r))throw new rt;return r}else if(r instanceof Date){const n=r.valueOf();if(isNaN(n))throw new rt;return new Date(n)}else{if(typeof r=="string")return r;if(r instanceof ArrayBuffer||typeof ArrayBuffer<"u"&&ArrayBuffer.isView&&ArrayBuffer.isView(r))return r instanceof ArrayBuffer?new Uint8Array(r).buffer:new Uint8Array(r.buffer).buffer;if(Array.isArray(r)){if(e===void 0)e=new Set;else if(e.has(r))throw new rt;e.add(r);const n=[];for(let t=0;t<r.length;t++){if(!r.hasOwnProperty(t))throw new rt;const s=r[t],u=Re(s,e);n.push(u)}return n}else throw new rt}},Gi=r=>{if(typeof r=="number")return"Number";if(r instanceof Date)return"Date";if(Array.isArray(r))return"Array";if(typeof r=="string")return"String";if(r instanceof ArrayBuffer)return"Binary";throw new rt},Se=(r,e)=>{if(e===void 0)throw new TypeError;r=Re(r),e=Re(e);const n=Gi(r),t=Gi(e);if(n!==t)return n==="Array"||n==="Binary"&&(t==="String"||t==="Date"||t==="Number")||n==="String"&&(t==="Date"||t==="Number")||n==="Date"&&t==="Number"?1:-1;if(n==="Binary"&&(r=new Uint8Array(r),e=new Uint8Array(e)),n==="Array"||n==="Binary"){const i=Math.min(r.length,e.length);for(let s=0;s<i;s++){const u=Se(r[s],e[s]);if(u!==0)return u}return r.length>e.length?1:r.length<e.length?-1:0}if(n==="Date"){if(r.getTime()===e.getTime())return 0}else if(r===e)return 0;return r>e?1:-1};class _e{static only(e){if(arguments.length===0)throw new TypeError;return e=Re(e),new _e(e,e,!1,!1)}static lowerBound(e,n=!1){if(arguments.length===0)throw new TypeError;return e=Re(e),new _e(e,void 0,n,!0)}static upperBound(e,n=!1){if(arguments.length===0)throw new TypeError;return e=Re(e),new _e(void 0,e,!0,n)}static bound(e,n,t=!1,i=!1){if(arguments.length<2)throw new TypeError;const s=Se(e,n);if(s===1||s===0&&(t||i))throw new rt;return e=Re(e),n=Re(n),new _e(e,n,t,i)}constructor(e,n,t,i){this.lower=e,this.upper=n,this.lowerOpen=t,this.upperOpen=i}includes(e){if(arguments.length===0)throw new TypeError;if(e=Re(e),this.lower!==void 0){const n=Se(this.lower,e);if(n===1||n===0&&this.lowerOpen)return!1}if(this.upper!==void 0){const n=Se(this.upper,e);if(n===-1||n===0&&this.upperOpen)return!1}return!0}toString(){return"[object IDBKeyRange]"}}const er=(r,e)=>{if(Array.isArray(r)){const i=[];for(let s of r)s!=null&&typeof s!="string"&&s.toString&&(s=s.toString()),i.push(Re(er(s,e)));return i}if(r==="")return e;let n=r,t=e;for(;n!==null;){let i;const s=n.indexOf(".");if(s>=0?(i=n.slice(0,s),n=n.slice(s+1)):(i=n,n=null),t==null||!t.hasOwnProperty(i))return;t=t[i]}return t};function cr(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fa={exports:{}};(function(r,e){(function(n){r.exports=n()})(function(){return function(){function n(t,i,s){function u(b,p){if(!i[b]){if(!t[b]){var y=typeof cr=="function"&&cr;if(!p&&y)return y(b,!0);if(h)return h(b,!0);var w=new Error("Cannot find module '"+b+"'");throw w.code="MODULE_NOT_FOUND",w}var T=i[b]={exports:{}};t[b][0].call(T.exports,function(R){var S=t[b][1][R];return u(S||R)},T,T.exports,n,t,i,s)}return i[b].exports}for(var h=typeof cr=="function"&&cr,c=0;c<s.length;c++)u(s[c]);return u}return n}()({1:[function(n,t,i){var s=n("domexception"),u=n("typeson"),h=n("typeson-registry/dist/presets/structured-cloning-throwing"),c=typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:typeof hr<"u"?hr:Function("return this;")();c.DOMException||(c.DOMException=s);var b=new u().register(h);function p(y){return b.revive(b.encapsulate(y))}t.exports=p},{domexception:5,typeson:8,"typeson-registry/dist/presets/structured-cloning-throwing":7}],2:[function(n,t,i){var s=function(){function p(y,w){var T=[],R=!0,S=!1,O=void 0;try{for(var P=y[Symbol.iterator](),C;!(R=(C=P.next()).done)&&(T.push(C.value),!(w&&T.length===w));R=!0);}catch(N){S=!0,O=N}finally{try{!R&&P.return&&P.return()}finally{if(S)throw O}}return T}return function(y,w){if(Array.isArray(y))return y;if(Symbol.iterator in Object(y))return p(y,w);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function p(y,w){for(var T=0;T<w.length;T++){var R=w[T];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(y,R.key,R)}}return function(y,w,T){return w&&p(y.prototype,w),T&&p(y,T),y}}();function h(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")}var c=n("./legacy-error-codes.json"),b=n("./utils.js");i.implementation=function(){function p(y){var w=s(y,2),T=w[0],R=w[1];h(this,p),this.name=R,this.message=T}return u(p,[{key:"code",get:function(){return c[this.name]||0}}]),p}(),i.init=function(p){if(Error.captureStackTrace){var y=b.wrapperForImpl(p);Error.captureStackTrace(y,y.constructor)}}},{"./legacy-error-codes.json":4,"./utils.js":6}],3:[function(n,t,i){var s=n("webidl-conversions"),u=n("./utils.js"),h=u.implSymbol;function c(){for(var y=[],w=0;w<arguments.length&&w<2;++w)y[w]=arguments[w];y[0]!==void 0?y[0]=s.DOMString(y[0],{context:"Failed to construct 'DOMException': parameter 1"}):y[0]="",y[1]!==void 0?y[1]=s.DOMString(y[1],{context:"Failed to construct 'DOMException': parameter 2"}):y[1]="Error",b.setup(this,y)}Object.defineProperty(c,"prototype",{value:c.prototype,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(c.prototype,"name",{get:function(){return this[h].name},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this[h].message},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"code",{get:function(){return this[h].code},enumerable:!0,configurable:!0}),Object.defineProperty(c,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(c.prototype,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(c,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(c.prototype,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(c,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(c.prototype,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(c,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(c.prototype,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(c,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(c.prototype,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(c,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(c.prototype,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(c,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(c.prototype,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(c,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(c.prototype,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(c,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(c.prototype,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(c,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(c.prototype,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(c,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(c.prototype,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(c,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(c.prototype,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(c,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(c.prototype,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(c,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(c.prototype,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(c,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(c.prototype,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(c,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(c.prototype,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(c,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(c.prototype,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(c,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(c.prototype,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(c,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(c.prototype,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(c,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(c.prototype,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(c,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(c.prototype,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(c,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(c.prototype,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(c,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(c.prototype,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(c,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(c.prototype,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(c,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(c.prototype,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(c.prototype,Symbol.toStringTag,{value:"DOMException",writable:!1,enumerable:!1,configurable:!0});var b={mixedInto:[],is:function(w){if(w){if(w[h]instanceof p.implementation)return!0;for(var T=0;T<t.exports.mixedInto.length;++T)if(w instanceof t.exports.mixedInto[T])return!0}return!1},isImpl:function(w){if(w){if(w instanceof p.implementation)return!0;for(var T=u.wrapperForImpl(w),R=0;R<t.exports.mixedInto.length;++R)if(T instanceof t.exports.mixedInto[R])return!0}return!1},convert:function(w){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=T.context,S=R===void 0?"The provided value":R;if(t.exports.is(w))return u.implForWrapper(w);throw new TypeError(S+" is not of type 'DOMException'.")},create:function(w,T){var R=Object.create(c.prototype);return this.setup(R,w,T),R},createImpl:function(w,T){var R=Object.create(c.prototype);return this.setup(R,w,T),u.implForWrapper(R)},_internalSetup:function(w){},setup:function(w,T,R){R||(R={}),R.wrapper=w,this._internalSetup(w),Object.defineProperty(w,h,{value:new p.implementation(T,R),writable:!1,enumerable:!1,configurable:!0}),w[h][u.wrapperSymbol]=w,p.init&&p.init(w[h],R)},interface:c,expose:{Window:{DOMException:c},Worker:{DOMException:c}}};t.exports=b;var p=n(".//DOMException-impl.js")},{".//DOMException-impl.js":2,"./utils.js":6,"webidl-conversions":9}],4:[function(n,t,i){t.exports={IndexSizeError:1,DOMStringSizeError:2,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoDataAllowedError:6,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,ValidationError:16,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25}},{}],5:[function(n,t,i){t.exports=n("./DOMException").interface,Object.setPrototypeOf(t.exports.prototype,Error.prototype)},{"./DOMException":3}],6:[function(n,t,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function u(a){return(typeof a>"u"?"undefined":s(a))==="object"&&a!==null||typeof a=="function"}function h(a){return Object.getPrototypeOf(a)===Buffer.prototype?a:a instanceof ArrayBuffer?Buffer.from(a):Buffer.from(a.buffer,a.byteOffset,a.byteLength)}function c(a){return Buffer.from(h(a))}function b(a,o){for(var d=Object.getOwnPropertyNames(o),l=0;l<d.length;++l)d[l]in a||Object.defineProperty(a,d[l],Object.getOwnPropertyDescriptor(o,d[l]))}var p=Symbol("wrapper"),y=Symbol("impl"),w=Symbol("SameObject caches");function T(a,o,d){return a[w]||(a[w]=Object.create(null)),o in a[w]||(a[w][o]=d()),a[w][o]}function R(a){return a?a[p]:null}function S(a){return a?a[y]:null}function O(a){var o=R(a);return o||a}function P(a){var o=S(a);return o||a}var C=Symbol("internal"),N=Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()));t.exports={isObject:u,getReferenceToBytes:h,getCopyToBytes:c,mixin:b,wrapperSymbol:p,implSymbol:y,getSameObject:T,wrapperForImpl:R,implForWrapper:S,tryWrapperForImpl:O,tryImplForWrapper:P,iterInternalSymbol:C,IteratorPrototype:N}},{}],7:[function(n,t,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u};(function(u,h){(typeof i>"u"?"undefined":s(i))=="object"&&typeof t<"u"?t.exports=h():((u=typeof globalThis<"u"?globalThis:u||self).Typeson=u.Typeson||{},u.Typeson.presets=u.Typeson.presets||{},u.Typeson.presets.structuredCloningThrowing=h())})(void 0,function(){function u(E){return(u=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(f){return typeof f>"u"?"undefined":s(f)}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f>"u"?"undefined":s(f)})(E)}function h(E,f){if(!(E instanceof f))throw new TypeError("Cannot call a class as a function")}function c(E,f){for(var v=0;v<f.length;v++){var k=f[v];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(E,k.key,k)}}function b(E,f,v){return f in E?Object.defineProperty(E,f,{value:v,enumerable:!0,configurable:!0,writable:!0}):E[f]=v,E}function p(E,f){var v=Object.keys(E);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(E);f&&(k=k.filter(function(B){return Object.getOwnPropertyDescriptor(E,B).enumerable})),v.push.apply(v,k)}return v}function y(E){return function(v){if(Array.isArray(v))return w(v)}(E)||function(v){if(typeof Symbol<"u"&&Symbol.iterator in Object(v))return Array.from(v)}(E)||function(v,k){if(v){if(typeof v=="string")return w(v,k);var B=Object.prototype.toString.call(v).slice(8,-1);if(B==="Object"&&v.constructor&&(B=v.constructor.name),B==="Map"||B==="Set")return Array.from(v);if(B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B))return w(v,k)}}(E)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function w(E,f){(f==null||f>E.length)&&(f=E.length);for(var v=0,k=new Array(f);v<f;v++)k[v]=E[v];return k}function T(E){return(T=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(v){return typeof v>"u"?"undefined":s(v)}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v>"u"?"undefined":s(v)})(E)}function R(E,f){if(!(E instanceof f))throw new TypeError("Cannot call a class as a function")}function S(E,f){for(var v=0;v<f.length;v++){var k=f[v];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(E,k.key,k)}}function O(E,f,v){return f in E?Object.defineProperty(E,f,{value:v,enumerable:!0,configurable:!0,writable:!0}):E[f]=v,E}function P(E,f){var v=Object.keys(E);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(E);f&&(k=k.filter(function(B){return Object.getOwnPropertyDescriptor(E,B).enumerable})),v.push.apply(v,k)}return v}function C(E){for(var f=1;f<arguments.length;f++){var v=arguments[f]!=null?arguments[f]:{};f%2?P(Object(v),!0).forEach(function(k){O(E,k,v[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(v)):P(Object(v)).forEach(function(k){Object.defineProperty(E,k,Object.getOwnPropertyDescriptor(v,k))})}return E}function N(E,f){return function(k){if(Array.isArray(k))return k}(E)||function(k,B){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(k)))){var J=[],ne=!0,de=!1,re=void 0;try{for(var Te,ge=k[Symbol.iterator]();!(ne=(Te=ge.next()).done)&&(J.push(Te.value),!B||J.length!==B);ne=!0);}catch(ke){de=!0,re=ke}finally{try{ne||ge.return==null||ge.return()}finally{if(de)throw re}}return J}}(E,f)||o(E,f)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function a(E){return function(v){if(Array.isArray(v))return d(v)}(E)||function(v){if(typeof Symbol<"u"&&Symbol.iterator in Object(v))return Array.from(v)}(E)||o(E)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function o(E,f){if(E){if(typeof E=="string")return d(E,f);var v=Object.prototype.toString.call(E).slice(8,-1);return v==="Object"&&E.constructor&&(v=E.constructor.name),v==="Map"||v==="Set"?Array.from(E):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?d(E,f):void 0}}function d(E,f){(f==null||f>E.length)&&(f=E.length);for(var v=0,k=new Array(f);v<f;v++)k[v]=E[v];return k}var l=function E(f){R(this,E),this.p=new Promise(f)};l.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(l.prototype[Symbol.toStringTag]="TypesonPromise"),l.prototype.then=function(E,f){var v=this;return new l(function(k,B){v.p.then(function(J){k(E?E(J):J)}).catch(function(J){return f?f(J):Promise.reject(J)}).then(k,B)})},l.prototype.catch=function(E){return this.then(null,E)},l.resolve=function(E){return new l(function(f){f(E)})},l.reject=function(E){return new l(function(f,v){v(E)})},["all","race"].forEach(function(E){l[E]=function(f){return new l(function(v,k){Promise[E](f.map(function(B){return B&&B.constructor&&B.constructor.__typeson__type__==="TypesonPromise"?B.p:B})).then(v,k)})}});var g={}.toString,m={}.hasOwnProperty,_=Object.getPrototypeOf,I=m.toString;function V(E,f){return A(E)&&typeof E.then=="function"&&(!f||typeof E.catch=="function")}function F(E){return g.call(E).slice(8,-1)}function j(E,f){if(!E||T(E)!=="object")return!1;var v=_(E);if(!v)return f===null;var k=m.call(v,"constructor")&&v.constructor;return typeof k!="function"?f===null:f===k||f!==null&&I.call(k)===I.call(f)||typeof f=="function"&&typeof k.__typeson__type__=="string"&&k.__typeson__type__===f.__typeson__type__}function W(E){return!(!E||F(E)!=="Object")&&(!_(E)||j(E,Object))}function A(E){return E&&T(E)==="object"}function H(E){return E.replace(/~/g,"~0").replace(/\./g,"~1")}function q(E){return E.replace(/~1/g,".").replace(/~0/g,"~")}function X(E,f){if(f==="")return E;var v=f.indexOf(".");if(v>-1){var k=E[q(f.slice(0,v))];return k===void 0?void 0:X(k,f.slice(v+1))}return E[q(f)]}function me(E,f,v){if(f==="")return v;var k=f.indexOf(".");return k>-1?me(E[q(f.slice(0,k))],f.slice(k+1),v):(E[q(f)]=v,E)}function Y(E,f,v){return v?f?f(E):E:(E&&E.then||(E=Promise.resolve(E)),f?E.then(f):E)}var xe=Object.keys,M=Array.isArray,x={}.hasOwnProperty,L=["type","replaced","iterateIn","iterateUnsetNumeric"];function K(E){return function(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];try{return Promise.resolve(E.apply(this,f))}catch(k){return Promise.reject(k)}}}function G(E,f){if(E.keypath==="")return-1;var v=E.keypath.match(/\./g)||0,k=f.keypath.match(/\./g)||0;return v&&(v=v.length),k&&(k=k.length),v>k?-1:v<k?1:E.keypath<f.keypath?-1:E.keypath>f.keypath}var z=function(){function E(f){R(this,E),this.options=f,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(v,k,B){return k&&S(v.prototype,k),B&&S(v,B),v}(E,[{key:"stringify",value:function(v,k,B,J){J=C(C(C({},this.options),J),{},{stringification:!0});var ne=this.encapsulate(v,null,J);return M(ne)?JSON.stringify(ne[0],k,B):ne.then(function(de){return JSON.stringify(de,k,B)})}},{key:"stringifySync",value:function(v,k,B,J){return this.stringify(v,k,B,C(C({throwOnBadSyncType:!0},J),{},{sync:!0}))}},{key:"stringifyAsync",value:function(v,k,B,J){return this.stringify(v,k,B,C(C({throwOnBadSyncType:!0},J),{},{sync:!1}))}},{key:"parse",value:function(v,k,B){return B=C(C(C({},this.options),B),{},{parse:!0}),this.revive(JSON.parse(v,k),B)}},{key:"parseSync",value:function(v,k,B){return this.parse(v,k,C(C({throwOnBadSyncType:!0},B),{},{sync:!0}))}},{key:"parseAsync",value:function(v,k,B){return this.parse(v,k,C(C({throwOnBadSyncType:!0},B),{},{sync:!1}))}},{key:"specialTypeNames",value:function(v,k){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return B.returnTypeNames=!0,this.encapsulate(v,k,B)}},{key:"rootTypeName",value:function(v,k){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return B.iterateNone=!0,this.encapsulate(v,k,B)}},{key:"encapsulate",value:function(v,k,B){var J=K(function(ce,ee){return Y(Promise.all(ee.map(function(Ae){return Ae[1].p})),function(Ae){return Y(Promise.all(Ae.map(K(function(pe){var De=!1,Me=[],wt=N(ee.splice(0,1),1),Ge=N(wt[0],7),bt=Ge[0],Ot=Ge[2],Be=Ge[3],Tt=Ge[4],He=Ge[5],_t=Ge[6],ct=be(bt,pe,Ot,Be,Me,!0,_t),Pt=j(ct,l);return function(Lr,tr){var bn=Lr();return bn&&bn.then?bn.then(tr):tr(bn)}(function(){if(bt&&Pt)return Y(ct.p,function(Bt){return Tt[He]=Bt,De=!0,J(ce,Me)})},function(Bt){return De?Bt:(bt?Tt[He]=ct:ce=Pt?ct.p:ct,J(ce,Me))})}))),function(){return ce})})}),ne=(B=C(C({sync:!0},this.options),B)).sync,de=this,re={},Te=[],ge=[],ke=[],Ze=!("cyclic"in B)||B.cyclic,ze=B.encapsulateObserver,Mt=be("",v,Ze,k||{},ke);function qe(ce){var ee=Object.values(re);if(B.iterateNone)return ee.length?ee[0]:E.getJSONType(ce);if(ee.length){if(B.returnTypeNames)return a(new Set(ee));ce&&W(ce)&&!x.call(ce,"$types")?ce.$types=re:ce={$:ce,$types:{$:re}}}else A(ce)&&x.call(ce,"$types")&&(ce={$:ce,$types:!0});return!B.returnTypeNames&&ce}function Xe(ce,ee,Ae){Object.assign(ce,ee);var pe=L.map(function(De){var Me=ce[De];return delete ce[De],Me});Ae(),L.forEach(function(De,Me){ce[De]=pe[Me]})}function be(ce,ee,Ae,pe,De,Me,wt){var Ge,bt={},Ot=T(ee),Be=ze?function(Zt){var lt=wt||pe.type||E.getJSONType(ee);ze(Object.assign(Zt||bt,{keypath:ce,value:ee,cyclic:Ae,stateObj:pe,promisesData:De,resolvingTypesonPromise:Me,awaitingTypesonPromise:j(ee,l)},{type:lt}))}:null;if(["string","boolean","number","undefined"].includes(Ot))return ee===void 0||Number.isNaN(ee)||ee===Number.NEGATIVE_INFINITY||ee===Number.POSITIVE_INFINITY?(Ge=pe.replaced?ee:It(ce,ee,pe,De,!1,Me,Be))!==ee&&(bt={replaced:Ge}):Ge=ee,Be&&Be(),Ge;if(ee===null)return Be&&Be(),ee;if(Ae&&!pe.iterateIn&&!pe.iterateUnsetNumeric&&ee&&T(ee)==="object"){var Tt=Te.indexOf(ee);if(!(Tt<0))return re[ce]="#",Be&&Be({cyclicKeypath:ge[Tt]}),"#"+ge[Tt];Ae===!0&&(Te.push(ee),ge.push(ce))}var He,_t=W(ee),ct=M(ee),Pt=(_t||ct)&&(!de.plainObjectReplacers.length||pe.replaced)||pe.iterateIn?ee:It(ce,ee,pe,De,_t||ct,null,Be);if(Pt!==ee?(Ge=Pt,bt={replaced:Pt}):ce===""&&j(ee,l)?(De.push([ce,ee,Ae,pe,void 0,void 0,pe.type]),Ge=ee):ct&&pe.iterateIn!=="object"||pe.iterateIn==="array"?(He=new Array(ee.length),bt={clone:He}):(["function","symbol"].includes(T(ee))||"toJSON"in ee||j(ee,l)||j(ee,Promise)||j(ee,ArrayBuffer))&&!_t&&pe.iterateIn!=="object"?Ge=ee:(He={},pe.addLength&&(He.length=ee.length),bt={clone:He}),Be&&Be(),B.iterateNone)return He||Ge;if(!He)return Ge;if(pe.iterateIn){var Bt=function(lt){var Kt={ownKeys:x.call(ee,lt)};Xe(pe,Kt,function(){var un=ce+(ce?".":"")+H(lt),nr=be(un,ee[lt],!!Ae,pe,De,Me);j(nr,l)?De.push([un,nr,!!Ae,pe,He,lt,pe.type]):nr!==void 0&&(He[lt]=nr)})};for(var Lr in ee)Bt(Lr);Be&&Be({endIterateIn:!0,end:!0})}else xe(ee).forEach(function(Zt){var lt=ce+(ce?".":"")+H(Zt);Xe(pe,{ownKeys:!0},function(){var Kt=be(lt,ee[Zt],!!Ae,pe,De,Me);j(Kt,l)?De.push([lt,Kt,!!Ae,pe,He,Zt,pe.type]):Kt!==void 0&&(He[Zt]=Kt)})}),Be&&Be({endIterateOwn:!0,end:!0});if(pe.iterateUnsetNumeric){for(var tr=ee.length,bn=function(lt){if(!(lt in ee)){var Kt=ce+(ce?".":"")+lt;Xe(pe,{ownKeys:!1},function(){var un=be(Kt,void 0,!!Ae,pe,De,Me);j(un,l)?De.push([Kt,un,!!Ae,pe,He,lt,pe.type]):un!==void 0&&(He[lt]=un)})}},xr=0;xr<tr;xr++)bn(xr);Be&&Be({endIterateUnsetNumeric:!0,end:!0})}return He}function It(ce,ee,Ae,pe,De,Me,wt){for(var Ge=De?de.plainObjectReplacers:de.nonplainObjectReplacers,bt=Ge.length;bt--;){var Ot=Ge[bt];if(Ot.test(ee,Ae)){var Be=Ot.type;if(de.revivers[Be]){var Tt=re[ce];re[ce]=Tt?[Be].concat(Tt):Be}return Object.assign(Ae,{type:Be,replaced:!0}),!ne&&Ot.replaceAsync||Ot.replace?(wt&&wt({replacing:!0}),be(ce,Ot[ne||!Ot.replaceAsync?"replace":"replaceAsync"](ee,Ae),Ze&&"readonly",Ae,pe,Me,Be)):(wt&&wt({typeDetected:!0}),be(ce,ee,Ze&&"readonly",Ae,pe,Me,Be))}}return ee}return ke.length?ne&&B.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(J(Mt,ke)).then(qe):!ne&&B.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():B.stringification&&ne?[qe(Mt)]:ne?qe(Mt):Promise.resolve(qe(Mt))}},{key:"encapsulateSync",value:function(v,k,B){return this.encapsulate(v,k,C(C({throwOnBadSyncType:!0},B),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(v,k,B){return this.encapsulate(v,k,C(C({throwOnBadSyncType:!0},B),{},{sync:!1}))}},{key:"revive",value:function(v,k){var B=v&&v.$types;if(!B)return v;if(B===!0)return v.$;var J=(k=C(C({sync:!0},this.options),k)).sync,ne=[],de={},re=!0;B.$&&W(B.$)&&(v=v.$,B=B.$,re=!1);var Te=this;function ge(qe,Xe){var be=N(Te.revivers[qe]||[],1)[0];if(!be)throw new Error("Unregistered type: "+qe);return J&&!("revive"in be)?Xe:be[J&&be.revive?"revive":!J&&be.reviveAsync?"reviveAsync":"revive"](Xe,de)}var ke=[];function Ze(qe){return j(qe,Ce)?void 0:qe}var ze,Mt=function(){var Xe=[];if(Object.entries(B).forEach(function(be){var It=N(be,2),ce=It[0],ee=It[1];ee!=="#"&&[].concat(ee).forEach(function(Ae){N(Te.revivers[Ae]||[null,{}],2)[1].plain&&(Xe.push({keypath:ce,type:Ae}),delete B[ce])})}),Xe.length)return Xe.sort(G).reduce(function be(It,ce){var ee=ce.keypath,Ae=ce.type;if(V(It))return It.then(function(Me){return be(Me,{keypath:ee,type:Ae})});var pe=X(v,ee);if(j(pe=ge(Ae,pe),l))return pe.then(function(Me){var wt=me(v,ee,Me);wt===Me&&(v=wt)});var De=me(v,ee,pe);De===pe&&(v=De)},void 0)}();return j(Mt,l)?ze=Mt.then(function(){return v}):(ze=function qe(Xe,be,It,ce,ee){if(!re||Xe!=="$types"){var Ae=B[Xe],pe=M(be);if(pe||W(be)){var De=pe?new Array(be.length):{};for(xe(be).forEach(function(He){var _t=qe(Xe+(Xe?".":"")+H(He),be[He],It||De,De,He),ct=function(Bt){return j(Bt,Ce)?De[He]=void 0:Bt!==void 0&&(De[He]=Bt),Bt};j(_t,l)?ke.push(_t.then(function(Pt){return ct(Pt)})):ct(_t)}),be=De;ne.length;){var Me=N(ne[0],4),wt=Me[0],Ge=Me[1],bt=Me[2],Ot=Me[3],Be=X(wt,Ge);if(Be===void 0)break;bt[Ot]=Be,ne.splice(0,1)}}if(!Ae)return be;if(Ae==="#"){var Tt=X(It,be.slice(1));return Tt===void 0&&ne.push([It,be.slice(1),ce,ee]),Tt}return[].concat(Ae).reduce(function He(_t,ct){return j(_t,l)?_t.then(function(Pt){return He(Pt,ct)}):ge(ct,_t)},be)}}("",v,null),ke.length&&(ze=l.resolve(ze).then(function(qe){return l.all([qe].concat(ke))}).then(function(qe){return N(qe,1)[0]}))),V(ze)?J&&k.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():j(ze,l)?ze.p.then(Ze):ze:!J&&k.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():J?Ze(ze):Promise.resolve(Ze(ze))}},{key:"reviveSync",value:function(v,k){return this.revive(v,C(C({throwOnBadSyncType:!0},k),{},{sync:!0}))}},{key:"reviveAsync",value:function(v,k){return this.revive(v,C(C({throwOnBadSyncType:!0},k),{},{sync:!1}))}},{key:"register",value:function(v,k){return k=k||{},[].concat(v).forEach(function B(J){var ne=this;if(M(J))return J.map(function(de){return B.call(ne,de)});J&&xe(J).forEach(function(de){if(de==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(E.JSON_TYPES.includes(de))throw new TypeError("Plain JSON object types are reserved as type names");var re=J[de],Te=re&&re.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,ge=Te.filter(function(Xe){return Xe.type===de});if(ge.length&&(Te.splice(Te.indexOf(ge[0]),1),delete this.revivers[de],delete this.types[de]),typeof re=="function"){var ke=re;re={test:function(be){return be&&be.constructor===ke},replace:function(be){return C({},be)},revive:function(be){return Object.assign(Object.create(ke.prototype),be)}}}else if(M(re)){var Ze=N(re,3);re={test:Ze[0],replace:Ze[1],revive:Ze[2]}}if(re&&re.test){var ze={type:de,test:re.test.bind(re)};re.replace&&(ze.replace=re.replace.bind(re)),re.replaceAsync&&(ze.replaceAsync=re.replaceAsync.bind(re));var Mt=typeof k.fallback=="number"?k.fallback:k.fallback?0:Number.POSITIVE_INFINITY;if(re.testPlainObjects?this.plainObjectReplacers.splice(Mt,0,ze):this.nonplainObjectReplacers.splice(Mt,0,ze),re.revive||re.reviveAsync){var qe={};re.revive&&(qe.revive=re.revive.bind(re)),re.reviveAsync&&(qe.reviveAsync=re.reviveAsync.bind(re)),this.revivers[de]=[qe,{plain:re.testPlainObjects}]}this.types[de]=re}},this)},this),this}}]),E}(),Ce=function E(){R(this,E)};Ce.__typeson__type__="TypesonUndefined",z.Undefined=Ce,z.Promise=l,z.isThenable=V,z.toStringTag=F,z.hasConstructorOf=j,z.isObject=A,z.isPlainObject=W,z.isUserObject=function E(f){if(!f||F(f)!=="Object")return!1;var v=_(f);return!v||j(f,Object)||E(v)},z.escapeKeyPathComponent=H,z.unescapeKeyPathComponent=q,z.getByKeyPath=X,z.getJSONType=function(f){return f===null?"null":Array.isArray(f)?"array":T(f)},z.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Oe={userObject:{test:function(f,v){return z.isUserObject(f)},replace:function(f){return function(k){for(var B=1;B<arguments.length;B++){var J=arguments[B]!=null?arguments[B]:{};B%2?p(Object(J),!0).forEach(function(ne){b(k,ne,J[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(J)):p(Object(J)).forEach(function(ne){Object.defineProperty(k,ne,Object.getOwnPropertyDescriptor(J,ne))})}return k}({},f)},revive:function(f){return f}}},fe=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(f,v){return!!Array.isArray(f)&&(Object.keys(f).some(function(k){return String(Number.parseInt(k))!==k})&&(v.iterateIn="object",v.addLength=!0),!0)},replace:function(f,v){return v.iterateUnsetNumeric=!0,f},revive:function(f){if(Array.isArray(f))return f;var v=[];return Object.keys(f).forEach(function(k){var B=f[k];v[k]=B}),v}}},{sparseUndefined:{test:function(f,v){return f===void 0&&v.ownKeys===!1},replace:function(f){return 0},revive:function(f){}}}],et={undef:{test:function(f,v){return f===void 0&&(v.ownKeys||!("ownKeys"in v))},replace:function(f){return 0},revive:function(f){return new z.Undefined}}},tt={StringObject:{test:function(f){return z.toStringTag(f)==="String"&&u(f)==="object"},replace:function(f){return String(f)},revive:function(f){return new String(f)}},BooleanObject:{test:function(f){return z.toStringTag(f)==="Boolean"&&u(f)==="object"},replace:function(f){return!!f},revive:function(f){return new Boolean(f)}},NumberObject:{test:function(f){return z.toStringTag(f)==="Number"&&u(f)==="object"},replace:function(f){return Number(f)},revive:function(f){return new Number(f)}}},mt=[{nan:{test:function(f){return Number.isNaN(f)},replace:function(f){return"NaN"},revive:function(f){return Number.NaN}}},{infinity:{test:function(f){return f===Number.POSITIVE_INFINITY},replace:function(f){return"Infinity"},revive:function(f){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(f){return f===Number.NEGATIVE_INFINITY},replace:function(f){return"-Infinity"},revive:function(f){return Number.NEGATIVE_INFINITY}}}],vt={date:{test:function(f){return z.toStringTag(f)==="Date"},replace:function(f){var v=f.getTime();return Number.isNaN(v)?"NaN":v},revive:function(f){return f==="NaN"?new Date(Number.NaN):new Date(f)}}},Ye={regexp:{test:function(f){return z.toStringTag(f)==="RegExp"},replace:function(f){return{source:f.source,flags:(f.global?"g":"")+(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.sticky?"y":"")+(f.unicode?"u":"")}},revive:function(f){var v=f.source,k=f.flags;return new RegExp(v,k)}}},Ct={map:{test:function(f){return z.toStringTag(f)==="Map"},replace:function(f){return y(f.entries())},revive:function(f){return new Map(f)}}},We={set:{test:function(f){return z.toStringTag(f)==="Set"},replace:function(f){return y(f.values())},revive:function(f){return new Set(f)}}},Ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ye=new Uint8Array(256),it=0;it<Ne.length;it++)ye[Ne.charCodeAt(it)]=it;var ae=function(f,v,k){k==null&&(k=f.byteLength);for(var B=new Uint8Array(f,v||0,k),J=B.length,ne="",de=0;de<J;de+=3)ne+=Ne[B[de]>>2],ne+=Ne[(3&B[de])<<4|B[de+1]>>4],ne+=Ne[(15&B[de+1])<<2|B[de+2]>>6],ne+=Ne[63&B[de+2]];return J%3==2?ne=ne.slice(0,-1)+"=":J%3==1&&(ne=ne.slice(0,-2)+"=="),ne},Z=function(f){var v,k,B,J,ne=f.length,de=.75*f.length,re=0;f[f.length-1]==="="&&(de--,f[f.length-2]==="="&&de--);for(var Te=new ArrayBuffer(de),ge=new Uint8Array(Te),ke=0;ke<ne;ke+=4)v=ye[f.charCodeAt(ke)],k=ye[f.charCodeAt(ke+1)],B=ye[f.charCodeAt(ke+2)],J=ye[f.charCodeAt(ke+3)],ge[re++]=v<<2|k>>4,ge[re++]=(15&k)<<4|B>>2,ge[re++]=(3&B)<<6|63&J;return Te},ve={arraybuffer:{test:function(f){return z.toStringTag(f)==="ArrayBuffer"},replace:function(f,v){v.buffers||(v.buffers=[]);var k=v.buffers.indexOf(f);return k>-1?{index:k}:(v.buffers.push(f),ae(f))},revive:function(f,v){if(v.buffers||(v.buffers=[]),u(f)==="object")return v.buffers[f.index];var k=Z(f);return v.buffers.push(k),k}}},he=typeof self>"u"?hr:self,Ee={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(E){var f=E,v=he[f];v&&(Ee[E.toLowerCase()]={test:function(B){return z.toStringTag(B)===f},replace:function(B,J){var ne=B.buffer,de=B.byteOffset,re=B.length;J.buffers||(J.buffers=[]);var Te=J.buffers.indexOf(ne);return Te>-1?{index:Te,byteOffset:de,length:re}:(J.buffers.push(ne),{encoded:ae(ne),byteOffset:de,length:re})},revive:function(B,J){J.buffers||(J.buffers=[]);var ne,de=B.byteOffset,re=B.length,Te=B.encoded,ge=B.index;return"index"in B?ne=J.buffers[ge]:(ne=Z(Te),J.buffers.push(ne)),new v(ne,de,re)}})});var Pe={dataview:{test:function(f){return z.toStringTag(f)==="DataView"},replace:function(f,v){var k=f.buffer,B=f.byteOffset,J=f.byteLength;v.buffers||(v.buffers=[]);var ne=v.buffers.indexOf(k);return ne>-1?{index:ne,byteOffset:B,byteLength:J}:(v.buffers.push(k),{encoded:ae(k),byteOffset:B,byteLength:J})},revive:function(f,v){v.buffers||(v.buffers=[]);var k,B=f.byteOffset,J=f.byteLength,ne=f.encoded,de=f.index;return"index"in f?k=v.buffers[de]:(k=Z(ne),v.buffers.push(k)),new DataView(k,B,J)}}},dt={IntlCollator:{test:function(f){return z.hasConstructorOf(f,Intl.Collator)},replace:function(f){return f.resolvedOptions()},revive:function(f){return new Intl.Collator(f.locale,f)}},IntlDateTimeFormat:{test:function(f){return z.hasConstructorOf(f,Intl.DateTimeFormat)},replace:function(f){return f.resolvedOptions()},revive:function(f){return new Intl.DateTimeFormat(f.locale,f)}},IntlNumberFormat:{test:function(f){return z.hasConstructorOf(f,Intl.NumberFormat)},replace:function(f){return f.resolvedOptions()},revive:function(f){return new Intl.NumberFormat(f.locale,f)}}};function Ke(E){for(var f=new Uint8Array(E.length),v=0;v<E.length;v++)f[v]=E.charCodeAt(v);return f.buffer}var at={file:{test:function(f){return z.toStringTag(f)==="File"},replace:function(f){var v=new XMLHttpRequest;if(v.overrideMimeType("text/plain; charset=x-user-defined"),v.open("GET",URL.createObjectURL(f),!1),v.send(),v.status!==200&&v.status!==0)throw new Error("Bad File access: "+v.status);return{type:f.type,stringContents:v.responseText,name:f.name,lastModified:f.lastModified}},revive:function(f){var v=f.name,k=f.type,B=f.stringContents,J=f.lastModified;return new File([Ke(B)],v,{type:k,lastModified:J})},replaceAsync:function(f){return new z.Promise(function(v,k){var B=new FileReader;B.addEventListener("load",function(){v({type:f.type,stringContents:B.result,name:f.name,lastModified:f.lastModified})}),B.addEventListener("error",function(){k(B.error)}),B.readAsBinaryString(f)})}}},yt={bigint:{test:function(f){return typeof f=="bigint"},replace:function(f){return String(f)},revive:function(f){return BigInt(f)}}},Ie={bigintObject:{test:function(f){return u(f)==="object"&&z.hasConstructorOf(f,BigInt)},replace:function(f){return String(f)},revive:function(f){return new Object(BigInt(f))}}},gt={cryptokey:{test:function(f){return z.toStringTag(f)==="CryptoKey"&&f.extractable},replaceAsync:function(f){return new z.Promise(function(v,k){crypto.subtle.exportKey("jwk",f).catch(function(B){k(B)}).then(function(B){v({jwk:B,algorithm:f.algorithm,usages:f.usages})})})},revive:function(f){var v=f.jwk,k=f.algorithm,B=f.usages;return crypto.subtle.importKey("jwk",v,k,!0,B)}}};return[Oe,et,fe,tt,mt,vt,Ye,{imagedata:{test:function(f){return z.toStringTag(f)==="ImageData"},replace:function(f){return{array:y(f.data),width:f.width,height:f.height}},revive:function(f){return new ImageData(new Uint8ClampedArray(f.array),f.width,f.height)}}},{imagebitmap:{test:function(f){return z.toStringTag(f)==="ImageBitmap"||f&&f.dataset&&f.dataset.toStringTag==="ImageBitmap"},replace:function(f){var v=document.createElement("canvas");return v.getContext("2d").drawImage(f,0,0),v.toDataURL()},revive:function(f){var v=document.createElement("canvas"),k=v.getContext("2d"),B=document.createElement("img");return B.addEventListener("load",function(){k.drawImage(B,0,0)}),B.src=f,v},reviveAsync:function(f){var v=document.createElement("canvas"),k=v.getContext("2d"),B=document.createElement("img");return B.addEventListener("load",function(){k.drawImage(B,0,0)}),B.src=f,createImageBitmap(v)}}},at,{file:at.file,filelist:{test:function(f){return z.toStringTag(f)==="FileList"},replace:function(f){for(var v=[],k=0;k<f.length;k++)v[k]=f.item(k);return v},revive:function(f){return new(function(){function v(){h(this,v),this._files=arguments[0],this.length=this._files.length}return function(B,J,ne){return J&&c(B.prototype,J),ne&&c(B,ne),B}(v,[{key:"item",value:function(B){return this._files[B]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),v}())(f)}}},{blob:{test:function(f){return z.toStringTag(f)==="Blob"},replace:function(f){var v=new XMLHttpRequest;if(v.overrideMimeType("text/plain; charset=x-user-defined"),v.open("GET",URL.createObjectURL(f),!1),v.send(),v.status!==200&&v.status!==0)throw new Error("Bad Blob access: "+v.status);return{type:f.type,stringContents:v.responseText}},revive:function(f){var v=f.type,k=f.stringContents;return new Blob([Ke(k)],{type:v})},replaceAsync:function(f){return new z.Promise(function(v,k){var B=new FileReader;B.addEventListener("load",function(){v({type:f.type,stringContents:B.result})}),B.addEventListener("error",function(){k(B.error)}),B.readAsBinaryString(f)})}}}].concat(typeof Map=="function"?Ct:[],typeof Set=="function"?We:[],typeof ArrayBuffer=="function"?ve:[],typeof Uint8Array=="function"?Ee:[],typeof DataView=="function"?Pe:[],typeof Intl<"u"?dt:[],typeof crypto<"u"?gt:[],typeof BigInt<"u"?[yt,Ie]:[]).concat({checkDataCloneException:{test:function(f){var v={}.toString.call(f).slice(8,-1);if(["symbol","function"].includes(u(f))||["Arguments","Module","Error","Promise","WeakMap","WeakSet","Event","MessageChannel"].includes(v)||f&&u(f)==="object"&&typeof f.nodeType=="number"&&typeof f.insertBefore=="function")throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}}})})},{}],8:[function(n,t,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M};function u(M){return(u=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(x){return typeof x>"u"?"undefined":s(x)}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x>"u"?"undefined":s(x)})(M)}function h(M,x){if(!(M instanceof x))throw new TypeError("Cannot call a class as a function")}function c(M,x){for(var L=0;L<x.length;L++){var K=x[L];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(M,K.key,K)}}function b(M,x,L){return x in M?Object.defineProperty(M,x,{value:L,enumerable:!0,configurable:!0,writable:!0}):M[x]=L,M}function p(M,x){var L=Object.keys(M);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(M);x&&(K=K.filter(function(G){return Object.getOwnPropertyDescriptor(M,G).enumerable})),L.push.apply(L,K)}return L}function y(M){for(var x=1;x<arguments.length;x++){var L=arguments[x]!=null?arguments[x]:{};x%2?p(Object(L),!0).forEach(function(K){b(M,K,L[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(L)):p(Object(L)).forEach(function(K){Object.defineProperty(M,K,Object.getOwnPropertyDescriptor(L,K))})}return M}function w(M,x){return function(K){if(Array.isArray(K))return K}(M)||function(K,G){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(K)))){var z=[],Ce=!0,Oe=!1,fe=void 0;try{for(var et,tt=K[Symbol.iterator]();!(Ce=(et=tt.next()).done)&&(z.push(et.value),!G||z.length!==G);Ce=!0);}catch(mt){Oe=!0,fe=mt}finally{try{Ce||tt.return==null||tt.return()}finally{if(Oe)throw fe}}return z}}(M,x)||R(M,x)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function T(M){return function(L){if(Array.isArray(L))return S(L)}(M)||function(L){if(typeof Symbol<"u"&&Symbol.iterator in Object(L))return Array.from(L)}(M)||R(M)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function R(M,x){if(M){if(typeof M=="string")return S(M,x);var L=Object.prototype.toString.call(M).slice(8,-1);return L==="Object"&&M.constructor&&(L=M.constructor.name),L==="Map"||L==="Set"?Array.from(M):L==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(L)?S(M,x):void 0}}function S(M,x){(x==null||x>M.length)&&(x=M.length);for(var L=0,K=new Array(x);L<x;L++)K[L]=M[L];return K}var O=function M(x){h(this,M),this.p=new Promise(x)};O.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(O.prototype[Symbol.toStringTag]="TypesonPromise"),O.prototype.then=function(M,x){var L=this;return new O(function(K,G){L.p.then(function(z){K(M?M(z):z)}).catch(function(z){return x?x(z):Promise.reject(z)}).then(K,G)})},O.prototype.catch=function(M){return this.then(null,M)},O.resolve=function(M){return new O(function(x){x(M)})},O.reject=function(M){return new O(function(x,L){L(M)})},["all","race","allSettled"].forEach(function(M){O[M]=function(x){return new O(function(L,K){Promise[M](x.map(function(G){return G&&G.constructor&&G.constructor.__typeson__type__==="TypesonPromise"?G.p:G})).then(L,K)})}});var P={}.toString,C={}.hasOwnProperty,N=Object.getPrototypeOf,a=C.toString;function o(M,x){return m(M)&&typeof M.then=="function"&&(!x||typeof M.catch=="function")}function d(M){return P.call(M).slice(8,-1)}function l(M,x){if(!M||u(M)!=="object")return!1;var L=N(M);if(!L)return x===null;var K=C.call(L,"constructor")&&L.constructor;return typeof K!="function"?x===null:x===K||x!==null&&a.call(K)===a.call(x)||typeof x=="function"&&typeof K.__typeson__type__=="string"&&K.__typeson__type__===x.__typeson__type__}function g(M){return!(!M||d(M)!=="Object")&&(!N(M)||l(M,Object))}function m(M){return M&&u(M)==="object"}function _(M){return M.replace(/~/g,"~0").replace(/\./g,"~1")}function I(M){return M.replace(/~1/g,".").replace(/~0/g,"~")}function V(M,x){if(x==="")return M;var L=x.indexOf(".");if(L>-1){var K=M[I(x.slice(0,L))];return K===void 0?void 0:V(K,x.slice(L+1))}return M[I(x)]}function F(M,x,L){if(x==="")return L;var K=x.indexOf(".");return K>-1?F(M[I(x.slice(0,K))],x.slice(K+1),L):(M[I(x)]=L,M)}function j(M,x,L){return L?x?x(M):M:(M&&M.then||(M=Promise.resolve(M)),x?M.then(x):M)}var W=Object.keys,A=Array.isArray,H={}.hasOwnProperty,q=["type","replaced","iterateIn","iterateUnsetNumeric"];function X(M){return function(){for(var x=[],L=0;L<arguments.length;L++)x[L]=arguments[L];try{return Promise.resolve(M.apply(this,x))}catch(K){return Promise.reject(K)}}}function me(M,x){if(M.keypath==="")return-1;var L=M.keypath.match(/\./g)||0,K=x.keypath.match(/\./g)||0;return L&&(L=L.length),K&&(K=K.length),L>K?-1:L<K?1:M.keypath<x.keypath?-1:M.keypath>x.keypath}var Y=function(){function M(x){h(this,M),this.options=x,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(L,K,G){return K&&c(L.prototype,K),G&&c(L,G),L}(M,[{key:"stringify",value:function(L,K,G,z){z=y(y(y({},this.options),z),{},{stringification:!0});var Ce=this.encapsulate(L,null,z);return A(Ce)?JSON.stringify(Ce[0],K,G):Ce.then(function(Oe){return JSON.stringify(Oe,K,G)})}},{key:"stringifySync",value:function(L,K,G,z){return this.stringify(L,K,G,y(y({throwOnBadSyncType:!0},z),{},{sync:!0}))}},{key:"stringifyAsync",value:function(L,K,G,z){return this.stringify(L,K,G,y(y({throwOnBadSyncType:!0},z),{},{sync:!1}))}},{key:"parse",value:function(L,K,G){return G=y(y(y({},this.options),G),{},{parse:!0}),this.revive(JSON.parse(L,K),G)}},{key:"parseSync",value:function(L,K,G){return this.parse(L,K,y(y({throwOnBadSyncType:!0},G),{},{sync:!0}))}},{key:"parseAsync",value:function(L,K,G){return this.parse(L,K,y(y({throwOnBadSyncType:!0},G),{},{sync:!1}))}},{key:"specialTypeNames",value:function(L,K){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return G.returnTypeNames=!0,this.encapsulate(L,K,G)}},{key:"rootTypeName",value:function(L,K){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return G.iterateNone=!0,this.encapsulate(L,K,G)}},{key:"encapsulate",value:function(L,K,G){var z=X(function(ae,Z){return j(Promise.all(Z.map(function(ve){return ve[1].p})),function(ve){return j(Promise.all(ve.map(X(function(he){var Ee=!1,Pe=[],dt=w(Z.splice(0,1),1),Ke=w(dt[0],7),at=Ke[0],yt=Ke[2],Ie=Ke[3],gt=Ke[4],E=Ke[5],f=Ke[6],v=ye(at,he,yt,Ie,Pe,!0,f),k=l(v,O);return function(J,ne){var de=J();return de&&de.then?de.then(ne):ne(de)}(function(){if(at&&k)return j(v.p,function(B){return gt[E]=B,Ee=!0,z(ae,Pe)})},function(B){return Ee?B:(at?gt[E]=v:ae=k?v.p:v,z(ae,Pe))})}))),function(){return ae})})}),Ce=(G=y(y({sync:!0},this.options),G)).sync,Oe=this,fe={},et=[],tt=[],mt=[],vt=!("cyclic"in G)||G.cyclic,Ye=G.encapsulateObserver,Ct=ye("",L,vt,K||{},mt);function We(ae){var Z=Object.values(fe);if(G.iterateNone)return Z.length?Z[0]:M.getJSONType(ae);if(Z.length){if(G.returnTypeNames)return T(new Set(Z));ae&&g(ae)&&!H.call(ae,"$types")?ae.$types=fe:ae={$:ae,$types:{$:fe}}}else m(ae)&&H.call(ae,"$types")&&(ae={$:ae,$types:!0});return!G.returnTypeNames&&ae}function Ne(ae,Z,ve){Object.assign(ae,Z);var he=q.map(function(Ee){var Pe=ae[Ee];return delete ae[Ee],Pe});ve(),q.forEach(function(Ee,Pe){ae[Ee]=he[Pe]})}function ye(ae,Z,ve,he,Ee,Pe,dt){var Ke,at={},yt=u(Z),Ie=Ye?function(Te){var ge=dt||he.type||M.getJSONType(Z);Ye(Object.assign(Te||at,{keypath:ae,value:Z,cyclic:ve,stateObj:he,promisesData:Ee,resolvingTypesonPromise:Pe,awaitingTypesonPromise:l(Z,O)},{type:ge}))}:null;if(["string","boolean","number","undefined"].includes(yt))return Z===void 0||Number.isNaN(Z)||Z===Number.NEGATIVE_INFINITY||Z===Number.POSITIVE_INFINITY?(Ke=he.replaced?Z:it(ae,Z,he,Ee,!1,Pe,Ie))!==Z&&(at={replaced:Ke}):Ke=Z,Ie&&Ie(),Ke;if(Z===null)return Ie&&Ie(),Z;if(ve&&!he.iterateIn&&!he.iterateUnsetNumeric&&Z&&u(Z)==="object"){var gt=et.indexOf(Z);if(!(gt<0))return fe[ae]="#",Ie&&Ie({cyclicKeypath:tt[gt]}),"#"+tt[gt];ve===!0&&(et.push(Z),tt.push(ae))}var E,f=g(Z),v=A(Z),k=(f||v)&&(!Oe.plainObjectReplacers.length||he.replaced)||he.iterateIn?Z:it(ae,Z,he,Ee,f||v,null,Ie);if(k!==Z?(Ke=k,at={replaced:k}):ae===""&&l(Z,O)?(Ee.push([ae,Z,ve,he,void 0,void 0,he.type]),Ke=Z):v&&he.iterateIn!=="object"||he.iterateIn==="array"?(E=new Array(Z.length),at={clone:E}):(["function","symbol"].includes(u(Z))||"toJSON"in Z||l(Z,O)||l(Z,Promise)||l(Z,ArrayBuffer))&&!f&&he.iterateIn!=="object"?Ke=Z:(E={},he.addLength&&(E.length=Z.length),at={clone:E}),Ie&&Ie(),G.iterateNone)return E||Ke;if(!E)return Ke;if(he.iterateIn){var B=function(ge){var ke={ownKeys:H.call(Z,ge)};Ne(he,ke,function(){var Ze=ae+(ae?".":"")+_(ge),ze=ye(Ze,Z[ge],!!ve,he,Ee,Pe);l(ze,O)?Ee.push([Ze,ze,!!ve,he,E,ge,he.type]):ze!==void 0&&(E[ge]=ze)})};for(var J in Z)B(J);Ie&&Ie({endIterateIn:!0,end:!0})}else W(Z).forEach(function(Te){var ge=ae+(ae?".":"")+_(Te);Ne(he,{ownKeys:!0},function(){var ke=ye(ge,Z[Te],!!ve,he,Ee,Pe);l(ke,O)?Ee.push([ge,ke,!!ve,he,E,Te,he.type]):ke!==void 0&&(E[Te]=ke)})}),Ie&&Ie({endIterateOwn:!0,end:!0});if(he.iterateUnsetNumeric){for(var ne=Z.length,de=function(ge){if(!(ge in Z)){var ke=ae+(ae?".":"")+ge;Ne(he,{ownKeys:!1},function(){var Ze=ye(ke,void 0,!!ve,he,Ee,Pe);l(Ze,O)?Ee.push([ke,Ze,!!ve,he,E,ge,he.type]):Ze!==void 0&&(E[ge]=Ze)})}},re=0;re<ne;re++)de(re);Ie&&Ie({endIterateUnsetNumeric:!0,end:!0})}return E}function it(ae,Z,ve,he,Ee,Pe,dt){for(var Ke=Ee?Oe.plainObjectReplacers:Oe.nonplainObjectReplacers,at=Ke.length;at--;){var yt=Ke[at];if(yt.test(Z,ve)){var Ie=yt.type;if(Oe.revivers[Ie]){var gt=fe[ae];fe[ae]=gt?[Ie].concat(gt):Ie}return Object.assign(ve,{type:Ie,replaced:!0}),!Ce&&yt.replaceAsync||yt.replace?(dt&&dt({replacing:!0}),ye(ae,yt[Ce||!yt.replaceAsync?"replace":"replaceAsync"](Z,ve),vt&&"readonly",ve,he,Pe,Ie)):(dt&&dt({typeDetected:!0}),ye(ae,Z,vt&&"readonly",ve,he,Pe,Ie))}}return Z}return mt.length?Ce&&G.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(z(Ct,mt)).then(We):!Ce&&G.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():G.stringification&&Ce?[We(Ct)]:Ce?We(Ct):Promise.resolve(We(Ct))}},{key:"encapsulateSync",value:function(L,K,G){return this.encapsulate(L,K,y(y({throwOnBadSyncType:!0},G),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(L,K,G){return this.encapsulate(L,K,y(y({throwOnBadSyncType:!0},G),{},{sync:!1}))}},{key:"revive",value:function(L,K){var G=L&&L.$types;if(!G)return L;if(G===!0)return L.$;var z=(K=y(y({sync:!0},this.options),K)).sync,Ce=[],Oe={},fe=!0;G.$&&g(G.$)&&(L=L.$,G=G.$,fe=!1);var et=this;function tt(We,Ne){var ye=w(et.revivers[We]||[],1)[0];if(!ye)throw new Error("Unregistered type: "+We);return z&&!("revive"in ye)?Ne:ye[z&&ye.revive?"revive":!z&&ye.reviveAsync?"reviveAsync":"revive"](Ne,Oe)}var mt=[];function vt(We){return l(We,xe)?void 0:We}var Ye,Ct=function(){var Ne=[];if(Object.entries(G).forEach(function(ye){var it=w(ye,2),ae=it[0],Z=it[1];Z!=="#"&&[].concat(Z).forEach(function(ve){w(et.revivers[ve]||[null,{}],2)[1].plain&&(Ne.push({keypath:ae,type:ve}),delete G[ae])})}),Ne.length)return Ne.sort(me).reduce(function ye(it,ae){var Z=ae.keypath,ve=ae.type;if(o(it))return it.then(function(Pe){return ye(Pe,{keypath:Z,type:ve})});var he=V(L,Z);if(l(he=tt(ve,he),O))return he.then(function(Pe){var dt=F(L,Z,Pe);dt===Pe&&(L=dt)});var Ee=F(L,Z,he);Ee===he&&(L=Ee)},void 0)}();return l(Ct,O)?Ye=Ct.then(function(){return L}):(Ye=function We(Ne,ye,it,ae,Z){if(!fe||Ne!=="$types"){var ve=G[Ne],he=A(ye);if(he||g(ye)){var Ee=he?new Array(ye.length):{};for(W(ye).forEach(function(E){var f=We(Ne+(Ne?".":"")+_(E),ye[E],it||Ee,Ee,E),v=function(B){return l(B,xe)?Ee[E]=void 0:B!==void 0&&(Ee[E]=B),B};l(f,O)?mt.push(f.then(function(k){return v(k)})):v(f)}),ye=Ee;Ce.length;){var Pe=w(Ce[0],4),dt=Pe[0],Ke=Pe[1],at=Pe[2],yt=Pe[3],Ie=V(dt,Ke);if(Ie===void 0)break;at[yt]=Ie,Ce.splice(0,1)}}if(!ve)return ye;if(ve==="#"){var gt=V(it,ye.slice(1));return gt===void 0&&Ce.push([it,ye.slice(1),ae,Z]),gt}return[].concat(ve).reduce(function E(f,v){return l(f,O)?f.then(function(k){return E(k,v)}):tt(v,f)},ye)}}("",L,null),mt.length&&(Ye=O.resolve(Ye).then(function(We){return O.all([We].concat(mt))}).then(function(We){return w(We,1)[0]}))),o(Ye)?z&&K.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():l(Ye,O)?Ye.p.then(vt):Ye:!z&&K.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():z?vt(Ye):Promise.resolve(vt(Ye))}},{key:"reviveSync",value:function(L,K){return this.revive(L,y(y({throwOnBadSyncType:!0},K),{},{sync:!0}))}},{key:"reviveAsync",value:function(L,K){return this.revive(L,y(y({throwOnBadSyncType:!0},K),{},{sync:!1}))}},{key:"register",value:function(L,K){return K=K||{},[].concat(L).forEach(function G(z){var Ce=this;if(A(z))return z.map(function(Oe){return G.call(Ce,Oe)});z&&W(z).forEach(function(Oe){if(Oe==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(M.JSON_TYPES.includes(Oe))throw new TypeError("Plain JSON object types are reserved as type names");var fe=z[Oe],et=fe&&fe.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,tt=et.filter(function(Ne){return Ne.type===Oe});if(tt.length&&(et.splice(et.indexOf(tt[0]),1),delete this.revivers[Oe],delete this.types[Oe]),typeof fe=="function"){var mt=fe;fe={test:function(ye){return ye&&ye.constructor===mt},replace:function(ye){return y({},ye)},revive:function(ye){return Object.assign(Object.create(mt.prototype),ye)}}}else if(A(fe)){var vt=w(fe,3);fe={test:vt[0],replace:vt[1],revive:vt[2]}}if(fe&&fe.test){var Ye={type:Oe,test:fe.test.bind(fe)};fe.replace&&(Ye.replace=fe.replace.bind(fe)),fe.replaceAsync&&(Ye.replaceAsync=fe.replaceAsync.bind(fe));var Ct=typeof K.fallback=="number"?K.fallback:K.fallback?0:Number.POSITIVE_INFINITY;if(fe.testPlainObjects?this.plainObjectReplacers.splice(Ct,0,Ye):this.nonplainObjectReplacers.splice(Ct,0,Ye),fe.revive||fe.reviveAsync){var We={};fe.revive&&(We.revive=fe.revive.bind(fe)),fe.reviveAsync&&(We.reviveAsync=fe.reviveAsync.bind(fe)),this.revivers[Oe]=[We,{plain:fe.testPlainObjects}]}this.types[Oe]=fe}},this)},this),this}}]),M}(),xe=function M(){h(this,M)};xe.__typeson__type__="TypesonUndefined",Y.Undefined=xe,Y.Promise=O,Y.isThenable=o,Y.toStringTag=d,Y.hasConstructorOf=l,Y.isObject=m,Y.isPlainObject=g,Y.isUserObject=function M(x){if(!x||d(x)!=="Object")return!1;var L=N(x);return!L||l(x,Object)||M(L)},Y.escapeKeyPathComponent=_,Y.unescapeKeyPathComponent=I,Y.getByKeyPath=V,Y.getJSONType=function(x){return x===null?"null":Array.isArray(x)?"array":u(x)},Y.JSON_TYPES=["null","boolean","number","string","array","object"],t.exports=Y},{}],9:[function(n,t,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S};function u(S,O){return(O&&O.context?O.context:"Value")+" "+S+"."}function h(S){if(S===null)return"Null";switch(typeof S>"u"?"undefined":s(S)){case"undefined":return"Undefined";case"boolean":return"Boolean";case"number":return"Number";case"string":return"String";case"symbol":return"Symbol";case"object":case"function":default:return"Object"}}function c(S){return S>0&&S%1===.5&&!(S&1)||S<0&&S%1===-.5&&(S&1)===1?w(Math.floor(S)):w(Math.round(S))}function b(S){return w(Math.trunc(S))}function p(S){return S<0?-1:1}function y(S,O){var P=S%O;return p(O)!==p(P)?P+O:P}function w(S){return S===0?0:S}function T(S,O){var P=!O.unsigned,C=void 0,N=void 0;S===64?(N=Math.pow(2,53)-1,C=P?-Math.pow(2,53)+1:0):P?(C=-Math.pow(2,S-1),N=Math.pow(2,S-1)-1):(C=0,N=Math.pow(2,S)-1);var a=Math.pow(2,S),o=Math.pow(2,S-1);return function(d,l){l===void 0&&(l={});var g=+d;if(g=w(g),l.enforceRange){if(!Number.isFinite(g))throw new TypeError(u("is not a finite number",l));if(g=b(g),g<C||g>N)throw new TypeError(u("is outside the accepted range of "+C+" to "+N+", inclusive",l));return g}return!Number.isNaN(g)&&l.clamp?(g=Math.min(Math.max(g,C),N),g=c(g),g):!Number.isFinite(g)||g===0?0:(g=b(g),g>=C&&g<=N?g:(g=y(g,a),P&&g>=o?g-a:g))}}i.any=function(S){return S},i.void=function(){},i.boolean=function(S){return!!S},i.byte=T(8,{unsigned:!1}),i.octet=T(8,{unsigned:!0}),i.short=T(16,{unsigned:!1}),i["unsigned short"]=T(16,{unsigned:!0}),i.long=T(32,{unsigned:!1}),i["unsigned long"]=T(32,{unsigned:!0}),i["long long"]=T(64,{unsigned:!1}),i["unsigned long long"]=T(64,{unsigned:!0}),i.double=function(S,O){var P=+S;if(!Number.isFinite(P))throw new TypeError(u("is not a finite floating-point value",O));return P},i["unrestricted double"]=function(S){var O=+S;return O},i.float=function(S,O){var P=+S;if(!Number.isFinite(P))throw new TypeError(u("is not a finite floating-point value",O));if(Object.is(P,-0))return P;var C=Math.fround(P);if(!Number.isFinite(C))throw new TypeError(u("is outside the range of a single-precision floating-point value",O));return C},i["unrestricted float"]=function(S){var O=+S;return isNaN(O)||Object.is(O,-0)?O:Math.fround(O)},i.DOMString=function(S,O){if(O===void 0&&(O={}),O.treatNullAsEmptyString&&S===null)return"";if((typeof S>"u"?"undefined":s(S))==="symbol")throw new TypeError(u("is a symbol, which cannot be converted to a string",O));return String(S)},i.ByteString=function(S,O){for(var P=i.DOMString(S,O),C=void 0,N=0;(C=P.codePointAt(N))!==void 0;++N)if(C>255)throw new TypeError(u("is not a valid ByteString",O));return P},i.USVString=function(S,O){for(var P=i.DOMString(S,O),C=P.length,N=[],a=0;a<C;++a){var o=P.charCodeAt(a);if(o<55296||o>57343)N.push(String.fromCodePoint(o));else if(56320<=o&&o<=57343)N.push(String.fromCodePoint(65533));else if(a===C-1)N.push(String.fromCodePoint(65533));else{var d=P.charCodeAt(a+1);if(56320<=d&&d<=57343){var l=o&1023,g=d&1023;N.push(String.fromCodePoint(65536+1024*l+g)),++a}else N.push(String.fromCodePoint(65533))}}return N.join("")},i.object=function(S,O){if(h(S)!=="Object")throw new TypeError(u("is not an object",O));return S};function R(S,O){if(typeof S!="function")throw new TypeError(u("is not a function",O));return S}[Error,ArrayBuffer,DataView,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,Float32Array,Float64Array].forEach(function(S){var O=S.name,P=/^[AEIOU]/.test(O)?"an":"a";i[O]=function(C,N){if(!(C instanceof S))throw new TypeError(u("is not "+P+" "+O+" object",N));return C}}),i.ArrayBufferView=function(S,O){if(!ArrayBuffer.isView(S))throw new TypeError(u("is not a view on an ArrayBuffer object",O));return S},i.BufferSource=function(S,O){if(!(ArrayBuffer.isView(S)||S instanceof ArrayBuffer))throw new TypeError(u("is not an ArrayBuffer object or a view on one",O));return S},i.DOMTimeStamp=i["unsigned long long"],i.Function=R,i.VoidFunction=R},{}]},{},[1])(1)})})(Fa);var pu=Fa.exports;const mu=bs(pu),Nt=r=>{if(typeof structuredClone<"u")return structuredClone(r);try{return mu(r)}catch{throw new fu}},Bn=r=>r.source instanceof Rt?r.source:r.source.objectStore,lr=(r,e,n)=>{let t=r!==void 0?r.lower:void 0,i=r!==void 0?r.upper:void 0;for(const s of e)s!==void 0&&(t===void 0||Se(t,s)===1)&&(t=s);for(const s of n)s!==void 0&&(i===void 0||Se(i,s)===-1)&&(i=s);if(t!==void 0&&i!==void 0)return _e.bound(t,i);if(t!==void 0)return _e.lowerBound(t);if(i!==void 0)return _e.upperBound(i)};class Yn{_gotValue=!1;_position=void 0;_objectStorePosition=void 0;_keyOnly=!1;_key=void 0;_primaryKey=void 0;constructor(e,n,t="next",i,s=!1){this._range=n,this._source=e,this._direction=t,this._request=i,this._keyOnly=s}get source(){return this._source}set source(e){}get request(){return this._request}set request(e){}get direction(){return this._direction}set direction(e){}get key(){return this._key}set key(e){}get primaryKey(){return this._primaryKey}set primaryKey(e){}_iterate(e,n){const t=this.source instanceof Rt,i=this.source instanceof Rt?this.source._rawObjectStore.records:this.source._rawIndex.records;let s;if(this.direction==="next"){const h=lr(this._range,[e,this._position],[]);for(const c of i.values(h)){const b=e!==void 0?Se(c.key,e):void 0,p=this._position!==void 0?Se(c.key,this._position):void 0;if(!(e!==void 0&&b===-1)){if(n!==void 0){if(b===-1)continue;const y=Se(c.value,n);if(b===0&&y===-1)continue}if(!(this._position!==void 0&&t&&p!==1)&&!(this._position!==void 0&&!t&&(p===-1||p===0&&Se(c.value,this._objectStorePosition)!==1))&&!(this._range!==void 0&&!this._range.includes(c.key))){s=c;break}}}}else if(this.direction==="nextunique"){const h=lr(this._range,[e,this._position],[]);for(const c of i.values(h))if(!(e!==void 0&&Se(c.key,e)===-1)&&!(this._position!==void 0&&Se(c.key,this._position)!==1)&&!(this._range!==void 0&&!this._range.includes(c.key))){s=c;break}}else if(this.direction==="prev"){const h=lr(this._range,[],[e,this._position]);for(const c of i.values(h,"prev")){const b=e!==void 0?Se(c.key,e):void 0,p=this._position!==void 0?Se(c.key,this._position):void 0;if(!(e!==void 0&&b===1)){if(n!==void 0){if(b===1)continue;const y=Se(c.value,n);if(b===0&&y===1)continue}if(!(this._position!==void 0&&t&&p!==-1)&&!(this._position!==void 0&&!t&&(p===1||p===0&&Se(c.value,this._objectStorePosition)!==-1))&&!(this._range!==void 0&&!this._range.includes(c.key))){s=c;break}}}}else if(this.direction==="prevunique"){let h;const c=lr(this._range,[],[e,this._position]);for(const b of i.values(c,"prev"))if(!(e!==void 0&&Se(b.key,e)===1)&&!(this._position!==void 0&&Se(b.key,this._position)!==-1)&&!(this._range!==void 0&&!this._range.includes(b.key))){h=b;break}h&&(s=i.get(h.key))}let u;if(!s)this._key=void 0,t||(this._objectStorePosition=void 0),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=void 0),u=null;else{if(this._position=s.key,t||(this._objectStorePosition=s.value),this._key=s.key,t)this._primaryKey=Nt(s.key),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=Nt(s.value));else if(this._primaryKey=Nt(s.value),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"){if(this.source instanceof Rt)throw new Error("This should never happen");const h=this.source.objectStore._rawObjectStore.getValue(s.value);this.value=Nt(h)}this._gotValue=!0,u=this}return u}update(e){if(e===void 0)throw new TypeError;const n=Bn(this),t=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,i=n.transaction;if(i._state!=="active")throw new xt;if(i.mode==="readonly")throw new Gn;if(n._rawObjectStore.deleted)throw new we;if(!(this.source instanceof Rt)&&this.source._rawIndex.deleted)throw new we;if(!this._gotValue||!this.hasOwnProperty("value"))throw new we;const s=Nt(e);if(n.keyPath!==null){let h;try{h=er(n.keyPath,s)}catch{}if(Se(h,t)!==0)throw new rt}const u={key:t,value:s};return i._execRequestAsync({operation:n._rawObjectStore.storeRecord.bind(n._rawObjectStore,u,!1,i._rollbackLog),source:this})}advance(e){if(!Number.isInteger(e)||e<=0)throw new TypeError;const n=Bn(this),t=n.transaction;if(t._state!=="active")throw new xt;if(n._rawObjectStore.deleted)throw new we;if(!(this.source instanceof Rt)&&this.source._rawIndex.deleted)throw new we;if(!this._gotValue)throw new we;this._request&&(this._request.readyState="pending"),t._execRequestAsync({operation:()=>{let i;for(let s=0;s<e&&(i=this._iterate(),!!i);s++);return i},request:this._request,source:this.source}),this._gotValue=!1}continue(e){const n=Bn(this),t=n.transaction;if(t._state!=="active")throw new xt;if(n._rawObjectStore.deleted)throw new we;if(!(this.source instanceof Rt)&&this.source._rawIndex.deleted)throw new we;if(!this._gotValue)throw new we;if(e!==void 0){e=Re(e);const i=Se(e,this._position);if(i<=0&&(this.direction==="next"||this.direction==="nextunique")||i>=0&&(this.direction==="prev"||this.direction==="prevunique"))throw new rt}this._request&&(this._request.readyState="pending"),t._execRequestAsync({operation:this._iterate.bind(this,e),request:this._request,source:this.source}),this._gotValue=!1}continuePrimaryKey(e,n){const t=Bn(this),i=t.transaction;if(i._state!=="active")throw new xt;if(t._rawObjectStore.deleted)throw new we;if(!(this.source instanceof Rt)&&this.source._rawIndex.deleted)throw new we;if(this.source instanceof Rt||this.direction!=="next"&&this.direction!=="prev")throw new kr;if(!this._gotValue)throw new we;if(e===void 0||n===void 0)throw new rt;e=Re(e);const s=Se(e,this._position);if(s===-1&&this.direction==="next"||s===1&&this.direction==="prev")throw new rt;const u=Se(n,this._objectStorePosition);if(s===0&&(u<=0&&this.direction==="next"||u>=0&&this.direction==="prev"))throw new rt;this._request&&(this._request.readyState="pending"),i._execRequestAsync({operation:this._iterate.bind(this,e,n),request:this._request,source:this.source}),this._gotValue=!1}delete(){const e=Bn(this),n=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,t=e.transaction;if(t._state!=="active")throw new xt;if(t.mode==="readonly")throw new Gn;if(e._rawObjectStore.deleted)throw new we;if(!(this.source instanceof Rt)&&this.source._rawIndex.deleted)throw new we;if(!this._gotValue||!this.hasOwnProperty("value"))throw new we;return t._execRequestAsync({operation:e._rawObjectStore.deleteRecord.bind(e._rawObjectStore,n,t._rollbackLog),source:this})}toString(){return"[object IDBCursor]"}}class ja extends Yn{value=void 0;constructor(e,n,t,i){super(e,n,t,i)}toString(){return"[object IDBCursorWithValue]"}}const Yi=(r,e)=>r.immediatePropagationStopped||r.eventPhase===r.CAPTURING_PHASE&&e.capture===!1||r.eventPhase===r.BUBBLING_PHASE&&e.capture===!0,Gr=(r,e)=>{r.currentTarget=e;for(const s of e.listeners.slice())r.type!==s.type||Yi(r,s)||s.callback.call(r.currentTarget,r);const t={abort:"onabort",blocked:"onblocked",complete:"oncomplete",error:"onerror",success:"onsuccess",upgradeneeded:"onupgradeneeded",versionchange:"onversionchange"}[r.type];if(t===void 0)throw new Error(`Unknown event type: "${r.type}"`);const i=r.currentTarget[t];if(i){const s={callback:i,capture:!1,type:r.type};Yi(r,s)||s.callback.call(r.currentTarget,r)}};class Ni{listeners=[];addEventListener(e,n,t=!1){this.listeners.push({callback:n,capture:t,type:e})}removeEventListener(e,n,t=!1){const i=this.listeners.findIndex(s=>s.type===e&&s.callback===n&&s.capture===t);this.listeners.splice(i,1)}dispatchEvent(e){if(e.dispatched||!e.initialized)throw new we("The object is in an invalid state.");e.isTrusted=!1,e.dispatched=!0,e.target=this,e.eventPhase=e.CAPTURING_PHASE;for(const n of e.eventPath)e.propagationStopped||Gr(e,n);if(e.eventPhase=e.AT_TARGET,e.propagationStopped||Gr(e,e.target),e.bubbles){e.eventPath.reverse(),e.eventPhase=e.BUBBLING_PHASE;for(const n of e.eventPath)e.propagationStopped||Gr(e,n)}return e.dispatched=!1,e.eventPhase=e.NONE,e.currentTarget=null,!e.canceled}}class yn extends Ni{_result=null;_error=null;source=null;transaction=null;readyState="pending";onsuccess=null;onerror=null;get error(){if(this.readyState==="pending")throw new we;return this._error}set error(e){this._error=e}get result(){if(this.readyState==="pending")throw new we;return this._result}set result(e){this._result=e}toString(){return"[object IDBRequest]"}}const Xn=(r,e)=>{const t=e==="unsigned long"?4294967295:9007199254740991;if(isNaN(r)||r<0||r>t)throw new TypeError;if(r>=0)return Math.floor(r)};class ft extends Array{contains(e){for(const n of this)if(e===n)return!0;return!1}item(e){return e<0||e>=this.length?null:this[e]}_push(...e){return Array.prototype.push.call(this,...e)}_sort(...e){return Array.prototype.sort.call(this,...e)}}const Dr=(r,e=!1)=>{if(r instanceof _e)return r;if(r==null){if(e)throw new rt;return new _e(void 0,void 0,!1,!1)}const n=Re(r);return _e.only(n)},dn=r=>{if(r._rawIndex.deleted||r.objectStore._rawObjectStore.deleted)throw new we;if(r.objectStore.transaction._state!=="active")throw new xt};class Xi{constructor(e,n){this._rawIndex=n,this._name=n.name,this.objectStore=e,this.keyPath=n.keyPath,this.multiEntry=n.multiEntry,this.unique=n.unique}get name(){return this._name}set name(e){const n=this.objectStore.transaction;if(!n.db._runningVersionchangeTransaction)throw new we;if(n._state!=="active")throw new xt;if(this._rawIndex.deleted||this.objectStore._rawObjectStore.deleted)throw new we;if(e=String(e),e===this._name)return;if(this.objectStore.indexNames.contains(e))throw new sn;const t=this._name,i=[...this.objectStore.indexNames];this._name=e,this._rawIndex.name=e,this.objectStore._indexesCache.delete(t),this.objectStore._indexesCache.set(e,this),this.objectStore._rawObjectStore.rawIndexes.delete(t),this.objectStore._rawObjectStore.rawIndexes.set(e,this._rawIndex),this.objectStore.indexNames=new ft(...Array.from(this.objectStore._rawObjectStore.rawIndexes.keys()).filter(s=>{const u=this.objectStore._rawObjectStore.rawIndexes.get(s);return u&&!u.deleted}).sort()),n._rollbackLog.push(()=>{this._name=t,this._rawIndex.name=t,this.objectStore._indexesCache.delete(e),this.objectStore._indexesCache.set(t,this),this.objectStore._rawObjectStore.rawIndexes.delete(e),this.objectStore._rawObjectStore.rawIndexes.set(t,this._rawIndex),this.objectStore.indexNames=new ft(...i)})}openCursor(e,n){dn(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e)));const t=new yn;t.source=this,t.transaction=this.objectStore.transaction;const i=new ja(this,e,n,t);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:t,source:this})}openKeyCursor(e,n){dn(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e)));const t=new yn;t.source=this,t.transaction=this.objectStore.transaction;const i=new Yn(this,e,n,t,!0);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:t,source:this})}get(e){return dn(this),e instanceof _e||(e=Re(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getValue.bind(this._rawIndex,e),source:this})}getAll(e,n){arguments.length>1&&n!==void 0&&(n=Xn(n,"unsigned long")),dn(this);const t=Dr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllValues.bind(this._rawIndex,t,n),source:this})}getKey(e){return dn(this),e instanceof _e||(e=Re(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getKey.bind(this._rawIndex,e),source:this})}getAllKeys(e,n){arguments.length>1&&n!==void 0&&(n=Xn(n,"unsigned long")),dn(this);const t=Dr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllKeys.bind(this._rawIndex,t,n),source:this})}count(e){return dn(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e))),this.objectStore.transaction._execRequestAsync({operation:()=>{let n=0;const t=new Yn(this,e);for(;t._iterate()!==null;)n+=1;return n},source:this})}toString(){return"[object IDBIndex]"}}const yu=(r,e)=>{if(Array.isArray(r))throw new Error("The key paths used in this section are always strings and never sequences, since it is not possible to create a object store which has a key generator and also has a key path that is a sequence.");const n=r.split(".");if(n.length===0)throw new Error("Assert: identifiers is not empty");n.pop();for(const t of n){if(typeof e!="object"&&!Array.isArray(e))return!1;if(!e.hasOwnProperty(t))return!0;e=e[t]}return typeof e=="object"||Array.isArray(e)};function Pr(r,e){let n=0,t=r.length,i;for(;n<t;)i=n+t>>>1,Se(r[i].key,e)<0?n=i+1:t=i;return n}function Ma(r,e){const n=Pr(r,e),t=r[n];return t&&Se(t.key,e)===0?n:-1}function gu(r,e){const n=Ma(r,e);return r[n]}function La(r,e){const n=typeof e.lower>"u"?0:Pr(r,e.lower),t=typeof e.upper>"u"?r.length-1:Pr(r,e.upper);for(let i=n;i<=t;i++){const s=r[i];if(s&&e.includes(s.key))return i}return-1}function bu(r,e){const n=La(r,e);return r[n]}function vu(r,e){const n=Pr(r,e),t=r[n];return t&&Se(t.key,e)>=0?n:-1}class xa{records=[];get(e){return e instanceof _e?bu(this.records,e):gu(this.records,e)}add(e){let n;if(this.records.length===0)n=0;else if(n=vu(this.records,e.key),n===-1)n=this.records.length;else for(;n<this.records.length&&Se(this.records[n].key,e.key)===0&&Se(this.records[n].value,e.value)===-1;)n+=1;this.records.splice(n,0,e)}delete(e){const n=[],t=e instanceof _e;for(;;){const i=t?La(this.records,e):Ma(this.records,e);if(i===-1)break;n.push(this.records[i]),this.records.splice(i,1)}return n}deleteByValue(e){const n=e instanceof _e?e:_e.only(e),t=[];return this.records=this.records.filter(i=>{const s=n.includes(i.value);return s&&t.push(i),!s}),t}clear(){const e=this.records.slice();return this.records=[],e}values(e,n="next"){return{[Symbol.iterator]:()=>{let t;if(n==="next"){if(t=0,e!==void 0&&e.lower!==void 0)for(;this.records[t]!==void 0;){const i=Se(this.records[t].key,e.lower);if(i===1||i===0&&!e.lowerOpen)break;t+=1}}else if(t=this.records.length-1,e!==void 0&&e.upper!==void 0)for(;this.records[t]!==void 0;){const i=Se(this.records[t].key,e.upper);if(i===-1||i===0&&!e.upperOpen)break;t-=1}return{next:()=>{let i,s;if(n==="next"){if(s=this.records[t],i=t>=this.records.length,t+=1,!i&&e!==void 0&&e.upper!==void 0){const u=Se(s.key,e.upper);i=u===1||u===0&&e.upperOpen,i&&(s=void 0)}}else if(s=this.records[t],i=t<0,t-=1,!i&&e!==void 0&&e.lower!==void 0){const u=Se(s.key,e.lower);i=u===-1||u===0&&e.lowerOpen,i&&(s=void 0)}return{done:i,value:s}}}}}}}class wu{deleted=!1;initialized=!1;records=new xa;constructor(e,n,t,i,s){this.rawObjectStore=e,this.name=n,this.keyPath=t,this.multiEntry=i,this.unique=s}getKey(e){const n=this.records.get(e);return n!==void 0?n.value:void 0}getAllKeys(e,n){(n===void 0||n===0)&&(n=1/0);const t=[];for(const i of this.records.values(e))if(t.push(Nt(i.value)),t.length>=n)break;return t}getValue(e){const n=this.records.get(e);return n!==void 0?this.rawObjectStore.getValue(n.value):void 0}getAllValues(e,n){(n===void 0||n===0)&&(n=1/0);const t=[];for(const i of this.records.values(e))if(t.push(this.rawObjectStore.getValue(i.value)),t.length>=n)break;return t}storeRecord(e){let n;try{n=er(this.keyPath,e.value)}catch(t){if(t.name==="DataError")return;throw t}if(!this.multiEntry||!Array.isArray(n))try{Re(n)}catch{return}else{const t=[];for(const i of n)if(t.indexOf(i)<0)try{t.push(Re(i))}catch{}n=t}if(!this.multiEntry||!Array.isArray(n)){if(this.unique&&this.records.get(n))throw new sn}else if(this.unique){for(const t of n)if(this.records.get(t))throw new sn}if(!this.multiEntry||!Array.isArray(n))this.records.add({key:n,value:e.key});else for(const t of n)this.records.add({key:t,value:e.key})}initialize(e){if(this.initialized)throw new Error("Index already initialized");e._execRequestAsync({operation:()=>{try{for(const n of this.rawObjectStore.records.values())this.storeRecord(n);this.initialized=!0}catch(n){e._abort(n.name)}},source:null})}}const Br=(r,e)=>{if(r!=null&&typeof r!="string"&&r.toString&&(e==="array"||!Array.isArray(r))&&(r=r.toString()),typeof r=="string"){if(r===""&&e!=="string")return;try{const n=/^(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])(?:[\$0-9A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])*$/;if(r.length>=1&&n.test(r))return}catch(n){throw new SyntaxError(n.message)}if(r.indexOf(" ")>=0)throw new SyntaxError("The keypath argument contains an invalid key path (no spaces allowed).")}if(Array.isArray(r)&&r.length>0){if(e)throw new SyntaxError("The keypath argument contains an invalid key path (nested arrays).");for(const n of r)Br(n,"array");return}else if(typeof r=="string"&&r.indexOf(".")>=0){r=r.split(".");for(const n of r)Br(n,"string");return}throw new SyntaxError},At=r=>{if(r._rawObjectStore.deleted)throw new we;if(r.transaction._state!=="active")throw new xt},Ji=(r,e,n)=>{if(At(r),r.transaction.mode==="readonly")throw new Gn;if(r.keyPath!==null&&n!==void 0)throw new rt;const t=Nt(e);if(r.keyPath!==null){const i=er(r.keyPath,t);if(i!==void 0)Re(i);else if(r._rawObjectStore.keyGenerator){if(!yu(r.keyPath,t))throw new rt}else throw new rt}if(r.keyPath===null&&r._rawObjectStore.keyGenerator===null&&n===void 0)throw new rt;return n!==void 0&&(n=Re(n)),{key:n,value:t}};class _u{_indexesCache=new Map;constructor(e,n){this._rawObjectStore=n,this._name=n.name,this.keyPath=n.keyPath,this.autoIncrement=n.autoIncrement,this.transaction=e,this.indexNames=new ft(...Array.from(n.rawIndexes.keys()).sort())}get name(){return this._name}set name(e){const n=this.transaction;if(!n.db._runningVersionchangeTransaction)throw new we;if(At(this),e=String(e),e===this._name)return;if(this._rawObjectStore.rawDatabase.rawObjectStores.has(e))throw new sn;const t=this._name,i=[...n.db.objectStoreNames];this._name=e,this._rawObjectStore.name=e,this.transaction._objectStoresCache.delete(t),this.transaction._objectStoresCache.set(e,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(t),this._rawObjectStore.rawDatabase.rawObjectStores.set(e,this._rawObjectStore),n.db.objectStoreNames=new ft(...Array.from(this._rawObjectStore.rawDatabase.rawObjectStores.keys()).filter(h=>{const c=this._rawObjectStore.rawDatabase.rawObjectStores.get(h);return c&&!c.deleted}).sort());const s=new Set(n._scope),u=[...n.objectStoreNames];this.transaction._scope.delete(t),n._scope.add(e),n.objectStoreNames=new ft(...Array.from(n._scope).sort()),n._rollbackLog.push(()=>{this._name=t,this._rawObjectStore.name=t,this.transaction._objectStoresCache.delete(e),this.transaction._objectStoresCache.set(t,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(e),this._rawObjectStore.rawDatabase.rawObjectStores.set(t,this._rawObjectStore),n.db.objectStoreNames=new ft(...i),n._scope=s,n.objectStoreNames=new ft(...u)})}put(e,n){if(arguments.length===0)throw new TypeError;const t=Ji(this,e,n);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,t,!1,this.transaction._rollbackLog),source:this})}add(e,n){if(arguments.length===0)throw new TypeError;const t=Ji(this,e,n);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,t,!0,this.transaction._rollbackLog),source:this})}delete(e){if(arguments.length===0)throw new TypeError;if(At(this),this.transaction.mode==="readonly")throw new Gn;return e instanceof _e||(e=Re(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.deleteRecord.bind(this._rawObjectStore,e,this.transaction._rollbackLog),source:this})}get(e){if(arguments.length===0)throw new TypeError;return At(this),e instanceof _e||(e=Re(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getValue.bind(this._rawObjectStore,e),source:this})}getAll(e,n){arguments.length>1&&n!==void 0&&(n=Xn(n,"unsigned long")),At(this);const t=Dr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllValues.bind(this._rawObjectStore,t,n),source:this})}getKey(e){if(arguments.length===0)throw new TypeError;return At(this),e instanceof _e||(e=Re(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getKey.bind(this._rawObjectStore,e),source:this})}getAllKeys(e,n){arguments.length>1&&n!==void 0&&(n=Xn(n,"unsigned long")),At(this);const t=Dr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllKeys.bind(this._rawObjectStore,t,n),source:this})}clear(){if(At(this),this.transaction.mode==="readonly")throw new Gn;return this.transaction._execRequestAsync({operation:this._rawObjectStore.clear.bind(this._rawObjectStore,this.transaction._rollbackLog),source:this})}openCursor(e,n){At(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e)));const t=new yn;t.source=this,t.transaction=this.transaction;const i=new ja(this,e,n,t);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:t,source:this})}openKeyCursor(e,n){At(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e)));const t=new yn;t.source=this,t.transaction=this.transaction;const i=new Yn(this,e,n,t,!0);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:t,source:this})}createIndex(e,n,t={}){if(arguments.length<2)throw new TypeError;const i=t.multiEntry!==void 0?t.multiEntry:!1,s=t.unique!==void 0?t.unique:!1;if(this.transaction.mode!=="versionchange")throw new we;if(At(this),this.indexNames.contains(e))throw new sn;if(Br(n),Array.isArray(n)&&i)throw new kr;const u=[...this.indexNames];this.transaction._rollbackLog.push(()=>{const c=this._rawObjectStore.rawIndexes.get(e);c&&(c.deleted=!0),this.indexNames=new ft(...u),this._rawObjectStore.rawIndexes.delete(e)});const h=new wu(this._rawObjectStore,e,n,i,s);return this.indexNames._push(e),this.indexNames._sort(),this._rawObjectStore.rawIndexes.set(e,h),h.initialize(this.transaction),new Xi(this,h)}index(e){if(arguments.length===0)throw new TypeError;if(this._rawObjectStore.deleted||this.transaction._state==="finished")throw new we;const n=this._indexesCache.get(e);if(n!==void 0)return n;const t=this._rawObjectStore.rawIndexes.get(e);if(!this.indexNames.contains(e)||t===void 0)throw new qn;const i=new Xi(this,t);return this._indexesCache.set(e,i),i}deleteIndex(e){if(arguments.length===0)throw new TypeError;if(this.transaction.mode!=="versionchange")throw new we;At(this);const n=this._rawObjectStore.rawIndexes.get(e);if(n===void 0)throw new qn;this.transaction._rollbackLog.push(()=>{n.deleted=!1,this._rawObjectStore.rawIndexes.set(e,n),this.indexNames._push(e),this.indexNames._sort()}),this.indexNames=new ft(...Array.from(this.indexNames).filter(t=>t!==e)),n.deleted=!0,this.transaction._execRequestAsync({operation:()=>{const t=this._rawObjectStore.rawIndexes.get(e);n===t&&this._rawObjectStore.rawIndexes.delete(e)},source:this})}count(e){return At(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof _e)&&(e=_e.only(Re(e))),this.transaction._execRequestAsync({operation:()=>{let n=0;const t=new Yn(this,e);for(;t._iterate()!==null;)n+=1;return n},source:this})}toString(){return"[object IDBObjectStore]"}}const Rt=_u;class qt{eventPath=[];NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;propagationStopped=!1;immediatePropagationStopped=!1;canceled=!1;initialized=!0;dispatched=!1;target=null;currentTarget=null;eventPhase=0;defaultPrevented=!1;isTrusted=!1;timeStamp=Date.now();constructor(e,n={}){this.type=e,this.bubbles=n.bubbles!==void 0?n.bubbles:!1,this.cancelable=n.cancelable!==void 0?n.cancelable:!1}preventDefault(){this.cancelable&&(this.canceled=!0)}stopPropagation(){this.propagationStopped=!0}stopImmediatePropagation(){this.propagationStopped=!0,this.immediatePropagationStopped=!0}}function Eu(){if(typeof navigator<"u"&&/jsdom/.test(navigator.userAgent)){const r=Node.constructor;return new r("return setImmediate")()}else return}const Ht=globalThis.setImmediate||Eu()||(r=>setTimeout(r,0));class Au extends Ni{_state="active";_started=!1;_rollbackLog=[];_objectStoresCache=new Map;error=null;onabort=null;oncomplete=null;onerror=null;_requests=[];constructor(e,n,t){super(),this._scope=new Set(e),this.mode=n,this.db=t,this.objectStoreNames=new ft(...Array.from(this._scope).sort())}_abort(e){for(const n of this._rollbackLog.reverse())n();if(e!==null){const n=new Error;n.name=e,this.error=n}for(const{request:n}of this._requests)if(n.readyState!=="done"&&(n.readyState="done",n.source)){n.result=void 0,n.error=new _i;const t=new qt("error",{bubbles:!0,cancelable:!0});t.eventPath=[this.db,this],n.dispatchEvent(t)}Ht(()=>{const n=new qt("abort",{bubbles:!0,cancelable:!1});n.eventPath=[this.db],this.dispatchEvent(n)}),this._state="finished"}abort(){if(this._state==="committing"||this._state==="finished")throw new we;this._state="active",this._abort(null)}objectStore(e){if(this._state!=="active")throw new we;const n=this._objectStoresCache.get(e);if(n!==void 0)return n;const t=this.db._rawDatabase.rawObjectStores.get(e);if(!this._scope.has(e)||t===void 0)throw new qn;const i=new Rt(this,t);return this._objectStoresCache.set(e,i),i}_execRequestAsync(e){const n=e.source,t=e.operation;let i=e.hasOwnProperty("request")?e.request:null;if(this._state!=="active")throw new xt;return i||(n?(i=new yn,i.source=n,i.transaction=n.transaction):i=new yn),this._requests.push({operation:t,request:i}),i}_start(){this._started=!0;let e,n;for(;this._requests.length>0;){const t=this._requests.shift();if(t&&t.request.readyState!=="done"){n=t.request,e=t.operation;break}}if(n&&e){if(!n.source)e();else{let t,i;try{const s=e();n.readyState="done",n.result=s,n.error=void 0,this._state==="inactive"&&(this._state="active"),i=new qt("success",{bubbles:!1,cancelable:!1})}catch(s){n.readyState="done",n.result=void 0,n.error=s,this._state==="inactive"&&(this._state="active"),i=new qt("error",{bubbles:!0,cancelable:!0}),t=this._abort.bind(this,s.name)}try{i.eventPath=[this.db,this],n.dispatchEvent(i)}catch(s){throw this._state!=="committing"&&this._abort("AbortError"),s}i.canceled||t&&t()}Ht(this._start.bind(this));return}if(this._state!=="finished"&&(this._state="finished",!this.error)){const t=new qt("complete");this.dispatchEvent(t)}}commit(){if(this._state!=="active")throw new we;this._state="committing"}toString(){return"[object IDBRequest]"}}const Zi=9007199254740992;class Su{num=0;next(){if(this.num>=Zi)throw new sn;return this.num+=1,this.num}setIfLarger(e){const n=Math.floor(Math.min(e,Zi))-1;n>=this.num&&(this.num=n+1)}}class Cu{deleted=!1;records=new xa;rawIndexes=new Map;constructor(e,n,t,i){this.rawDatabase=e,this.keyGenerator=i===!0?new Su:null,this.deleted=!1,this.name=n,this.keyPath=t,this.autoIncrement=i}getKey(e){const n=this.records.get(e);return n!==void 0?Nt(n.key):void 0}getAllKeys(e,n){(n===void 0||n===0)&&(n=1/0);const t=[];for(const i of this.records.values(e))if(t.push(Nt(i.key)),t.length>=n)break;return t}getValue(e){const n=this.records.get(e);return n!==void 0?Nt(n.value):void 0}getAllValues(e,n){(n===void 0||n===0)&&(n=1/0);const t=[];for(const i of this.records.values(e))if(t.push(Nt(i.value)),t.length>=n)break;return t}storeRecord(e,n,t){if(this.keyPath!==null){const s=er(this.keyPath,e.value);s!==void 0&&(e.key=s)}if(this.keyGenerator!==null&&e.key===void 0){if(t){const s=this.keyGenerator.num;t.push(()=>{this.keyGenerator&&(this.keyGenerator.num=s)})}if(e.key=this.keyGenerator.next(),this.keyPath!==null){if(Array.isArray(this.keyPath))throw new Error("Cannot have an array key path in an object store with a key generator");let s=this.keyPath,u=e.value,h,c=0;for(;c>=0;){if(typeof u!="object")throw new rt;c=s.indexOf("."),c>=0&&(h=s.slice(0,c),s=s.slice(c+1),u.hasOwnProperty(h)||(u[h]={}),u=u[h])}h=s,u[h]=e.key}}else this.keyGenerator!==null&&typeof e.key=="number"&&this.keyGenerator.setIfLarger(e.key);if(this.records.get(e.key)){if(n)throw new sn;this.deleteRecord(e.key,t)}this.records.add(e),t&&t.push(()=>{this.deleteRecord(e.key)});for(const s of this.rawIndexes.values())s.initialized&&s.storeRecord(e);return e.key}deleteRecord(e,n){const t=this.records.delete(e);if(n)for(const i of t)n.push(()=>{this.storeRecord(i,!0)});for(const i of this.rawIndexes.values())i.records.deleteByValue(e)}clear(e){const n=this.records.clear();if(e)for(const t of n)e.push(()=>{this.storeRecord(t,!0)});for(const t of this.rawIndexes.values())t.records.clear()}}const Qi=r=>{if(!r._runningVersionchangeTransaction)throw new we;const e=r._rawDatabase.transactions.filter(t=>t.mode==="versionchange"),n=e[e.length-1];if(!n||n._state==="finished")throw new we;if(n._state!=="active")throw new xt;return n},Ha=r=>{r._closePending=!0,r._rawDatabase.transactions.every(n=>n._state==="finished")?(r._closed=!0,r._rawDatabase.connections=r._rawDatabase.connections.filter(n=>r!==n)):Ht(()=>{Ha(r)})};class Iu extends Ni{_closePending=!1;_closed=!1;_runningVersionchangeTransaction=!1;constructor(e){super(),this._rawDatabase=e,this._rawDatabase.connections.push(this),this.name=e.name,this.version=e.version,this.objectStoreNames=new ft(...Array.from(e.rawObjectStores.keys()).sort())}createObjectStore(e,n={}){if(e===void 0)throw new TypeError;const t=Qi(this),i=n!==null&&n.keyPath!==void 0?n.keyPath:null,s=n!==null&&n.autoIncrement!==void 0?n.autoIncrement:!1;if(i!==null&&Br(i),this._rawDatabase.rawObjectStores.has(e))throw new sn;if(s&&(i===""||Array.isArray(i)))throw new kr;const u=[...this.objectStoreNames];t._rollbackLog.push(()=>{const c=this._rawDatabase.rawObjectStores.get(e);c&&(c.deleted=!0),this.objectStoreNames=new ft(...u),t._scope.delete(e),this._rawDatabase.rawObjectStores.delete(e)});const h=new Cu(this._rawDatabase,e,i,s);return this.objectStoreNames._push(e),this.objectStoreNames._sort(),t._scope.add(e),this._rawDatabase.rawObjectStores.set(e,h),t.objectStoreNames=new ft(...this.objectStoreNames),t.objectStore(e)}deleteObjectStore(e){if(e===void 0)throw new TypeError;const n=Qi(this),t=this._rawDatabase.rawObjectStores.get(e);if(t===void 0)throw new qn;this.objectStoreNames=new ft(...Array.from(this.objectStoreNames).filter(i=>i!==e)),n.objectStoreNames=new ft(...this.objectStoreNames),n._rollbackLog.push(()=>{t.deleted=!1,this._rawDatabase.rawObjectStores.set(e,t),this.objectStoreNames._push(e),this.objectStoreNames._sort()}),t.deleted=!0,this._rawDatabase.rawObjectStores.delete(e),n._objectStoresCache.delete(e)}transaction(e,n){if(n=n!==void 0?n:"readonly",n!=="readonly"&&n!=="readwrite"&&n!=="versionchange")throw new TypeError("Invalid mode: "+n);if(this._rawDatabase.transactions.some(s=>s._state==="active"&&s.mode==="versionchange"&&s.db===this))throw new we;if(this._closePending)throw new we;if(Array.isArray(e)||(e=[e]),e.length===0&&n!=="versionchange")throw new kr;for(const s of e)if(!this.objectStoreNames.contains(s))throw new qn("No objectStore named "+s+" in this database");const i=new Au(e,n,this);return this._rawDatabase.transactions.push(i),this._rawDatabase.processTransactions(),i}close(){Ha(this)}toString(){return"[object IDBDatabase]"}}class ea extends yn{onupgradeneeded=null;onblocked=null;toString(){return"[object IDBOpenDBRequest]"}}class Cn extends qt{constructor(e,n={}){super(e),this.newVersion=n.newVersion!==void 0?n.newVersion:null,this.oldVersion=n.oldVersion!==void 0?n.oldVersion:0}toString(){return"[object IDBVersionChangeEvent]"}}class Ou{deletePending=!1;transactions=[];rawObjectStores=new Map;connections=[];constructor(e,n){this.name=e,this.version=n,this.processTransactions=this.processTransactions.bind(this)}processTransactions(){Ht(()=>{if(!this.transactions.some(n=>n._started&&n._state!=="finished")){const n=this.transactions.find(t=>!t._started&&t._state!=="finished");n&&(n.addEventListener("complete",this.processTransactions),n.addEventListener("abort",this.processTransactions),n._start())}})}}const Ua=(r,e,n,t)=>{if(n.some(s=>!s._closed&&!s._closePending)){Ht(()=>Ua(r,e,n,t));return}r.delete(e),t(null)},Tu=(r,e,n,t)=>{try{const i=r.get(e);if(i===void 0){t(null);return}i.deletePending=!0;const s=i.connections.filter(h=>!h._closed&&!h._closePending);for(const h of s)if(!h._closePending){const c=new Cn("versionchange",{newVersion:null,oldVersion:i.version});h.dispatchEvent(c)}const u=s.some(h=>!h._closed&&!h._closePending);if(n&&u){const h=new Cn("blocked",{newVersion:null,oldVersion:i.version});n.dispatchEvent(h)}Ua(r,e,s,t)}catch(i){t(i)}},ku=(r,e,n,t)=>{r._runningVersionchangeTransaction=!0;const i=r.version,s=r._rawDatabase.connections.filter(c=>r!==c);for(const c of s)if(!c._closed&&!c._closePending){const b=new Cn("versionchange",{newVersion:e,oldVersion:i});c.dispatchEvent(b)}if(s.some(c=>!c._closed&&!c._closePending)){const c=new Cn("blocked",{newVersion:e,oldVersion:i});n.dispatchEvent(c)}const h=()=>{if(s.some(y=>!y._closed&&!y._closePending)){Ht(h);return}r._rawDatabase.version=e,r.version=e;const b=r.transaction(r.objectStoreNames,"versionchange");n.result=r,n.readyState="done",n.transaction=b,b._rollbackLog.push(()=>{r._rawDatabase.version=i,r.version=i});const p=new Cn("upgradeneeded",{newVersion:e,oldVersion:i});n.dispatchEvent(p),b.addEventListener("error",()=>{r._runningVersionchangeTransaction=!1}),b.addEventListener("abort",()=>{r._runningVersionchangeTransaction=!1,n.transaction=null,Ht(()=>{t(new _i)})}),b.addEventListener("complete",()=>{r._runningVersionchangeTransaction=!1,n.transaction=null,Ht(()=>{r._closePending?t(new _i):t(null)})})};h()},Du=(r,e,n,t,i)=>{let s=r.get(e);if(s===void 0&&(s=new Ou(e,0),r.set(e,s)),n===void 0&&(n=s.version!==0?s.version:1),s.version>n)return i(new hu);const u=new Iu(s);s.version<n?ku(u,n,t,h=>{if(h)return i(h);i(null,u)}):i(null,u)};class Pu{cmp=Se;_databases=new Map;deleteDatabase(e){const n=new ea;return n.source=null,Ht(()=>{const t=this._databases.get(e),i=t!==void 0?t.version:0;Tu(this._databases,e,n,s=>{if(s){n.error=new Error,n.error.name=s.name,n.readyState="done";const h=new qt("error",{bubbles:!0,cancelable:!0});h.eventPath=[],n.dispatchEvent(h);return}n.result=void 0,n.readyState="done";const u=new Cn("success",{newVersion:null,oldVersion:i});n.dispatchEvent(u)})}),n}open(e,n){if(arguments.length>1&&n!==void 0&&(n=Xn(n,"MAX_SAFE_INTEGER")),n===0)throw new TypeError;const t=new ea;return t.source=null,Ht(()=>{Du(this._databases,e,n,t,(i,s)=>{if(i){t.result=void 0,t.readyState="done",t.error=new Error,t.error.name=i.name;const h=new qt("error",{bubbles:!0,cancelable:!0});h.eventPath=[],t.dispatchEvent(h);return}t.result=s,t.readyState="done";const u=new qt("success");u.eventPath=[],t.dispatchEvent(u)})}),t}databases(){return new Promise(e=>{const n=[];for(const[t,i]of this._databases)n.push({name:t,version:i.version});e(n)})}toString(){return"[object IDBFactory]"}}const Bu=new Pu;class ta extends hn{inMemory;ActiveEncounter;Creatures;Tracker;Settings;constructor(e,n){super("ClashDatabase",n),this.inMemory=e;const t=`
        id,
        tokenId,
        initiative,
        currentHp,
        isMonster,
        isActive,
        unitName,
        maxHP,
        armorClass,
        unitType,
        unitSize,
        strScore,
        strSave,
        dexScore,
        dexSave,
        conScore,
        conSave,
        intScore,
        intSave,
        wisScore,
        wisSave,
        chaScore,
        chaSave,
        damageVulnerabilities,
        damageImmunities,
        damageResistances,
        conditionImmunities,
        challengeRating,
        experiencePoints,
        alignment,
        standardActions,
        legendaryActions,
        specialAbilities,
        spellActions,
        reactions,
        spellList,
        senses,
        skills,
        languages,
        speedWalk,
        speedFly,
        speedClimb,
        speedBurrow,
        speedSwim,
        dataSlug
        `,i=t+", favorite",s=i+", ownerId",u=s+", sceneId";this.version(1).stores({ActiveEncounter:t,Creatures:t,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, disableFocus"}),this.version(2).stores({ActiveEncounter:t,Creatures:t,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(3).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(4).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"}),this.version(5).stores({ActiveEncounter:s,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"}),this.version(6).stores({ActiveEncounter:u,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"})}async SaveToCreatureStorage(e){return await ot.Creatures.add(e)}async DeleteFromCreatureStorage(e){return await ot.Creatures.delete(e)}async SaveToActiveList(e){return await ot.ActiveEncounter.add(e)}async DeleteFromActiveList(e){return await ot.ActiveEncounter.delete(e)}Ready(){console.log("Setup is complete.")}}async function ao(){return ot||(ot=await Ru(),ot)}async function Ru(){return new Promise(r=>{let e=window.indexedDB.open("__test");e.onsuccess=async function(){e.result.close(),window.indexedDB.deleteDatabase("__test"),r(new ta(!1))},e.onerror=async function(){console.warn("IndexDB is disabled, no Collection Items will be saved"),window.indexedDB.deleteDatabase("__test"),r(new ta(!0,{indexedDB:Bu,IDBKeyRange:_e}))}})}let ot;function Nu(){let r=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const t=(r+Math.random()*16)%16|0;return r=Math.floor(r/16),(n==="x"?t:t&3|8).toString(16)})}function Va(r,e){const n=parseInt(r.substring(1,3),16),t=parseInt(r.substring(3,5),16),i=parseInt(r.substring(5,7),16);return`rgba(${n}, ${t}, ${i}, ${e})`}function Fu(r){for(const e of Q.ADJECTIVES)if(r.includes(e)){const n=Q.ADJECTIVES[Math.floor(Math.random()*Q.ADJECTIVES.length)];return r.replace(e,n)}return ju(r)}function ju(r){const e=Math.floor(Math.random()*Q.ADJECTIVES.length);return`${Q.ADJECTIVES[e]} ${r}`}function Yr(r,e){let n;return function(i){clearTimeout(n),n=setTimeout(()=>{r(i)},e)}}function so(r){return r.length>30?r.substring(0,30)+"...":r}function uo(r){if(r.indexOf("#")===0&&(r=r.slice(1)),r.length===3&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),r.length!==6)throw new Error("Invalid HEX color.");var e=parseInt(r.slice(0,2),16),n=parseInt(r.slice(2,4),16),t=parseInt(r.slice(4,6),16);return e*.299+n*.587+t*.114>186?"#000000":"#FFFFFF"}function oo(r){if(!r||r==="")return"white";switch(r.substring(0,1).toLowerCase()){case"a":case"e":case"i":case"o":case"u":return"red";case"b":case"c":case"d":return"pink";case"f":case"g":case"h":return"cyan";case"j":case"k":case"l":case"m":return"#747bff";case"n":case"p":case"q":return"green";case"r":case"s":case"t":case"v":return"orange";case"w":case"x":case"y":case"z":return"yellow";default:return"white"}}function na(r,e){const n=window.matchMedia("(prefers-color-scheme: dark)"),t=n.matches?"dark":"light",i=n.matches?"light":"dark";for(var s=0;s<e.styleSheets.length;s++)for(var u=0;u<e.styleSheets[s].cssRules.length;u++){let h=e.styleSheets[s].cssRules[u];h&&h.media&&h.media.mediaText.includes("prefers-color-scheme")&&(r.mode=="LIGHT"?(h.media.appendMedium(`(prefers-color-scheme: ${t})`),h.media.mediaText.includes(i)&&h.media.deleteMedium(`(prefers-color-scheme: ${i})`)):r.mode=="DARK"&&(h.media.appendMedium(`(prefers-color-scheme: ${i})`),h.media.mediaText.includes(t)&&h.media.deleteMedium(`(prefers-color-scheme: ${t})`)))}}function ra(r,e){const n=e/r.grid.dpi,t=r.image.width*n*r.scale.x,i=r.image.height*n*r.scale.y,s=r.grid.offset.x/r.image.width*t,u=r.grid.offset.y/r.image.height*i,h={x:r.position.x-s,y:r.position.y-u},c={x:h.x+t,y:h.y+i};return{min:h,max:c}}function Ue(r,e){return r.metadata[e]}function se(r){return ie.roomMetadata[r]}function On(r){return ie.sceneMetadata[r]}const jt="10%",Fr="25px",jr="15%",Mr="40px",Fi="40%",Mu="60px",Lu="80%",xu="100px";function Ka(){const r=document.createElement("th");r.style.width=jt,r.style.minWidth=Fr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Initiative"),e.setAttribute("src","/queue.svg"),r.appendChild(e),r}function $a(){const r=document.createElement("th");r.style.width=jt,r.style.minWidth=Fr;const e=document.createElement("input");return e.type="image",e.className="icon roller-button clickable",e.title="Roll For All (Purple) Units",e.src="/dice.svg",e.onclick=async function(){$.notification.show("Rolled Initiative for all selected.");const n=document.querySelectorAll(".isMonster"),t=[];n.forEach(i=>{const u=i.id.substring(2),h=document.querySelector(`#iI${u}`),b=se(U.INITBONUS)??!0?parseFloat(h.getAttribute("unit-dexbonus")):0,p=se(U.INITIATIVEDICE)??20,y=(b+Math.floor(Math.random()*(p-1)+1)).toString();h.value=y,t.push({key:u,value:y})}),await $.scene.items.updateItems(t.map(i=>i.key),i=>{for(let s of i)s.metadata[D.INITIATIVE]=t.find(u=>u.key===s.id)?.value})},r.appendChild(e),r}function Wa(){const r=document.createElement("th");return r.style.width=Lu,r.style.minWidth=xu,r.innerText="NAME",r}function za(){const r=document.createElement("th");r.style.width=Fi,r.style.minWidth=Mu;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Hit Points"),e.setAttribute("src","/health.svg"),r.appendChild(e),r}function qa(){const r=document.createElement("th");r.style.width=jt,r.style.minWidth=Fr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Temporary Health"),e.setAttribute("src","/temphp.svg"),r.appendChild(e),r}function Ga(){const r=document.createElement("th");r.style.width=jt,r.style.minWidth=Fr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Armor Class"),e.setAttribute("src","/shield.svg"),r.appendChild(e),r}function Ya(){const r=document.createElement("th");r.style.width=jr,r.style.minWidth=Mr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Highest Move Speed"),e.setAttribute("src","/speedwalk.svg"),r.appendChild(e),r}function Xa(){const r=document.createElement("th");r.style.width=jr,r.style.minWidth=Mr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Unit Elevation"),e.setAttribute("src","/elevation.svg"),r.appendChild(e),r}function Ja(){const r=document.createElement("th");r.style.width=jr,r.style.minWidth=Mr;const e=document.createElement("img");return e.setAttribute("class","icon"),e.setAttribute("title","Effects"),e.setAttribute("src","/effectheader.svg"),r.appendChild(e),r}function Za(){const r=document.createElement("th");r.style.width=jt;const e=document.createElement("img");e.id="whatsNewButton",e.setAttribute("class","icon"),e.classList.add("clickable"),e.setAttribute("title","Whats New?"),e.setAttribute("src","/info.svg"),e.onclick=async function(){try{localStorage.setItem(Q.VERSION,"true"),e.classList.remove("whats-new-shine")}catch{}await $.modal.open({id:Q.EXTENSIONWHATSNEW,url:"/submenu/whatsnew.html?timer=300",height:500,width:350})};try{localStorage.getItem(Q.VERSION)!=="true"&&e.classList.add("whats-new-shine")}catch{}return r.appendChild(e),r}function Qa(r){const e=document.createElement("input");return e.classList.add("text-input"),e.classList.add("unit-initiative"),e.inputMode="numeric",e.setAttribute("unit-dexbonus",Math.floor((je(r,D.DEXSCORE)-10)/2).toString()),e.value=je(r,D.INITIATIVE).toString(),e.id=`iI${r.id}`,e.size=4,e.min="0",e.max="99",e.maxLength=4,e.style.width=jt,e.style.minWidth="28px",e.onblur=async n=>{const t=n.currentTarget;await nt(t.id,[{key:D.INITIATIVE,value:t.value}])},e}function es(r){const e=document.createElement("input");return e.type="image",e.title="Roll this Unit's Initiative",e.id=`rB${r.id}`,e.className="clickable",e.onclick=async n=>{const t=n.currentTarget,i=t.id.substring(2),u=ie.sceneItems.find(y=>y.id===i).metadata[D.DEXSCORE],c=se(U.INITBONUS)??!0?Math.floor((+u-10)/2):0,b=se(U.INITIATIVEDICE)??20,p=(c+Math.floor(Math.random()*(b-1)+1)).toString();await nt(t.id,[{key:D.INITIATIVE,value:p}])},e.src="/dice.svg",e.height=20,e.width=20,e.style.width=jt,e.style.minWidth="25px",e}function ts(r){let e;if(je(r,D.OWNERID)){const t=ie.party.find(i=>i.id===je(r,D.OWNERID))?.color;t&&(e=Va(t,.9))}const n=document.createElement("input");return n.type="button",n.value=je(r,D.ISMONSTER)?` ${je(r,D.UNITNAME)} `:je(r,D.UNITNAME),n.title="Change between Player and Monster groups",n.id=`nT${r.id}`,n.style.width="100%",n.classList.add("text-input"),n.classList.add("unit-name-input"),n.style.textOverflow="ellipsis",n.style.overflow="hidden",e&&(n.style.borderColor=e,n.style.borderWidth="2px"),n.onclick=async function(){n.classList.contains("isMonster")?(n.value=je(r,D.UNITNAME),n.classList.remove("isMonster")):(n.value=` ${je(r,D.UNITNAME)} `,n.classList.add("isMonster"))},n.oncontextmenu=async function(t){t.preventDefault();const i=document.getElementById("contextMenu"),s=c=>{c.preventDefault()},u=async c=>{const b=c.target;b.id==="REMOVE"?await $.scene.items.updateItems([n.id.substring(2)],p=>{for(let y of p)delete y.metadata[D.ONLIST],delete y.metadata[D.HPBAR]}):await nt(n.id,[{key:D.OWNERID,value:b.id}]),i.style.display="none",c.stopPropagation(),window.removeEventListener("click",h),i.removeEventListener("click",u),i.removeEventListener("contextmenu",s)};i.setAttribute("currentUnit",r.id);const h=()=>{i.style.display="none",window.removeEventListener("click",h),i.removeEventListener("click",u),i.removeEventListener("contextmenu",s)};if(i.addEventListener("click",u),i.addEventListener("contextmenu",s),window.addEventListener("click",h),i.style.display=="block")Gu();else{const c=Math.min(t.pageX,window.innerWidth-150),b=Math.min(t.pageY,(window.innerHeight>300?window.innerHeight-50:window.innerHeight)-120);i.style.display="block",i.style.left=c+"px",i.style.top=b+"px"}},n}function ns(r){const e=document.createElement("input");return e.classList.add("text-input"),e.inputMode="numeric",e.id=`cH${r.id}`,e.title=je(r,D.CURRENTHP).toString(),e.value=je(r,D.CURRENTHP).toString(),e.size=4,e.style.width="30px",e.maxLength=4,e.style.width=(+Fi/2).toString(),e.style.minWidth="25px",e.onblur=async function(n){const t=n.currentTarget,i=t.value;if(i.substring(0,1)=="+"){const u=(+i.substring(i.indexOf("+")+1)+ +je(r,D.CURRENTHP)).toString();await nt(t.id,[{key:D.CURRENTHP,value:u}]),n.preventDefault()}else if(i.substring(0,1)=="-"){const s=i.substring(i.indexOf("-")+1),u=(+je(r,D.CURRENTHP)-+s).toString();await nt(t.id,[{key:D.CURRENTHP,value:u}]),n.preventDefault()}else await nt(t.id,[{key:D.CURRENTHP,value:e.value}])},e.onkeydown=async function(n){if(n.key!=="Enter")return;const t=n.currentTarget,i=t.value;if(i.substring(0,1)=="+"){const u=(+i.substring(i.indexOf("+")+1)+ +je(r,D.CURRENTHP)).toString();await nt(t.id,[{key:D.CURRENTHP,value:u}]),n.preventDefault()}else if(i.substring(0,1)=="-"){const s=i.substring(i.indexOf("-")+1),u=(+je(r,D.CURRENTHP)-+s).toString();await nt(t.id,[{key:D.CURRENTHP,value:u}]),n.preventDefault()}else await nt(t.id,[{key:D.CURRENTHP,value:t.value}])},e}function rs(r){const e=document.createElement("input");return e.classList.add("text-input"),e.inputMode="numeric",e.id=`mH${r.id}`,e.value=je(r,D.MAXHP).toString(),e.style.width="30px",e.size=4,e.maxLength=4,e.style.width=(+Fi/2).toString(),e.style.minWidth="25px",e.onblur=async n=>{const t=n.currentTarget;await nt(t.id,[{key:D.MAXHP,value:t.value}])},e}function is(r){const e=document.createElement("input");return e.classList.add("text-input"),e.inputMode="numeric",e.id=`tH${r.id}`,e.title=je(r,D.TEMPHP)??0,e.value=je(r,D.TEMPHP)??0,e.size=3,e.maxLength=3,e.style.width=jt,e.style.minWidth="25px",e.onblur=async function(n){const t=n.currentTarget,i=document.getElementById(`cH${t.id.substring(2)}`);let s=i.value;const u=t.value;if(u.substring(0,1)=="+"){let c=(+u.substring(u.indexOf("+")+1)+ +e.title).toString();await nt(t.id,[{key:D.TEMPHP,value:c}]),n.preventDefault()}else if(u.substring(0,1)=="-"){const h=u.substring(u.indexOf("-")+1);let c=+e.title-+h;c<0&&(s=(+i.value+c).toString(),c=0),await nt(t.id,[{key:D.TEMPHP,value:c.toString()},{key:D.CURRENTHP,value:s}]),n.preventDefault()}else await nt(t.id,[{key:D.TEMPHP,value:u}])},e.onkeydown=async function(n){if(n.key!=="Enter")return;const t=n.currentTarget,i=document.getElementById(`cH${t.id.substring(2)}`);let s=i.value;const u=t.value;if(u.substring(0,1)=="+"){let c=(+u.substring(u.indexOf("+")+1)+ +e.title).toString();await nt(t.id,[{key:D.TEMPHP,value:c}]),n.preventDefault()}else if(u.substring(0,1)=="-"){const h=u.substring(u.indexOf("-")+1);let c=+e.title-+h;c<0&&(s=(+i.value+c).toString(),c=0),await nt(t.id,[{key:D.TEMPHP,value:c.toString()},{key:D.CURRENTHP,value:s}]),n.preventDefault()}else await nt(t.id,[{key:D.TEMPHP,value:u}])},e}function as(r){const e=document.createElement("input");return e.classList.add("text-input"),e.inputMode="numeric",e.id=`aC${r.id}`,e.value=je(r,D.ARMORCLASS),e.size=2,e.maxLength=2,e.style.width=jt,e.style.minWidth="25px",e.onblur=async n=>{const t=n.currentTarget;await nt(t.id,[{key:D.ARMORCLASS,value:t.value}])},e}function ss(r){const e=document.createElement("input");return e.classList.add("text-input"),e.inputMode="numeric",e.id=`eL${r.id}`,e.value=je(r,D.ELEVATION)??"-",e.size=3,e.maxLength=3,e.style.width=jt,e.style.minWidth="25px",e.onblur=async n=>{const t=n.currentTarget;await nt(t.id,[{key:D.ELEVATION,value:t.value}])},e}function us(r){const e=document.createElement("input");e.type="image",e.src=je(r,D.EFFECTS)?"/effect-on.svg":"/effect-off.svg",e.classList.add("text-input"),e.classList.add("icon"),e.classList.add("clickable"),e.id=`eX${r.id}`,e.style.width=jt,e.style.minWidth="25px",e.onclick=async t=>{await $.popover.open({id:Q.EXTENSIONEFFECTSID,url:`/submenu/effects.html?unitid=${r.id}`,height:220,width:300,hidePaper:!0})};const n=je(r,D.EFFECTS);if(n?.length>0){const t=[];for(const i of n){const s=`'${i.Name}' til ${i.StartOfTurn.toLowerCase()} of Round ${i.EndingRound}`;t.push(s)}e.title=t.join(`\r
`)}else e.title="No active effects";return e}function os(r){const e=je(r,D.SPEEDWALK);let n=e,t="/speedwalk.svg";const i=je(r,D.SPEEDCLIMB);i>n&&(n=i,t="/speedclimb.svg");const s=je(r,D.SPEEDSWIM);s>n&&(n=s,t="/speedswim.svg");const u=je(r,D.SPEEDFLY);u>n&&(n=u,t="/speedfly.svg");const h=je(r,D.SPEEDBURROW);h>n&&(n=h,t="/speedburrow.svg");const c=`Walk:${e}
Climb:${i}
Swim:${s}
Fly:${u}
Burrow:${h}`,b=document.createElement("div");b.classList.add("text-input"),b.classList.add("disabled"),b.classList.add("information"),b.inputMode="numeric",b.id=`mV${r.id}`,b.style.width=jr,b.style.minWidth=Mr,b.innerText=n.toString(),b.setAttribute("data-information",c);const p=document.createElement("img");return p.setAttribute("class","icon"),p.setAttribute("title","Highest Move Speed"),p.setAttribute("src",t),p.style.paddingLeft="2px",b.appendChild(p),b}function Hu(r){const e=document.createElement("input");return e.type="image",e.title="View/Edit this Unit's Stats",e.id=`tB${r.id}`,e.className="clickable",e.onclick=async function(n){const t=n.currentTarget;await Yu(t.id.substring(2))},e.src="/triangle.svg",e.height=20,e.width=20,e.style.marginLeft="5px",e}function Uu(){document.getElementById("previousContainer")?.appendChild(Ku()),document.getElementById("nextContainer")?.appendChild($u()),document.getElementById("settingsContainer")?.appendChild(zu()),document.getElementById("showLogContainer")?.appendChild(ds()),document.getElementById("showHelpContainer")?.appendChild(cs())}function Vu(){document.getElementById("showLogContainer")?.appendChild(ds()),document.getElementById("showHelpContainer")?.appendChild(cs())}function Ku(){const r=document.createElement("input");return r.type="button",r.id="previousButton",r.value="Previous",r.classList.add("footer-button"),r.title="Previous Turn",r.onclick=async function(){if(!(oe.roundCounter===1&&oe.turnCounter===0)&&oe.viewBody.rows?.length>1){oe.turnCounter--;for(var e=0,n;n=oe.viewBody.rows[e];e++)n.className.includes("turn-outline")&&n.parentElement?.firstElementChild===n&&(oe.roundCounter--,oe.roundCounter<1&&(oe.roundCounter=1),oe.turnCounter=n.parentElement.childElementCount);await $.scene.setMetadata({[U.TURNCOUNT]:oe.turnCounter,[U.ROUNDCOUNT]:oe.roundCounter})}},r}function $u(){const r=document.createElement("input");return r.type="button",r.id="nextButton",r.value="Next",r.classList.add("footer-button"),r.title="Next Turn",r.onclick=async function(){if(oe.currentTurnUnit&&oe.HandleEffects(oe.currentTurnUnit,"End"),oe.viewBody.rows?.length>1){oe.turnCounter++;for(var e=0,n;n=oe.viewBody.rows[e];e++)n.className.includes("turn-outline")&&n.parentElement?.lastElementChild===n&&(oe.roundCounter++,oe.turnCounter=0);oe.startEffectsDone=!1,await $.scene.setMetadata({[U.TURNCOUNT]:oe.turnCounter,[U.ROUNDCOUNT]:oe.roundCounter})}},r}function ds(){const r=document.createElement("input");return r.type="button",r.id="showLogButton",r.value="Show Log",r.title="Show Log",r.classList.add("footer-button"),r.onclick=async function(){ps(!0)},r}function cs(){const r=document.createElement("input");return r.type="button",r.id="showHelpButton",r.value="Help",r.title="View Help Docs",r.classList.add("footer-button"),r.onclick=async function(){hs(!0)},r}function ls(){Q.MAINLOG.innerHTML=Q.ROLLLOG,Wu()}function Wu(){const r=document.getElementById("rollLogReturnContainer"),e=document.createElement("input");e.type="button",e.classList.add("footer-button"),e.id="returnButton",e.title="Return to Initiative List",e.value="Return",e.onclick=async function(){ps(!1)},r?.append(e)}function zu(){const r=document.createElement("input");return r.type="button",r.id="settingsButton",r.value="Settings",r.title="View Settings",r.classList.add("footer-button"),r.onclick=async function(){fs(!0)},r}function fs(r){Q.MAINSETTINGS.style.display=r?"contents":"none",Q.MAINAPP.style.display=r?"none":"block"}function hs(r){Q.MAINHELP.style.display=r?"contents":"none",Q.MAINAPP.style.display=r?"none":"block"}function ps(r){Q.MAINLOG.style.display=r?"contents":"none",Q.MAINAPP.style.display=r?"none":"block"}function qu(r){Q.MAINSETTINGS.style.display=r?"none":"contents",Q.MAINHELP.style.display=r?"none":"contents",Q.MAINLOG.style.display=r?"none":"contents",Q.MAINAPP.style.display=r?"block":"none"}function Gu(){document.getElementById("contextMenu").style.display="none"}function je(r,e){return r.metadata[e]}async function nt(r,e){const n=r.substring(2);await $.scene.items.updateItems(t=>t.id===n,t=>{for(let i of t)for(let s of e)i.metadata[s.key]=s.value,s.key===D.OWNERID&&(i.createdUserId=s.value)})}async function Yu(r,e){const n=await $.viewport.getHeight(),t=100,i=n>800?700:n-t;r===ie.openUnitPopover?(await $.popover.close(Q.EXTENSIONSUBMENUID),ie.openUnitPopover=""):e?(await $.popover.close(Q.EXTENSIONSUBMENUID),await $.popover.open({id:Q.EXTENSIONSUBMENUID,url:`/submenu/subindex.html?unitid=${r}`,height:i,width:350,anchorElementId:e,hidePaper:!0,disableClickAway:!0}),ie.openUnitPopover=r):(await $.popover.close(Q.EXTENSIONSUBMENUID),await $.popover.open({id:Q.EXTENSIONSUBMENUID,url:`/submenu/subindex.html?unitid=${r}`,height:i,width:350,hidePaper:!0,disableClickAway:!0}),ie.openUnitPopover=r)}class Xu{id;tokenId;initiative;currentHP;isMonster;isActive;unitName;maxHP;armorClass;unitType;unitSize;strScore;strSave;dexScore;dexSave;conScore;conSave;intScore;intSave;wisScore;wisSave;chaScore;chaSave;damageVulnerabilities;damageImmunities;damageResistances;conditionImmunities;challengeRating;experiencePoints;alignment;standardActions;legendaryActions;specialAbilities;spellActions;reactions;spellList;senses;languages;speedWalk;speedFly;speedClimb;speedBurrow;speedSwim;dataSlug;favorite;ownerId;sceneId;constructor(e,n,t){this.id=e,this.tokenId=e,this.isActive=0,this.unitName=n??="Default",this.initiative=1,this.currentHP=4,this.maxHP=4,this.armorClass=10,this.speedWalk=30,this.speedBurrow=0,this.speedSwim=0,this.speedClimb=0,this.speedFly=0,this.strScore=10,this.dexScore=10,this.conScore=10,this.intScore=10,this.wisScore=10,this.chaScore=10,this.strSave=2,this.dexSave=2,this.conSave=2,this.intSave=2,this.wisSave=2,this.chaSave=2,this.senses="No unique senses.",this.unitSize="Medium",this.unitType="Humanoid",this.alignment="True Neutral",this.languages="No known languages.",this.damageVulnerabilities="None.",this.damageResistances="None.",this.damageImmunities="None.",this.conditionImmunities="None.",this.challengeRating="0CR.",this.experiencePoints=0,this.standardActions=[],this.specialAbilities=[],this.spellList=[],this.dataSlug="",this.favorite=!1,this.ownerId=t,this.sceneId=""}ImportFromJSON(e){let n=JSON.parse(e);this.SetToModel(n)}async ImportFromDatabase(e){const n=await ot.ActiveEncounter.get(e);if(!n){console.log("Found no UnitInformation for "+e);return}this.SetToModel(n),this.isActive=n.isActive}SetMetadata(e){const n=e.metadata;this.id=n[D.ID],this.initiative=n[D.INITIATIVE],this.maxHP=n[D.CURRENTHP],this.maxHP=n[D.MAXHP],this.isMonster=n[D.ISMONSTER],this.unitName=n[D.UNITNAME],this.armorClass=n[D.ARMORCLASS],this.unitType=n[D.UNITTYPE],this.unitSize=n[D.UNITSIZE],this.strScore=n[D.STRSCORE],this.strSave=n[D.STRSAVE],this.dexScore=n[D.DEXSCORE],this.dexSave=n[D.DEXSAVE],this.conScore=n[D.CONSCORE],this.conSave=n[D.CONSAVE],this.intScore=n[D.INTSCORE],this.intSave=n[D.INTSAVE],this.wisScore=n[D.WISSCORE],this.wisSave=n[D.WISSAVE],this.chaScore=n[D.CHASCORE],this.chaSave=n[D.CHASAVE],this.damageVulnerabilities=n[D.DAMAGEVULNERABILITIES],this.damageImmunities=n[D.DAMAGEIMMUNITIES],this.damageResistances=n[D.DAMAGERESISTANCES],this.conditionImmunities=n[D.CONDITIONIMMUNITIES],this.challengeRating=n[D.CHALLENGERATING],this.experiencePoints=n[D.EXPERIENCEPOINTS],this.alignment=n[D.ALIGNMENT],this.standardActions=n[D.STANDARDACTIONS],this.legendaryActions=n[D.LEGENDARYACTIONS],this.specialAbilities=n[D.SPECIALABILITIES],this.spellActions=n[D.SPELLACTIONS],this.reactions=n[D.REACTIONS],this.spellList=n[D.SPELLLIST],this.senses=n[D.SENSES],this.languages=n[D.LANGUAGES],this.speedWalk=n[D.SPEEDWALK],this.speedFly=n[D.SPEEDFLY],this.speedClimb=n[D.SPEEDCLIMB],this.speedBurrow=n[D.SPEEDBURROW],this.speedSwim=n[D.SPEEDSWIM],this.ownerId=n[D.OWNERID]}GetMetadata(){const e={};return e[D.ID]=this.id,e[D.INITIATIVE]=this.initiative,e[D.CURRENTHP]=this.maxHP,e[D.MAXHP]=this.maxHP,e[D.ISMONSTER]=this.isMonster,e[D.UNITNAME]=this.unitName,e[D.ARMORCLASS]=this.armorClass,e[D.UNITTYPE]=this.unitType,e[D.UNITSIZE]=this.unitSize,e[D.STRSCORE]=this.strScore,e[D.STRSAVE]=this.strSave,e[D.DEXSCORE]=this.dexScore,e[D.DEXSAVE]=this.dexSave,e[D.CONSCORE]=this.conScore,e[D.CONSAVE]=this.conSave,e[D.INTSCORE]=this.intScore,e[D.INTSAVE]=this.intSave,e[D.WISSCORE]=this.wisScore,e[D.WISSAVE]=this.wisSave,e[D.CHASCORE]=this.chaScore,e[D.CHASAVE]=this.chaSave,e[D.DAMAGEVULNERABILITIES]=this.damageVulnerabilities,e[D.DAMAGEIMMUNITIES]=this.damageImmunities,e[D.DAMAGERESISTANCES]=this.damageResistances,e[D.CONDITIONIMMUNITIES]=this.conditionImmunities,e[D.CHALLENGERATING]=this.challengeRating,e[D.EXPERIENCEPOINTS]=this.experiencePoints,e[D.ALIGNMENT]=this.alignment,e[D.STANDARDACTIONS]=this.standardActions,e[D.LEGENDARYACTIONS]=this.legendaryActions,e[D.SPECIALABILITIES]=this.specialAbilities,e[D.SPELLACTIONS]=this.spellActions,e[D.REACTIONS]=this.reactions,e[D.SPELLLIST]=this.spellList,e[D.SENSES]=this.senses,e[D.LANGUAGES]=this.languages,e[D.SPEEDWALK]=this.speedWalk,e[D.SPEEDFLY]=this.speedFly,e[D.SPEEDCLIMB]=this.speedClimb,e[D.SPEEDBURROW]=this.speedBurrow,e[D.SPEEDSWIM]=this.speedSwim,e[D.OWNERID]=this.ownerId,e}SetToModel(e,n){this.initiative=e.initiative,this.currentHP=e.maxHP,this.maxHP=e.maxHP,this.isMonster=e.isMonster,this.unitName=e.unitName,this.armorClass=e.armorClass,this.unitType=e.unitType,this.unitSize=e.unitSize,this.strScore=e.strScore,this.strSave=e.strSave,this.dexScore=e.dexScore,this.dexSave=e.dexSave,this.conScore=e.conScore,this.conSave=e.conSave,this.intScore=e.intScore,this.intSave=e.intSave,this.wisScore=e.wisScore,this.wisSave=e.wisSave,this.chaScore=e.chaScore,this.chaSave=e.chaSave,this.damageVulnerabilities=e.damageVulnerabilities,this.damageImmunities=e.damageImmunities,this.damageResistances=e.damageResistances,this.conditionImmunities=e.conditionImmunities,this.challengeRating=e.challengeRating,this.experiencePoints=e.experiencePoints,this.alignment=e.alignment,this.standardActions=e.standardActions,this.legendaryActions=e.legendaryActions,this.specialAbilities=e.specialAbilities,this.spellActions=e.spellActions,this.reactions=e.reactions,this.spellList=e.spellList,this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speedWalk,this.speedFly=e.speedFly,this.speedClimb=e.speedClimb,this.speedBurrow=e.speedBurrow,this.speedSwim=e.speedSwim,this.dataSlug=e.dataSlug,this.favorite=n?e.favorite:!1,this.CheckDefaults()}ImportCustomFormInputs(e){this.unitName=this.GetContent(e,"formUnitName"),this.maxHP=parseFloat(this.GetContent(e,"formMaxHP"))||4,this.currentHP=this.maxHP,this.armorClass=parseFloat(this.GetContent(e,"formArmorClass"))||10,this.unitType=this.GetContent(e,"formUnitType"),this.unitSize=this.GetContent(e,"formUnitSize"),this.alignment=this.GetContent(e,"formAlignment"),this.speedWalk=parseFloat(this.GetContent(e,"formSpeedWalk"))||0,this.speedSwim=parseFloat(this.GetContent(e,"formSpeedSwim"))||0,this.speedClimb=parseFloat(this.GetContent(e,"formSpeedClimb"))||0,this.speedFly=parseFloat(this.GetContent(e,"formSpeedFly"))||0,this.speedBurrow=parseFloat(this.GetContent(e,"formSpeedBurrow"))||0,this.strScore=parseFloat(this.GetContent(e,"formStrScore"))||1,this.dexScore=parseFloat(this.GetContent(e,"formDexScore"))||1,this.conScore=parseFloat(this.GetContent(e,"formConScore"))||1,this.intScore=parseFloat(this.GetContent(e,"formIntScore"))||1,this.wisScore=parseFloat(this.GetContent(e,"formWisScore"))||1,this.chaScore=parseFloat(this.GetContent(e,"formChaScore"))||1,this.strSave=parseFloat(this.GetContent(e,"formStrSave"))||0,this.dexSave=parseFloat(this.GetContent(e,"formDexSave"))||0,this.conSave=parseFloat(this.GetContent(e,"formConSave"))||0,this.intSave=parseFloat(this.GetContent(e,"formIntSave"))||0,this.wisSave=parseFloat(this.GetContent(e,"formWisSave"))||0,this.chaSave=parseFloat(this.GetContent(e,"formChaSave"))||0,this.senses=this.GetContent(e,"formSenses"),this.languages=this.GetContent(e,"formLanguages"),this.challengeRating=this.GetContent(e,"formChallengeRating"),this.experiencePoints=parseFloat(this.GetContent(e,"formEXP"))||0,this.damageImmunities=this.GetContent(e,"formImmune"),this.damageResistances=this.GetContent(e,"formResist"),this.damageVulnerabilities=this.GetContent(e,"formVulnerable"),this.conditionImmunities=this.GetContent(e,"formConditions");const n=e.querySelectorAll("#formAttackCollection > #formAttackContainer");this.standardActions=[],n.forEach(h=>{const c=h.querySelector("#formAttackName")?.textContent,b=h.querySelector("#formAttackDesc")?.textContent;if(c&&b){let p={name:c,desc:b};this.standardActions?.push(p)}});const t=e.querySelectorAll("#formReactionCollection > #formReactionContainer");this.reactions=[],t.forEach(h=>{const c=h.querySelector("#formReactionName")?.textContent,b=h.querySelector("#formReactionDesc")?.textContent;if(c&&b){let p={name:c,desc:b};this.reactions?.push(p)}});const i=e.querySelectorAll("#formLegendaryCollection > #formLegendaryContainer");this.legendaryActions=[],i.forEach(h=>{const c=h.querySelector("#formLegendaryName")?.textContent,b=h.querySelector("#formLegendaryDesc")?.textContent;if(c&&b){let p={name:c,desc:b};this.legendaryActions?.push(p)}});const s=e.querySelectorAll("#formAbilityCollection > #formAbilityContainer");this.specialAbilities=[],s.forEach(h=>{const c=h.querySelector("#formAbilityName")?.textContent,b=h.querySelector("#formAbilityDesc")?.textContent;if(c&&b){let p={name:c,desc:b};this.specialAbilities?.push(p)}});const u=e.querySelectorAll("#formSpellCollection > #formSpellContainer");this.spellActions=[],u.forEach(h=>{const c=h.querySelector("#formSpellName")?.textContent,b=h.querySelector("#formSpellDesc")?.textContent;if(c&&b){let p={name:c,desc:b};this.spellActions?.push(p)}}),this.CheckDefaults()}CheckDefaults(){this.unitName??="Nameless",this.maxHP??=4,this.currentHP??=this.maxHP,this.armorClass??=10,this.dataSlug??="Unknown",this.unitType??="Humanoid",this.unitSize??="Medium",this.alignment??="True Neutral",this.speedWalk??=30,this.speedSwim??=0,this.speedClimb??=0,this.speedFly??=0,this.speedBurrow??=0,this.strScore??=10,this.dexScore??=10,this.conScore??=10,this.intScore??=10,this.wisScore??=10,this.chaScore??=10,this.strSave??=Math.floor((Number(this.strScore)-10)/2),this.dexSave??=Math.floor((Number(this.dexScore)-10)/2),this.conSave??=Math.floor((Number(this.conScore)-10)/2),this.intSave??=Math.floor((Number(this.intScore)-10)/2),this.wisSave??=Math.floor((Number(this.wisScore)-10)/2),this.chaSave??=Math.floor((Number(this.chaScore)-10)/2),this.senses??="No unique senses.",this.languages??="No known languages.",this.challengeRating??="0CR.",this.experiencePoints??=0,this.damageImmunities??="None.",this.damageResistances??="None.",this.damageVulnerabilities??="None.",this.conditionImmunities??="None."}GetContent(e,n){return e.getElementById(n).textContent}async ImportOpen5eResponse(e){this.unitName=e.name,this.maxHP=e.hit_points,this.armorClass=e.armor_class,this.unitType=e.type,this.unitSize=e.size,this.strScore=e.strength,this.strSave=e.strength_save,this.dexScore=e.dexterity,this.dexSave=e.dexterity_save,this.conScore=e.constitution,this.conSave=e.constitution_save,this.intScore=e.intelligence,this.intSave=e.intelligence_save,this.wisScore=e.wisdom,this.wisSave=e.wisdom_save,this.chaScore=e.charisma,this.chaSave=e.charisma_save,this.damageVulnerabilities=e.damage_vulnerabilities,this.damageImmunities=e.damage_immunities,this.damageResistances=e.damage_resistances,this.conditionImmunities=e.condition_immunities,this.challengeRating=e.challenge_rating,this.experiencePoints=0,this.alignment=e.alignment,this.standardActions=e.actions,this.legendaryActions=e.legendary_actions,this.specialAbilities=e.special_abilities,this.reactions=e.reactions,this.spellList=e.spell_list,this.spellList!=null&&this.spellList?.length>0&&(this.spellActions=await this.ConvertSpellListtoSpellAction(this.spellList)),this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speed?.walk,this.speedFly=e.speed?.fly,this.speedClimb=e.speed?.walk,this.speedBurrow=e.speed?.burrow,this.speedSwim=e.speed?.swim,this.CheckDefaults()}async ConvertSpellListtoSpellAction(e){const n=[];for(var t=0,i;i=e[t];t++)await fetch(i).then(function(s){return s.json()}).then(function(s){let u={name:s.name,desc:s.desc};n.push(u)});return n}async SaveToDB(e){return this.sceneId=e,await ot.ActiveEncounter.put(this)}async SaveToCreatureStorage(){return await ot.Creatures.add(this)}}async function Ju(){Q.MAINSETTINGS.innerHTML=`
        <div id="settingsWindowContainer">
            <div class="settings-header">Settings - Data Management</div>
            <div class="settings-item">
                <div>
                    <span id="exportAllContainer"></span>
                    - Collection to Clash! JSON
                </div>
                <i><small>This will save Collection data to a Text/JSON file</small></i>
            </div>
            <div class="settings-item">
                <div>
                    <span id="importSubmitContainer">
                    <label id="importSubmitLabel" for="importSubmitButton">IMPORT</label></span>
                    - Clash! JSON to Collection
                </div>
                <div>
                    <span id="importAllContainer"></span>
                </div>
                <i><small>This will overwrite keys with the same Name/Author</small></i>
            </div>
            <div class="settings-item">
                <div>
                    <span id="clearAllContainer"></span>
                    - Clear All Clash! Collection Data 
                </div>
                <i><small>This will delete the database and start from scratch.</small></i>
            </div>
            <div class="settings-header">Initiative List</div>
                <div style="display:flex;">
                    <span id="resetClearContainer"></span>
                </div>
                <table>
                    <tr>
                        <td>
                            ${a("HPROW")}
                            Health </div>
                        </td>
                        <td>
                            ${a("TEMPHPROW")}
                            Temp Health </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            ${a("ACROW")}
                            Armor </div>
                        </td>
                        <td>
                            ${a("MOVEROW")}
                            Fastest Move </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            ${a("EFXROW")}
                            Effects </div>
                        </td>
                        <td>
                            ${a("ELEVATEROW")}
                            Elevation </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            ${a("ROLLERROW")}
                            Roller </div>
                        </td>
                        <td>
                            ${a("BLOCKROW")}
                            Stat Block </div>
                        </td>
                    </tr>
                </table>
            <div class="settings-header">Gameplay</div>
            <div title="This disables the view from a player's perspective, so they cannot see any information on the Initiative List.">
                ${a("HIDEALL")}
                Disable Player Initiative List
            </div>
            <div title="Ths will hide all information other than enemy Initiative for units they do not own.">
                ${a("HIDEENEMYINFO")}
                Hide Enemy Information on Player Initiative List
            </div>
            <div title="This changes the color of a unit from White to Yellow to Red depending on how much HP they have left. 100% => 50% => 25%.">
                ${a("HIDEHP")}
                Disable HP Colors on Player Initiative List 
            </div>
            <div title="This disables showing HP bars on each token in Initiative for you and your players.">
                ${a("HIDEHPBAR")}
                Disable HP Bars on Tokens 
            </div>
            <div title="This swaps the HP on the bar to showing exact numbers instead of a percentage.">
                ${a("HPBARNUMBERS")}
                Show HP Numbers instead of Bar 
            </div>
            <div title="This reverses the Initiative List turn order, so that lowest number goes first.">
                ${a("REVERSELIST")}
                Reverse Initiative Order
            </div>
            <div title="This disables the auto-focus when current turn changes.">
                ${a("DISABLEFOCUS")}
                Disable Camera Focus (For Self)
            </div>
            <div title="This will make it so Clash! will also add the name to the token's label. Turning it off will REMOVE visible names from any token on the Initiative List.">
                ${a("SHOWNAMES")}
                Show Names on Token
            </div>
            <div title="This will give all duplicate tokens a random descripitor to tell them apart. Turn off if you hate fun.">
                ${a("RANDOMNAME")}
                Descriptor Names for Duplicates
            </div>
            <div title="This removes the label applied to the token indicating it's their turn.">
                ${a("DISABLELABEL")}
                Disable Turn Label
            </div>
            <span style="display:flex;">Turn Label <div id="turnLabelTextContainer" style="padding-left: 6px;"></div></span>
            <div title="This makes it so any initiative rolled via Clash adds the unit's Dexterity modifier.">
                ${a("INITBONUS")}
                Add DEX to Initiative Rolls
            </div>
            <span style="display:flex;">Initiative Dice <div id="initDiceContainer" style="padding-left: 6px;"></div></span>

            <div class="settings-header">Dice</div>
            <div title="This enables the integration with Rumble! so that roll results are shown for all to see.">
                ${a("RUMBLELOG")}
                Enable Rumble! Integratrion 
            </div>
            <div title="This enables the integration with Bones! so that roll results are shown through the Bones! User Interface.">
                ${a("BONESROLL")}
                Enable Bones! Integratrion 
            </div>
            <div title="This enables the 3D dice window when rolling (To self only).">
                ${a("VISUALDICE")}
                Enable Clash! 3D Rolls (For Self)
            </div>
            <div title="This enables the dice notification showing the results at the top of the screen.">
                ${a("DICENOTIFICATION")}
                Enable Dice Text Notification of Results 
            </div>
            <div title="This enables showing dice notifications to everyone.">
                ${a("DICEEVERYONE")}
                Enable Showing Text Results to All
            </div>
            <div title="This sends the results of all rolls to the specified Discord channel/hook.">
                ${a("DISCORDHOOK")}
                Enable Discord Logging
            </div>
                <span style="display:flex;">Discord Hook <div id="discordHookContainer" style="padding-left: 6px;"></div><embed id="discordIcon" class="discord" src="/discord2.svg" /></span>
            <footer>
                <span id="settingsReturnContainer"></span>
            </footer>
        </div>
       `,o("HIDEHP",!!se(U.HIDEHP)),o("HIDEALL",!!se(U.HIDEALL)),o("HIDEENEMYINFO",!!se(U.HIDEENEMYINFO)),o("HIDEHPBAR",!!se(U.HIDEHPBAR)),o("HPBARNUMBERS",!!se(U.HPBARNUMBERS)),o("REVERSELIST",!!se(U.REVERSELIST)),o("DISABLEFOCUS",!!se(U.DISABLEFOCUS)),o("SHOWNAMES",!!se(U.NAMELABELS)),o("RANDOMNAME",se(U.RANDOMNAME)??!0),o("DISABLELABEL",!!se(U.DISABLELABEL)),o("INITBONUS",se(U.INITBONUS)??!0),o("RUMBLELOG",!!se(U.RUMBLELOG)),o("BONESROLL",!!se(U.BONESROLL)),o("VISUALDICE",!!se(U.VISUALDICE)),o("DICENOTIFICATION",!!se(U.DICENOTIFICATION)),o("DICEEVERYONE",!!se(U.DICEEVERYONE)),o("DISCORDHOOK",se(U.DISCORDHOOK)??!1),o("HPROW",se(U.HPROW)??!0),o("TEMPHPROW",!!se(U.TEMPHPROW)),o("ACROW",se(U.ACROW)??!0),o("MOVEROW",!!se(U.MOVEROW)),o("ROLLERROW",se(U.ROLLERROW)??!0),o("BLOCKROW",se(U.BLOCKROW)??!0),o("EFXROW",!!se(U.EFXROW)),o("ELEVATEROW",!!se(U.ELEVATEROW));const r=document.getElementById("turnLabelTextContainer"),e=document.createElement("input");e.type="text",e.id="textLabelButton",e.title="Change your Turn Label's text",e.placeholder="Custom Turn Label",e.maxLength=20,e.value=ie.roomMetadata[U.TURNTEXT]??"",e.size=20,e.onblur=async g=>{const m=g.currentTarget;await $.room.setMetadata({[U.TURNTEXT]:m.value})},r?.appendChild(e);const n=document.getElementById("discordIcon");se(U.DISCORDURL)&&(n.style.display="block");const t=document.getElementById("discordHookContainer"),i=document.createElement("input");i.type="text",i.id="discordHookInput",i.title="Add your Discord Webhook",i.placeholder="Add your channel hook..",i.maxLength=200,i.value=ie.roomMetadata[U.DISCORDURL]??"",i.size=18,i.onblur=async g=>{const m=g.currentTarget;m.value&&(m.value.startsWith("https://discord.com/api/webhook")||m.value.startsWith("https://discordapp.com/api/webhook"))?(m.classList.add("flash-input"),await $.room.setMetadata({[U.DISCORDURL]:m.value}),setTimeout(()=>{m.classList.remove("flash-input"),n.style.display="block"},1e3)):(m.classList.add("shake-input"),m.value="Invalid/Clearing URL",se(U.DISCORDURL)&&await $.room.setMetadata({[U.DISCORDURL]:void 0}),setTimeout(()=>{m.classList.remove("shake-input"),m.value="",n.style.display="none"},1e3))},t?.appendChild(i);const s=document.getElementById("initDiceContainer"),u=document.createElement("input");u.type="number",u.id="textLabelButton",u.classList.add("remove-number-arrow"),u.title="Change your Turn Label's text",u.placeholder="Custom Turn Label",u.maxLength=2,u.min="2",u.max="99",u.value=ie.roomMetadata[U.INITIATIVEDICE]??"20",u.size=6,u.oninput=g=>{const m=g.currentTarget;parseInt(m.value)<1?m.value="1":parseInt(m.value)>99?m.value="99":isNaN(parseInt(m.value))&&(m.value="20")},u.onblur=async g=>{const m=g.currentTarget;await $.room.setMetadata({[U.INITIATIVEDICE]:parseInt(m.value)})},s?.appendChild(u);const h=document.getElementById("importAllContainer"),c=document.createElement("input");c.type="checkbox",c.id="favBox",c.title="Unfavorite during Upload";const b=document.getElementById("importSubmitContainer"),p=document.createElement("input");p.type="file",p.style.display="none",p.id="importSubmitButton",p.onchange=async function(){if(p.files&&p.files.length>0){let g=p.files[0],m=new FileReader;m.readAsText(g),m.onload=async function(){try{const _=JSON.parse(m.result);await l(_),$.notification.show("Import Complete!","SUCCESS"),p.files=null}catch(_){await $.notification.show(`The import failed - ${_}`,"ERROR"),p.files=null}},m.onerror=function(){console.log(m.error),p.files=null}}},h?.appendChild(c),h?.appendChild(document.createTextNode("Unfavorite all items that are Imported")),b?.appendChild(p);const y=document.getElementById("exportAllContainer"),w=document.createElement("input");w.type="button",w.classList.add("settings-input-button"),w.id="exportButton",w.value="EXPORT",w.title="Export Clash Collection Data",w.onclick=async function(){await d()},y?.appendChild(w);const T=document.getElementById("clearAllContainer"),R=document.createElement("input");R.type="button",R.classList.add("settings-input-button"),R.id="deleteButton",R.value="DELETE",R.title="Clear all Clash! Data",R.onclick=async function(){confirm("Delete EVERYTHING? (Deletes Database and Refreshes Window)")&&(oe.turnCounter=1,oe.roundCounter=1,oe.viewCounter.innerText=`Round: ${oe.roundCounter}`,await $.scene.items.deleteItems([Q.LABEL]),await $.scene.items.updateItems(g=>g.metadata[`${Q.EXTENSIONID}/metadata_initiative`]!=null||g.id===Q.LABEL,g=>{for(let m of g)delete m.metadata[`${Q.EXTENSIONID}/metadata_initiative`]}),await ot.delete(),window.location.reload())},T?.appendChild(R);const S=document.getElementById("settingsReturnContainer"),O=document.createElement("input");O.type="button",O.id="returnButton",O.title="Save and return to Initiative List",O.value="Return",O.onclick=async function(){fs(!1),oe.RefreshList(),qu(!0)},S?.append(O);const P=document.getElementById("resetClearContainer"),C=document.createElement("input");C.type="button",C.classList.add("settings-input-button"),C.id="resetTurnButton",C.value="Reset Initiative List",C.title="Reset",C.onclick=async function(){oe.turnCounter=0,oe.roundCounter=1;const g=document.getElementById("roundCounter");g.innerText=`Round: ${oe.roundCounter}`,await $.scene.items.updateItems(ie.sceneItems.filter(m=>Ue(m,D.ONLIST)===!0).map(m=>m.id),m=>{for(let _ of m)_.metadata[D.INITIATIVE]=1,_.metadata[D.CURRENTHP]=_.metadata[D.MAXHP],_.metadata[D.ELEVATION]=null,_.metadata[D.EFFECTS]=null}),await $.scene.setMetadata({[U.TURNCOUNT]:oe.turnCounter,[U.ROUNDCOUNT]:oe.roundCounter}),oe.ShowTurnSelection()},P?.appendChild(C);const N=document.createElement("input");N.type="button",N.id="clearButton",N.classList.add("settings-input-button"),N.value="Clear Initiative List",N.title="Clear",N.onclick=async function(){if(confirm("Clear the Initiative List (This will leave unit info)?")){oe.turnCounter=0,oe.roundCounter=1;const g=document.getElementById("roundCounter");g.innerText=`Round: ${oe.roundCounter}`;const m=ie.sceneItems.map(_=>_.id+"_hpbar");m.push(Q.LABEL),await $.scene.items.deleteItems(m),await $.scene.items.updateItems(ie.sceneItems,_=>{for(let I of _)I.metadata[D.INITIATIVE]=1,delete I.metadata[D.ONLIST],delete I.metadata[D.HPBAR]})}},P?.appendChild(N);function a(g){return`<label class="switch" id="setting${g}Container">
            <span class="slider round"></span>
            </label>`}function o(g,m){const _=document.getElementById(`setting${g}Container`),I=document.createElement("input");I.type="checkbox",I.value=String(m),I.checked=m,I.onclick=async function(V){const F=V.target;switch(I.value=String(F.checked),g){case"HIDEHP":await $.room.setMetadata({[U.HIDEHP]:F.checked});break;case"HIDEALL":await $.room.setMetadata({[U.HIDEALL]:F.checked});break;case"HIDEENEMYINFO":await $.room.setMetadata({[U.HIDEENEMYINFO]:F.checked});break;case"HIDEHPBAR":await $.room.setMetadata({[U.HIDEHPBAR]:F.checked});break;case"HPBARNUMBERS":await $.room.setMetadata({[U.HPBARNUMBERS]:F.checked});break;case"DISABLEFOCUS":await $.room.setMetadata({[U.DISABLEFOCUS]:F.checked});break;case"SHOWNAMES":await $.room.setMetadata({[U.NAMELABELS]:F.checked});break;case"RANDOMNAME":await $.room.setMetadata({[U.RANDOMNAME]:F.checked});break;case"DISABLELABEL":await $.room.setMetadata({[U.DISABLELABEL]:F.checked});break;case"REVERSELIST":await $.room.setMetadata({[U.REVERSELIST]:F.checked});break;case"RUMBLELOG":await $.room.setMetadata({[U.RUMBLELOG]:F.checked});break;case"BONESROLL":await $.room.setMetadata({[U.BONESROLL]:F.checked});break;case"VISUALDICE":await $.room.setMetadata({[U.VISUALDICE]:F.checked});break;case"DICENOTIFICATION":await $.room.setMetadata({[U.DICENOTIFICATION]:F.checked});break;case"DICEEVERYONE":await $.room.setMetadata({[U.DICEEVERYONE]:F.checked});break;case"DISCORDHOOK":await $.room.setMetadata({[U.DISCORDHOOK]:F.checked});break;case"HPROW":await $.room.setMetadata({[U.HPROW]:F.checked});break;case"ROLLERROW":await $.room.setMetadata({[U.ROLLERROW]:F.checked});break;case"TEMPHPROW":await $.room.setMetadata({[U.TEMPHPROW]:F.checked});break;case"ACROW":await $.room.setMetadata({[U.ACROW]:F.checked});break;case"MOVEROW":await $.room.setMetadata({[U.MOVEROW]:F.checked});break;case"BLOCKROW":await $.room.setMetadata({[U.BLOCKROW]:F.checked});break;case"EFXROW":await $.room.setMetadata({[U.EFXROW]:F.checked});break;case"ELEVATEROW":await $.room.setMetadata({[U.ELEVATEROW]:F.checked});break;case"INITBONUS":await $.room.setMetadata({[U.INITBONUS]:F.checked});break}},_?.insertBefore(I,_.firstChild)}async function d(){const g=await ot.Creatures.toArray();var m=document.createElement("a"),_=new Blob([JSON.stringify(g)],{type:"text/plain"});m.href=URL.createObjectURL(_),m.download=`ClashCollectionExport-${Date.now()}`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}async function l(g){const m=await ot.Creatures.toArray();let _=[];g.forEach(I=>{let V=new Xu("","Default");V.SetToModel(I,!c.checked),V.tokenId="";const F=m.find(j=>j.unitName==I.unitName&&j.dataSlug==I.dataSlug);F?V.id=F.id:V.id=Nu(),_.push(V)}),await ot.Creatures.bulkPut(_)}}class Tn{static async FocusUnit(e){e.preventDefault();const t=e.target.closest("tr").getAttribute("unit-id"),i=ie.sceneItems.find(s=>s.id===t);await Tn.CenterViewportOnImage(i)}static async CenterViewportOnImage(e){const n=await $.scene.grid.getDpi(),t=await $.viewport.getScale(),i=await $.viewport.getWidth(),s=await $.viewport.getHeight(),u={x:i/2,y:s/2},h={x:u.x/t,y:u.y/t},c=await this.GetImageCenter(e,n),b={x:c.x-h.x,y:c.y-h.y},p={x:b.x*t*-1,y:b.y*t*-1};await $.viewport.animateTo({position:p,scale:t})}static async GetImageCenter(e,n){if(ws(e)){const t=n/e.grid.dpi,i=e.image.width*t,s=e.image.height*t,u=e.grid.offset.x/e.image.width*i,h=e.grid.offset.y/e.image.height*s;return{x:e.position.x-u+i/2,y:e.position.y-h+s/2}}else return vs(e)&&e.points.length>0?{x:e.points[0].x,y:e.points[0].y}:{x:e.position.x,y:e.position.y}}}var ms={exports:{}};(function(r){(function(){function e(a){var o={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `` and `` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(a===!1)return JSON.parse(JSON.stringify(o));var d={};for(var l in o)o.hasOwnProperty(l)&&(d[l]=o[l].defaultValue);return d}function n(){var a=e(!0),o={};for(var d in a)a.hasOwnProperty(d)&&(o[d]=!0);return o}var t={},i={},s={},u=e(!0),h="vanilla",c={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:n()};t.helper={},t.extensions={},t.setOption=function(a,o){return u[a]=o,this},t.getOption=function(a){return u[a]},t.getOptions=function(){return u},t.resetOptions=function(){u=e(!0)},t.setFlavor=function(a){if(!c.hasOwnProperty(a))throw Error(a+" flavor was not found");t.resetOptions();var o=c[a];h=a;for(var d in o)o.hasOwnProperty(d)&&(u[d]=o[d])},t.getFlavor=function(){return h},t.getFlavorOptions=function(a){if(c.hasOwnProperty(a))return c[a]},t.getDefaultOptions=function(a){return e(a)},t.subParser=function(a,o){if(t.helper.isString(a))if(typeof o<"u")i[a]=o;else{if(i.hasOwnProperty(a))return i[a];throw Error("SubParser named "+a+" not registered!")}},t.extension=function(a,o){if(!t.helper.isString(a))throw Error("Extension 'name' must be a string");if(a=t.helper.stdExtName(a),t.helper.isUndefined(o)){if(!s.hasOwnProperty(a))throw Error("Extension named "+a+" is not registered!");return s[a]}else{typeof o=="function"&&(o=o()),t.helper.isArray(o)||(o=[o]);var d=b(o,a);if(d.valid)s[a]=o;else throw Error(d.error)}},t.getAllExtensions=function(){return s},t.removeExtension=function(a){delete s[a]},t.resetExtensions=function(){s={}};function b(a,o){var d=o?"Error in "+o+" extension->":"Error in unnamed extension",l={valid:!0,error:""};t.helper.isArray(a)||(a=[a]);for(var g=0;g<a.length;++g){var m=d+" sub-extension "+g+": ",_=a[g];if(typeof _!="object")return l.valid=!1,l.error=m+"must be an object, but "+typeof _+" given",l;if(!t.helper.isString(_.type))return l.valid=!1,l.error=m+'property "type" must be a string, but '+typeof _.type+" given",l;var I=_.type=_.type.toLowerCase();if(I==="language"&&(I=_.type="lang"),I==="html"&&(I=_.type="output"),I!=="lang"&&I!=="output"&&I!=="listener")return l.valid=!1,l.error=m+"type "+I+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',l;if(I==="listener"){if(t.helper.isUndefined(_.listeners))return l.valid=!1,l.error=m+'. Extensions of type "listener" must have a property called "listeners"',l}else if(t.helper.isUndefined(_.filter)&&t.helper.isUndefined(_.regex))return l.valid=!1,l.error=m+I+' extensions must define either a "regex" property or a "filter" method',l;if(_.listeners){if(typeof _.listeners!="object")return l.valid=!1,l.error=m+'"listeners" property must be an object but '+typeof _.listeners+" given",l;for(var V in _.listeners)if(_.listeners.hasOwnProperty(V)&&typeof _.listeners[V]!="function")return l.valid=!1,l.error=m+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+V+" must be a function but "+typeof _.listeners[V]+" given",l}if(_.filter){if(typeof _.filter!="function")return l.valid=!1,l.error=m+'"filter" must be a function, but '+typeof _.filter+" given",l}else if(_.regex){if(t.helper.isString(_.regex)&&(_.regex=new RegExp(_.regex,"g")),!(_.regex instanceof RegExp))return l.valid=!1,l.error=m+'"regex" property must either be a string or a RegExp object, but '+typeof _.regex+" given",l;if(t.helper.isUndefined(_.replace))return l.valid=!1,l.error=m+'"regex" extensions must implement a replace string or function',l}}return l}t.validateExtension=function(a){var o=b(a,null);return o.valid?!0:(console.warn(o.error),!1)},t.hasOwnProperty("helper")||(t.helper={}),t.helper.isString=function(a){return typeof a=="string"||a instanceof String},t.helper.isFunction=function(a){var o={};return a&&o.toString.call(a)==="[object Function]"},t.helper.isArray=function(a){return Array.isArray(a)},t.helper.isUndefined=function(a){return typeof a>"u"},t.helper.forEach=function(a,o){if(t.helper.isUndefined(a))throw new Error("obj param is required");if(t.helper.isUndefined(o))throw new Error("callback param is required");if(!t.helper.isFunction(o))throw new Error("callback param must be a function/closure");if(typeof a.forEach=="function")a.forEach(o);else if(t.helper.isArray(a))for(var d=0;d<a.length;d++)o(a[d],d,a);else if(typeof a=="object")for(var l in a)a.hasOwnProperty(l)&&o(a[l],l,a);else throw new Error("obj does not seem to be an array or an iterable object")},t.helper.stdExtName=function(a){return a.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function p(a,o){var d=o.charCodeAt(0);return"E"+d+"E"}t.helper.escapeCharactersCallback=p,t.helper.escapeCharacters=function(a,o,d){var l="(["+o.replace(/([\[\]\\])/g,"\\$1")+"])";d&&(l="\\\\"+l);var g=new RegExp(l,"g");return a=a.replace(g,p),a},t.helper.unescapeHTMLEntities=function(a){return a.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var y=function(a,o,d,l){var g=l||"",m=g.indexOf("g")>-1,_=new RegExp(o+"|"+d,"g"+g.replace(/g/g,"")),I=new RegExp(o,g.replace(/g/g,"")),V=[],F,j,W,A,H;do for(F=0;W=_.exec(a);)if(I.test(W[0]))F++||(j=_.lastIndex,A=j-W[0].length);else if(F&&!--F){H=W.index+W[0].length;var q={left:{start:A,end:j},match:{start:j,end:W.index},right:{start:W.index,end:H},wholeMatch:{start:A,end:H}};if(V.push(q),!m)return V}while(F&&(_.lastIndex=j));return V};t.helper.matchRecursiveRegExp=function(a,o,d,l){for(var g=y(a,o,d,l),m=[],_=0;_<g.length;++_)m.push([a.slice(g[_].wholeMatch.start,g[_].wholeMatch.end),a.slice(g[_].match.start,g[_].match.end),a.slice(g[_].left.start,g[_].left.end),a.slice(g[_].right.start,g[_].right.end)]);return m},t.helper.replaceRecursiveRegExp=function(a,o,d,l,g){if(!t.helper.isFunction(o)){var m=o;o=function(){return m}}var _=y(a,d,l,g),I=a,V=_.length;if(V>0){var F=[];_[0].wholeMatch.start!==0&&F.push(a.slice(0,_[0].wholeMatch.start));for(var j=0;j<V;++j)F.push(o(a.slice(_[j].wholeMatch.start,_[j].wholeMatch.end),a.slice(_[j].match.start,_[j].match.end),a.slice(_[j].left.start,_[j].left.end),a.slice(_[j].right.start,_[j].right.end))),j<V-1&&F.push(a.slice(_[j].wholeMatch.end,_[j+1].wholeMatch.start));_[V-1].wholeMatch.end<a.length&&F.push(a.slice(_[V-1].wholeMatch.end)),I=F.join("")}return I},t.helper.regexIndexOf=function(a,o,d){if(!t.helper.isString(a))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(o instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var l=a.substring(d||0).search(o);return l>=0?l+(d||0):l},t.helper.splitAtIndex=function(a,o){if(!t.helper.isString(a))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[a.substring(0,o),a.substring(o)]},t.helper.encodeEmailAddress=function(a){var o=[function(d){return"&#"+d.charCodeAt(0)+";"},function(d){return"&#x"+d.charCodeAt(0).toString(16)+";"},function(d){return d}];return a=a.replace(/./g,function(d){if(d==="@")d=o[Math.floor(Math.random()*2)](d);else{var l=Math.random();d=l>.9?o[2](d):l>.45?o[1](d):o[0](d)}return d}),a},t.helper.padEnd=function(o,d,l){return d=d>>0,l=String(l||" "),o.length>d?String(o):(d=d-o.length,d>l.length&&(l+=l.repeat(d/l.length)),String(o)+l.slice(0,d))},typeof console>"u"&&(console={warn:function(a){alert(a)},log:function(a){alert(a)},error:function(a){throw a}}),t.helper.regexes={asteriskDashAndColon:/([*_:~])/g},t.helper.emojis={"+1":"","-1":"",100:"",1234:"","1st_place_medal":"","2nd_place_medal":"","3rd_place_medal":"","8ball":"",a:"",ab:"",abc:"",abcd:"",accept:"",aerial_tramway:"",airplane:"",alarm_clock:"",alembic:"",alien:"",ambulance:"",amphora:"",anchor:"",angel:"",anger:"",angry:"",anguished:"",ant:"",apple:"",aquarius:"",aries:"",arrow_backward:"",arrow_double_down:"",arrow_double_up:"",arrow_down:"",arrow_down_small:"",arrow_forward:"",arrow_heading_down:"",arrow_heading_up:"",arrow_left:"",arrow_lower_left:"",arrow_lower_right:"",arrow_right:"",arrow_right_hook:"",arrow_up:"",arrow_up_down:"",arrow_up_small:"",arrow_upper_left:"",arrow_upper_right:"",arrows_clockwise:"",arrows_counterclockwise:"",art:"",articulated_lorry:"",artificial_satellite:"",astonished:"",athletic_shoe:"",atm:"",atom_symbol:"",avocado:"",b:"",baby:"",baby_bottle:"",baby_chick:"",baby_symbol:"",back:"",bacon:"",badminton:"",baggage_claim:"",baguette_bread:"",balance_scale:"",balloon:"",ballot_box:"",ballot_box_with_check:"",bamboo:"",banana:"",bangbang:"",bank:"",bar_chart:"",barber:"",baseball:"",basketball:"",basketball_man:"",basketball_woman:"&zwj;",bat:"",bath:"",bathtub:"",battery:"",beach_umbrella:"",bear:"",bed:"",bee:"",beer:"",beers:"",beetle:"",beginner:"",bell:"",bellhop_bell:"",bento:"",biking_man:"",bike:"",biking_woman:"&zwj;",bikini:"",biohazard:"",bird:"",birthday:"",black_circle:"",black_flag:"",black_heart:"",black_joker:"",black_large_square:"",black_medium_small_square:"",black_medium_square:"",black_nib:"",black_small_square:"",black_square_button:"",blonde_man:"",blonde_woman:"&zwj;",blossom:"",blowfish:"",blue_book:"",blue_car:"",blue_heart:"",blush:"",boar:"",boat:"",bomb:"",book:"",bookmark:"",bookmark_tabs:"",books:"",boom:"",boot:"",bouquet:"",bowing_man:"",bow_and_arrow:"",bowing_woman:"&zwj;",bowling:"",boxing_glove:"",boy:"",bread:"",bride_with_veil:"",bridge_at_night:"",briefcase:"",broken_heart:"",bug:"",building_construction:"",bulb:"",bullettrain_front:"",bullettrain_side:"",burrito:"",bus:"",business_suit_levitating:"",busstop:"",bust_in_silhouette:"",busts_in_silhouette:"",butterfly:"",cactus:"",cake:"",calendar:"",call_me_hand:"",calling:"",camel:"",camera:"",camera_flash:"",camping:"",cancer:"",candle:"",candy:"",canoe:"",capital_abcd:"",capricorn:"",car:"",card_file_box:"",card_index:"",card_index_dividers:"",carousel_horse:"",carrot:"",cat:"",cat2:"",cd:"",chains:"",champagne:"",chart:"",chart_with_downwards_trend:"",chart_with_upwards_trend:"",checkered_flag:"",cheese:"",cherries:"",cherry_blossom:"",chestnut:"",chicken:"",children_crossing:"",chipmunk:"",chocolate_bar:"",christmas_tree:"",church:"",cinema:"",circus_tent:"",city_sunrise:"",city_sunset:"",cityscape:"",cl:"",clamp:"",clap:"",clapper:"",classical_building:"",clinking_glasses:"",clipboard:"",clock1:"",clock10:"",clock1030:"",clock11:"",clock1130:"",clock12:"",clock1230:"",clock130:"",clock2:"",clock230:"",clock3:"",clock330:"",clock4:"",clock430:"",clock5:"",clock530:"",clock6:"",clock630:"",clock7:"",clock730:"",clock8:"",clock830:"",clock9:"",clock930:"",closed_book:"",closed_lock_with_key:"",closed_umbrella:"",cloud:"",cloud_with_lightning:"",cloud_with_lightning_and_rain:"",cloud_with_rain:"",cloud_with_snow:"",clown_face:"",clubs:"",cocktail:"",coffee:"",coffin:"",cold_sweat:"",comet:"",computer:"",computer_mouse:"",confetti_ball:"",confounded:"",confused:"",congratulations:"",construction:"",construction_worker_man:"",construction_worker_woman:"&zwj;",control_knobs:"",convenience_store:"",cookie:"",cool:"",policeman:"",copyright:"",corn:"",couch_and_lamp:"",couple:"",couple_with_heart_woman_man:"",couple_with_heart_man_man:"&zwj;&zwj;",couple_with_heart_woman_woman:"&zwj;&zwj;",couplekiss_man_man:"&zwj;&zwj;&zwj;",couplekiss_man_woman:"",couplekiss_woman_woman:"&zwj;&zwj;&zwj;",cow:"",cow2:"",cowboy_hat_face:"",crab:"",crayon:"",credit_card:"",crescent_moon:"",cricket:"",crocodile:"",croissant:"",crossed_fingers:"",crossed_flags:"",crossed_swords:"",crown:"",cry:"",crying_cat_face:"",crystal_ball:"",cucumber:"",cupid:"",curly_loop:"",currency_exchange:"",curry:"",custard:"",customs:"",cyclone:"",dagger:"",dancer:"",dancing_women:"",dancing_men:"&zwj;",dango:"",dark_sunglasses:"",dart:"",dash:"",date:"",deciduous_tree:"",deer:"",department_store:"",derelict_house:"",desert:"",desert_island:"",desktop_computer:"",male_detective:"",diamond_shape_with_a_dot_inside:"",diamonds:"",disappointed:"",disappointed_relieved:"",dizzy:"",dizzy_face:"",do_not_litter:"",dog:"",dog2:"",dollar:"",dolls:"",dolphin:"",door:"",doughnut:"",dove:"",dragon:"",dragon_face:"",dress:"",dromedary_camel:"",drooling_face:"",droplet:"",drum:"",duck:"",dvd:"","e-mail":"",eagle:"",ear:"",ear_of_rice:"",earth_africa:"",earth_americas:"",earth_asia:"",egg:"",eggplant:"",eight_pointed_black_star:"",eight_spoked_asterisk:"",electric_plug:"",elephant:"",email:"",end:"",envelope_with_arrow:"",euro:"",european_castle:"",european_post_office:"",evergreen_tree:"",exclamation:"",expressionless:"",eye:"",eye_speech_bubble:"&zwj;",eyeglasses:"",eyes:"",face_with_head_bandage:"",face_with_thermometer:"",fist_oncoming:"",factory:"",fallen_leaf:"",family_man_woman_boy:"",family_man_boy:"&zwj;",family_man_boy_boy:"&zwj;&zwj;",family_man_girl:"&zwj;",family_man_girl_boy:"&zwj;&zwj;",family_man_girl_girl:"&zwj;&zwj;",family_man_man_boy:"&zwj;&zwj;",family_man_man_boy_boy:"&zwj;&zwj;&zwj;",family_man_man_girl:"&zwj;&zwj;",family_man_man_girl_boy:"&zwj;&zwj;&zwj;",family_man_man_girl_girl:"&zwj;&zwj;&zwj;",family_man_woman_boy_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl:"&zwj;&zwj;",family_man_woman_girl_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl_girl:"&zwj;&zwj;&zwj;",family_woman_boy:"&zwj;",family_woman_boy_boy:"&zwj;&zwj;",family_woman_girl:"&zwj;",family_woman_girl_boy:"&zwj;&zwj;",family_woman_girl_girl:"&zwj;&zwj;",family_woman_woman_boy:"&zwj;&zwj;",family_woman_woman_boy_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl:"&zwj;&zwj;",family_woman_woman_girl_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl_girl:"&zwj;&zwj;&zwj;",fast_forward:"",fax:"",fearful:"",feet:"",female_detective:"&zwj;",ferris_wheel:"",ferry:"",field_hockey:"",file_cabinet:"",file_folder:"",film_projector:"",film_strip:"",fire:"",fire_engine:"",fireworks:"",first_quarter_moon:"",first_quarter_moon_with_face:"",fish:"",fish_cake:"",fishing_pole_and_fish:"",fist_raised:"",fist_left:"",fist_right:"",flags:"",flashlight:"",fleur_de_lis:"",flight_arrival:"",flight_departure:"",floppy_disk:"",flower_playing_cards:"",flushed:"",fog:"",foggy:"",football:"",footprints:"",fork_and_knife:"",fountain:"",fountain_pen:"",four_leaf_clover:"",fox_face:"",framed_picture:"",free:"",fried_egg:"",fried_shrimp:"",fries:"",frog:"",frowning:"",frowning_face:"",frowning_man:"&zwj;",frowning_woman:"",middle_finger:"",fuelpump:"",full_moon:"",full_moon_with_face:"",funeral_urn:"",game_die:"",gear:"",gem:"",gemini:"",ghost:"",gift:"",gift_heart:"",girl:"",globe_with_meridians:"",goal_net:"",goat:"",golf:"",golfing_man:"",golfing_woman:"&zwj;",gorilla:"",grapes:"",green_apple:"",green_book:"",green_heart:"",green_salad:"",grey_exclamation:"",grey_question:"",grimacing:"",grin:"",grinning:"",guardsman:"",guardswoman:"&zwj;",guitar:"",gun:"",haircut_woman:"",haircut_man:"&zwj;",hamburger:"",hammer:"",hammer_and_pick:"",hammer_and_wrench:"",hamster:"",hand:"",handbag:"",handshake:"",hankey:"",hatched_chick:"",hatching_chick:"",headphones:"",hear_no_evil:"",heart:"",heart_decoration:"",heart_eyes:"",heart_eyes_cat:"",heartbeat:"",heartpulse:"",hearts:"",heavy_check_mark:"",heavy_division_sign:"",heavy_dollar_sign:"",heavy_heart_exclamation:"",heavy_minus_sign:"",heavy_multiplication_x:"",heavy_plus_sign:"",helicopter:"",herb:"",hibiscus:"",high_brightness:"",high_heel:"",hocho:"",hole:"",honey_pot:"",horse:"",horse_racing:"",hospital:"",hot_pepper:"",hotdog:"",hotel:"",hotsprings:"",hourglass:"",hourglass_flowing_sand:"",house:"",house_with_garden:"",houses:"",hugs:"",hushed:"",ice_cream:"",ice_hockey:"",ice_skate:"",icecream:"",id:"",ideograph_advantage:"",imp:"",inbox_tray:"",incoming_envelope:"",tipping_hand_woman:"",information_source:"",innocent:"",interrobang:"",iphone:"",izakaya_lantern:"",jack_o_lantern:"",japan:"",japanese_castle:"",japanese_goblin:"",japanese_ogre:"",jeans:"",joy:"",joy_cat:"",joystick:"",kaaba:"",key:"",keyboard:"",keycap_ten:"",kick_scooter:"",kimono:"",kiss:"",kissing:"",kissing_cat:"",kissing_closed_eyes:"",kissing_heart:"",kissing_smiling_eyes:"",kiwi_fruit:"",koala:"",koko:"",label:"",large_blue_circle:"",large_blue_diamond:"",large_orange_diamond:"",last_quarter_moon:"",last_quarter_moon_with_face:"",latin_cross:"",laughing:"",leaves:"",ledger:"",left_luggage:"",left_right_arrow:"",leftwards_arrow_with_hook:"",lemon:"",leo:"",leopard:"",level_slider:"",libra:"",light_rail:"",link:"",lion:"",lips:"",lipstick:"",lizard:"",lock:"",lock_with_ink_pen:"",lollipop:"",loop:"",loud_sound:"",loudspeaker:"",love_hotel:"",love_letter:"",low_brightness:"",lying_face:"",m:"",mag:"",mag_right:"",mahjong:"",mailbox:"",mailbox_closed:"",mailbox_with_mail:"",mailbox_with_no_mail:"",man:"",man_artist:"&zwj;",man_astronaut:"&zwj;",man_cartwheeling:"&zwj;",man_cook:"&zwj;",man_dancing:"",man_facepalming:"&zwj;",man_factory_worker:"&zwj;",man_farmer:"&zwj;",man_firefighter:"&zwj;",man_health_worker:"&zwj;",man_in_tuxedo:"",man_judge:"&zwj;",man_juggling:"&zwj;",man_mechanic:"&zwj;",man_office_worker:"&zwj;",man_pilot:"&zwj;",man_playing_handball:"&zwj;",man_playing_water_polo:"&zwj;",man_scientist:"&zwj;",man_shrugging:"&zwj;",man_singer:"&zwj;",man_student:"&zwj;",man_teacher:"&zwj;",man_technologist:"&zwj;",man_with_gua_pi_mao:"",man_with_turban:"",tangerine:"",mans_shoe:"",mantelpiece_clock:"",maple_leaf:"",martial_arts_uniform:"",mask:"",massage_woman:"",massage_man:"&zwj;",meat_on_bone:"",medal_military:"",medal_sports:"",mega:"",melon:"",memo:"",men_wrestling:"&zwj;",menorah:"",mens:"",metal:"",metro:"",microphone:"",microscope:"",milk_glass:"",milky_way:"",minibus:"",minidisc:"",mobile_phone_off:"",money_mouth_face:"",money_with_wings:"",moneybag:"",monkey:"",monkey_face:"",monorail:"",moon:"",mortar_board:"",mosque:"",motor_boat:"",motor_scooter:"",motorcycle:"",motorway:"",mount_fuji:"",mountain:"",mountain_biking_man:"",mountain_biking_woman:"&zwj;",mountain_cableway:"",mountain_railway:"",mountain_snow:"",mouse:"",mouse2:"",movie_camera:"",moyai:"",mrs_claus:"",muscle:"",mushroom:"",musical_keyboard:"",musical_note:"",musical_score:"",mute:"",nail_care:"",name_badge:"",national_park:"",nauseated_face:"",necktie:"",negative_squared_cross_mark:"",nerd_face:"",neutral_face:"",new:"",new_moon:"",new_moon_with_face:"",newspaper:"",newspaper_roll:"",next_track_button:"",ng:"",no_good_man:"&zwj;",no_good_woman:"",night_with_stars:"",no_bell:"",no_bicycles:"",no_entry:"",no_entry_sign:"",no_mobile_phones:"",no_mouth:"",no_pedestrians:"",no_smoking:"","non-potable_water":"",nose:"",notebook:"",notebook_with_decorative_cover:"",notes:"",nut_and_bolt:"",o:"",o2:"",ocean:"",octopus:"",oden:"",office:"",oil_drum:"",ok:"",ok_hand:"",ok_man:"&zwj;",ok_woman:"",old_key:"",older_man:"",older_woman:"",om:"",on:"",oncoming_automobile:"",oncoming_bus:"",oncoming_police_car:"",oncoming_taxi:"",open_file_folder:"",open_hands:"",open_mouth:"",open_umbrella:"",ophiuchus:"",orange_book:"",orthodox_cross:"",outbox_tray:"",owl:"",ox:"",package:"",page_facing_up:"",page_with_curl:"",pager:"",paintbrush:"",palm_tree:"",pancakes:"",panda_face:"",paperclip:"",paperclips:"",parasol_on_ground:"",parking:"",part_alternation_mark:"",partly_sunny:"",passenger_ship:"",passport_control:"",pause_button:"",peace_symbol:"",peach:"",peanuts:"",pear:"",pen:"",pencil2:"",penguin:"",pensive:"",performing_arts:"",persevere:"",person_fencing:"",pouting_woman:"",phone:"",pick:"",pig:"",pig2:"",pig_nose:"",pill:"",pineapple:"",ping_pong:"",pisces:"",pizza:"",place_of_worship:"",plate_with_cutlery:"",play_or_pause_button:"",point_down:"",point_left:"",point_right:"",point_up:"",point_up_2:"",police_car:"",policewoman:"&zwj;",poodle:"",popcorn:"",post_office:"",postal_horn:"",postbox:"",potable_water:"",potato:"",pouch:"",poultry_leg:"",pound:"",rage:"",pouting_cat:"",pouting_man:"&zwj;",pray:"",prayer_beads:"",pregnant_woman:"",previous_track_button:"",prince:"",princess:"",printer:"",purple_heart:"",purse:"",pushpin:"",put_litter_in_its_place:"",question:"",rabbit:"",rabbit2:"",racehorse:"",racing_car:"",radio:"",radio_button:"",radioactive:"",railway_car:"",railway_track:"",rainbow:"",rainbow_flag:"&zwj;",raised_back_of_hand:"",raised_hand_with_fingers_splayed:"",raised_hands:"",raising_hand_woman:"",raising_hand_man:"&zwj;",ram:"",ramen:"",rat:"",record_button:"",recycle:"",red_circle:"",registered:"",relaxed:"",relieved:"",reminder_ribbon:"",repeat:"",repeat_one:"",rescue_worker_helmet:"",restroom:"",revolving_hearts:"",rewind:"",rhinoceros:"",ribbon:"",rice:"",rice_ball:"",rice_cracker:"",rice_scene:"",right_anger_bubble:"",ring:"",robot:"",rocket:"",rofl:"",roll_eyes:"",roller_coaster:"",rooster:"",rose:"",rosette:"",rotating_light:"",round_pushpin:"",rowing_man:"",rowing_woman:"&zwj;",rugby_football:"",running_man:"",running_shirt_with_sash:"",running_woman:"&zwj;",sa:"",sagittarius:"",sake:"",sandal:"",santa:"",satellite:"",saxophone:"",school:"",school_satchel:"",scissors:"",scorpion:"",scorpius:"",scream:"",scream_cat:"",scroll:"",seat:"",secret:"",see_no_evil:"",seedling:"",selfie:"",shallow_pan_of_food:"",shamrock:"",shark:"",shaved_ice:"",sheep:"",shell:"",shield:"",shinto_shrine:"",ship:"",shirt:"",shopping:"",shopping_cart:"",shower:"",shrimp:"",signal_strength:"",six_pointed_star:"",ski:"",skier:"",skull:"",skull_and_crossbones:"",sleeping:"",sleeping_bed:"",sleepy:"",slightly_frowning_face:"",slightly_smiling_face:"",slot_machine:"",small_airplane:"",small_blue_diamond:"",small_orange_diamond:"",small_red_triangle:"",small_red_triangle_down:"",smile:"",smile_cat:"",smiley:"",smiley_cat:"",smiling_imp:"",smirk:"",smirk_cat:"",smoking:"",snail:"",snake:"",sneezing_face:"",snowboarder:"",snowflake:"",snowman:"",snowman_with_snow:"",sob:"",soccer:"",soon:"",sos:"",sound:"",space_invader:"",spades:"",spaghetti:"",sparkle:"",sparkler:"",sparkles:"",sparkling_heart:"",speak_no_evil:"",speaker:"",speaking_head:"",speech_balloon:"",speedboat:"",spider:"",spider_web:"",spiral_calendar:"",spiral_notepad:"",spoon:"",squid:"",stadium:"",star:"",star2:"",star_and_crescent:"",star_of_david:"",stars:"",station:"",statue_of_liberty:"",steam_locomotive:"",stew:"",stop_button:"",stop_sign:"",stopwatch:"",straight_ruler:"",strawberry:"",stuck_out_tongue:"",stuck_out_tongue_closed_eyes:"",stuck_out_tongue_winking_eye:"",studio_microphone:"",stuffed_flatbread:"",sun_behind_large_cloud:"",sun_behind_rain_cloud:"",sun_behind_small_cloud:"",sun_with_face:"",sunflower:"",sunglasses:"",sunny:"",sunrise:"",sunrise_over_mountains:"",surfing_man:"",surfing_woman:"&zwj;",sushi:"",suspension_railway:"",sweat:"",sweat_drops:"",sweat_smile:"",sweet_potato:"",swimming_man:"",swimming_woman:"&zwj;",symbols:"",synagogue:"",syringe:"",taco:"",tada:"",tanabata_tree:"",taurus:"",taxi:"",tea:"",telephone_receiver:"",telescope:"",tennis:"",tent:"",thermometer:"",thinking:"",thought_balloon:"",ticket:"",tickets:"",tiger:"",tiger2:"",timer_clock:"",tipping_hand_man:"&zwj;",tired_face:"",tm:"",toilet:"",tokyo_tower:"",tomato:"",tongue:"",top:"",tophat:"",tornado:"",trackball:"",tractor:"",traffic_light:"",train:"",train2:"",tram:"",triangular_flag_on_post:"",triangular_ruler:"",trident:"",triumph:"",trolleybus:"",trophy:"",tropical_drink:"",tropical_fish:"",truck:"",trumpet:"",tulip:"",tumbler_glass:"",turkey:"",turtle:"",tv:"",twisted_rightwards_arrows:"",two_hearts:"",two_men_holding_hands:"",two_women_holding_hands:"",u5272:"",u5408:"",u55b6:"",u6307:"",u6708:"",u6709:"",u6e80:"",u7121:"",u7533:"",u7981:"",u7a7a:"",umbrella:"",unamused:"",underage:"",unicorn:"",unlock:"",up:"",upside_down_face:"",v:"",vertical_traffic_light:"",vhs:"",vibration_mode:"",video_camera:"",video_game:"",violin:"",virgo:"",volcano:"",volleyball:"",vs:"",vulcan_salute:"",walking_man:"",walking_woman:"&zwj;",waning_crescent_moon:"",waning_gibbous_moon:"",warning:"",wastebasket:"",watch:"",water_buffalo:"",watermelon:"",wave:"",wavy_dash:"",waxing_crescent_moon:"",wc:"",weary:"",wedding:"",weight_lifting_man:"",weight_lifting_woman:"&zwj;",whale:"",whale2:"",wheel_of_dharma:"",wheelchair:"",white_check_mark:"",white_circle:"",white_flag:"",white_flower:"",white_large_square:"",white_medium_small_square:"",white_medium_square:"",white_small_square:"",white_square_button:"",wilted_flower:"",wind_chime:"",wind_face:"",wine_glass:"",wink:"",wolf:"",woman:"",woman_artist:"&zwj;",woman_astronaut:"&zwj;",woman_cartwheeling:"&zwj;",woman_cook:"&zwj;",woman_facepalming:"&zwj;",woman_factory_worker:"&zwj;",woman_farmer:"&zwj;",woman_firefighter:"&zwj;",woman_health_worker:"&zwj;",woman_judge:"&zwj;",woman_juggling:"&zwj;",woman_mechanic:"&zwj;",woman_office_worker:"&zwj;",woman_pilot:"&zwj;",woman_playing_handball:"&zwj;",woman_playing_water_polo:"&zwj;",woman_scientist:"&zwj;",woman_shrugging:"&zwj;",woman_singer:"&zwj;",woman_student:"&zwj;",woman_teacher:"&zwj;",woman_technologist:"&zwj;",woman_with_turban:"&zwj;",womans_clothes:"",womans_hat:"",women_wrestling:"&zwj;",womens:"",world_map:"",worried:"",wrench:"",writing_hand:"",x:"",yellow_heart:"",yen:"",yin_yang:"",yum:"",zap:"",zipper_mouth_face:"",zzz:"",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},t.Converter=function(a){var o={},d=[],l=[],g={},m=h,_={parsed:{},raw:"",format:""};I();function I(){a=a||{};for(var A in u)u.hasOwnProperty(A)&&(o[A]=u[A]);if(typeof a=="object")for(var H in a)a.hasOwnProperty(H)&&(o[H]=a[H]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof a+" was passed instead.");o.extensions&&t.helper.forEach(o.extensions,V)}function V(A,H){if(H=H||null,t.helper.isString(A))if(A=t.helper.stdExtName(A),H=A,t.extensions[A]){console.warn("DEPRECATION WARNING: "+A+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),F(t.extensions[A],A);return}else if(!t.helper.isUndefined(s[A]))A=s[A];else throw Error('Extension "'+A+'" could not be loaded. It was either not found or is not a valid extension.');typeof A=="function"&&(A=A()),t.helper.isArray(A)||(A=[A]);var q=b(A,H);if(!q.valid)throw Error(q.error);for(var X=0;X<A.length;++X){switch(A[X].type){case"lang":d.push(A[X]);break;case"output":l.push(A[X]);break}if(A[X].hasOwnProperty("listeners"))for(var me in A[X].listeners)A[X].listeners.hasOwnProperty(me)&&j(me,A[X].listeners[me])}}function F(A,H){typeof A=="function"&&(A=A(new t.Converter)),t.helper.isArray(A)||(A=[A]);var q=b(A,H);if(!q.valid)throw Error(q.error);for(var X=0;X<A.length;++X)switch(A[X].type){case"lang":d.push(A[X]);break;case"output":l.push(A[X]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function j(A,H){if(!t.helper.isString(A))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof A+" given");if(typeof H!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof H+" given");g.hasOwnProperty(A)||(g[A]=[]),g[A].push(H)}function W(A){var H=A.match(/^\s*/)[0].length,q=new RegExp("^\\s{0,"+H+"}","gm");return A.replace(q,"")}this._dispatch=function(H,q,X,me){if(g.hasOwnProperty(H))for(var Y=0;Y<g[H].length;++Y){var xe=g[H][Y](H,q,this,X,me);xe&&typeof xe<"u"&&(q=xe)}return q},this.listen=function(A,H){return j(A,H),this},this.makeHtml=function(A){if(!A)return A;var H={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:d,outputModifiers:l,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return A=A.replace(//g,"T"),A=A.replace(/\$/g,"D"),A=A.replace(/\r\n/g,`
`),A=A.replace(/\r/g,`
`),A=A.replace(/\u00A0/g,"&nbsp;"),o.smartIndentationFix&&(A=W(A)),A=`

`+A+`

`,A=t.subParser("detab")(A,o,H),A=A.replace(/^[ \t]+$/mg,""),t.helper.forEach(d,function(q){A=t.subParser("runExtension")(q,A,o,H)}),A=t.subParser("metadata")(A,o,H),A=t.subParser("hashPreCodeTags")(A,o,H),A=t.subParser("githubCodeBlocks")(A,o,H),A=t.subParser("hashHTMLBlocks")(A,o,H),A=t.subParser("hashCodeTags")(A,o,H),A=t.subParser("stripLinkDefinitions")(A,o,H),A=t.subParser("blockGamut")(A,o,H),A=t.subParser("unhashHTMLSpans")(A,o,H),A=t.subParser("unescapeSpecialChars")(A,o,H),A=A.replace(/D/g,"$$"),A=A.replace(/T/g,""),A=t.subParser("completeHTMLDocument")(A,o,H),t.helper.forEach(l,function(q){A=t.subParser("runExtension")(q,A,o,H)}),_=H.metadata,A},this.makeMarkdown=this.makeMd=function(A,H){if(A=A.replace(/\r\n/g,`
`),A=A.replace(/\r/g,`
`),A=A.replace(/>[ \t]+</,">NBSP;<"),!H)if(window&&window.document)H=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var q=H.createElement("div");q.innerHTML=A;var X={preList:x(q)};M(q);for(var me=q.childNodes,Y="",xe=0;xe<me.length;xe++)Y+=t.subParser("makeMarkdown.node")(me[xe],X);function M(L){for(var K=0;K<L.childNodes.length;++K){var G=L.childNodes[K];G.nodeType===3?!/\S/.test(G.nodeValue)&&!/^[ ]+$/.test(G.nodeValue)?(L.removeChild(G),--K):(G.nodeValue=G.nodeValue.split(`
`).join(" "),G.nodeValue=G.nodeValue.replace(/(\s)+/g,"$1")):G.nodeType===1&&M(G)}}function x(L){for(var K=L.querySelectorAll("pre"),G=[],z=0;z<K.length;++z)if(K[z].childElementCount===1&&K[z].firstChild.tagName.toLowerCase()==="code"){var Ce=K[z].firstChild.innerHTML.trim(),Oe=K[z].firstChild.getAttribute("data-language")||"";if(Oe==="")for(var fe=K[z].firstChild.className.split(" "),et=0;et<fe.length;++et){var tt=fe[et].match(/^language-(.+)$/);if(tt!==null){Oe=tt[1];break}}Ce=t.helper.unescapeHTMLEntities(Ce),G.push(Ce),K[z].outerHTML='<precode language="'+Oe+'" precodenum="'+z.toString()+'"></precode>'}else G.push(K[z].innerHTML),K[z].innerHTML="",K[z].setAttribute("prenum",z.toString());return G}return Y},this.setOption=function(A,H){o[A]=H},this.getOption=function(A){return o[A]},this.getOptions=function(){return o},this.addExtension=function(A,H){H=H||null,V(A,H)},this.useExtension=function(A){V(A)},this.setFlavor=function(A){if(!c.hasOwnProperty(A))throw Error(A+" flavor was not found");var H=c[A];m=A;for(var q in H)H.hasOwnProperty(q)&&(o[q]=H[q])},this.getFlavor=function(){return m},this.removeExtension=function(A){t.helper.isArray(A)||(A=[A]);for(var H=0;H<A.length;++H){for(var q=A[H],X=0;X<d.length;++X)d[X]===q&&d.splice(X,1);for(var me=0;me<l.length;++me)l[me]===q&&l.splice(me,1)}},this.getAllExtensions=function(){return{language:d,output:l}},this.getMetadata=function(A){return A?_.raw:_.parsed},this.getMetadataFormat=function(){return _.format},this._setMetadataPair=function(A,H){_.parsed[A]=H},this._setMetadataFormat=function(A){_.format=A},this._setMetadataRaw=function(A){_.raw=A}},t.subParser("anchors",function(a,o,d){a=d.converter._dispatch("anchors.before",a,o,d);var l=function(g,m,_,I,V,F,j){if(t.helper.isUndefined(j)&&(j=""),_=_.toLowerCase(),g.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)I="";else if(!I)if(_||(_=m.toLowerCase().replace(/ ?\n/g," ")),I="#"+_,!t.helper.isUndefined(d.gUrls[_]))I=d.gUrls[_],t.helper.isUndefined(d.gTitles[_])||(j=d.gTitles[_]);else return g;I=I.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var W='<a href="'+I+'"';return j!==""&&j!==null&&(j=j.replace(/"/g,"&quot;"),j=j.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),W+=' title="'+j+'"'),o.openLinksInNewWindow&&!/^#/.test(I)&&(W+=' rel="noopener noreferrer" target="E95Eblank"'),W+=">"+m+"</a>",W};return a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,l),a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,l),a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,l),a=a.replace(/\[([^\[\]]+)]()()()()()/g,l),o.ghMentions&&(a=a.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(g,m,_,I,V){if(_==="\\")return m+I;if(!t.helper.isString(o.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var F=o.ghMentionsLink.replace(/\{u}/g,V),j="";return o.openLinksInNewWindow&&(j=' rel="noopener noreferrer" target="E95Eblank"'),m+'<a href="'+F+'"'+j+">"+I+"</a>"})),a=d.converter._dispatch("anchors.after",a,o,d),a});var w=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,T=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,R=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,S=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,O=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,P=function(a){return function(o,d,l,g,m,_,I){l=l.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var V=l,F="",j="",W=d||"",A=I||"";return/^www\./i.test(l)&&(l=l.replace(/^www\./i,"http://www.")),a.excludeTrailingPunctuationFromURLs&&_&&(F=_),a.openLinksInNewWindow&&(j=' rel="noopener noreferrer" target="E95Eblank"'),W+'<a href="'+l+'"'+j+">"+V+"</a>"+F+A}},C=function(a,o){return function(d,l,g){var m="mailto:";return l=l||"",g=t.subParser("unescapeSpecialChars")(g,a,o),a.encodeEmails?(m=t.helper.encodeEmailAddress(m+g),g=t.helper.encodeEmailAddress(g)):m=m+g,l+'<a href="'+m+'">'+g+"</a>"}};t.subParser("autoLinks",function(a,o,d){return a=d.converter._dispatch("autoLinks.before",a,o,d),a=a.replace(R,P(o)),a=a.replace(O,C(o,d)),a=d.converter._dispatch("autoLinks.after",a,o,d),a}),t.subParser("simplifiedAutoLinks",function(a,o,d){return o.simplifiedAutoLink&&(a=d.converter._dispatch("simplifiedAutoLinks.before",a,o,d),o.excludeTrailingPunctuationFromURLs?a=a.replace(T,P(o)):a=a.replace(w,P(o)),a=a.replace(S,C(o,d)),a=d.converter._dispatch("simplifiedAutoLinks.after",a,o,d)),a}),t.subParser("blockGamut",function(a,o,d){return a=d.converter._dispatch("blockGamut.before",a,o,d),a=t.subParser("blockQuotes")(a,o,d),a=t.subParser("headers")(a,o,d),a=t.subParser("horizontalRule")(a,o,d),a=t.subParser("lists")(a,o,d),a=t.subParser("codeBlocks")(a,o,d),a=t.subParser("tables")(a,o,d),a=t.subParser("hashHTMLBlocks")(a,o,d),a=t.subParser("paragraphs")(a,o,d),a=d.converter._dispatch("blockGamut.after",a,o,d),a}),t.subParser("blockQuotes",function(a,o,d){a=d.converter._dispatch("blockQuotes.before",a,o,d),a=a+`

`;var l=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return o.splitAdjacentBlockquotes&&(l=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),a=a.replace(l,function(g){return g=g.replace(/^[ \t]*>[ \t]?/gm,""),g=g.replace(/0/g,""),g=g.replace(/^[ \t]+$/gm,""),g=t.subParser("githubCodeBlocks")(g,o,d),g=t.subParser("blockGamut")(g,o,d),g=g.replace(/(^|\n)/g,"$1  "),g=g.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(m,_){var I=_;return I=I.replace(/^  /mg,"0"),I=I.replace(/0/g,""),I}),t.subParser("hashBlock")(`<blockquote>
`+g+`
</blockquote>`,o,d)}),a=d.converter._dispatch("blockQuotes.after",a,o,d),a}),t.subParser("codeBlocks",function(a,o,d){a=d.converter._dispatch("codeBlocks.before",a,o,d),a+="0";var l=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=0))/g;return a=a.replace(l,function(g,m,_){var I=m,V=_,F=`
`;return I=t.subParser("outdent")(I,o,d),I=t.subParser("encodeCode")(I,o,d),I=t.subParser("detab")(I,o,d),I=I.replace(/^\n+/g,""),I=I.replace(/\n+$/g,""),o.omitExtraWLInCodeBlocks&&(F=""),I="<pre><code>"+I+F+"</code></pre>",t.subParser("hashBlock")(I,o,d)+V}),a=a.replace(/0/,""),a=d.converter._dispatch("codeBlocks.after",a,o,d),a}),t.subParser("codeSpans",function(a,o,d){return a=d.converter._dispatch("codeSpans.before",a,o,d),typeof a>"u"&&(a=""),a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(l,g,m,_){var I=_;return I=I.replace(/^([ \t]*)/g,""),I=I.replace(/[ \t]*$/g,""),I=t.subParser("encodeCode")(I,o,d),I=g+"<code>"+I+"</code>",I=t.subParser("hashHTMLSpans")(I,o,d),I}),a=d.converter._dispatch("codeSpans.after",a,o,d),a}),t.subParser("completeHTMLDocument",function(a,o,d){if(!o.completeHTMLDocument)return a;a=d.converter._dispatch("completeHTMLDocument.before",a,o,d);var l="html",g=`<!DOCTYPE HTML>
`,m="",_=`<meta charset="utf-8">
`,I="",V="";typeof d.metadata.parsed.doctype<"u"&&(g="<!DOCTYPE "+d.metadata.parsed.doctype+`>
`,l=d.metadata.parsed.doctype.toString().toLowerCase(),(l==="html"||l==="html5")&&(_='<meta charset="utf-8">'));for(var F in d.metadata.parsed)if(d.metadata.parsed.hasOwnProperty(F))switch(F.toLowerCase()){case"doctype":break;case"title":m="<title>"+d.metadata.parsed.title+`</title>
`;break;case"charset":l==="html"||l==="html5"?_='<meta charset="'+d.metadata.parsed.charset+`">
`:_='<meta name="charset" content="'+d.metadata.parsed.charset+`">
`;break;case"language":case"lang":I=' lang="'+d.metadata.parsed[F]+'"',V+='<meta name="'+F+'" content="'+d.metadata.parsed[F]+`">
`;break;default:V+='<meta name="'+F+'" content="'+d.metadata.parsed[F]+`">
`}return a=g+"<html"+I+`>
<head>
`+m+_+V+`</head>
<body>
`+a.trim()+`
</body>
</html>`,a=d.converter._dispatch("completeHTMLDocument.after",a,o,d),a}),t.subParser("detab",function(a,o,d){return a=d.converter._dispatch("detab.before",a,o,d),a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"AB"),a=a.replace(/B(.+?)A/g,function(l,g){for(var m=g,_=4-m.length%4,I=0;I<_;I++)m+=" ";return m}),a=a.replace(/A/g,"    "),a=a.replace(/B/g,""),a=d.converter._dispatch("detab.after",a,o,d),a}),t.subParser("ellipsis",function(a,o,d){return o.ellipsis&&(a=d.converter._dispatch("ellipsis.before",a,o,d),a=a.replace(/\.\.\./g,""),a=d.converter._dispatch("ellipsis.after",a,o,d)),a}),t.subParser("emoji",function(a,o,d){if(!o.emoji)return a;a=d.converter._dispatch("emoji.before",a,o,d);var l=/:([\S]+?):/g;return a=a.replace(l,function(g,m){return t.helper.emojis.hasOwnProperty(m)?t.helper.emojis[m]:g}),a=d.converter._dispatch("emoji.after",a,o,d),a}),t.subParser("encodeAmpsAndAngles",function(a,o,d){return a=d.converter._dispatch("encodeAmpsAndAngles.before",a,o,d),a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?$!])/gi,"&lt;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=d.converter._dispatch("encodeAmpsAndAngles.after",a,o,d),a}),t.subParser("encodeBackslashEscapes",function(a,o,d){return a=d.converter._dispatch("encodeBackslashEscapes.before",a,o,d),a=a.replace(/\\(\\)/g,t.helper.escapeCharactersCallback),a=a.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,t.helper.escapeCharactersCallback),a=d.converter._dispatch("encodeBackslashEscapes.after",a,o,d),a}),t.subParser("encodeCode",function(a,o,d){return a=d.converter._dispatch("encodeCode.before",a,o,d),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,t.helper.escapeCharactersCallback),a=d.converter._dispatch("encodeCode.after",a,o,d),a}),t.subParser("escapeSpecialCharsWithinTagAttributes",function(a,o,d){a=d.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",a,o,d);var l=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,g=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return a=a.replace(l,function(m){return m.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),a=a.replace(g,function(m){return m.replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),a=d.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",a,o,d),a}),t.subParser("githubCodeBlocks",function(a,o,d){return o.ghCodeBlocks?(a=d.converter._dispatch("githubCodeBlocks.before",a,o,d),a+="0",a=a.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(l,g,m,_){var I=o.omitExtraWLInCodeBlocks?"":`
`;return _=t.subParser("encodeCode")(_,o,d),_=t.subParser("detab")(_,o,d),_=_.replace(/^\n+/g,""),_=_.replace(/\n+$/g,""),_="<pre><code"+(m?' class="'+m+" language-"+m+'"':"")+">"+_+I+"</code></pre>",_=t.subParser("hashBlock")(_,o,d),`

G`+(d.ghCodeBlocks.push({text:l,codeblock:_})-1)+`G

`}),a=a.replace(/0/,""),d.converter._dispatch("githubCodeBlocks.after",a,o,d)):a}),t.subParser("hashBlock",function(a,o,d){return a=d.converter._dispatch("hashBlock.before",a,o,d),a=a.replace(/(^\n+|\n+$)/g,""),a=`

K`+(d.gHtmlBlocks.push(a)-1)+`K

`,a=d.converter._dispatch("hashBlock.after",a,o,d),a}),t.subParser("hashCodeTags",function(a,o,d){a=d.converter._dispatch("hashCodeTags.before",a,o,d);var l=function(g,m,_,I){var V=_+t.subParser("encodeCode")(m,o,d)+I;return"C"+(d.gHtmlSpans.push(V)-1)+"C"};return a=t.helper.replaceRecursiveRegExp(a,l,"<code\\b[^>]*>","</code>","gim"),a=d.converter._dispatch("hashCodeTags.after",a,o,d),a}),t.subParser("hashElement",function(a,o,d){return function(l,g){var m=g;return m=m.replace(/\n\n/g,`
`),m=m.replace(/^\n/,""),m=m.replace(/\n+$/g,""),m=`

K`+(d.gHtmlBlocks.push(m)-1)+`K

`,m}}),t.subParser("hashHTMLBlocks",function(a,o,d){a=d.converter._dispatch("hashHTMLBlocks.before",a,o,d);var l=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],g=function(A,H,q,X){var me=A;return q.search(/\bmarkdown\b/)!==-1&&(me=q+d.converter.makeHtml(H)+X),`

K`+(d.gHtmlBlocks.push(me)-1)+`K

`};o.backslashEscapesHTMLTags&&(a=a.replace(/\\<(\/?[^>]+?)>/g,function(A,H){return"&lt;"+H+"&gt;"}));for(var m=0;m<l.length;++m)for(var _,I=new RegExp("^ {0,3}(<"+l[m]+"\\b[^>]*>)","im"),V="<"+l[m]+"\\b[^>]*>",F="</"+l[m]+">";(_=t.helper.regexIndexOf(a,I))!==-1;){var j=t.helper.splitAtIndex(a,_),W=t.helper.replaceRecursiveRegExp(j[1],g,V,F,"im");if(W===j[1])break;a=j[0].concat(W)}return a=a.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(a,o,d)),a=t.helper.replaceRecursiveRegExp(a,function(A){return`

K`+(d.gHtmlBlocks.push(A)-1)+`K

`},"^ {0,3}<!--","-->","gm"),a=a.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(a,o,d)),a=d.converter._dispatch("hashHTMLBlocks.after",a,o,d),a}),t.subParser("hashHTMLSpans",function(a,o,d){a=d.converter._dispatch("hashHTMLSpans.before",a,o,d);function l(g){return"C"+(d.gHtmlSpans.push(g)-1)+"C"}return a=a.replace(/<[^>]+?\/>/gi,function(g){return l(g)}),a=a.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(g){return l(g)}),a=a.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(g){return l(g)}),a=a.replace(/<[^>]+?>/gi,function(g){return l(g)}),a=d.converter._dispatch("hashHTMLSpans.after",a,o,d),a}),t.subParser("unhashHTMLSpans",function(a,o,d){a=d.converter._dispatch("unhashHTMLSpans.before",a,o,d);for(var l=0;l<d.gHtmlSpans.length;++l){for(var g=d.gHtmlSpans[l],m=0;/C(\d+)C/.test(g);){var _=RegExp.$1;if(g=g.replace("C"+_+"C",d.gHtmlSpans[_]),m===10){console.error("maximum nesting of 10 spans reached!!!");break}++m}a=a.replace("C"+l+"C",g)}return a=d.converter._dispatch("unhashHTMLSpans.after",a,o,d),a}),t.subParser("hashPreCodeTags",function(a,o,d){a=d.converter._dispatch("hashPreCodeTags.before",a,o,d);var l=function(g,m,_,I){var V=_+t.subParser("encodeCode")(m,o,d)+I;return`

G`+(d.ghCodeBlocks.push({text:g,codeblock:V})-1)+`G

`};return a=t.helper.replaceRecursiveRegExp(a,l,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),a=d.converter._dispatch("hashPreCodeTags.after",a,o,d),a}),t.subParser("headers",function(a,o,d){a=d.converter._dispatch("headers.before",a,o,d);var l=isNaN(parseInt(o.headerLevelStart))?1:parseInt(o.headerLevelStart),g=o.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,m=o.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;a=a.replace(g,function(V,F){var j=t.subParser("spanGamut")(F,o,d),W=o.noHeaderId?"":' id="'+I(F)+'"',A=l,H="<h"+A+W+">"+j+"</h"+A+">";return t.subParser("hashBlock")(H,o,d)}),a=a.replace(m,function(V,F){var j=t.subParser("spanGamut")(F,o,d),W=o.noHeaderId?"":' id="'+I(F)+'"',A=l+1,H="<h"+A+W+">"+j+"</h"+A+">";return t.subParser("hashBlock")(H,o,d)});var _=o.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;a=a.replace(_,function(V,F,j){var W=j;o.customizedHeaderId&&(W=j.replace(/\s?\{([^{]+?)}\s*$/,""));var A=t.subParser("spanGamut")(W,o,d),H=o.noHeaderId?"":' id="'+I(j)+'"',q=l-1+F.length,X="<h"+q+H+">"+A+"</h"+q+">";return t.subParser("hashBlock")(X,o,d)});function I(V){var F,j;if(o.customizedHeaderId){var W=V.match(/\{([^{]+?)}\s*$/);W&&W[1]&&(V=W[1])}return F=V,t.helper.isString(o.prefixHeaderId)?j=o.prefixHeaderId:o.prefixHeaderId===!0?j="section-":j="",o.rawPrefixHeaderId||(F=j+F),o.ghCompatibleHeaderId?F=F.replace(/ /g,"-").replace(/&amp;/g,"").replace(/T/g,"").replace(/D/g,"").replace(/[&+$,\/:;=?@"#{}|^~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():o.rawHeaderId?F=F.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/T/g,"").replace(/D/g,"$").replace(/["']/g,"-").toLowerCase():F=F.replace(/[^\w]/g,"").toLowerCase(),o.rawPrefixHeaderId&&(F=j+F),d.hashLinkCounts[F]?F=F+"-"+d.hashLinkCounts[F]++:d.hashLinkCounts[F]=1,F}return a=d.converter._dispatch("headers.after",a,o,d),a}),t.subParser("horizontalRule",function(a,o,d){a=d.converter._dispatch("horizontalRule.before",a,o,d);var l=t.subParser("hashBlock")("<hr />",o,d);return a=a.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,l),a=a.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,l),a=a.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,l),a=d.converter._dispatch("horizontalRule.after",a,o,d),a}),t.subParser("images",function(a,o,d){a=d.converter._dispatch("images.before",a,o,d);var l=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,g=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,m=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,_=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,I=/!\[([^\[\]]+)]()()()()()/g;function V(j,W,A,H,q,X,me,Y){return H=H.replace(/\s/g,""),F(j,W,A,H,q,X,me,Y)}function F(j,W,A,H,q,X,me,Y){var xe=d.gUrls,M=d.gTitles,x=d.gDimensions;if(A=A.toLowerCase(),Y||(Y=""),j.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)H="";else if(H===""||H===null)if((A===""||A===null)&&(A=W.toLowerCase().replace(/ ?\n/g," ")),H="#"+A,!t.helper.isUndefined(xe[A]))H=xe[A],t.helper.isUndefined(M[A])||(Y=M[A]),t.helper.isUndefined(x[A])||(q=x[A].width,X=x[A].height);else return j;W=W.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),H=H.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var L='<img src="'+H+'" alt="'+W+'"';return Y&&t.helper.isString(Y)&&(Y=Y.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),L+=' title="'+Y+'"'),q&&X&&(q=q==="*"?"auto":q,X=X==="*"?"auto":X,L+=' width="'+q+'"',L+=' height="'+X+'"'),L+=" />",L}return a=a.replace(_,F),a=a.replace(m,V),a=a.replace(g,F),a=a.replace(l,F),a=a.replace(I,F),a=d.converter._dispatch("images.after",a,o,d),a}),t.subParser("italicsAndBold",function(a,o,d){a=d.converter._dispatch("italicsAndBold.before",a,o,d);function l(g,m,_){return m+g+_}return o.literalMidWordUnderscores?(a=a.replace(/\b___(\S[\s\S]*?)___\b/g,function(g,m){return l(m,"<strong><em>","</em></strong>")}),a=a.replace(/\b__(\S[\s\S]*?)__\b/g,function(g,m){return l(m,"<strong>","</strong>")}),a=a.replace(/\b_(\S[\s\S]*?)_\b/g,function(g,m){return l(m,"<em>","</em>")})):(a=a.replace(/___(\S[\s\S]*?)___/g,function(g,m){return/\S$/.test(m)?l(m,"<strong><em>","</em></strong>"):g}),a=a.replace(/__(\S[\s\S]*?)__/g,function(g,m){return/\S$/.test(m)?l(m,"<strong>","</strong>"):g}),a=a.replace(/_([^\s_][\s\S]*?)_/g,function(g,m){return/\S$/.test(m)?l(m,"<em>","</em>"):g})),o.literalMidWordAsterisks?(a=a.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(g,m,_){return l(_,m+"<strong><em>","</em></strong>")}),a=a.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(g,m,_){return l(_,m+"<strong>","</strong>")}),a=a.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(g,m,_){return l(_,m+"<em>","</em>")})):(a=a.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(g,m){return/\S$/.test(m)?l(m,"<strong><em>","</em></strong>"):g}),a=a.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(g,m){return/\S$/.test(m)?l(m,"<strong>","</strong>"):g}),a=a.replace(/\*([^\s*][\s\S]*?)\*/g,function(g,m){return/\S$/.test(m)?l(m,"<em>","</em>"):g})),a=d.converter._dispatch("italicsAndBold.after",a,o,d),a}),t.subParser("lists",function(a,o,d){function l(_,I){d.gListLevel++,_=_.replace(/\n{2,}$/,`
`),_+="0";var V=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,F=/\n[ \t]*\n(?!0)/.test(_);return o.disableForced4SpacesIndentedSublists&&(V=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0|\2([*+-]|\d+[.])[ \t]+))/gm),_=_.replace(V,function(j,W,A,H,q,X,me){me=me&&me.trim()!=="";var Y=t.subParser("outdent")(q,o,d),xe="";return X&&o.tasklists&&(xe=' class="task-list-item" style="list-style-type: none;"',Y=Y.replace(/^[ \t]*\[(x|X| )?]/m,function(){var M='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return me&&(M+=" checked"),M+=">",M})),Y=Y.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(M){return"A"+M}),W||Y.search(/\n{2,}/)>-1?(Y=t.subParser("githubCodeBlocks")(Y,o,d),Y=t.subParser("blockGamut")(Y,o,d)):(Y=t.subParser("lists")(Y,o,d),Y=Y.replace(/\n$/,""),Y=t.subParser("hashHTMLBlocks")(Y,o,d),Y=Y.replace(/\n\n+/g,`

`),F?Y=t.subParser("paragraphs")(Y,o,d):Y=t.subParser("spanGamut")(Y,o,d)),Y=Y.replace("A",""),Y="<li"+xe+">"+Y+`</li>
`,Y}),_=_.replace(/0/g,""),d.gListLevel--,I&&(_=_.replace(/\s+$/,"")),_}function g(_,I){if(I==="ol"){var V=_.match(/^ *(\d+)\./);if(V&&V[1]!=="1")return' start="'+V[1]+'"'}return""}function m(_,I,V){var F=o.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,j=o.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,W=I==="ul"?F:j,A="";if(_.search(W)!==-1)(function q(X){var me=X.search(W),Y=g(_,I);me!==-1?(A+=`

<`+I+Y+`>
`+l(X.slice(0,me),!!V)+"</"+I+`>
`,I=I==="ul"?"ol":"ul",W=I==="ul"?F:j,q(X.slice(me))):A+=`

<`+I+Y+`>
`+l(X,!!V)+"</"+I+`>
`})(_);else{var H=g(_,I);A=`

<`+I+H+`>
`+l(_,!!V)+"</"+I+`>
`}return A}return a=d.converter._dispatch("lists.before",a,o,d),a+="0",d.gListLevel?a=a.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(_,I,V){var F=V.search(/[*+-]/g)>-1?"ul":"ol";return m(I,F,!0)}):a=a.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(_,I,V,F){var j=F.search(/[*+-]/g)>-1?"ul":"ol";return m(V,j,!1)}),a=a.replace(/0/,""),a=d.converter._dispatch("lists.after",a,o,d),a}),t.subParser("metadata",function(a,o,d){if(!o.metadata)return a;a=d.converter._dispatch("metadata.before",a,o,d);function l(g){d.metadata.raw=g,g=g.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),g=g.replace(/\n {4}/g," "),g.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(m,_,I){return d.metadata.parsed[_]=I,""})}return a=a.replace(/^\s*+(\S*?)\n([\s\S]+?)\n+\n/,function(g,m,_){return l(_),"M"}),a=a.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(g,m,_){return m&&(d.metadata.format=m),l(_),"M"}),a=a.replace(/M/g,""),a=d.converter._dispatch("metadata.after",a,o,d),a}),t.subParser("outdent",function(a,o,d){return a=d.converter._dispatch("outdent.before",a,o,d),a=a.replace(/^(\t|[ ]{1,4})/gm,"0"),a=a.replace(/0/g,""),a=d.converter._dispatch("outdent.after",a,o,d),a}),t.subParser("paragraphs",function(a,o,d){a=d.converter._dispatch("paragraphs.before",a,o,d),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var l=a.split(/\n{2,}/g),g=[],m=l.length,_=0;_<m;_++){var I=l[_];I.search(/(K|G)(\d+)\1/g)>=0?g.push(I):I.search(/\S/)>=0&&(I=t.subParser("spanGamut")(I,o,d),I=I.replace(/^([ \t]*)/g,"<p>"),I+="</p>",g.push(I))}for(m=g.length,_=0;_<m;_++){for(var V="",F=g[_],j=!1;/(K|G)(\d+)\1/.test(F);){var W=RegExp.$1,A=RegExp.$2;W==="K"?V=d.gHtmlBlocks[A]:j?V=t.subParser("encodeCode")(d.ghCodeBlocks[A].text,o,d):V=d.ghCodeBlocks[A].codeblock,V=V.replace(/\$/g,"$$$$"),F=F.replace(/(\n\n)?(K|G)\d+\2(\n\n)?/,V),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(F)&&(j=!0)}g[_]=F}return a=g.join(`
`),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),d.converter._dispatch("paragraphs.after",a,o,d)}),t.subParser("runExtension",function(a,o,d,l){if(a.filter)o=a.filter(o,l.converter,d);else if(a.regex){var g=a.regex;g instanceof RegExp||(g=new RegExp(g,"g")),o=o.replace(g,a.replace)}return o}),t.subParser("spanGamut",function(a,o,d){return a=d.converter._dispatch("spanGamut.before",a,o,d),a=t.subParser("codeSpans")(a,o,d),a=t.subParser("escapeSpecialCharsWithinTagAttributes")(a,o,d),a=t.subParser("encodeBackslashEscapes")(a,o,d),a=t.subParser("images")(a,o,d),a=t.subParser("anchors")(a,o,d),a=t.subParser("autoLinks")(a,o,d),a=t.subParser("simplifiedAutoLinks")(a,o,d),a=t.subParser("emoji")(a,o,d),a=t.subParser("underline")(a,o,d),a=t.subParser("italicsAndBold")(a,o,d),a=t.subParser("strikethrough")(a,o,d),a=t.subParser("ellipsis")(a,o,d),a=t.subParser("hashHTMLSpans")(a,o,d),a=t.subParser("encodeAmpsAndAngles")(a,o,d),o.simpleLineBreaks?/\n\nK/.test(a)||(a=a.replace(/\n+/g,`<br />
`)):a=a.replace(/  +\n/g,`<br />
`),a=d.converter._dispatch("spanGamut.after",a,o,d),a}),t.subParser("strikethrough",function(a,o,d){function l(g){return o.simplifiedAutoLink&&(g=t.subParser("simplifiedAutoLinks")(g,o,d)),"<del>"+g+"</del>"}return o.strikethrough&&(a=d.converter._dispatch("strikethrough.before",a,o,d),a=a.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(g,m){return l(m)}),a=d.converter._dispatch("strikethrough.after",a,o,d)),a}),t.subParser("stripLinkDefinitions",function(a,o,d){var l=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=0))/gm,g=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=0)|(?=\n\[))/gm;a+="0";var m=function(_,I,V,F,j,W,A){return I=I.toLowerCase(),a.toLowerCase().split(I).length-1<2?_:(V.match(/^data:.+?\/.+?;base64,/)?d.gUrls[I]=V.replace(/\s/g,""):d.gUrls[I]=t.subParser("encodeAmpsAndAngles")(V,o,d),W?W+A:(A&&(d.gTitles[I]=A.replace(/"|'/g,"&quot;")),o.parseImgDimensions&&F&&j&&(d.gDimensions[I]={width:F,height:j}),""))};return a=a.replace(g,m),a=a.replace(l,m),a=a.replace(/0/,""),a}),t.subParser("tables",function(a,o,d){if(!o.tables)return a;var l=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|0)/gm,g=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|0)/gm;function m(j){return/^:[ \t]*--*$/.test(j)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(j)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(j)?' style="text-align:center;"':""}function _(j,W){var A="";return j=j.trim(),(o.tablesHeaderId||o.tableHeaderId)&&(A=' id="'+j.replace(/ /g,"_").toLowerCase()+'"'),j=t.subParser("spanGamut")(j,o,d),"<th"+A+W+">"+j+`</th>
`}function I(j,W){var A=t.subParser("spanGamut")(j,o,d);return"<td"+W+">"+A+`</td>
`}function V(j,W){for(var A=`<table>
<thead>
<tr>
`,H=j.length,q=0;q<H;++q)A+=j[q];for(A+=`</tr>
</thead>
<tbody>
`,q=0;q<W.length;++q){A+=`<tr>
`;for(var X=0;X<H;++X)A+=W[q][X];A+=`</tr>
`}return A+=`</tbody>
</table>
`,A}function F(j){var W,A=j.split(`
`);for(W=0;W<A.length;++W)/^ {0,3}\|/.test(A[W])&&(A[W]=A[W].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(A[W])&&(A[W]=A[W].replace(/\|[ \t]*$/,"")),A[W]=t.subParser("codeSpans")(A[W],o,d);var H=A[0].split("|").map(function(L){return L.trim()}),q=A[1].split("|").map(function(L){return L.trim()}),X=[],me=[],Y=[],xe=[];for(A.shift(),A.shift(),W=0;W<A.length;++W)A[W].trim()!==""&&X.push(A[W].split("|").map(function(L){return L.trim()}));if(H.length<q.length)return j;for(W=0;W<q.length;++W)Y.push(m(q[W]));for(W=0;W<H.length;++W)t.helper.isUndefined(Y[W])&&(Y[W]=""),me.push(_(H[W],Y[W]));for(W=0;W<X.length;++W){for(var M=[],x=0;x<me.length;++x)t.helper.isUndefined(X[W][x]),M.push(I(X[W][x],Y[x]));xe.push(M)}return V(me,xe)}return a=d.converter._dispatch("tables.before",a,o,d),a=a.replace(/\\(\|)/g,t.helper.escapeCharactersCallback),a=a.replace(l,F),a=a.replace(g,F),a=d.converter._dispatch("tables.after",a,o,d),a}),t.subParser("underline",function(a,o,d){return o.underline&&(a=d.converter._dispatch("underline.before",a,o,d),o.literalMidWordUnderscores?(a=a.replace(/\b___(\S[\s\S]*?)___\b/g,function(l,g){return"<u>"+g+"</u>"}),a=a.replace(/\b__(\S[\s\S]*?)__\b/g,function(l,g){return"<u>"+g+"</u>"})):(a=a.replace(/___(\S[\s\S]*?)___/g,function(l,g){return/\S$/.test(g)?"<u>"+g+"</u>":l}),a=a.replace(/__(\S[\s\S]*?)__/g,function(l,g){return/\S$/.test(g)?"<u>"+g+"</u>":l})),a=a.replace(/(_)/g,t.helper.escapeCharactersCallback),a=d.converter._dispatch("underline.after",a,o,d)),a}),t.subParser("unescapeSpecialChars",function(a,o,d){return a=d.converter._dispatch("unescapeSpecialChars.before",a,o,d),a=a.replace(/E(\d+)E/g,function(l,g){var m=parseInt(g);return String.fromCharCode(m)}),a=d.converter._dispatch("unescapeSpecialChars.after",a,o,d),a}),t.subParser("makeMarkdown.blockquote",function(a,o){var d="";if(a.hasChildNodes())for(var l=a.childNodes,g=l.length,m=0;m<g;++m){var _=t.subParser("makeMarkdown.node")(l[m],o);_!==""&&(d+=_)}return d=d.trim(),d="> "+d.split(`
`).join(`
> `),d}),t.subParser("makeMarkdown.codeBlock",function(a,o){var d=a.getAttribute("language"),l=a.getAttribute("precodenum");return"```"+d+`
`+o.preList[l]+"\n```"}),t.subParser("makeMarkdown.codeSpan",function(a){return"`"+a.innerHTML+"`"}),t.subParser("makeMarkdown.emphasis",function(a,o){var d="";if(a.hasChildNodes()){d+="*";for(var l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);d+="*"}return d}),t.subParser("makeMarkdown.header",function(a,o,d){var l=new Array(d+1).join("#"),g="";if(a.hasChildNodes()){g=l+" ";for(var m=a.childNodes,_=m.length,I=0;I<_;++I)g+=t.subParser("makeMarkdown.node")(m[I],o)}return g}),t.subParser("makeMarkdown.hr",function(){return"---"}),t.subParser("makeMarkdown.image",function(a){var o="";return a.hasAttribute("src")&&(o+="!["+a.getAttribute("alt")+"](",o+="<"+a.getAttribute("src")+">",a.hasAttribute("width")&&a.hasAttribute("height")&&(o+=" ="+a.getAttribute("width")+"x"+a.getAttribute("height")),a.hasAttribute("title")&&(o+=' "'+a.getAttribute("title")+'"'),o+=")"),o}),t.subParser("makeMarkdown.links",function(a,o){var d="";if(a.hasChildNodes()&&a.hasAttribute("href")){var l=a.childNodes,g=l.length;d="[";for(var m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);d+="](",d+="<"+a.getAttribute("href")+">",a.hasAttribute("title")&&(d+=' "'+a.getAttribute("title")+'"'),d+=")"}return d}),t.subParser("makeMarkdown.list",function(a,o,d){var l="";if(!a.hasChildNodes())return"";for(var g=a.childNodes,m=g.length,_=a.getAttribute("start")||1,I=0;I<m;++I)if(!(typeof g[I].tagName>"u"||g[I].tagName.toLowerCase()!=="li")){var V="";d==="ol"?V=_.toString()+". ":V="- ",l+=V+t.subParser("makeMarkdown.listItem")(g[I],o),++_}return l+=`
<!-- -->
`,l.trim()}),t.subParser("makeMarkdown.listItem",function(a,o){for(var d="",l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);return/\n$/.test(d)?d=d.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):d+=`
`,d}),t.subParser("makeMarkdown.node",function(a,o,d){d=d||!1;var l="";if(a.nodeType===3)return t.subParser("makeMarkdown.txt")(a,o);if(a.nodeType===8)return"<!--"+a.data+`-->

`;if(a.nodeType!==1)return"";var g=a.tagName.toLowerCase();switch(g){case"h1":d||(l=t.subParser("makeMarkdown.header")(a,o,1)+`

`);break;case"h2":d||(l=t.subParser("makeMarkdown.header")(a,o,2)+`

`);break;case"h3":d||(l=t.subParser("makeMarkdown.header")(a,o,3)+`

`);break;case"h4":d||(l=t.subParser("makeMarkdown.header")(a,o,4)+`

`);break;case"h5":d||(l=t.subParser("makeMarkdown.header")(a,o,5)+`

`);break;case"h6":d||(l=t.subParser("makeMarkdown.header")(a,o,6)+`

`);break;case"p":d||(l=t.subParser("makeMarkdown.paragraph")(a,o)+`

`);break;case"blockquote":d||(l=t.subParser("makeMarkdown.blockquote")(a,o)+`

`);break;case"hr":d||(l=t.subParser("makeMarkdown.hr")(a,o)+`

`);break;case"ol":d||(l=t.subParser("makeMarkdown.list")(a,o,"ol")+`

`);break;case"ul":d||(l=t.subParser("makeMarkdown.list")(a,o,"ul")+`

`);break;case"precode":d||(l=t.subParser("makeMarkdown.codeBlock")(a,o)+`

`);break;case"pre":d||(l=t.subParser("makeMarkdown.pre")(a,o)+`

`);break;case"table":d||(l=t.subParser("makeMarkdown.table")(a,o)+`

`);break;case"code":l=t.subParser("makeMarkdown.codeSpan")(a,o);break;case"em":case"i":l=t.subParser("makeMarkdown.emphasis")(a,o);break;case"strong":case"b":l=t.subParser("makeMarkdown.strong")(a,o);break;case"del":l=t.subParser("makeMarkdown.strikethrough")(a,o);break;case"a":l=t.subParser("makeMarkdown.links")(a,o);break;case"img":l=t.subParser("makeMarkdown.image")(a,o);break;default:l=a.outerHTML+`

`}return l}),t.subParser("makeMarkdown.paragraph",function(a,o){var d="";if(a.hasChildNodes())for(var l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);return d=d.trim(),d}),t.subParser("makeMarkdown.pre",function(a,o){var d=a.getAttribute("prenum");return"<pre>"+o.preList[d]+"</pre>"}),t.subParser("makeMarkdown.strikethrough",function(a,o){var d="";if(a.hasChildNodes()){d+="~~";for(var l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);d+="~~"}return d}),t.subParser("makeMarkdown.strong",function(a,o){var d="";if(a.hasChildNodes()){d+="**";for(var l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o);d+="**"}return d}),t.subParser("makeMarkdown.table",function(a,o){var d="",l=[[],[]],g=a.querySelectorAll("thead>tr>th"),m=a.querySelectorAll("tbody>tr"),_,I;for(_=0;_<g.length;++_){var V=t.subParser("makeMarkdown.tableCell")(g[_],o),F="---";if(g[_].hasAttribute("style")){var j=g[_].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(j){case"text-align:left;":F=":---";break;case"text-align:right;":F="---:";break;case"text-align:center;":F=":---:";break}}l[0][_]=V.trim(),l[1][_]=F}for(_=0;_<m.length;++_){var W=l.push([])-1,A=m[_].getElementsByTagName("td");for(I=0;I<g.length;++I){var H=" ";typeof A[I]<"u"&&(H=t.subParser("makeMarkdown.tableCell")(A[I],o)),l[W].push(H)}}var q=3;for(_=0;_<l.length;++_)for(I=0;I<l[_].length;++I){var X=l[_][I].length;X>q&&(q=X)}for(_=0;_<l.length;++_){for(I=0;I<l[_].length;++I)_===1?l[_][I].slice(-1)===":"?l[_][I]=t.helper.padEnd(l[_][I].slice(-1),q-1,"-")+":":l[_][I]=t.helper.padEnd(l[_][I],q,"-"):l[_][I]=t.helper.padEnd(l[_][I],q);d+="| "+l[_].join(" | ")+` |
`}return d.trim()}),t.subParser("makeMarkdown.tableCell",function(a,o){var d="";if(!a.hasChildNodes())return"";for(var l=a.childNodes,g=l.length,m=0;m<g;++m)d+=t.subParser("makeMarkdown.node")(l[m],o,!0);return d.trim()}),t.subParser("makeMarkdown.txt",function(a){var o=a.nodeValue;return o=o.replace(/ +/g," "),o=o.replace(/NBSP;/g," "),o=t.helper.unescapeHTMLEntities(o),o=o.replace(/([*_~|`])/g,"\\$1"),o=o.replace(/^(\s*)>/g,"\\$1>"),o=o.replace(/^#/gm,"\\#"),o=o.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),o=o.replace(/^( {0,3}\d+)\./gm,"$1\\."),o=o.replace(/^( {0,3})([+-])/gm,"$1\\$2"),o=o.replace(/]([\s]*)\(/g,"\\]$1\\("),o=o.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),o});var N=this;r.exports?r.exports=t:N.showdown=t}).call(hr)})(ms);var Zu=ms.exports;async function ys(){Q.MAINHELP.innerHTML=`
        <div id="helpWindowContainer">
            <div id="helpMarkdownContainer"></div>
        <footer>
            <span id="helpReturnContainer"></span>
        </footer>
        </div>
        `;const e=new Zu.Converter().makeHtml(Q.MARKDOWNHELP),n=document.getElementById("helpMarkdownContainer");n.innerHTML=e;const t=document.getElementById("helpReturnContainer"),i=document.createElement("input");i.type="button",i.id="returnButton",i.title="Return to Initiative List",i.value="Return",i.onclick=async function(){hs(!1)},t?.append(i)}class Qu{DISABLEMYFOCUS="";viewHeader;viewBody;viewFooter;viewCounter;windowWidth=350;currentTurnUnit;roundCounter=1;turnCounter=0;RenderWaiting(e){e?(ie.KillHandlers(),Q.MAINAPP.hidden=!0,Q.MAINLOAD.hidden=!1):(Q.MAINAPP.hidden=!1,Q.MAINLOAD.hidden=!0)}async Render(){Q.MAINAPP.innerHTML=Q.PLAYERLIST,this.viewHeader=document.querySelector("#clashPLViewHeader"),this.viewBody=document.querySelector("#clashPLViewBody"),this.viewFooter=document.querySelector("#clashPLViewButtons"),this.viewCounter=document.querySelector("#roundCounterContainer"),this.roundCounter=On(U.ROUNDCOUNT)??1,this.turnCounter=On(U.TURNCOUNT)??0,this.DISABLEMYFOCUS=`${Q.EXTENSIONID}/setting_disablefocus_${ie.playerId}`,this.SetupFocusSlider(),Vu(),ls(),ys();const e=document.getElementById("clashPLViewBody");e&&e.addEventListener("dblclick",n=>Tn.FocusUnit(n)),await this.RefreshList()}async RefreshList(){const e=ie.sceneItems.filter(p=>p.metadata[D.ONLIST]===!0);let n=0;const t=Va(ie.playerColor,.9),i=["INIT"];(ie.roomMetadata[U.ROLLERROW]??!0)&&i.push("ROLL"),i.push("NAME"),(ie.roomMetadata[U.HPROW]??!0)&&i.push("HP"),ie.roomMetadata[U.TEMPHPROW]&&i.push("TEMPHP"),(ie.roomMetadata[U.ACROW]??!0)&&i.push("AC"),ie.roomMetadata[U.MOVEROW]&&i.push("MOVE"),ie.roomMetadata[U.ELEVATEROW]&&i.push("ELEVATE"),ie.roomMetadata[U.EFXROW]&&i.push("EFX");let s;ie.roomMetadata[U.REVERSELIST]?s=e.sort((p,y)=>Ue(p,D.INITIATIVE)-Ue(y,D.INITIATIVE)||Ue(p,D.UNITNAME).localeCompare(Ue(y,D.UNITNAME))):s=e.sort((p,y)=>Ue(y,D.INITIATIVE)-Ue(p,D.INITIATIVE)||Ue(p,D.UNITNAME).localeCompare(Ue(y,D.UNITNAME))),this.viewHeader.innerHTML="",this.viewBody.innerHTML="";const u=this.viewHeader.insertRow(-1),h=Ka();if(u.appendChild(h),n+=1,i.includes("ROLL")){const p=$a();u.appendChild(p),n+=1}const c=Wa();if(u.appendChild(c),n+=3,i.includes("HP")){const p=za();u.appendChild(p),n+=2}if(i.includes("TEMPHP")){const p=qa();u.appendChild(p),n+=1}if(i.includes("AC")){const p=Ga();u.appendChild(p),n+=1}if(i.includes("MOVE")){const p=Ya();u.appendChild(p),n+=1}if(i.includes("ELEVATE")){const p=Xa();u.appendChild(p),n+=1}if(i.includes("EFX")){const p=Ja();u.appendChild(p),n+=1}const b=Za();if(u.appendChild(b),n>7){const p=360+(n-7)*25;p!==this.windowWidth&&(await $.action.setWidth(p),this.windowWidth=p)}else this.windowWidth!==400&&(await $.action.setWidth(350),this.windowWidth=350);for(const p of s){const y=ie.playerId===p.createdUserId,w=this.viewBody.insertRow(-1);p.visible||(w.style.display="none"),w.setAttribute("unit-id",p.id);let T=0;const R=w.insertCell(T),S=Qa(p);if(this.Disable(S,y),R.appendChild(S),T++,i.includes("ROLL")){const C=w.insertCell(T);C.style.textAlign="center";const N=es(p);this.Disable(N,y),C.appendChild(N),T++}const O=w.insertCell(T),P=ts(p);if(y&&(P.style.borderColor=t,P.style.borderWidth="2px"),!se(U.HIDEHP)){const C=Ue(p,D.CURRENTHP),N=Ue(p,D.MAXHP);C<=N/4?P.classList.add("unit-harmed"):C<=N/2?P.classList.add("unit-hurt"):P.classList.add("unit-happy")}if(this.Disable(P,y),O.appendChild(P),O.classList.add("name-cell"),T++,i.includes("HP")){const C=w.insertCell(T);C.style.display="flex",C.style.marginTop="4px";const N=ns(p);this.Disable(N,y);const a=rs(p);this.Disable(a,y),C.appendChild(N),(!se(U.HIDEENEMYINFO)||y)&&C.appendChild(document.createTextNode("/")),C.appendChild(a),T++}if(i.includes("TEMPHP")){const C=w.insertCell(T),N=is(p);this.Disable(N,y),C.appendChild(N),T++}if(i.includes("AC")){const C=w.insertCell(T),N=as(p);this.Disable(N,y),C.appendChild(N),T++}if(i.includes("MOVE")){const C=w.insertCell(T),N=os(p);y||(N.innerText="",N.classList.remove("information"),N.setAttribute("data-information","")),C.appendChild(N),T++}if(i.includes("ELEVATE")){const C=w.insertCell(T);C.style.justifyContent="center";const N=ss(p);this.Disable(N,y),C.appendChild(N),T++}if(i.includes("EFX")){const C=w.insertCell(T);C.style.textAlign="left",C.style.paddingLeft="10px",C.colSpan=2;const N=us(p);this.Disable(N,y),C.appendChild(N),T++}w.insertCell(T)}this.ShowTurnSelection()}ShowTurnSelection(){const e=this.viewBody;if(e&&e.rows?.length>0){for(var n=0,t;t=e.rows[n];n++)t.classList.remove("turn-outline");if(this.turnCounter>=e.rows.length&&(this.turnCounter=e.rows.length-1),e.rows[this.turnCounter]){const i=e.rows[this.turnCounter];i.classList.add("turn-outline");const s=i.getAttribute("unit-id");this.currentTurnUnit=ie.sceneItems.find(h=>h.id===s);const u=document.getElementById("roundCounter");u.innerText=`Round: ${this.roundCounter}`}}else this.currentTurnUnit=void 0}async FocusOnCurrentTurnUnit(){ie.roomMetadata[this.DISABLEMYFOCUS]===!0&&this.currentTurnUnit&&await Tn.CenterViewportOnImage(this.currentTurnUnit),await Dt.UpdateLabel()}Disable(e,n){n||(e.disabled=!0,e.classList.add("disabled"),e.classList.remove("clickable"),e.onclick=null,se(U.HIDEENEMYINFO)&&!e.classList.contains("unit-initiative")&&!e.classList.contains("unit-name-input")&&(e.hidden=!0))}SetupFocusSlider(){const e=document.getElementById("settingnoFocusContainer"),n=document.createElement("input");n.type="checkbox",n.value=se(this.DISABLEMYFOCUS)?"true":"false",n.checked=!!se(this.DISABLEMYFOCUS),n.onclick=async function(t){const i=t.target;await $.room.setMetadata({[`${Q.EXTENSIONID}/setting_disablefocus_${ie.playerId}`]:i.checked})},e?.insertBefore(n,e.firstChild)}}const kt=new Qu;class Dt{static async UpdateLabel(){const e=se(U.TURNTEXT),n=e?.trim().length===0||e===void 0?"":e,t=!!se(U.DISABLELABEL),i=ie.playerRole==="GM"?oe.currentTurnUnit:kt.currentTurnUnit,s=await $.scene.local.getItems([Q.LABEL]);if(await Dt.CleanupHPBars(),t||i===void 0)s&&await $.scene.local.deleteItems([Q.LABEL]);else if(s.length===0){const u=gs().fillColor("#ffffff").plainText(n).build();u.visible=!1,u.type="LABEL",u.id=Q.LABEL,u.style={backgroundColor:"#bb99ff",backgroundOpacity:.5,pointerDirection:"DOWN",pointerWidth:15,pointerHeight:15,cornerRadius:10},u.position={x:i.position.x,y:i.position.y-100},u.visible=!!i.visible,u.text.plainText=u.visible?n:n+`\r
(Hidden)`,u.attachedTo=i.id,u.disableAttachmentBehavior=["ROTATION","SCALE"],u.locked=!0,await $.scene.local.addItems([u])}else await $.scene.local.updateItems(u=>u.id==Q.LABEL,u=>{const h=ie.playerRole==="GM"?oe.currentTurnUnit:kt.currentTurnUnit;for(let c of u)c.position={x:h.position.x,y:h.position.y-100},c.visible=!!h.visible,c.text.plainText=c.visible?n:n+`\r
(Hidden)`,c.attachedTo=h.id,c.locked=!0})}static async CleanupHPBars(){const e=await $.scene.local.getItems(n=>n.metadata[D.HPBAR]===!0);if(e.length>0){const n=[];for(const t of e)ie.sceneItems.some(s=>s.id===t.attachedTo)||n.push(t.id);n.length>0&&await $.scene.local.deleteItems(n)}}static async UpdateElevation(){const e=ie.sceneItems.filter(i=>i.metadata[D.ONLIST]===!0),n=await $.scene.local.getItems(i=>i.id.startsWith("ELE")),t=n.map(i=>i.id);if(n.length>0||se(U.ELEVATEROW))if(se(U.ELEVATEROW)===!1)t.length>0&&await $.scene.local.deleteItems(t);else{await $.scene.local.deleteItems(t);let i=[];for(const s of e){const u=Dt.GetElevation(s);u&&i.push(u)}await $.scene.local.addItems(i)}}static async UpdateHealthBars(){const e=ie.sceneItems.filter(t=>t.metadata[D.ONLIST]===!0),n=await $.scene.local.getItems(t=>t.id.startsWith("LBL"));if(n.length>0||!se(U.HIDEHPBAR)){const t=n.map(i=>i.id);if(se(U.HIDEHPBAR)===!0)t.length>0&&await $.scene.local.deleteItems(t);else{await $.scene.local.deleteItems(t);let i=[];for(const s of e)i.push(Dt.GetHPBar(s));await $.scene.local.addItems(i)}}}static GetElevation(e){const t=ra(e,ie.gridDpi),i=Ue(e,D.ELEVATION)??null;if(i===null||i===0||i==="0"||isNaN(i))return;let s="";Ue(e,D.ELEVATION)>0?s="":Ue(e,D.ELEVATION)<0&&(s="");let u=i<0?-i:i;const h=`${s}${u}`,c=Hr().plainText(h).fontWeight(900).fillOpacity(.95).fillColor("white").strokeWidth(2).strokeColor("black").strokeOpacity(1).build();return c.position={x:t.min.x-40,y:t.min.y},c.text.style.fontSize=36,c.id="ELE"+e.id.slice(3),c.metadata[D.ELEVATION]=!0,c.metadata[D.ID]=e.id,c.type="TEXT",c.attachedTo=e.id,c.visible=!!e.visible,c.locked=!0,c.disableAttachmentBehavior=["ROTATION","SCALE"],c.text.style.fontFamily="Segoe UI",c.text.type="PLAIN",c.text.style.textAlign="CENTER",c}static GetHPBar(e){const t=ra(e,ie.gridDpi),i=this.GetHealthInformation(e);let s;return se(U.HPBARNUMBERS)===!0?(s=Hr().plainText(i.health).fontWeight(900).fillOpacity(.95).fillColor(i.color).strokeWidth(2).strokeColor("black").strokeOpacity(1).build(),s.position={x:t.max.x-(t.max.x-t.min.x)/2-30,y:t.max.y-55},s.text.style.fontSize=36):(s=Hr().plainText(i.health).fontWeight(800).fillOpacity(.85).fillColor(i.color).strokeWidth(1).strokeColor("black").strokeOpacity(1).build(),s.position={x:t.max.x-(t.max.x-t.min.x)/2-85,y:t.max.y-44},s.text.style.fontSize=24),s.id="LBL"+e.id.slice(3),s.metadata[D.HPBAR]=!0,s.metadata[D.ID]=e.id,s.type="TEXT",s.attachedTo=e.id,s.visible=!!e.visible,s.locked=!0,s.disableAttachmentBehavior=["ROTATION","SCALE"],s.text.style.fontFamily="Segoe UI",s.text.type="PLAIN",s.text.style.textAlign="CENTER",s}static GetHealthInformation(e){const n=Ue(e,D.CURRENTHP),t=Ue(e,D.MAXHP),i=Ue(e,D.TEMPHP);let s=this.getHealthPercentageString(n,t),u=this.getTempHealthPercentageString(i,t,s);return{color:this.getHealthColorString(n,t,i),health:u}}static getHealthPercentageString(e,n){const t=e/n*100;if(se(U.HPBARNUMBERS)===!0)return`${e}${n}`;switch(!0){case t==0:return" 0%";case t<=20:return" 20%";case t<=40:return" 40%";case t<=60:return" 60%";case t<=80:return" 80%";default:return" 100%"}}static getTempHealthPercentageString(e,n,t){if(e>0){if(se(U.HPBARNUMBERS)===!0)return t+`(${e})`;const i=e/n*100;switch(!0){case i==0:return" 0%";case i<=20:return""+t.substring(1);case i<=40:return""+t.substring(2);case i<=60:return""+t.substring(3);case i<=80:return""+t.substring(4);default:return" 100%"}}return t}static getHealthColorString(e,n,t){const i=e/n*100;switch(!0){case t>0:return"lightgrey";case i<=25:return"red";case i<=50:return"yellow";default:return"white"}}static async GetCTUFromRow(e){let n={id:"",visible:!1,xpos:0,ypos:0,dpi:0,width:0,height:0,offsetx:0,offsety:0};const t=e.getAttribute("unit-id"),i=await $.scene.items.getItems([t]);for(let s of i){const u=s;n={id:u.id,visible:u.visible,xpos:u.position.x,ypos:u.position.y,dpi:u.grid.dpi,width:u.image.width,height:u.image.height,offsetx:u.grid.offset.x,offsety:u.grid.offset.y}}return n}}class eo{currentTurnUnit;startEffectsDone=!1;lastTurnUnit;roundCounter=1;turnCounter=0;windowWidth=350;viewHeader;viewBody;viewFooter;viewCounter;viewPlayerList;addedColumns=[];RenderWaiting(e){e?(ie.KillHandlers(),Q.MAINAPP.hidden=!0,Q.MAINLOAD.hidden=!1):(Q.MAINAPP.hidden=!1,Q.MAINLOAD.hidden=!0)}async Render(){if(Q.MAINAPP.innerHTML=Q.BASELIST,this.viewHeader=document.querySelector("#clashGMViewHeader"),this.viewBody=document.querySelector("#clashGMViewBody"),this.viewFooter=document.querySelector("#clashGMViewButtons"),this.viewCounter=document.querySelector("#roundCounter"),this.viewPlayerList=document.querySelector("#playerListing"),Uu(),ot.inMemory){const t=document.createElement("div");t.innerText="Local Storage Disabled - Features Limited",t.className="noDatabase",Q.MAINAPP.prepend(t)}this.roundCounter=On(U.ROUNDCOUNT)??1,this.turnCounter=On(U.TURNCOUNT)??0,Ju(),ys(),ls();const e=document.getElementById("clashGMViewBody");e&&e.addEventListener("dblclick",t=>Tn.FocusUnit(t));const n=document.getElementById("playerListing");n.appendChild(this.GetEmptyContextItem()),n.appendChild(this.GetRemoveContextItem());for(const t of ie.party){const i=document.createElement("li");i.id=t.id,i.textContent=t.name,i.style.color=t.color,n.appendChild(i)}await this.RefreshList()}async RefreshList(){const e=ie.sceneItems.filter(b=>b.metadata[D.ONLIST]===!0);let n=0;const t=["INIT"];(ie.roomMetadata[U.ROLLERROW]??!0)&&t.push("ROLL"),t.push("NAME"),(ie.roomMetadata[U.HPROW]??!0)&&t.push("HP"),ie.roomMetadata[U.TEMPHPROW]&&t.push("TEMPHP"),(ie.roomMetadata[U.ACROW]??!0)&&t.push("AC"),ie.roomMetadata[U.MOVEROW]&&t.push("MOVE"),ie.roomMetadata[U.ELEVATEROW]&&t.push("ELEVATE"),ie.roomMetadata[U.EFXROW]&&t.push("EFX"),(ie.roomMetadata[U.BLOCKROW]??!0)&&t.push("BLOCK");let i;ie.roomMetadata[U.REVERSELIST]?i=e.sort((b,p)=>Ue(b,D.INITIATIVE)-Ue(p,D.INITIATIVE)||Ue(b,D.UNITNAME).localeCompare(Ue(p,D.UNITNAME))):i=e.sort((b,p)=>Ue(p,D.INITIATIVE)-Ue(b,D.INITIATIVE)||Ue(b,D.UNITNAME).localeCompare(Ue(p,D.UNITNAME))),this.viewHeader.innerHTML="",this.viewBody.innerHTML="";const s=this.viewHeader.insertRow(-1),u=Ka();if(s.appendChild(u),n+=1,t.includes("ROLL")){const b=$a();s.appendChild(b),n+=1}const h=Wa();if(s.appendChild(h),n+=3,t.includes("HP")){const b=za();s.appendChild(b),n+=2}if(t.includes("TEMPHP")){const b=qa();s.appendChild(b),n+=1}if(t.includes("AC")){const b=Ga();s.appendChild(b),n+=1}if(t.includes("MOVE")){const b=Ya();s.appendChild(b),n+=1}if(t.includes("ELEVATE")){const b=Xa();s.appendChild(b),n+=1}if(t.includes("EFX")){const b=Ja();s.appendChild(b),n+=1}t.includes("BLOCK")&&(n+=1);const c=Za();if(s.appendChild(c),n>7){const b=360+(n-7)*25;b!==this.windowWidth&&(await $.action.setWidth(b),this.windowWidth=b)}else this.windowWidth!==400&&(await $.action.setWidth(350),this.windowWidth=350);for(const b of i){const p=this.viewBody.insertRow(-1);p.setAttribute("unit-id",b.id);let y=0;const w=p.insertCell(y),T=Qa(b);if(w.appendChild(T),y++,t.includes("ROLL")){const O=p.insertCell(y);O.style.textAlign="center";const P=es(b);O.appendChild(P),y++}const R=p.insertCell(y),S=ts(b);if(b.visible===!1&&(S.value="(Hidden) "+S.value),R.appendChild(S),R.classList.add("name-cell"),y++,t.includes("HP")){const O=p.insertCell(y);O.style.display="flex",O.style.marginTop="4px";const P=ns(b),C=rs(b);O.appendChild(P),O.appendChild(document.createTextNode("/")),O.appendChild(C),y++}if(t.includes("TEMPHP")){const O=p.insertCell(y),P=is(b);O.appendChild(P),y++}if(t.includes("AC")){const O=p.insertCell(y),P=as(b);O.appendChild(P),y++}if(t.includes("MOVE")){const O=p.insertCell(y),P=os(b);O.appendChild(P),y++}if(t.includes("ELEVATE")){const O=p.insertCell(y);O.style.justifyContent="center";const P=ss(b);O.appendChild(P),y++}if(t.includes("EFX")){const O=p.insertCell(y);O.style.textAlign="center";const P=us(b);O.appendChild(P),t.includes("BLOCK")||(O.colSpan=2,O.style.textAlign="left",O.style.paddingLeft="10px"),y++}if(t.includes("BLOCK")){const O=p.insertCell(y),P=Hu(b);O.appendChild(P)}else p.insertCell(y)}this.ShowTurnSelection()}ShowTurnSelection(){const e=document.getElementById("clashGMViewBody");if(e&&e.rows?.length>0){for(var n=0,t;t=e.rows[n];n++)t.classList.remove("turn-outline");if(this.turnCounter>=e.rows.length&&(this.turnCounter=e.rows.length-1),e.rows[this.turnCounter]){const i=e.rows[this.turnCounter];i.classList.add("turn-outline");const s=i.getAttribute("unit-id");this.currentTurnUnit=ie.sceneItems.find(h=>h.id===s);const u=document.getElementById("roundCounter");u.innerText=`Round: ${this.roundCounter}`,this.currentTurnUnit&&!this.startEffectsDone&&this.HandleEffects(this.currentTurnUnit,"Start")}}else this.currentTurnUnit=void 0}async HandleEffects(e,n){if(this.startEffectsDone=!0,se(U.EFXROW)===!0){const t=[],i=[],s=e.metadata[D.EFFECTS];if(s&&s.length>0){for(let u=0;u<s.length;u++){const h=s[u];h.EndingRound===this.roundCounter&&h.StartOfTurn===n?i.push(h.Name):t.push(h)}await $.scene.items.updateItems([e.id],u=>{for(const h of u)t.length>0?h.metadata[D.EFFECTS]=t:h.metadata[D.EFFECTS]=void 0})}if(i.length>0){const u=new Date().toISOString(),h=`The following effects have expired for ${e.metadata[D.UNITNAME]}: ${i.join(", ")}`;await $.player.setMetadata({[`${Q.EXTENSIONID}/metadata_effect_notify`]:{message:h,created:u}})}}}async FocusOnCurrentTurnUnit(){ie.playerRole==="GM"&&(this.currentTurnUnit&&ie.roomMetadata[U.DISABLEFOCUS]!==!0&&await Tn.CenterViewportOnImage(this.currentTurnUnit),await Dt.UpdateLabel())}GetEmptyContextItem(){const e=document.createElement("li");return e.id=ie.playerId,e.textContent="No Owner",e}GetRemoveContextItem(){const e=document.createElement("li");return e.id="REMOVE",e.textContent="Remove Unit",e}}const oe=new eo;async function to(r,e,n=!1){const t=await $.room.getMetadata(),i=t[U.RUMBLELOG],s=new Date().toISOString();await no(r,t,e),await $.player.setMetadata(i?{[`${Q.EXTENSIONID}/metadata_chatlog`]:{chatlog:r,sender:"Clash!",senderId:"Clash0000",targetId:"0000",created:s,color:"#ff9294",critical:n},[`${Q.EXTENSIONID}/metadata_rolllog`]:{chatlog:r,sender:e,created:s,color:"#ff9294",critical:n}}:{[`${Q.EXTENSIONID}/metadata_rolllog`]:{chatlog:r,sender:e,created:s,color:"#ff9294",critical:n}})}async function no(r,e,n){const t=e[U.DISCORDHOOK],i=e[U.DISCORDURL];if(!t||!i||i.length<10)return;const s=new XMLHttpRequest;s.open("POST",i),s.setRequestHeader("Content-type","application/json");const u={username:"Clash! : "+n,avatar_url:"https://battle-system.com/owlbear/clash-docs/logo.png",content:r};s.send(JSON.stringify(u))}class ro{messageCounter;constructor(){this.messageCounter={}}IsThisOld(e,n,t="DEFAULT"){const i=`${n}_${t}}`,s=this.messageCounter[i];return s?s!==e?(this.messageCounter[i]=e,!1):!0:(this.messageCounter[i]=e,!1)}async HandleBonesMessage(e){const n=document.querySelector("#rollLog"),t=new Date().toLocaleTimeString(),i=e[`${Q.BONESID}/metadata_logroll`];if(i!==void 0&&!this.IsThisOld(i.created,"BONES","DICE")){const s=document.createElement("li"),u=document.createElement("li");s.className="clashAuthor",s.style.color=i.senderColor,s.innerText=`[${t}] - ${i.senderName}`,u.className="clashLog",u.innerHTML=i.rollHtml,n.append(s),n.append(u);const h=/<\/?[^>]+>/gi,c=i.rollHtml.replace(h,""),b=`${i.senderName} ... ${c}!`;await to(b,i.senderName)}}async HandleMessage(e){const n=document.querySelector("#rollLog"),t=new Date().toLocaleTimeString();if(e[`${Q.EXTENSIONID}/metadata_effect_notify`]!=null){const i=e[`${Q.EXTENSIONID}/metadata_effect_notify`];this.IsThisOld(i.created,"CLASH","EFFECT")||await $.notification.show(i.message,"INFO")}if(e[`${Q.EXTENSIONID}/metadata_rolllog`]!=null){const i=e[`${Q.EXTENSIONID}/metadata_rolllog`];if(!this.IsThisOld(i.created,"CLASH","DICE")){const s=i.chatlog,u=document.createElement("li"),h=document.createElement("li");u.className="clashAuthor",u.style.color=i.color,u.innerText=`[${t}] - ${i.sender}`,h.className=i.critical?"clashLog glow":"clashLog",h.innerText="..."+s.replace(i.sender,"").trim(),n.append(u),n.append(h),se(U.DICENOTIFICATION)&&await $.notification.show(s,"INFO")}}}}const fr=new ro;class Le{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static ROOMMETA="ROOMMETADATA";debouncedOnSceneItemsChange;debouncedOnSceneMetadataChange;debouncedOnRoomMetadataChange;playerId;playerColor;playerName;playerMetadata;playerRole;party;gridDpi;gridScale;sceneItems;sceneSelected;sceneMetadata;sceneReady;roomMetadata;oldRoomMetadata;openUnitPopover;theme;caches;sceneMetadataHandler;sceneItemsHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.sceneItems=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.sceneReady=!1,this.theme="DARK",this.roomMetadata={},this.oldRoomMetadata={},this.openUnitPopover="",this.caches=e,this.debouncedOnSceneItemsChange=Yr(this.OnSceneItemsChange.bind(this),100),this.debouncedOnSceneMetadataChange=Yr(this.OnSceneMetadataChanges.bind(this),100),this.debouncedOnRoomMetadataChange=Yr(this.OnRoomMetadataChange.bind(this),100)}async InitializeCache(){this.sceneReady=await $.scene.isReady(),this.theme=await $.theme.getTheme(),na(this.theme,document),this.caches.includes(Le.PLAYER)&&(this.playerId=await $.player.getId(),this.playerName=await $.player.getName(),this.playerColor=await $.player.getColor(),this.playerMetadata=await $.player.getMetadata(),this.playerRole=await $.player.getRole()),this.caches.includes(Le.PARTY)&&(this.party=await $.party.getPlayers()),this.caches.includes(Le.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await $.scene.items.getItems()),this.caches.includes(Le.SCENEMETA)&&this.sceneReady&&(this.sceneMetadata=await $.scene.getMetadata()),this.caches.includes(Le.SCENEGRID)&&this.sceneReady&&(this.gridDpi=await $.scene.grid.getDpi(),this.gridScale=(await $.scene.grid.getScale()).parsed?.multiplier??5),this.caches.includes(Le.ROOMMETA)&&(this.roomMetadata=await $.room.getMetadata())}KillHandlers(){this.caches.includes(Le.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(Le.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(Le.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(Le.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(Le.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(Le.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(Le.SCENEMETA)&&(this.sceneMetadataHandler=$.scene.onMetadataChange(async e=>{this.debouncedOnSceneMetadataChange(e),this.sceneMetadata=e})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(Le.SCENEITEMS)&&(this.sceneItemsHandler=$.scene.items.onChange(async e=>{this.debouncedOnSceneItemsChange(e),this.sceneItems=e})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(Le.SCENEGRID)&&(this.sceneGridHandler=$.scene.grid.onChange(async e=>{this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale),await this.OnSceneGridChange(e)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(Le.PLAYER)&&(this.playerHandler=$.player.onChange(async e=>{this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e)})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(Le.PARTY)&&(this.partyHandler=$.party.onChange(async e=>{this.party=e,await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(Le.ROOMMETA)&&(this.roomHandler=$.room.onMetadataChange(async e=>{this.roomMetadata=e,this.debouncedOnRoomMetadataChange(e)})),this.themeHandler===void 0&&(this.themeHandler=$.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=$.scene.onReadyChange(async e=>{this.sceneReady=e,this.playerRole==="GM"?oe.currentTurnUnit=void 0:kt.currentTurnUnit=void 0,e&&(this.sceneItems=await $.scene.items.getItems(),this.sceneMetadata=await $.scene.getMetadata(),this.gridDpi=await $.scene.grid.getDpi(),this.gridScale=(await $.scene.grid.getScale()).parsed?.multiplier??5),await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){this.playerRole==="GM"?(oe.ShowTurnSelection(),oe.FocusOnCurrentTurnUnit()):(kt.turnCounter=On(U.TURNCOUNT),kt.roundCounter=On(U.ROUNDCOUNT),kt.ShowTurnSelection(),kt.FocusOnCurrentTurnUnit())}async OnSceneItemsChange(e){if(this.sceneReady){if(this.playerRole==="GM"){if(se(U.RANDOMNAME)??!0){const t=[],i=[];for(const s of e){if(s.metadata[D.ONLIST]!==!0)continue;const u=s.name;t.includes(u)?i.push(s):t.push(u)}for(let s of i)s.name=Fu(s.name);i.length>0&&await $.scene.items.updateItems(i.map(s=>s.id),s=>{for(let u of s){const h=i.find(c=>c.id===u.id);h&&(se(U.NAMELABELS)&&(u.text.plainText=h.name),u.name=h.name,u.metadata[D.UNITNAME]=h.name)}})}await oe.RefreshList()}else await kt.RefreshList();await Dt.UpdateHealthBars(),await Dt.UpdateElevation(),await Dt.UpdateLabel()}}async OnSceneGridChange(e){}async OnSceneReadyChange(e){this.playerRole==="GM"?oe.RenderWaiting(!e):kt.RenderWaiting(!e),e&&(this.SetupHandlers(),this.playerRole==="GM"?await oe.Render():await kt.Render(),this.playerRole==="GM"?await oe.RefreshList():await kt.RefreshList())}async OnPlayerChange(e){this.sceneSelected=e.selection?e.selection:[],await fr.HandleMessage(e.metadata);const n=document.querySelectorAll(".unit-name-input");for(let t=0;t<n.length;t++){const i=n[t],u=i.id.substring(2);this.sceneSelected.includes(u)?i.classList.add("selected"):i.classList.remove("selected")}se(U.BONESROLL)&&await fr.HandleBonesMessage(e.metadata)}async OnPartyChange(e){if(oe.viewPlayerList){oe.viewPlayerList.innerHTML="",oe.viewPlayerList.appendChild(oe.GetEmptyContextItem()),oe.viewPlayerList.appendChild(oe.GetRemoveContextItem());for(const n of e){const t=document.createElement("li");t.id=n.id,t.textContent=n.name,t.style.color=n.color,oe.viewPlayerList.appendChild(t)}}if(se(U.DICEEVERYONE))for(const n of e)n.role==="GM"&&await fr.HandleMessage(n.metadata);if(se(U.EFXROW))for(const n of e)n.role==="GM"&&await fr.HandleMessage(n.metadata)}async OnRoomMetadataChange(e){if(await Dt.UpdateHealthBars(),await Dt.UpdateElevation(),await Dt.UpdateLabel(),this.playerRole==="PLAYER"&&(await kt.RefreshList(),se(U.HIDEALL)===!0?(Q.MAINDISABLED.style.display="block",Q.MAINAPP.style.display="none",Q.MAINLOG.style.display="none"):(Q.MAINDISABLED.style.display="none",Q.MAINAPP.style.display="block",Q.MAINLOG.style.display="none")),this.oldRoomMetadata[U.NAMELABELS]!==!0&&e[U.NAMELABELS]===!0){const n=this.sceneItems.filter(t=>t.metadata[D.ONLIST]===!0);n.length>0&&await $.scene.items.updateItems(n,t=>{for(const i of t)i.text.plainText=i.name})}else if(this.oldRoomMetadata[U.NAMELABELS]!==!1&&e[U.NAMELABELS]===!1){const n=this.sceneItems.filter(t=>t.metadata[D.ONLIST]===!0);n.length>0&&await $.scene.items.updateItems(n,t=>{for(const i of t)i.text.plainText=""})}this.oldRoomMetadata=e}async OnThemeChange(e){na(e,document)}}const ie=new Le([Le.ROOMMETA,Le.SCENEGRID,Le.SCENEMETA,Le.SCENEITEMS,Le.PLAYER,Le.PARTY]);export{Fu as A,ie as B,oo as C,oe as G,uo as I,Yu as O,kt as P,se as R,to as S,so as T,Xu as U,Nu as a,na as b,ot as d,ao as g,ws as i};
