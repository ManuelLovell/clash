var gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const Se=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pe=Object.keys,Ge=Array.isArray;function Qe(n,e){return typeof e!="object"||Pe(e).forEach(function(t){n[t]=e[t]}),n}typeof Promise>"u"||Se.Promise||(Se.Promise=Promise);const En=Object.getPrototypeOf,vs={}.hasOwnProperty;function lt(n,e){return vs.call(n,e)}function fn(n,e){typeof e=="function"&&(e=e(En(n))),(typeof Reflect>"u"?Pe:Reflect.ownKeys)(e).forEach(t=>{Pt(n,t,e[t])})}const Ii=Object.defineProperty;function Pt(n,e,t,r){Ii(n,e,Qe(t&&lt(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function un(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Pt(n.prototype,"constructor",n),{extend:fn.bind(null,n.prototype)}}}}const gs=Object.getOwnPropertyDescriptor;function ei(n,e){let t;return gs(n,e)||(t=En(n))&&ei(t,e)}const ws=[].slice;function rr(n,e,t){return ws.call(n,e,t)}function Pi(n,e){return e(n)}function bn(n){if(!n)throw new Error("Assertion Failed")}function ki(n){Se.setImmediate?setImmediate(n):setTimeout(n,0)}function Ri(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function kt(n,e){if(lt(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=kt(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var c=n[e.substr(0,o)];return c===void 0?void 0:kt(c,e.substr(o+1))}}function wt(n,e,t){if(n&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){bn(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)wt(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),c=e.substr(s+1);if(c==="")t===void 0?Ge(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var u=n[o];u&&lt(n,o)||(u=n[o]={}),wt(u,c,t)}}else t===void 0?Ge(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Ni(n){var e={};for(var t in n)lt(n,t)&&(e[t]=n[t]);return e}const As=[].concat;function Ki(n){return As.apply([],n)}const Mi="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ki([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>Se[n]),_s=Mi.map(n=>Se[n]);Ri(Mi,n=>[n,!0]);let qt=null;function kn(n){qt=typeof WeakMap<"u"&&new WeakMap;const e=Fr(n);return qt=null,e}function Fr(n){if(!n||typeof n!="object")return n;let e=qt&&qt.get(n);if(e)return e;if(Ge(n)){e=[],qt&&qt.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(Fr(n[t]))}else if(_s.indexOf(n.constructor)>=0)e=n;else{const s=En(n);for(var i in e=s===Object.prototype?{}:Object.create(s),qt&&qt.set(n,e),n)lt(n,i)&&(e[i]=Fr(n[i]))}return e}const{toString:Ss}={};function Br(n){return Ss.call(n).slice(8,-1)}const xr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Es=typeof xr=="symbol"?function(n){var e;return n!=null&&(e=n[xr])&&e.apply(n)}:function(){return null},an={};function jt(n){var e,t,r,i;if(arguments.length===1){if(Ge(n))return n.slice();if(this===an&&typeof n=="string")return[n];if(i=Es(n)){for(t=[];!(r=i.next()).done;)t.push(r.value);return t}if(n==null)return[n];if(typeof(e=n.length)=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}const ti=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Ct=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function qi(n,e){Ct=n,Li=e}var Li=()=>!0;const Cs=!new Error("").stack;function nn(){if(Cs)try{throw nn.arguments,new Error}catch(n){return n}return new Error}function jr(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(Li).map(r=>`
`+r).join("")):""}var Ui=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ni=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ui),Os={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function cn(n,e){this._e=nn(),this.name=n,this.message=e}function Vi(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function ir(n,e,t,r){this._e=nn(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=Vi(n,e)}function gn(n,e){this._e=nn(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=Vi(n,e)}un(cn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+jr(this._e,2))}},toString:function(){return this.name+": "+this.message}}),un(ir).from(cn),un(gn).from(cn);var ri=ni.reduce((n,e)=>(n[e]=e+"Error",n),{});const Ds=cn;var W=ni.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=nn(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Os[e]||t,this.inner=null)}return un(r).from(Ds),n[e]=r,n},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var di=Ui.reduce((n,e)=>(n[e+"Error"]=W[e],n),{}),Jn=ni.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=W[e]),n),{});function be(){}function Cn(n){return n}function Fs(n,e){return n==null||n===Cn?e:function(t){return e(n(t))}}function Zt(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function Bs(n,e){return n===be?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Zt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Zt(i,this.onerror):i),s!==void 0?s:t}}function xs(n,e){return n===be?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?Zt(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Zt(r,this.onerror):r)}}function js(n,e){return n===be?e:function(t){var r=n.apply(this,arguments);Qe(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Zt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Zt(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Qe(r,o)}}function Ts(n,e){return n===be?e:function(){return e.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function ii(n,e){return n===be?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Jn.ModifyError=ir,Jn.DexieError=cn,Jn.BulkError=gn;var On={};const $i=100,[Tr,sr,Ir]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,En(n),n];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,En(e),n]})(),Gi=sr&&sr.then,Xn=Tr&&Tr.constructor,si=!!Ir;var Pr=!1,Is=Ir?()=>{Ir.then(Ln)}:Se.setImmediate?setImmediate.bind(null,Ln):Se.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{Ln(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(Ln,0)},wn=function(n,e){vn.push([n,e]),or&&(Is(),or=!1)},kr=!0,or=!0,Jt=[],Qn=[],Rr=null,Nr=Cn,ln={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:mi,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{mi(n[0],n[1])}catch{}})}},$=ln,vn=[],Xt=0,Zn=[];function q(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=be,this._lib=!1;var e=this._PSD=$;if(Ct&&(this._stackHolder=nn(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==On)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Mr(this,this._value))}this._state=null,this._value=null,++e.ref,Wi(this,n)}const Kr={get:function(){var n=$,e=ar;function t(r,i){var s=!n.global&&(n!==$||e!==ar);const o=s&&!Rt();var c=new q((u,y)=>{oi(this,new Hi(ur(r,n,s,o),ur(i,n,s,o),u,y,n))});return Ct&&Ji(c,this),c}return t.prototype=On,t},set:function(n){Pt(this,"then",n&&n.prototype===On?Kr:{get:function(){return n},set:Kr.set})}};function Hi(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}function Wi(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&Rn();t&&typeof t.then=="function"?Wi(n,(i,s)=>{t instanceof q?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,Yi(n)),r&&Nn()}},Mr.bind(null,n))}catch(t){Mr(n,t)}}function Mr(n,e){if(Qn.push(e),n._state===null){var t=n._lib&&Rn();e=Nr(e),n._state=!1,n._value=e,Ct&&e!==null&&typeof e=="object"&&!e._promise&&function(r,i,s){try{r.apply(null,s)}catch(o){i&&i(o)}}(()=>{var r=ei(e,"stack");e._promise=n,Pt(e,"stack",{get:()=>Pr?r&&(r.get?r.get.apply(e):r.value):n.stack})}),function(r){Jt.some(i=>i._value===r._value)||Jt.push(r)}(n),Yi(n),t&&Nn()}}function Yi(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)oi(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),Xt===0&&(++Xt,wn(()=>{--Xt==0&&ai()},[]))}function oi(n,e){if(n._state!==null){var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++Xt,wn(Ps,[t,n,e])}else n._listeners.push(e)}function Ps(n,e,t){try{Rr=e;var r,i=e._value;e._state?r=n(i):(Qn.length&&(Qn=[]),r=n(i),Qn.indexOf(i)===-1&&function(s){for(var o=Jt.length;o;)if(Jt[--o]._value===s._value)return void Jt.splice(o,1)}(e)),t.resolve(r)}catch(s){t.reject(s)}finally{Rr=null,--Xt==0&&ai(),--t.psd.ref||t.psd.finalize()}}function zi(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i,s,o=n._value;o!=null?(i=o.name||"Error",s=o.message||o,r=jr(o,0)):(i=o,s=""),e.push(i+(s?": "+s:"")+r)}return Ct&&((r=jr(n._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),n._prev&&zi(n._prev,e,t)),e}function Ji(n,e){var t=e?e._numPrev+1:0;t<100&&(n._prev=e,n._numPrev=t)}function Ln(){Rn()&&Nn()}function Rn(){var n=kr;return kr=!1,or=!1,n}function Nn(){var n,e,t;do for(;vn.length>0;)for(n=vn,vn=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(vn.length>0);kr=!0,or=!0}function ai(){var n=Jt;Jt=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Zn.slice(0),t=e.length;t;)e[--t]()}function Un(n){return new q(On,!1,n)}function Oe(n,e){var t=$;return function(){var r=Rn(),i=$;try{return Vt(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{Vt(i,!1),r&&Nn()}}}fn(q.prototype,{then:Kr,_then:function(n,e){oi(this,new Hi(null,null,n,e,$))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):Un(r)):this.then(null,r=>r&&r.name===e?t(r):Un(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),Un(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Pr=!0;var n=zi(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{Pr=!1}}},timeout:function(n,e){return n<1/0?new q((t,r)=>{var i=setTimeout(()=>r(new W.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Pt(q.prototype,Symbol.toStringTag,"Dexie.Promise"),ln.env=Xi(),fn(q,{all:function(){var n=jt.apply(null,arguments).map(Vn);return new q(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>q.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof q)return n;if(n&&typeof n.then=="function")return new q((t,r)=>{n.then(t,r)});var e=new q(On,!0,n);return Ji(e,Rr),e},reject:Un,race:function(){var n=jt.apply(null,arguments).map(Vn);return new q((e,t)=>{n.map(r=>q.resolve(r).then(e,t))})},PSD:{get:()=>$,set:n=>$=n},totalEchoes:{get:()=>ar},newPSD:Ut,usePSD:pn,scheduler:{get:()=>wn,set:n=>{wn=n}},rejectionMapper:{get:()=>Nr,set:n=>{Nr=n}},follow:(n,e)=>new q((t,r)=>Ut((i,s)=>{var o=$;o.unhandleds=[],o.onunhandled=s,o.finalize=Zt(function(){(function(c){function u(){c(),Zn.splice(Zn.indexOf(u),1)}Zn.push(u),++Xt,wn(()=>{--Xt==0&&ai()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))}),Xn&&(Xn.allSettled&&Pt(q,"allSettled",function(){const n=jt.apply(null,arguments).map(Vn);return new q(e=>{n.length===0&&e([]);let t=n.length;const r=new Array(t);n.forEach((i,s)=>q.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),Xn.any&&typeof AggregateError<"u"&&Pt(q,"any",function(){const n=jt.apply(null,arguments).map(Vn);return new q((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length;const i=new Array(r);n.forEach((s,o)=>q.resolve(s).then(c=>e(c),c=>{i[o]=c,--r||t(new AggregateError(i))}))})}));const $e={awaits:0,echoes:0,id:0};var ks=0,er=[],wr=0,ar=0,Rs=0;function Ut(n,e,t,r){var i=$,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Rs;var o=ln.env;s.env=si?{Promise:q,PromiseProp:{value:q,configurable:!0,writable:!0},all:q.all,race:q.race,allSettled:q.allSettled,any:q.any,resolve:q.resolve,reject:q.reject,nthen:pi(o.nthen,s),gthen:pi(o.gthen,s)}:{},e&&Qe(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=pn(s,n,t,r);return s.ref===0&&s.finalize(),c}function dn(){return $e.id||($e.id=++ks),++$e.awaits,$e.echoes+=$i,$e.id}function Rt(){return!!$e.awaits&&(--$e.awaits==0&&($e.id=0),$e.echoes=$e.awaits*$i,!0)}function Vn(n){return $e.echoes&&n&&n.constructor===Xn?(dn(),n.then(e=>(Rt(),e),e=>(Rt(),Re(e)))):n}function Ns(n){++ar,$e.echoes&&--$e.echoes!=0||($e.echoes=$e.id=0),er.push($),Vt(n,!0)}function Ks(){var n=er[er.length-1];er.pop(),Vt(n,!1)}function Vt(n,e){var t=$;if((e?!$e.echoes||wr++&&n===$:!wr||--wr&&n===$)||Qi(e?Ns.bind(null,n):Ks),n!==$&&($=n,t===ln&&(ln.env=Xi()),si)){var r=ln.env.Promise,i=n.env;sr.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(Se,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Xi(){var n=Se.Promise;return si?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Se,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:sr.then,gthen:n.prototype.then}:{}}function pn(n,e,t,r,i){var s=$;try{return Vt(n,!0),e(t,r,i)}finally{Vt(s,!1)}}function Qi(n){Gi.call(Tr,n)}function ur(n,e,t,r){return typeof n!="function"?n:function(){var i=$;t&&dn(),Vt(e,!0);try{return n.apply(this,arguments)}finally{Vt(i,!1),r&&Qi(Rt)}}}function pi(n,e){return function(t,r){return n.call(this,ur(t,e),ur(r,e))}}(""+Gi).indexOf("[native code]")===-1&&(dn=Rt=be);const yi="unhandledrejection";function mi(n,e){var t;try{t=e.onuncatched(n)}catch{}if(t!==!1)try{var r,i={promise:e,reason:n};if(Se.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(yi,!0,!0),Qe(r,i)):Se.CustomEvent&&Qe(r=new CustomEvent(yi,{detail:i}),i),r&&Se.dispatchEvent&&(dispatchEvent(r),!Se.PromiseRejectionEvent&&Se.onunhandledrejection))try{Se.onunhandledrejection(r)}catch{}Ct&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var Re=q.reject;function qr(n,e,t,r){if(n.idbdb&&(n._state.openComplete||$.letThrough||n._vip)){var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===ri.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>qr(n,e,t,r))):Re(s)}return i._promise(e,(s,o)=>Ut(()=>($.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(n._state.openComplete)return Re(new W.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return Re(new W.DatabaseClosed);n.open().catch(be)}return n._state.dbReadyPromise.then(()=>qr(n,e,t,r))}const bi="3.2.4",zt=String.fromCharCode(65535),Lr=-1/0,Bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Zi="String expected.",An=[],yr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ms=yr,qs=yr,es=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),mr="__dbnames",Ar="readonly",_r="readwrite";function en(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}const ts={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function $n(n){return typeof n!="string"||/\./.test(n)?e=>e:e=>(e[n]===void 0&&n in e&&delete(e=kn(e))[n],e)}class Ls{_trans(e,t,r){const i=this._tx||$.trans,s=this.name;function o(u,y,p){if(!p.schema[s])throw new W.NotFound("Table "+s+" not part of transaction");return t(p.idbtrans,p)}const c=Rn();try{return i&&i.db===this.db?i===$.trans?i._promise(e,o,r):Ut(()=>i._promise(e,o,r),{trans:i,transless:$.transless||$}):qr(this.db,e,[this.name],o)}finally{c&&Nn()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ge(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=Pe(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(y=>y.compound&&t.every(p=>y.keyPath.indexOf(p)>=0)&&y.keyPath.every(p=>t.indexOf(p)>=0))[0];if(r&&this.db._maxKey!==zt)return this.where(r.name).equals(r.keyPath.map(y=>e[y]));!r&&Ct&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(y,p){try{return s.cmp(y,p)===0}catch{return!1}}const[c,u]=t.reduce(([y,p],f)=>{const d=i[f],g=e[f];return[y||d,y||!d?en(p,d&&d.multi?S=>{const m=kt(S,f);return Ge(m)&&m.some(w=>o(g,w))}:S=>o(g,kt(S,f))):p]},[null,null]);return c?this.where(c.name).equals(e[c.keyPath]).filter(u):r?this.filter(u):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ge(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=r=>{if(!r)return r;const i=Object.create(e.prototype);for(var s in r)if(lt(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass(function(e){Qe(this,e)})}add(e,t){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=$n(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?q.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{wt(e,i,o)}catch{}return o})}update(e,t){if(typeof e!="object"||Ge(e))return this.where(":id").equals(e).modify(t);{const r=kt(e,this.schema.primKey.keyPath);if(r===void 0)return Re(new W.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?Pe(t).forEach(i=>{wt(e,i,t[i])}):t(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=$n(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?q.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{wt(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?q.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:ts})).then(e=>e.numFailures?q.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){const i=Array.isArray(t)?t:void 0,s=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:c,keyPath:u}=this.schema.primKey;if(u&&i)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");const y=e.length;let p=u&&c?e.map($n(u)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:p,wantResults:s}).then(({numFailures:f,results:d,lastResult:g,failures:S})=>{if(f===0)return s?d:g;throw new gn(`${this.name}.bulkAdd(): ${f} of ${y} operations failed`,S)})})}bulkPut(e,t,r){const i=Array.isArray(t)?t:void 0,s=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:c,keyPath:u}=this.schema.primKey;if(u&&i)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");const y=e.length;let p=u&&c?e.map($n(u)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:p,wantResults:s}).then(({numFailures:f,results:d,lastResult:g,failures:S})=>{if(f===0)return s?d:g;throw new gn(`${this.name}.bulkPut(): ${f} of ${y} operations failed`,S)})})}bulkDelete(e){const t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new gn(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}}function _n(n){var e={},t=function(o,c){if(c){for(var u=arguments.length,y=new Array(u-1);--u;)y[u-1]=arguments[u];return e[o].subscribe.apply(null,y),n}if(typeof o=="string")return e[o]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(o,c,u){if(typeof o!="object"){var y;c||(c=Ts),u||(u=be);var p={subscribers:[],fire:u,subscribe:function(f){p.subscribers.indexOf(f)===-1&&(p.subscribers.push(f),p.fire=c(p.fire,f))},unsubscribe:function(f){p.subscribers=p.subscribers.filter(function(d){return d!==f}),p.fire=p.subscribers.reduce(c,u)}};return e[o]=t[o]=p,p}Pe(y=o).forEach(function(f){var d=y[f];if(Ge(d))s(f,y[f][0],y[f][1]);else{if(d!=="asap")throw new W.InvalidArgument("Invalid event config");var g=s(f,Cn,function(){for(var S=arguments.length,m=new Array(S);S--;)m[S]=arguments[S];g.subscribers.forEach(function(w){ki(function(){w.apply(null,m)})})})}})}}function yn(n,e){return un(e).from({prototype:n}),e}function sn(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function Sr(n,e){n.filter=en(n.filter,e)}function Er(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>en(r(),e()):e,n.justLimit=t&&!r}function tr(n,e){if(n.isPrimKey)return e.primaryKey;const t=e.getIndexByKeyPath(n.index);if(!t)throw new W.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function vi(n,e,t){const r=tr(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function Gn(n,e,t,r){const i=n.replayFilter?en(n.filter,n.replayFilter()):n.filter;if(n.or){const s={},o=(c,u,y)=>{if(!i||i(u,y,d=>u.stop(d),d=>u.fail(d))){var p=u.primaryKey,f=""+p;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(p)),lt(s,f)||(s[f]=!0,e(c,u,y))}};return Promise.all([n.or._iterate(o,t),gi(vi(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}return gi(vi(n,r,t),en(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function gi(n,e,t,r){var i=Oe(r?(s,o,c)=>t(r(s),o,c):t);return n.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();e&&!e(s,c=>o=c,c=>{s.stop(c),o=be},c=>{s.fail(c),o=be})||i(s.value,s,c=>o=c),o()})})}function Xe(n,e){try{const t=wi(n),r=wi(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return function(i,s){const o=i.length,c=s.length,u=o<c?o:c;for(let y=0;y<u;++y)if(i[y]!==s[y])return i[y]<s[y]?-1:1;return o===c?0:o<c?-1:1}(Ai(n),Ai(e));case"Array":return function(i,s){const o=i.length,c=s.length,u=o<c?o:c;for(let y=0;y<u;++y){const p=Xe(i[y],s[y]);if(p!==0)return p}return o===c?0:o<c?-1:1}(n,e)}}catch{}return NaN}function wi(n){const e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";const t=Br(n);return t==="ArrayBuffer"?"binary":t}function Ai(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class Us{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Re.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Re.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=en(t.algorithm,e)}_iterate(e,t){return Gn(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Qe(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>Gn(t,e,r,t.table.core))}count(e){return this._read(t=>{const r=this._ctx,i=r.table.core;if(sn(r,!0))return i.count({trans:t,query:{index:tr(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return Gn(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){const r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(y,p){return p?o(y[r[p]],p-1):y[i]}var c=this._ctx.dir==="next"?1:-1;function u(y,p){var f=o(y,s),d=o(p,s);return f<d?-c:f>d?c:0}return this.toArray(function(y){return y.sort(u)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&sn(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=tr(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return Gn(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,sn(t)?Er(t,()=>{var r=e;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):Er(t,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Er(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return Sr(this._ctx,function(r,i,s){return!e(r.value)||(i(s),t)}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return Sr(this._ctx,function(i){return e(i.value)}),t=this._ctx,r=e,t.isMatch=en(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&sn(t,!0)&&t.limit>0)return this._read(i=>{var s=tr(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Sr(this._ctx,function(i){var s=i.primaryKey.toString(),o=lt(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=Pe(e),o=s.length;i=function(m){for(var w=!1,_=0;_<o;++_){var v=s[_],B=e[v];kt(m,v)!==B&&(wt(m,v,B),w=!0)}return w}}const c=t.table.core,{outbound:u,extractKey:y}=c.schema.primaryKey,p=this.db._options.modifyChunkSize||200,f=[];let d=0;const g=[],S=(m,w)=>{const{failures:_,numFailures:v}=w;d+=m-v;for(let B of Pe(_))f.push(_[B])};return this.clone().primaryKeys().then(m=>{const w=_=>{const v=Math.min(p,m.length-_);return c.getMany({trans:r,keys:m.slice(_,_+v),cache:"immutable"}).then(B=>{const O=[],x=[],T=u?[]:null,E=[];for(let I=0;I<v;++I){const ue=B[I],Z={value:kn(ue),primKey:m[_+I]};i.call(Z,Z.value,Z)!==!1&&(Z.value==null?E.push(m[_+I]):u||Xe(y(ue),y(Z.value))===0?(x.push(Z.value),u&&T.push(m[_+I])):(E.push(m[_+I]),O.push(Z.value)))}const P=sn(t)&&t.limit===1/0&&(typeof e!="function"||e===Cr)&&{index:t.index,range:t.range};return Promise.resolve(O.length>0&&c.mutate({trans:r,type:"add",values:O}).then(I=>{for(let ue in I.failures)E.splice(parseInt(ue),1);S(O.length,I)})).then(()=>(x.length>0||P&&typeof e=="object")&&c.mutate({trans:r,type:"put",keys:T,values:x,criteria:P,changeSpec:typeof e!="function"&&e}).then(I=>S(x.length,I))).then(()=>(E.length>0||P&&e===Cr)&&c.mutate({trans:r,type:"delete",keys:E,criteria:P}).then(I=>S(E.length,I))).then(()=>m.length>_+v&&w(_+p))})};return w(0).then(()=>{if(f.length>0)throw new ir("Error modifying one or more objects",f,d,g);return m.length})})})}delete(){var e=this._ctx,t=e.range;return sn(e)&&(e.isPrimKey&&!qs||t.type===3)?this._write(r=>{const{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:c,lastResult:u,results:y,numFailures:p})=>{if(p)throw new ir("Could not delete some values",Object.keys(c).map(f=>c[f]),o-p);return o-p}))}):this.modify(Cr)}}const Cr=(n,e)=>e.value=null;function Vs(n,e){return n<e?-1:n===e?0:1}function $s(n,e){return n>e?-1:n===e?0:1}function ut(n,e,t){var r=n instanceof rs?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function on(n){return new n.Collection(n,()=>ns("")).limit(0)}function Gs(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),c=-1,u=0;u<o;++u){var y=e[u];if(y!==r[u])return i(n[u],t[u])<0?n.substr(0,u)+t[u]+t.substr(u+1):i(n[u],r[u])<0?n.substr(0,u)+r[u]+t.substr(u+1):c>=0?n.substr(0,c)+e[c]+t.substr(c+1):null;i(n[u],y)<0&&(c=u)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):c<0?null:n.substr(0,c)+r[c]+t.substr(c+1)}function Hn(n,e,t,r){var i,s,o,c,u,y,p,f=t.length;if(!t.every(m=>typeof m=="string"))return ut(n,Zi);function d(m){i=function(_){return _==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(m),s=function(_){return _==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(m),o=m==="next"?Vs:$s;var w=t.map(function(_){return{lower:s(_),upper:i(_)}}).sort(function(_,v){return o(_.lower,v.lower)});c=w.map(function(_){return _.upper}),u=w.map(function(_){return _.lower}),y=m,p=m==="next"?"":r}d("next");var g=new n.Collection(n,()=>Mt(c[0],u[f-1]+r));g._ondirectionchange=function(m){d(m)};var S=0;return g._addAlgorithm(function(m,w,_){var v=m.key;if(typeof v!="string")return!1;var B=s(v);if(e(B,u,S))return!0;for(var O=null,x=S;x<f;++x){var T=Gs(v,B,c[x],u[x],o,y);T===null&&O===null?S=x+1:(O===null||o(O,T)>0)&&(O=T)}return w(O!==null?function(){m.continue(O+p)}:_),!1}),g}function Mt(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function ns(n){return{type:1,lower:n,upper:n}}class rs{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&(!r||!i)?on(this):new this.Collection(this,()=>Mt(e,t,!r,!i))}catch{return ut(this,Bt)}}equals(e){return e==null?ut(this,Bt):new this.Collection(this,()=>ns(e))}above(e){return e==null?ut(this,Bt):new this.Collection(this,()=>Mt(e,void 0,!0))}aboveOrEqual(e){return e==null?ut(this,Bt):new this.Collection(this,()=>Mt(e,void 0,!1))}below(e){return e==null?ut(this,Bt):new this.Collection(this,()=>Mt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ut(this,Bt):new this.Collection(this,()=>Mt(void 0,e))}startsWith(e){return typeof e!="string"?ut(this,Zi):this.between(e,e+zt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Hn(this,(t,r)=>t.indexOf(r[0])===0,[e],zt)}equalsIgnoreCase(e){return Hn(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=jt.apply(an,arguments);return e.length===0?on(this):Hn(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=jt.apply(an,arguments);return e.length===0?on(this):Hn(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,zt)}anyOf(){const e=jt.apply(an,arguments);let t=this._cmp;try{e.sort(t)}catch{return ut(this,Bt)}if(e.length===0)return on(this);const r=new this.Collection(this,()=>Mt(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,c)=>{const u=s.key;for(;t(u,e[i])>0;)if(++i,i===e.length)return o(c),!1;return t(u,e[i])===0||(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[Lr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=jt.apply(an,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ut(this,Bt)}const t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Lr,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,c=this._max;if(e.length===0)return on(this);if(!e.every(v=>v[0]!==void 0&&v[1]!==void 0&&i(v[0],v[1])<=0))return ut(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);const u=!t||t.includeLowers!==!1,y=t&&t.includeUppers===!0;let p,f=i;function d(v,B){return f(v[0],B[0])}try{p=e.reduce(function(v,B){let O=0,x=v.length;for(;O<x;++O){const T=v[O];if(r(B[0],T[1])<0&&r(B[1],T[0])>0){T[0]=o(T[0],B[0]),T[1]=c(T[1],B[1]);break}}return O===x&&v.push(B),v},[]),p.sort(d)}catch{return ut(this,Bt)}let g=0;const S=y?v=>i(v,p[g][1])>0:v=>i(v,p[g][1])>=0,m=u?v=>s(v,p[g][0])>0:v=>s(v,p[g][0])>=0;let w=S;const _=new this.Collection(this,()=>Mt(p[0][0],p[p.length-1][1],!u,!y));return _._ondirectionchange=v=>{v==="next"?(w=S,f=i):(w=m,f=s),p.sort(d)},_._addAlgorithm((v,B,O)=>{for(var x=v.key;w(x);)if(++g,g===p.length)return B(O),!1;return!!function(T){return!S(T)&&!m(T)}(x)||(this._cmp(x,p[g][1])===0||this._cmp(x,p[g][0])===0||B(()=>{f===i?v.continue(p[g][0]):v.continue(p[g][1])}),!1)}),_}startsWithAnyOf(){const e=jt.apply(an,arguments);return e.every(t=>typeof t=="string")?e.length===0?on(this):this.inAnyRange(e.map(t=>[t,t+zt])):ut(this,"startsWithAnyOf() only works with strings")}}function _t(n){return Oe(function(e){return Dn(e),n(e.target.error),!1})}function Dn(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const Fn="storagemutated",Lt="x-storagemutated-1",$t=_n(null,Fn);class Hs{_lock(){return bn(!$.global),++this._reculock,this._reculock!==1||$.global||($.lockOwnerFor=this),this}_unlock(){if(bn(!$.global),--this._reculock==0)for($.global||($.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{pn(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&$.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(bn(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new W.DatabaseClosed(r);case"MissingAPIError":throw new W.MissingAPI(r.message,r);default:throw new W.OpenFailed(r)}if(!this.active)throw new W.TransactionInactive;return bn(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Oe(i=>{Dn(i),this._reject(e.error)}),e.onabort=Oe(i=>{Dn(i),this.active&&this._reject(new W.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=Oe(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&$t.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return Re(new W.ReadOnly("Transaction is readonly"));if(!this.active)return Re(new W.TransactionInactive);if(this._locked())return new q((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},$])});if(r)return Ut(()=>{var s=new q((o,c)=>{this._lock();const u=t(o,c,this);u&&u.then&&u.then(o,c)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new q((s,o)=>{var c=t(s,o,this);c&&c.then&&c.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=q.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new q((o,c)=>{r.then(u=>t._waitingQueue.push(Oe(o.bind(null,u))),u=>t._waitingQueue.push(Oe(c.bind(null,u)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(lt(t,e))return t[e];const r=this.schema[e];if(!r)throw new W.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}}function Ur(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+is(e)}}function is(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function ss(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:Ri(t,r=>[r.name,r])}}let Bn=n=>{try{return n.only([[]]),Bn=()=>[[]],[[]]}catch{return Bn=()=>zt,zt}};function Vr(n){return n==null?()=>{}:typeof n=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>kt(r,e)}(n):e=>kt(e,n)}function _i(n){return[].slice.call(n)}let Ws=0;function Sn(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Ys(n,e,t){function r(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:y,upper:p,lowerOpen:f,upperOpen:d}=u;return y===void 0?p===void 0?null:e.upperBound(p,!!d):p===void 0?e.lowerBound(y,!!f):e.bound(y,p,!!f,!!d)}const{schema:i,hasGetAll:s}=function(u,y){const p=_i(u.objectStoreNames);return{schema:{name:u.name,tables:p.map(f=>y.objectStore(f)).map(f=>{const{keyPath:d,autoIncrement:g}=f,S=Ge(d),m=d==null,w={},_={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:S,keyPath:d,autoIncrement:g,unique:!0,extractKey:Vr(d)},indexes:_i(f.indexNames).map(v=>f.index(v)).map(v=>{const{name:B,unique:O,multiEntry:x,keyPath:T}=v,E={name:B,compound:Ge(T),keyPath:T,unique:O,multiEntry:x,extractKey:Vr(T)};return w[Sn(T)]=E,E}),getIndexByKeyPath:v=>w[Sn(v)]};return w[":id"]=_.primaryKey,d!=null&&(w[Sn(d)]=_.primaryKey),_})},hasGetAll:p.length>0&&"getAll"in y.objectStore(p[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,t),o=i.tables.map(u=>function(y){const p=y.name;return{name:p,schema:y,mutate:function({trans:f,type:d,keys:g,values:S,range:m}){return new Promise((w,_)=>{w=Oe(w);const v=f.objectStore(p),B=v.keyPath==null,O=d==="put"||d==="add";if(!O&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:x}=g||S||{length:1};if(g&&S&&g.length!==S.length)throw new Error("Given keys array must have same length as given values array.");if(x===0)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let T;const E=[],P=[];let I=0;const ue=we=>{++I,Dn(we)};if(d==="deleteRange"){if(m.type===4)return w({numFailures:I,failures:P,results:[],lastResult:void 0});m.type===3?E.push(T=v.clear()):E.push(T=v.delete(r(m)))}else{const[we,Ee]=O?B?[S,g]:[S,null]:[g,null];if(O)for(let z=0;z<x;++z)E.push(T=Ee&&Ee[z]!==void 0?v[d](we[z],Ee[z]):v[d](we[z])),T.onerror=ue;else for(let z=0;z<x;++z)E.push(T=v[d](we[z])),T.onerror=ue}const Z=we=>{const Ee=we.target.result;E.forEach((z,Le)=>z.error!=null&&(P[Le]=z.error)),w({numFailures:I,failures:P,results:d==="delete"?g:E.map(z=>z.result),lastResult:Ee})};T.onerror=we=>{ue(we),Z(we)},T.onsuccess=Z})},getMany:({trans:f,keys:d})=>new Promise((g,S)=>{g=Oe(g);const m=f.objectStore(p),w=d.length,_=new Array(w);let v,B=0,O=0;const x=E=>{const P=E.target;_[P._pos]=P.result,++O===B&&g(_)},T=_t(S);for(let E=0;E<w;++E)d[E]!=null&&(v=m.get(d[E]),v._pos=E,v.onsuccess=x,v.onerror=T,++B);B===0&&g(_)}),get:({trans:f,key:d})=>new Promise((g,S)=>{g=Oe(g);const m=f.objectStore(p).get(d);m.onsuccess=w=>g(w.target.result),m.onerror=_t(S)}),query:function(f){return d=>new Promise((g,S)=>{g=Oe(g);const{trans:m,values:w,limit:_,query:v}=d,B=_===1/0?void 0:_,{index:O,range:x}=v,T=m.objectStore(p),E=O.isPrimaryKey?T:T.index(O.name),P=r(x);if(_===0)return g({result:[]});if(f){const I=w?E.getAll(P,B):E.getAllKeys(P,B);I.onsuccess=ue=>g({result:ue.target.result}),I.onerror=_t(S)}else{let I=0;const ue=w||!("openKeyCursor"in E)?E.openCursor(P):E.openKeyCursor(P),Z=[];ue.onsuccess=we=>{const Ee=ue.result;return Ee?(Z.push(w?Ee.value:Ee.primaryKey),++I===_?g({result:Z}):void Ee.continue()):g({result:Z})},ue.onerror=_t(S)}})}(s),openCursor:function({trans:f,values:d,query:g,reverse:S,unique:m}){return new Promise((w,_)=>{w=Oe(w);const{index:v,range:B}=g,O=f.objectStore(p),x=v.isPrimaryKey?O:O.index(v.name),T=S?m?"prevunique":"prev":m?"nextunique":"next",E=d||!("openKeyCursor"in x)?x.openCursor(r(B),T):x.openKeyCursor(r(B),T);E.onerror=_t(_),E.onsuccess=Oe(P=>{const I=E.result;if(!I)return void w(null);I.___id=++Ws,I.done=!1;const ue=I.continue.bind(I);let Z=I.continuePrimaryKey;Z&&(Z=Z.bind(I));const we=I.advance.bind(I),Ee=()=>{throw new Error("Cursor not stopped")};I.trans=f,I.stop=I.continue=I.continuePrimaryKey=I.advance=()=>{throw new Error("Cursor not started")},I.fail=Oe(_),I.next=function(){let z=1;return this.start(()=>z--?this.continue():this.stop()).then(()=>this)},I.start=z=>{const Le=new Promise((De,Ve)=>{De=Oe(De),E.onerror=_t(Ve),I.fail=Ve,I.stop=Ze=>{I.stop=I.continue=I.continuePrimaryKey=I.advance=Ee,De(Ze)}}),Ue=()=>{if(E.result)try{z()}catch(De){I.fail(De)}else I.done=!0,I.start=()=>{throw new Error("Cursor behind last entry")},I.stop()};return E.onsuccess=Oe(De=>{E.onsuccess=Ue,Ue()}),I.continue=ue,I.continuePrimaryKey=Z,I.advance=we,Ue(),Le},w(I)},_)})},count({query:f,trans:d}){const{index:g,range:S}=f;return new Promise((m,w)=>{const _=d.objectStore(p),v=g.isPrimaryKey?_:_.index(g.name),B=r(S),O=B?v.count(B):v.count();O.onsuccess=Oe(x=>m(x.target.result)),O.onerror=_t(w)})}}}(u)),c={};return o.forEach(u=>c[u.name]=u),{stack:"dbcore",transaction:n.transaction.bind(n),table(u){if(!c[u])throw new Error(`Table '${u}' not found`);return c[u]},MIN_KEY:-1/0,MAX_KEY:Bn(e),schema:i}}function $r({_novip:n},e){const t=e.db,r=function(i,s,{IDBKeyRange:o,indexedDB:c},u){return{dbcore:function(p,f){return f.reduce((d,{create:g})=>({...d,...g(d)}),p)}(Ys(s,o,u),i.dbcore)}}(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{const s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function cr({_novip:n},e,t,r){t.forEach(i=>{const s=r[i];e.forEach(o=>{const c=ei(o,i);(!c||"value"in c&&c.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?Pt(o,i,{get(){return this.table(i)},set(u){Ii(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function Gr({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function zs(n,e){return n._cfg.version-e._cfg.version}function Js(n,e,t,r){const i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);const o=s._reject.bind(s),c=$.transless||$;Ut(()=>{$.trans=s,$.transless=c,e===0?(Pe(i).forEach(u=>{Or(t,u,i[u].primKey,i[u].indexes)}),$r(n,t),q.follow(()=>n.on.populate.fire(s)).catch(o)):function({_novip:u},y,p,f){const d=[],g=u._versions;let S=u._dbSchema=Wr(u,u.idbdb,f),m=!1;const w=g.filter(v=>v._cfg.version>=y);function _(){return d.length?q.resolve(d.shift()(p.idbtrans)).then(_):q.resolve()}return w.forEach(v=>{d.push(()=>{const B=S,O=v._cfg.dbschema;Yr(u,B,f),Yr(u,O,f),S=u._dbSchema=O;const x=os(B,O);x.add.forEach(E=>{Or(f,E[0],E[1].primKey,E[1].indexes)}),x.change.forEach(E=>{if(E.recreate)throw new W.Upgrade("Not yet support for changing primary key");{const P=f.objectStore(E.name);E.add.forEach(I=>Hr(P,I)),E.change.forEach(I=>{P.deleteIndex(I.name),Hr(P,I)}),E.del.forEach(I=>P.deleteIndex(I))}});const T=v._cfg.contentUpgrade;if(T&&v._cfg.version>y){$r(u,f),p._memoizedTables={},m=!0;let E=Ni(O);x.del.forEach(Z=>{E[Z]=B[Z]}),Gr(u,[u.Transaction.prototype]),cr(u,[u.Transaction.prototype],Pe(E),E),p.schema=E;const P=ti(T);let I;P&&dn();const ue=q.follow(()=>{if(I=T(p),I&&P){var Z=Rt.bind(null,null);I.then(Z,Z)}});return I&&typeof I.then=="function"?q.resolve(I):ue.then(()=>I)}}),d.push(B=>{(!m||!Ms)&&function(O,x){[].slice.call(x.db.objectStoreNames).forEach(T=>O[T]==null&&x.db.deleteObjectStore(T))}(v._cfg.dbschema,B),Gr(u,[u.Transaction.prototype]),cr(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),p.schema=u._dbSchema})}),_().then(()=>{var v,B;B=f,Pe(v=S).forEach(O=>{B.db.objectStoreNames.contains(O)||Or(B,O,v[O].primKey,v[O].indexes)})})}(n,e,s,t).catch(o)})}function os(n,e){const t={del:[],add:[],change:[]};let r;for(r in n)e[r]||t.del.push(r);for(r in e){const i=n[r],s=e[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!yr)o.recreate=!0,t.change.push(o);else{const c=i.idxByName,u=s.idxByName;let y;for(y in c)u[y]||o.del.push(y);for(y in u){const p=c[y],f=u[y];p?p.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}else t.add.push([r,s])}return t}function Or(n,e,t,r){const i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Hr(i,s)),i}function Hr(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Wr(n,e,t){const r={};return rr(e.objectStoreNames,0).forEach(i=>{const s=t.objectStore(i);let o=s.keyPath;const c=Ur(is(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),u=[];for(let p=0;p<s.indexNames.length;++p){const f=s.index(s.indexNames[p]);o=f.keyPath;var y=Ur(f.name,o,!!f.unique,!!f.multiEntry,!1,o&&typeof o!="string",!1);u.push(y)}r[i]=ss(i,c,u)}),r}function Yr({_novip:n},e,t){const r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let c=0;c<o.indexNames.length;++c){const u=o.indexNames[c],y=o.index(u).keyPath,p=typeof y=="string"?y:"["+rr(y).join("+")+"]";if(e[s]){const f=e[s].idxByName[p];f&&(f.name=u,delete e[s].idxByName[p],e[s].idxByName[u]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Se.WorkerGlobalScope&&Se instanceof Se.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class Xs{_parseStoresSpec(e,t){Pe(e).forEach(r=>{if(e[r]!==null){var i=e[r].split(",").map((o,c)=>{const u=(o=o.trim()).replace(/([&*]|\+\+)/g,""),y=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Ur(u,y||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),Ge(y),c===0)}),s=i.shift();if(s.multi)throw new W.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),t[r]=ss(r,s,i)}})}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?Qe(this._cfg.storesSource,e):e;const r=t._versions,i={};let s={};return r.forEach(o=>{Qe(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,Gr(t,[t._allTables,t,t.Transaction.prototype]),cr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Pe(s),s),t._storeNames=Pe(s),this}upgrade(e){return this._cfg.contentUpgrade=ii(this._cfg.contentUpgrade||be,e),this}}function ui(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new Qt(mr,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function ci(n){return n&&typeof n.databases=="function"}function zr(n){return Ut(function(){return $.letThrough=!0,n()})}function Qs(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var t=function(){return indexedDB.databases().finally(e)};n=setInterval(t,100),t()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function Zs(n){const e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Re(e.dbOpenError):n);Ct&&(e.openCanceller._stackHolder=nn()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new W.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,c=!1;return q.race([r,(typeof navigator>"u"?q.resolve():Qs()).then(()=>new q((u,y)=>{if(i(),!t)throw new W.MissingAPI;const p=n.name,f=e.autoSchema?t.open(p):t.open(p,Math.round(10*n.verno));if(!f)throw new W.MissingAPI;f.onerror=_t(y),f.onblocked=Oe(n._fireOnBlocked),f.onupgradeneeded=Oe(d=>{if(o=f.transaction,e.autoSchema&&!n._options.allowEmptyDB){f.onerror=Dn,o.abort(),f.result.close();const S=t.deleteDatabase(p);S.onsuccess=S.onerror=Oe(()=>{y(new W.NoSuchDatabase(`Database ${p} doesnt exist`))})}else{o.onerror=_t(y);var g=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;c=g<1,n._novip.idbdb=f.result,Js(n,g/10,o,y)}},y),f.onsuccess=Oe(()=>{o=null;const d=n._novip.idbdb=f.result,g=rr(d.objectStoreNames);if(g.length>0)try{const m=d.transaction((S=g).length===1?S[0]:S,"readonly");e.autoSchema?function({_novip:w},_,v){w.verno=_.version/10;const B=w._dbSchema=Wr(0,_,v);w._storeNames=rr(_.objectStoreNames,0),cr(w,[w._allTables],Pe(B),B)}(n,d,m):(Yr(n,n._dbSchema,m),function(w,_){const v=os(Wr(0,w.idbdb,_),w._dbSchema);return!(v.add.length||v.change.some(B=>B.add.length||B.change.length))}(n,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),$r(n,m)}catch{}var S;An.push(n),d.onversionchange=Oe(m=>{e.vcFired=!0,n.on("versionchange").fire(m)}),d.onclose=Oe(m=>{n.on("close").fire(m)}),c&&function({indexedDB:m,IDBKeyRange:w},_){!ci(m)&&_!==mr&&ui(m,w).put({name:_}).catch(be)}(n._deps,p),u()},y)}))]).then(()=>(i(),e.onReadyBeingFired=[],q.resolve(zr(()=>n.on.ready.fire(n.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let y=e.onReadyBeingFired.reduce(ii,be);return e.onReadyBeingFired=[],q.resolve(zr(()=>y(n.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch{}return r===e.openCanceller&&n._close(),Re(u)}).finally(()=>{e.openComplete=!0,s()})}function Jr(n){var e=s=>n.next(s),t=i(e),r=i(s=>n.throw(s));function i(s){return o=>{var c=s(o),u=c.value;return c.done?u:u&&typeof u.then=="function"?u.then(t,r):Ge(u)?Promise.all(u).then(t,r):t(u)}}return i(e)()}function eo(n,e,t){var r=arguments.length;if(r<2)throw new W.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return t=i.pop(),[n,Ki(i),t]}function as(n,e,t,r,i){return q.resolve().then(()=>{const s=$.transless||$,o=n._createTransaction(e,t,n._dbSchema,r),c={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(f){return f.name===ri.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>as(n,e,t,null,i))):Re(f)}const u=ti(i);let y;u&&dn();const p=q.follow(()=>{if(y=i.call(o,o),y)if(u){var f=Rt.bind(null,null);y.then(f,f)}else typeof y.next=="function"&&typeof y.throw=="function"&&(y=Jr(y))},c);return(y&&typeof y.then=="function"?q.resolve(y).then(f=>o.active?f:Re(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):p.then(()=>y)).then(f=>(r&&o._resolve(),o._completion.then(()=>f))).catch(f=>(o._reject(f),Re(f)))})}function Wn(n,e,t){const r=Ge(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}const to={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(e){const t=n.table(e),{schema:r}=t,i={},s=[];function o(p,f,d){const g=Sn(p),S=i[g]=i[g]||[],m=p==null?0:typeof p=="string"?1:p.length,w=f>0,_={...d,isVirtual:w,keyTail:f,keyLength:m,extractKey:Vr(p),unique:!w&&d.unique};return S.push(_),_.isPrimaryKey||s.push(_),m>1&&o(m===2?p[0]:p.slice(0,m-1),f+1,d),S.sort((v,B)=>v.keyTail-B.keyTail),_}const c=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[c];for(const p of r.indexes)o(p.keyPath,0,p);function u(p){const f=p.query.index;return f.isVirtual?{...p,query:{index:f,range:(d=p.query.range,g=f.keyTail,{type:d.type===1?2:d.type,lower:Wn(d.lower,d.lowerOpen?n.MAX_KEY:n.MIN_KEY,g),lowerOpen:!0,upper:Wn(d.upper,d.upperOpen?n.MIN_KEY:n.MAX_KEY,g),upperOpen:!0})}}:p;var d,g}return{...t,schema:{...r,primaryKey:c,indexes:s,getIndexByKeyPath:function(p){const f=i[Sn(p)];return f&&f[0]}},count:p=>t.count(u(p)),query:p=>t.query(u(p)),openCursor(p){const{keyTail:f,isVirtual:d,keyLength:g}=p.query.index;return d?t.openCursor(u(p)).then(S=>S&&function(m){return Object.create(m,{continue:{value:function(_){_!=null?m.continue(Wn(_,p.reverse?n.MAX_KEY:n.MIN_KEY,f)):p.unique?m.continue(m.key.slice(0,g).concat(p.reverse?n.MIN_KEY:n.MAX_KEY,f)):m.continue()}},continuePrimaryKey:{value(_,v){m.continuePrimaryKey(Wn(_,n.MAX_KEY,f),v)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const _=m.key;return g===1?_[0]:_.slice(0,g)}},value:{get:()=>m.value}})}(S)):t.openCursor(p)}}}}}};function li(n,e,t,r){return t=t||{},r=r||"",Pe(n).forEach(i=>{if(lt(e,i)){var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const c=Br(s);c!==Br(o)?t[r+i]=e[i]:c==="Object"?li(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}else t[r+i]=void 0}),Pe(e).forEach(i=>{lt(n,i)||(t[r+i]=e[i])}),t}const no={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){const t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){const o=$.trans,{deleting:c,creating:u,updating:y}=o.table(e).hook;switch(s.type){case"add":if(u.fire===be)break;return o._promise("readwrite",()=>p(s),!0);case"put":if(u.fire===be&&y.fire===be)break;return o._promise("readwrite",()=>p(s),!0);case"delete":if(c.fire===be)break;return o._promise("readwrite",()=>p(s),!0);case"deleteRange":if(c.fire===be)break;return o._promise("readwrite",()=>function(d){return f(d.trans,d.range,1e4)}(s),!0)}return t.mutate(s);function p(d){const g=$.trans,S=d.keys||function(m,w){return w.type==="delete"?w.keys:w.keys||w.values.map(m.extractKey)}(r,d);if(!S)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:S}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(m,w,_){return w.type==="add"?Promise.resolve([]):m.getMany({trans:w.trans,keys:_,cache:"immutable"})}(t,d,S).then(m=>{const w=S.map((_,v)=>{const B=m[v],O={onerror:null,onsuccess:null};if(d.type==="delete")c.fire.call(O,_,B,g);else if(d.type==="add"||B===void 0){const x=u.fire.call(O,_,d.values[v],g);_==null&&x!=null&&(_=x,d.keys[v]=_,r.outbound||wt(d.values[v],r.keyPath,_))}else{const x=li(B,d.values[v]),T=y.fire.call(O,x,_,B,g);if(T){const E=d.values[v];Object.keys(T).forEach(P=>{lt(E,P)?E[P]=T[P]:wt(E,P,T[P])})}}return O});return t.mutate(d).then(({failures:_,results:v,numFailures:B,lastResult:O})=>{for(let x=0;x<S.length;++x){const T=v?v[x]:S[x],E=w[x];T==null?E.onerror&&E.onerror(_[x]):E.onsuccess&&E.onsuccess(d.type==="put"&&m[x]?d.values[x]:T)}return{failures:_,results:v,numFailures:B,lastResult:O}}).catch(_=>(w.forEach(v=>v.onerror&&v.onerror(_)),Promise.reject(_)))})}function f(d,g,S){return t.query({trans:d,values:!1,query:{index:r,range:g},limit:S}).then(({result:m})=>p({type:"delete",keys:m,trans:d}).then(w=>w.numFailures>0?Promise.reject(w.failures[0]):m.length<S?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...g,lower:m[m.length-1],lowerOpen:!0},S)))}}}}})};function us(n,e,t){try{if(!e||e.keys.length<n.length)return null;const r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)Xe(e.keys[i],n[s])===0&&(r.push(t?kn(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch{return null}}const ro={stack:"dbcore",level:-1,create:n=>({table:e=>{const t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);const i=us(r.keys,r.trans._cache,r.cache==="clone");return i?q.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?kn(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function hi(n){return!("from"in n)}const xt=function(n,e){if(!this){const t=new xt;return n&&"d"in n&&Qe(t,n),t}Qe(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0})};function xn(n,e,t){const r=Xe(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(hi(n))return Qe(n,{from:e,to:t,d:1});const i=n.l,s=n.r;if(Xe(t,n.from)<0)return i?xn(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},Si(n);if(Xe(e,n.to)>0)return s?xn(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},Si(n);Xe(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),Xe(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);const o=!n.r;i&&!n.l&&lr(n,i),s&&o&&lr(n,s)}function lr(n,e){hi(e)||function t(r,{from:i,to:s,l:o,r:c}){xn(r,i,s),o&&t(r,o),c&&t(r,c)}(n,e)}function io(n,e){const t=Xr(e);let r=t.next();if(r.done)return!1;let i=r.value;const s=Xr(n);let o=s.next(i.from),c=o.value;for(;!r.done&&!o.done;){if(Xe(c.from,i.to)<=0&&Xe(c.to,i.from)>=0)return!0;Xe(i.from,c.from)<0?i=(r=t.next(c.from)).value:c=(o=s.next(i.from)).value}return!1}function Xr(n){let e=hi(n)?null:{s:0,n};return{next(t){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Xe(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Xe(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Si(n){var e,t;const r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...n},c=n[i];n.from=c.from,n.to=c.to,n[i]=c[i],o[i]=c[s],n[s]=o,o.d=Ei(o)}n.d=Ei(n)}function Ei({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}fn(xt.prototype,{add(n){return lr(this,n),this},addKey(n){return xn(this,n,n),this},addKeys(n){return n.forEach(e=>xn(this,e,e)),this},[xr](){return Xr(this)}});const so={stack:"dbcore",level:0,create:n=>{const e=n.schema.name,t=new xt(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{const i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:c,outbound:u}=o,y={...i,mutate:d=>{const g=d.trans,S=g.mutatedParts||(g.mutatedParts={}),m=T=>{const E=`idb://${e}/${r}/${T}`;return S[E]||(S[E]=new xt)},w=m(""),_=m(":dels"),{type:v}=d;let[B,O]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const x=d.trans._cache;return i.mutate(d).then(T=>{if(Ge(B)){v!=="delete"&&(B=T.results),w.addKeys(B);const E=us(B,x);E||v==="add"||_.addKeys(B),(E||O)&&function(P,I,ue,Z){function we(Ee){const z=P(Ee.name||"");function Le(De){return De!=null?Ee.extractKey(De):null}const Ue=De=>Ee.multiEntry&&Ge(De)?De.forEach(Ve=>z.addKey(Ve)):z.addKey(De);(ue||Z).forEach((De,Ve)=>{const Ze=ue&&Le(ue[Ve]),Dt=Z&&Le(Z[Ve]);Xe(Ze,Dt)!==0&&(Ze!=null&&Ue(Ze),Dt!=null&&Ue(Dt))})}I.indexes.forEach(we)}(m,s,E,O)}else if(B){const E={from:B.lower,to:B.upper};_.add(E),w.add(E)}else w.add(t),_.add(t),s.indexes.forEach(E=>m(E.name).add(t));return T})}},p=({query:{index:d,range:g}})=>{var S,m;return[d,new xt((S=g.lower)!==null&&S!==void 0?S:n.MIN_KEY,(m=g.upper)!==null&&m!==void 0?m:n.MAX_KEY)]},f={get:d=>[o,new xt(d.key)],getMany:d=>[o,new xt().addKeys(d.keys)],count:p,query:p,openCursor:p};return Pe(f).forEach(d=>{y[d]=function(g){const{subscr:S}=$;if(S){const m=O=>{const x=`idb://${e}/${r}/${O}`;return S[x]||(S[x]=new xt)},w=m(""),_=m(":dels"),[v,B]=f[d](g);if(m(v.name||"").add(B),!v.isPrimaryKey){if(d!=="count"){const O=d==="query"&&u&&g.values&&i.query({...g,values:!1});return i[d].apply(this,arguments).then(x=>{if(d==="query"){if(u&&g.values)return O.then(({result:E})=>(w.addKeys(E),x));const T=g.values?x.result.map(c):x.result;g.values?w.addKeys(T):_.addKeys(T)}else if(d==="openCursor"){const T=x,E=g.values;return T&&Object.create(T,{key:{get:()=>(_.addKey(T.primaryKey),T.key)},primaryKey:{get(){const P=T.primaryKey;return _.addKey(P),P}},value:{get:()=>(E&&w.addKey(T.primaryKey),T.value)}})}return x})}_.add(t)}}return i[d].apply(this,arguments)}}),y}}}};class Qt{constructor(e,t){this._middlewares={},this.verno=0;const r=Qt.dependencies;this._options=t={addons:Qt.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:be,dbReadyPromise:null,cancelOpen:be,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new q(c=>{s.dbReadyResolve=c}),s.openCanceller=new q((c,u)=>{s.cancelOpen=u}),this._state=s,this.name=e,this.on=_n(this,"populate","blocked","versionchange","close",{ready:[ii,be]}),this.on.ready.subscribe=Pi(this.on.ready.subscribe,c=>(u,y)=>{Qt.vip(()=>{const p=this._state;if(p.openComplete)p.dbOpenError||q.resolve().then(u),y&&c(u);else if(p.onReadyBeingFired)p.onReadyBeingFired.push(u),y&&c(u);else{c(u);const f=this;y||c(function d(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,yn(Us.prototype,function(c,u){this.db=o;let y=ts,p=null;if(u)try{y=u()}catch(S){p=S}const f=c._ctx,d=f.table,g=d.hook.reading.fire;this._ctx={table:d,index:f.index,isPrimKey:!f.index||d.schema.primKey.keyPath&&f.index===d.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:p,or:f.or,valueMapper:g!==Cn?g:null}})),this.Table=function(c){return yn(Ls.prototype,function(u,y,p){this.db=c,this._tx=p,this.name=u,this.schema=y,this.hook=c._allTables[u]?c._allTables[u].hook:_n(null,{creating:[Bs,be],reading:[Fs,Cn],updating:[js,be],deleting:[xs,be]})})}(this),this.Transaction=function(c){return yn(Hs.prototype,function(u,y,p,f,d){this.db=c,this.mode=u,this.storeNames=y,this.schema=p,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=_n(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new q((g,S)=>{this._resolve=g,this._reject=S}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},g=>{var S=this.active;return this.active=!1,this.on.error.fire(g),this.parent?this.parent._reject(g):S&&this.idbtrans&&this.idbtrans.abort(),Re(g)})})}(this),this.Version=function(c){return yn(Xs.prototype,function(u){this.db=c,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(c){return yn(rs.prototype,function(u,y,p){this.db=c,this._ctx={table:u,index:y===":id"?null:y,or:p};const f=c._deps.indexedDB;if(!f)throw new W.MissingAPI;this._cmp=this._ascending=f.cmp.bind(f),this._descending=(d,g)=>f.cmp(g,d),this._max=(d,g)=>f.cmp(d,g)>0?d:g,this._min=(d,g)=>f.cmp(d,g)<0?d:g,this._IDBKeyRange=c._deps.IDBKeyRange})}(this),this.on("versionchange",c=>{c.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",c=>{!c.newVersion||c.newVersion<c.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${c.oldVersion/10}`)}),this._maxKey=Bn(t.IDBKeyRange),this._createTransaction=(c,u,y,p)=>new this.Transaction(c,u,y,this._options.chromeTransactionDurability,p),this._fireOnBlocked=c=>{this.on("blocked").fire(c),An.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(c))},this.use(to),this.use(no),this.use(so),this.use(ro),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(c=>c(this))}version(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(zs),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||$.letThrough||this._vip)?e():new q((t,r)=>{if(this._state.openComplete)return r(new W.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new W.DatabaseClosed);this.open().catch(be)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r??10,name:i}),s.sort((o,c)=>o.level-c.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:!!t&&i.name!==t)),this}open(){return Zs(this)}_close(){const e=this._state,t=An.indexOf(this);if(t>=0&&An.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new q(r=>{e.dbReadyResolve=r}),e.openCanceller=new q((r,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new W.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new q((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Oe(()=>{(function({indexedDB:c,IDBKeyRange:u},y){!ci(c)&&y!==mr&&ui(c,u).delete(y).catch(be)})(this._deps,this.name),r()}),o.onerror=_t(i),o.onblocked=this._fireOnBlocked};if(e)throw new W.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Pe(this._allTables).map(e=>this._allTables[e])}transaction(){const e=eo.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=$.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const s=e.indexOf("?")!==-1;let o,c;e=e.replace("!","").replace("?","");try{if(c=t.map(y=>{var p=y instanceof this.Table?y.name:y;if(typeof p!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return p}),e=="r"||e===Ar)o=Ar;else{if(e!="rw"&&e!=_r)throw new W.InvalidArgument("Invalid transaction mode: "+e);o=_r}if(i){if(i.mode===Ar&&o===_r){if(!s)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&c.forEach(y=>{if(i&&i.storeNames.indexOf(y)===-1){if(!s)throw new W.SubTransaction("Table "+y+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(y){return i?i._promise(null,(p,f)=>{f(y)}):Re(y)}const u=as.bind(null,this,o,c,i,r);return i?i._promise(o,u,"lock"):$.trans?pn($.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!lt(this._allTables,e))throw new W.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const oo=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ao{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})}[oo](){return this}}function cs(n,e){return Pe(e).forEach(t=>{lr(n[t]||(n[t]=new xt),e[t])}),n}function uo(n){let e,t=!1;const r=new ao(i=>{const s=ti(n);let o=!1,c={},u={};const y={get closed(){return o},unsubscribe:()=>{o=!0,$t.storagemutated.unsubscribe(g)}};i.start&&i.start(y);let p=!1,f=!1;function d(){return Pe(u).some(m=>c[m]&&io(c[m],u[m]))}const g=m=>{cs(c,m),d()&&S()},S=()=>{if(p||o)return;c={};const m={},w=function(_){s&&dn();const v=()=>Ut(n,{subscr:_,trans:null}),B=$.trans?pn($.transless,v):v();return s&&B.then(Rt,Rt),B}(m);f||($t(Fn,g),f=!0),p=!0,Promise.resolve(w).then(_=>{t=!0,e=_,p=!1,o||(d()?S():(c={},u=m,i.next&&i.next(_)))},_=>{p=!1,t=!1,i.error&&i.error(_),y.unsubscribe()})};return S(),y});return r.hasValue=()=>t,r.getValue=()=>e,r}let Qr;try{Qr={indexedDB:Se.indexedDB||Se.mozIndexedDB||Se.webkitIndexedDB||Se.msIndexedDB,IDBKeyRange:Se.IDBKeyRange||Se.webkitIDBKeyRange}}catch{Qr={indexedDB:null,IDBKeyRange:null}}const Wt=Qt;function nr(n){let e=It;try{It=!0,$t.storagemutated.fire(n)}finally{It=e}}fn(Wt,{...Jn,delete:n=>new Wt(n,{addons:[]}).delete(),exists:n=>new Wt(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:e,IDBKeyRange:t}){return ci(e)?Promise.resolve(e.databases()).then(r=>r.map(i=>i.name).filter(i=>i!==mr)):ui(e,t).toCollection().primaryKeys()}(Wt.dependencies).then(n)}catch{return Re(new W.MissingAPI)}},defineClass:()=>function(n){Qe(this,n)},ignoreTransaction:n=>$.trans?pn($.transless,n):n(),vip:zr,async:function(n){return function(){try{var e=Jr(n.apply(this,arguments));return e&&typeof e.then=="function"?e:q.resolve(e)}catch(t){return Re(t)}}},spawn:function(n,e,t){try{var r=Jr(n.apply(t,e||[]));return r&&typeof r.then=="function"?r:q.resolve(r)}catch(i){return Re(i)}},currentTransaction:{get:()=>$.trans||null},waitFor:function(n,e){const t=q.resolve(typeof n=="function"?Wt.ignoreTransaction(n):n).timeout(e||6e4);return $.trans?$.trans.waitFor(t):t},Promise:q,debug:{get:()=>Ct,set:n=>{qi(n,n==="dexie"?()=>!0:es)}},derive:un,extend:Qe,props:fn,override:Pi,Events:_n,on:$t,liveQuery:uo,extendObservabilitySet:cs,getByKeyPath:kt,setByKeyPath:wt,delByKeyPath:function(n,e){typeof e=="string"?wt(n,e,void 0):"length"in e&&[].map.call(e,function(t){wt(n,t,void 0)})},shallowClone:Ni,deepClone:kn,getObjectDiff:li,cmp:Xe,asap:ki,minKey:Lr,addons:[],connections:An,errnames:ri,dependencies:Qr,semVer:bi,version:bi.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,2*t))}),Wt.maxKey=Bn(Wt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($t(Fn,n=>{if(!It){let e;yr?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Lt,!0,!0,n)):e=new CustomEvent(Lt,{detail:n}),It=!0,dispatchEvent(e),It=!1}}),addEventListener(Lt,({detail:n})=>{It||nr(n)}));let It=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel(Lt);typeof n.unref=="function"&&n.unref(),$t(Fn,e=>{It||n.postMessage(e)}),n.onmessage=e=>{e.data&&nr(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){$t(Fn,e=>{try{It||(typeof localStorage<"u"&&localStorage.setItem(Lt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:Lt,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Lt){const t=JSON.parse(e.newValue);t&&nr(t.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:e}){e&&e.type===Lt&&nr(e.changedParts)})}q.rejectionMapper=function(n,e){if(!n||n instanceof cn||n instanceof TypeError||n instanceof SyntaxError||!n.name||!di[n.name])return n;var t=new di[n.name](e||n.message,n);return"stack"in n&&Pt(t,"stack",{get:function(){return this.inner.stack}}),t},qi(Ct,es);const Ot={AbortError:"A request was aborted, for example through a call to IDBTransaction.abort.",ConstraintError:"A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.",DataCloneError:"The data being stored could not be cloned by the internal structured cloning algorithm.",DataError:"Data provided to an operation does not meet requirements.",InvalidAccessError:"An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.",InvalidStateError:"An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.",NotFoundError:"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",ReadOnlyError:'The mutating operation was attempted in a "readonly" transaction.',TransactionInactiveError:"A request was placed against a transaction which is currently not active, or which is finished.",VersionError:"An attempt was made to open a database using a lower version than the existing version."};class Zr extends Error{constructor(e=Ot.AbortError){super(),this.name="AbortError",this.message=e}}class Gt extends Error{constructor(e=Ot.ConstraintError){super(),this.name="ConstraintError",this.message=e}}class co extends Error{constructor(e=Ot.DataCloneError){super(),this.name="DataCloneError",this.message=e}}class Ke extends Error{constructor(e=Ot.DataError){super(),this.name="DataError",this.message=e}}class hr extends Error{constructor(e=Ot.InvalidAccessError){super(),this.name="InvalidAccessError",this.message=e}}class re extends Error{constructor(e=Ot.InvalidStateError){super(),this.name="InvalidStateError",this.message=e}}class jn extends Error{constructor(e=Ot.NotFoundError){super(),this.name="NotFoundError",this.message=e}}class Tn extends Error{constructor(e=Ot.ReadOnlyError){super(),this.name="ReadOnlyError",this.message=e}}class St extends Error{constructor(e=Ot.TransactionInactiveError){super(),this.name="TransactionInactiveError",this.message=e}}class lo extends Error{constructor(e=Ot.VersionError){super(),this.name="VersionError",this.message=e}}const ye=(n,e)=>{if(typeof n=="number"){if(isNaN(n))throw new Ke;return n}else if(n instanceof Date){const t=n.valueOf();if(isNaN(t))throw new Ke;return new Date(t)}else{if(typeof n=="string")return n;if(n instanceof ArrayBuffer||typeof ArrayBuffer<"u"&&ArrayBuffer.isView&&ArrayBuffer.isView(n))return n instanceof ArrayBuffer?new Uint8Array(n).buffer:new Uint8Array(n.buffer).buffer;if(Array.isArray(n)){if(e===void 0)e=new Set;else if(e.has(n))throw new Ke;e.add(n);const t=[];for(let r=0;r<n.length;r++){if(!n.hasOwnProperty(r))throw new Ke;const s=n[r],o=ye(s,e);t.push(o)}return t}else throw new Ke}},Ci=n=>{if(typeof n=="number")return"Number";if(n instanceof Date)return"Date";if(Array.isArray(n))return"Array";if(typeof n=="string")return"String";if(n instanceof ArrayBuffer)return"Binary";throw new Ke},ae=(n,e)=>{if(e===void 0)throw new TypeError;n=ye(n),e=ye(e);const t=Ci(n),r=Ci(e);if(t!==r)return t==="Array"||t==="Binary"&&(r==="String"||r==="Date"||r==="Number")||t==="String"&&(r==="Date"||r==="Number")||t==="Date"&&r==="Number"?1:-1;if(t==="Binary"&&(n=new Uint8Array(n),e=new Uint8Array(e)),t==="Array"||t==="Binary"){const i=Math.min(n.length,e.length);for(let s=0;s<i;s++){const o=ae(n[s],e[s]);if(o!==0)return o}return n.length>e.length?1:n.length<e.length?-1:0}if(t==="Date"){if(n.getTime()===e.getTime())return 0}else if(n===e)return 0;return n>e?1:-1};class ie{static only(e){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(e,e,!1,!1)}static lowerBound(e,t=!1){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(e,void 0,t,!0)}static upperBound(e,t=!1){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(void 0,e,!0,t)}static bound(e,t,r=!1,i=!1){if(arguments.length<2)throw new TypeError;const s=ae(e,t);if(s===1||s===0&&(r||i))throw new Ke;return e=ye(e),t=ye(t),new ie(e,t,r,i)}constructor(e,t,r,i){this.lower=e,this.upper=t,this.lowerOpen=r,this.upperOpen=i}includes(e){if(arguments.length===0)throw new TypeError;if(e=ye(e),this.lower!==void 0){const t=ae(this.lower,e);if(t===1||t===0&&this.lowerOpen)return!1}if(this.upper!==void 0){const t=ae(this.upper,e);if(t===-1||t===0&&this.upperOpen)return!1}return!0}toString(){return"[object IDBKeyRange]"}}const Kn=(n,e)=>{if(Array.isArray(n)){const i=[];for(let s of n)s!=null&&typeof s!="string"&&s.toString&&(s=s.toString()),i.push(ye(Kn(s,e)));return i}if(n==="")return e;let t=n,r=e;for(;t!==null;){let i;const s=t.indexOf(".");if(s>=0?(i=t.slice(0,s),t=t.slice(s+1)):(i=t,t=null),r==null||!r.hasOwnProperty(i))return;r=r[i]}return r};function Yn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ls={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(r,i,s){function o(y,p){if(!i[y]){if(!r[y]){var f=typeof Yn=="function"&&Yn;if(!p&&f)return f(y,!0);if(c)return c(y,!0);var d=new Error("Cannot find module '"+y+"'");throw d.code="MODULE_NOT_FOUND",d}var g=i[y]={exports:{}};r[y][0].call(g.exports,function(S){var m=r[y][1][S];return o(m||S)},g,g.exports,t,r,i,s)}return i[y].exports}for(var c=typeof Yn=="function"&&Yn,u=0;u<s.length;u++)o(s[u]);return o}return t}()({1:[function(t,r,i){var s=t("domexception"),o=t("typeson"),c=t("typeson-registry/dist/presets/structured-cloning-throwing"),u=typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:typeof gr<"u"?gr:Function("return this;")();u.DOMException||(u.DOMException=s);var y=new o().register(c);function p(f){return y.revive(y.encapsulate(f))}r.exports=p},{domexception:5,typeson:8,"typeson-registry/dist/presets/structured-cloning-throwing":7}],2:[function(t,r,i){var s=function(){function p(f,d){var g=[],S=!0,m=!1,w=void 0;try{for(var _=f[Symbol.iterator](),v;!(S=(v=_.next()).done)&&(g.push(v.value),!(d&&g.length===d));S=!0);}catch(B){m=!0,w=B}finally{try{!S&&_.return&&_.return()}finally{if(m)throw w}}return g}return function(f,d){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f))return p(f,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function p(f,d){for(var g=0;g<d.length;g++){var S=d[g];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(f,S.key,S)}}return function(f,d,g){return d&&p(f.prototype,d),g&&p(f,g),f}}();function c(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}var u=t("./legacy-error-codes.json"),y=t("./utils.js");i.implementation=function(){function p(f){var d=s(f,2),g=d[0],S=d[1];c(this,p),this.name=S,this.message=g}return o(p,[{key:"code",get:function(){return u[this.name]||0}}]),p}(),i.init=function(p){if(Error.captureStackTrace){var f=y.wrapperForImpl(p);Error.captureStackTrace(f,f.constructor)}}},{"./legacy-error-codes.json":4,"./utils.js":6}],3:[function(t,r,i){var s=t("webidl-conversions"),o=t("./utils.js"),c=o.implSymbol;function u(){for(var f=[],d=0;d<arguments.length&&d<2;++d)f[d]=arguments[d];f[0]!==void 0?f[0]=s.DOMString(f[0],{context:"Failed to construct 'DOMException': parameter 1"}):f[0]="",f[1]!==void 0?f[1]=s.DOMString(f[1],{context:"Failed to construct 'DOMException': parameter 2"}):f[1]="Error",y.setup(this,f)}Object.defineProperty(u,"prototype",{value:u.prototype,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(u.prototype,"name",{get:function(){return this[c].name},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"message",{get:function(){return this[c].message},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"code",{get:function(){return this[c].code},enumerable:!0,configurable:!0}),Object.defineProperty(u,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(u.prototype,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(u,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(u.prototype,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(u,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(u.prototype,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(u,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(u.prototype,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(u,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(u.prototype,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(u,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(u.prototype,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(u,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(u.prototype,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(u,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(u.prototype,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(u,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(u.prototype,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(u,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(u.prototype,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(u,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(u.prototype,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(u,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(u.prototype,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(u,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(u.prototype,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(u,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(u.prototype,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(u,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(u.prototype,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(u,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(u.prototype,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(u,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(u.prototype,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(u,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(u.prototype,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(u,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(u.prototype,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(u,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(u.prototype,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(u,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(u.prototype,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(u,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(u.prototype,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(u,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(u.prototype,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(u,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(u.prototype,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(u,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(u.prototype,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(u.prototype,Symbol.toStringTag,{value:"DOMException",writable:!1,enumerable:!1,configurable:!0});var y={mixedInto:[],is:function(d){if(d){if(d[c]instanceof p.implementation)return!0;for(var g=0;g<r.exports.mixedInto.length;++g)if(d instanceof r.exports.mixedInto[g])return!0}return!1},isImpl:function(d){if(d){if(d instanceof p.implementation)return!0;for(var g=o.wrapperForImpl(d),S=0;S<r.exports.mixedInto.length;++S)if(g instanceof r.exports.mixedInto[S])return!0}return!1},convert:function(d){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},S=g.context,m=S===void 0?"The provided value":S;if(r.exports.is(d))return o.implForWrapper(d);throw new TypeError(m+" is not of type 'DOMException'.")},create:function(d,g){var S=Object.create(u.prototype);return this.setup(S,d,g),S},createImpl:function(d,g){var S=Object.create(u.prototype);return this.setup(S,d,g),o.implForWrapper(S)},_internalSetup:function(d){},setup:function(d,g,S){S||(S={}),S.wrapper=d,this._internalSetup(d),Object.defineProperty(d,c,{value:new p.implementation(g,S),writable:!1,enumerable:!1,configurable:!0}),d[c][o.wrapperSymbol]=d,p.init&&p.init(d[c],S)},interface:u,expose:{Window:{DOMException:u},Worker:{DOMException:u}}};r.exports=y;var p=t(".//DOMException-impl.js")},{".//DOMException-impl.js":2,"./utils.js":6,"webidl-conversions":9}],4:[function(t,r,i){r.exports={IndexSizeError:1,DOMStringSizeError:2,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoDataAllowedError:6,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,ValidationError:16,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25}},{}],5:[function(t,r,i){r.exports=t("./DOMException").interface,Object.setPrototypeOf(r.exports.prototype,Error.prototype)},{"./DOMException":3}],6:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O};function o(O){return(typeof O>"u"?"undefined":s(O))==="object"&&O!==null||typeof O=="function"}function c(O){return Object.getPrototypeOf(O)===Buffer.prototype?O:O instanceof ArrayBuffer?Buffer.from(O):Buffer.from(O.buffer,O.byteOffset,O.byteLength)}function u(O){return Buffer.from(c(O))}function y(O,x){for(var T=Object.getOwnPropertyNames(x),E=0;E<T.length;++E)T[E]in O||Object.defineProperty(O,T[E],Object.getOwnPropertyDescriptor(x,T[E]))}var p=Symbol("wrapper"),f=Symbol("impl"),d=Symbol("SameObject caches");function g(O,x,T){return O[d]||(O[d]=Object.create(null)),x in O[d]||(O[d][x]=T()),O[d][x]}function S(O){return O?O[p]:null}function m(O){return O?O[f]:null}function w(O){var x=S(O);return x||O}function _(O){var x=m(O);return x||O}var v=Symbol("internal"),B=Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()));r.exports={isObject:o,getReferenceToBytes:c,getCopyToBytes:u,mixin:y,wrapperSymbol:p,implSymbol:f,getSameObject:g,wrapperForImpl:S,implForWrapper:m,tryWrapperForImpl:w,tryImplForWrapper:_,iterInternalSymbol:v,IteratorPrototype:B}},{}],7:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};(function(o,c){(typeof i>"u"?"undefined":s(i))=="object"&&typeof r<"u"?r.exports=c():((o=typeof globalThis<"u"?globalThis:o||self).Typeson=o.Typeson||{},o.Typeson.presets=o.Typeson.presets||{},o.Typeson.presets.structuredCloningThrowing=c())})(void 0,function(){function o(h){return(o=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(a){return typeof a>"u"?"undefined":s(a)}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a>"u"?"undefined":s(a)})(h)}function c(h,a){if(!(h instanceof a))throw new TypeError("Cannot call a class as a function")}function u(h,a){for(var l=0;l<a.length;l++){var b=a[l];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(h,b.key,b)}}function y(h,a,l){return a in h?Object.defineProperty(h,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):h[a]=l,h}function p(h,a){var l=Object.keys(h);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(h);a&&(b=b.filter(function(A){return Object.getOwnPropertyDescriptor(h,A).enumerable})),l.push.apply(l,b)}return l}function f(h){return function(l){if(Array.isArray(l))return d(l)}(h)||function(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}(h)||function(l,b){if(l){if(typeof l=="string")return d(l,b);var A=Object.prototype.toString.call(l).slice(8,-1);if(A==="Object"&&l.constructor&&(A=l.constructor.name),A==="Map"||A==="Set")return Array.from(l);if(A==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A))return d(l,b)}}(h)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function d(h,a){(a==null||a>h.length)&&(a=h.length);for(var l=0,b=new Array(a);l<a;l++)b[l]=h[l];return b}function g(h){return(g=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(l){return typeof l>"u"?"undefined":s(l)}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l>"u"?"undefined":s(l)})(h)}function S(h,a){if(!(h instanceof a))throw new TypeError("Cannot call a class as a function")}function m(h,a){for(var l=0;l<a.length;l++){var b=a[l];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(h,b.key,b)}}function w(h,a,l){return a in h?Object.defineProperty(h,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):h[a]=l,h}function _(h,a){var l=Object.keys(h);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(h);a&&(b=b.filter(function(A){return Object.getOwnPropertyDescriptor(h,A).enumerable})),l.push.apply(l,b)}return l}function v(h){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?_(Object(l),!0).forEach(function(b){w(h,b,l[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(l)):_(Object(l)).forEach(function(b){Object.defineProperty(h,b,Object.getOwnPropertyDescriptor(l,b))})}return h}function B(h,a){return function(b){if(Array.isArray(b))return b}(h)||function(b,A){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(b)))){var R=[],L=!0,G=!1,U=void 0;try{for(var le,ee=b[Symbol.iterator]();!(L=(le=ee.next()).done)&&(R.push(le.value),!A||R.length!==A);L=!0);}catch(he){G=!0,U=he}finally{try{L||ee.return==null||ee.return()}finally{if(G)throw U}}return R}}(h,a)||x(h,a)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function O(h){return function(l){if(Array.isArray(l))return T(l)}(h)||function(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}(h)||x(h)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function x(h,a){if(h){if(typeof h=="string")return T(h,a);var l=Object.prototype.toString.call(h).slice(8,-1);return l==="Object"&&h.constructor&&(l=h.constructor.name),l==="Map"||l==="Set"?Array.from(h):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?T(h,a):void 0}}function T(h,a){(a==null||a>h.length)&&(a=h.length);for(var l=0,b=new Array(a);l<a;l++)b[l]=h[l];return b}var E=function h(a){S(this,h),this.p=new Promise(a)};E.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(E.prototype[Symbol.toStringTag]="TypesonPromise"),E.prototype.then=function(h,a){var l=this;return new E(function(b,A){l.p.then(function(R){b(h?h(R):R)}).catch(function(R){return a?a(R):Promise.reject(R)}).then(b,A)})},E.prototype.catch=function(h){return this.then(null,h)},E.resolve=function(h){return new E(function(a){a(h)})},E.reject=function(h){return new E(function(a,l){l(h)})},["all","race"].forEach(function(h){E[h]=function(a){return new E(function(l,b){Promise[h](a.map(function(A){return A&&A.constructor&&A.constructor.__typeson__type__==="TypesonPromise"?A.p:A})).then(l,b)})}});var P={}.toString,I={}.hasOwnProperty,ue=Object.getPrototypeOf,Z=I.toString;function we(h,a){return Ue(h)&&typeof h.then=="function"&&(!a||typeof h.catch=="function")}function Ee(h){return P.call(h).slice(8,-1)}function z(h,a){if(!h||g(h)!=="object")return!1;var l=ue(h);if(!l)return a===null;var b=I.call(l,"constructor")&&l.constructor;return typeof b!="function"?a===null:a===b||a!==null&&Z.call(b)===Z.call(a)||typeof a=="function"&&typeof b.__typeson__type__=="string"&&b.__typeson__type__===a.__typeson__type__}function Le(h){return!(!h||Ee(h)!=="Object")&&(!ue(h)||z(h,Object))}function Ue(h){return h&&g(h)==="object"}function De(h){return h.replace(/~/g,"~0").replace(/\./g,"~1")}function Ve(h){return h.replace(/~1/g,".").replace(/~0/g,"~")}function Ze(h,a){if(a==="")return h;var l=a.indexOf(".");if(l>-1){var b=h[Ve(a.slice(0,l))];return b===void 0?void 0:Ze(b,a.slice(l+1))}return h[Ve(a)]}function Dt(h,a,l){if(a==="")return l;var b=a.indexOf(".");return b>-1?Dt(h[Ve(a.slice(0,b))],a.slice(b+1),l):(h[Ve(a)]=l,h)}function Ne(h,a,l){return l?a?a(h):h:(h&&h.then||(h=Promise.resolve(h)),a?h.then(a):h)}var Nt=Object.keys,C=Array.isArray,F={}.hasOwnProperty,D=["type","replaced","iterateIn","iterateUnsetNumeric"];function j(h){return function(){for(var a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];try{return Promise.resolve(h.apply(this,a))}catch(b){return Promise.reject(b)}}}function K(h,a){if(h.keypath==="")return-1;var l=h.keypath.match(/\./g)||0,b=a.keypath.match(/\./g)||0;return l&&(l=l.length),b&&(b=b.length),l>b?-1:l<b?1:h.keypath<a.keypath?-1:h.keypath>a.keypath}var k=function(){function h(a){S(this,h),this.options=a,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(l,b,A){return b&&m(l.prototype,b),A&&m(l,A),l}(h,[{key:"stringify",value:function(l,b,A,R){R=v(v(v({},this.options),R),{},{stringification:!0});var L=this.encapsulate(l,null,R);return C(L)?JSON.stringify(L[0],b,A):L.then(function(G){return JSON.stringify(G,b,A)})}},{key:"stringifySync",value:function(l,b,A,R){return this.stringify(l,b,A,v(v({throwOnBadSyncType:!0},R),{},{sync:!0}))}},{key:"stringifyAsync",value:function(l,b,A,R){return this.stringify(l,b,A,v(v({throwOnBadSyncType:!0},R),{},{sync:!1}))}},{key:"parse",value:function(l,b,A){return A=v(v(v({},this.options),A),{},{parse:!0}),this.revive(JSON.parse(l,b),A)}},{key:"parseSync",value:function(l,b,A){return this.parse(l,b,v(v({throwOnBadSyncType:!0},A),{},{sync:!0}))}},{key:"parseAsync",value:function(l,b,A){return this.parse(l,b,v(v({throwOnBadSyncType:!0},A),{},{sync:!1}))}},{key:"specialTypeNames",value:function(l,b){var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return A.returnTypeNames=!0,this.encapsulate(l,b,A)}},{key:"rootTypeName",value:function(l,b){var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return A.iterateNone=!0,this.encapsulate(l,b,A)}},{key:"encapsulate",value:function(l,b,A){var R=j(function(H,M){return Ne(Promise.all(M.map(function(oe){return oe[1].p})),function(oe){return Ne(Promise.all(oe.map(j(function(J){var fe=!1,ge=[],ot=B(M.splice(0,1),1),je=B(ot[0],7),it=je[0],dt=je[2],pe=je[3],pt=je[4],_e=je[5],at=je[6],Ye=te(it,J,dt,pe,ge,!0,at),yt=z(Ye,E);return function(br,Mn){var rn=br();return rn&&rn.then?rn.then(Mn):Mn(rn)}(function(){if(it&&yt)return Ne(Ye.p,function(mt){return pt[_e]=mt,fe=!0,R(H,ge)})},function(mt){return fe?mt:(it?pt[_e]=Ye:H=yt?Ye.p:Ye,R(H,ge))})}))),function(){return H})})}),L=(A=v(v({sync:!0},this.options),A)).sync,G=this,U={},le=[],ee=[],he=[],ke=!("cyclic"in A)||A.cyclic,Be=A.encapsulateObserver,At=te("",l,ke,b||{},he);function xe(H){var M=Object.values(U);if(A.iterateNone)return M.length?M[0]:h.getJSONType(H);if(M.length){if(A.returnTypeNames)return O(new Set(M));H&&Le(H)&&!F.call(H,"$types")?H.$types=U:H={$:H,$types:{$:U}}}else Ue(H)&&F.call(H,"$types")&&(H={$:H,$types:!0});return!A.returnTypeNames&&H}function Ie(H,M,oe){Object.assign(H,M);var J=D.map(function(fe){var ge=H[fe];return delete H[fe],ge});oe(),D.forEach(function(fe,ge){H[fe]=J[ge]})}function te(H,M,oe,J,fe,ge,ot){var je,it={},dt=g(M),pe=Be?function(Kt){var ze=ot||J.type||h.getJSONType(M);Be(Object.assign(Kt||it,{keypath:H,value:M,cyclic:oe,stateObj:J,promisesData:fe,resolvingTypesonPromise:ge,awaitingTypesonPromise:z(M,E)},{type:ze}))}:null;if(["string","boolean","number","undefined"].includes(dt))return M===void 0||Number.isNaN(M)||M===Number.NEGATIVE_INFINITY||M===Number.POSITIVE_INFINITY?(je=J.replaced?M:ft(H,M,J,fe,!1,ge,pe))!==M&&(it={replaced:je}):je=M,pe&&pe(),je;if(M===null)return pe&&pe(),M;if(oe&&!J.iterateIn&&!J.iterateUnsetNumeric&&M&&g(M)==="object"){var pt=le.indexOf(M);if(!(pt<0))return U[H]="#",pe&&pe({cyclicKeypath:ee[pt]}),"#"+ee[pt];oe===!0&&(le.push(M),ee.push(H))}var _e,at=Le(M),Ye=C(M),yt=(at||Ye)&&(!G.plainObjectReplacers.length||J.replaced)||J.iterateIn?M:ft(H,M,J,fe,at||Ye,null,pe);if(yt!==M?(je=yt,it={replaced:yt}):H===""&&z(M,E)?(fe.push([H,M,oe,J,void 0,void 0,J.type]),je=M):Ye&&J.iterateIn!=="object"||J.iterateIn==="array"?(_e=new Array(M.length),it={clone:_e}):(["function","symbol"].includes(g(M))||"toJSON"in M||z(M,E)||z(M,Promise)||z(M,ArrayBuffer))&&!at&&J.iterateIn!=="object"?je=M:(_e={},J.addLength&&(_e.length=M.length),it={clone:_e}),pe&&pe(),A.iterateNone)return _e||je;if(!_e)return je;if(J.iterateIn){var mt=function(ze){var Ft={ownKeys:F.call(M,ze)};Ie(J,Ft,function(){var Ht=H+(H?".":"")+De(ze),qn=te(Ht,M[ze],!!oe,J,fe,ge);z(qn,E)?fe.push([Ht,qn,!!oe,J,_e,ze,J.type]):qn!==void 0&&(_e[ze]=qn)})};for(var br in M)mt(br);pe&&pe({endIterateIn:!0,end:!0})}else Nt(M).forEach(function(Kt){var ze=H+(H?".":"")+De(Kt);Ie(J,{ownKeys:!0},function(){var Ft=te(ze,M[Kt],!!oe,J,fe,ge);z(Ft,E)?fe.push([ze,Ft,!!oe,J,_e,Kt,J.type]):Ft!==void 0&&(_e[Kt]=Ft)})}),pe&&pe({endIterateOwn:!0,end:!0});if(J.iterateUnsetNumeric){for(var Mn=M.length,rn=function(ze){if(!(ze in M)){var Ft=H+(H?".":"")+ze;Ie(J,{ownKeys:!1},function(){var Ht=te(Ft,void 0,!!oe,J,fe,ge);z(Ht,E)?fe.push([Ft,Ht,!!oe,J,_e,ze,J.type]):Ht!==void 0&&(_e[ze]=Ht)})}},vr=0;vr<Mn;vr++)rn(vr);pe&&pe({endIterateUnsetNumeric:!0,end:!0})}return _e}function ft(H,M,oe,J,fe,ge,ot){for(var je=fe?G.plainObjectReplacers:G.nonplainObjectReplacers,it=je.length;it--;){var dt=je[it];if(dt.test(M,oe)){var pe=dt.type;if(G.revivers[pe]){var pt=U[H];U[H]=pt?[pe].concat(pt):pe}return Object.assign(oe,{type:pe,replaced:!0}),!L&&dt.replaceAsync||dt.replace?(ot&&ot({replacing:!0}),te(H,dt[L||!dt.replaceAsync?"replace":"replaceAsync"](M,oe),ke&&"readonly",oe,J,ge,pe)):(ot&&ot({typeDetected:!0}),te(H,M,ke&&"readonly",oe,J,ge,pe))}}return M}return he.length?L&&A.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(R(At,he)).then(xe):!L&&A.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():A.stringification&&L?[xe(At)]:L?xe(At):Promise.resolve(xe(At))}},{key:"encapsulateSync",value:function(l,b,A){return this.encapsulate(l,b,v(v({throwOnBadSyncType:!0},A),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(l,b,A){return this.encapsulate(l,b,v(v({throwOnBadSyncType:!0},A),{},{sync:!1}))}},{key:"revive",value:function(l,b){var A=l&&l.$types;if(!A)return l;if(A===!0)return l.$;var R=(b=v(v({sync:!0},this.options),b)).sync,L=[],G={},U=!0;A.$&&Le(A.$)&&(l=l.$,A=A.$,U=!1);var le=this;function ee(xe,Ie){var te=B(le.revivers[xe]||[],1)[0];if(!te)throw new Error("Unregistered type: "+xe);return R&&!("revive"in te)?Ie:te[R&&te.revive?"revive":!R&&te.reviveAsync?"reviveAsync":"revive"](Ie,G)}var he=[];function ke(xe){return z(xe,ve)?void 0:xe}var Be,At=function(){var Ie=[];if(Object.entries(A).forEach(function(te){var ft=B(te,2),H=ft[0],M=ft[1];M!=="#"&&[].concat(M).forEach(function(oe){B(le.revivers[oe]||[null,{}],2)[1].plain&&(Ie.push({keypath:H,type:oe}),delete A[H])})}),Ie.length)return Ie.sort(K).reduce(function te(ft,H){var M=H.keypath,oe=H.type;if(we(ft))return ft.then(function(ge){return te(ge,{keypath:M,type:oe})});var J=Ze(l,M);if(z(J=ee(oe,J),E))return J.then(function(ge){var ot=Dt(l,M,ge);ot===ge&&(l=ot)});var fe=Dt(l,M,J);fe===J&&(l=fe)},void 0)}();return z(At,E)?Be=At.then(function(){return l}):(Be=function xe(Ie,te,ft,H,M){if(!U||Ie!=="$types"){var oe=A[Ie],J=C(te);if(J||Le(te)){var fe=J?new Array(te.length):{};for(Nt(te).forEach(function(_e){var at=xe(Ie+(Ie?".":"")+De(_e),te[_e],ft||fe,fe,_e),Ye=function(mt){return z(mt,ve)?fe[_e]=void 0:mt!==void 0&&(fe[_e]=mt),mt};z(at,E)?he.push(at.then(function(yt){return Ye(yt)})):Ye(at)}),te=fe;L.length;){var ge=B(L[0],4),ot=ge[0],je=ge[1],it=ge[2],dt=ge[3],pe=Ze(ot,je);if(pe===void 0)break;it[dt]=pe,L.splice(0,1)}}if(!oe)return te;if(oe==="#"){var pt=Ze(ft,te.slice(1));return pt===void 0&&L.push([ft,te.slice(1),H,M]),pt}return[].concat(oe).reduce(function _e(at,Ye){return z(at,E)?at.then(function(yt){return _e(yt,Ye)}):ee(Ye,at)},te)}}("",l,null),he.length&&(Be=E.resolve(Be).then(function(xe){return E.all([xe].concat(he))}).then(function(xe){return B(xe,1)[0]}))),we(Be)?R&&b.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():z(Be,E)?Be.p.then(ke):Be:!R&&b.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():R?ke(Be):Promise.resolve(ke(Be))}},{key:"reviveSync",value:function(l,b){return this.revive(l,v(v({throwOnBadSyncType:!0},b),{},{sync:!0}))}},{key:"reviveAsync",value:function(l,b){return this.revive(l,v(v({throwOnBadSyncType:!0},b),{},{sync:!1}))}},{key:"register",value:function(l,b){return b=b||{},[].concat(l).forEach(function A(R){var L=this;if(C(R))return R.map(function(G){return A.call(L,G)});R&&Nt(R).forEach(function(G){if(G==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(h.JSON_TYPES.includes(G))throw new TypeError("Plain JSON object types are reserved as type names");var U=R[G],le=U&&U.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,ee=le.filter(function(Ie){return Ie.type===G});if(ee.length&&(le.splice(le.indexOf(ee[0]),1),delete this.revivers[G],delete this.types[G]),typeof U=="function"){var he=U;U={test:function(te){return te&&te.constructor===he},replace:function(te){return v({},te)},revive:function(te){return Object.assign(Object.create(he.prototype),te)}}}else if(C(U)){var ke=B(U,3);U={test:ke[0],replace:ke[1],revive:ke[2]}}if(U&&U.test){var Be={type:G,test:U.test.bind(U)};U.replace&&(Be.replace=U.replace.bind(U)),U.replaceAsync&&(Be.replaceAsync=U.replaceAsync.bind(U));var At=typeof b.fallback=="number"?b.fallback:b.fallback?0:Number.POSITIVE_INFINITY;if(U.testPlainObjects?this.plainObjectReplacers.splice(At,0,Be):this.nonplainObjectReplacers.splice(At,0,Be),U.revive||U.reviveAsync){var xe={};U.revive&&(xe.revive=U.revive.bind(U)),U.reviveAsync&&(xe.reviveAsync=U.reviveAsync.bind(U)),this.revivers[G]=[xe,{plain:U.testPlainObjects}]}this.types[G]=U}},this)},this),this}}]),h}(),ve=function h(){S(this,h)};ve.__typeson__type__="TypesonUndefined",k.Undefined=ve,k.Promise=E,k.isThenable=we,k.toStringTag=Ee,k.hasConstructorOf=z,k.isObject=Ue,k.isPlainObject=Le,k.isUserObject=function h(a){if(!a||Ee(a)!=="Object")return!1;var l=ue(a);return!l||z(a,Object)||h(l)},k.escapeKeyPathComponent=De,k.unescapeKeyPathComponent=Ve,k.getByKeyPath=Ze,k.getJSONType=function(a){return a===null?"null":Array.isArray(a)?"array":g(a)},k.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Ae={userObject:{test:function(a,l){return k.isUserObject(a)},replace:function(a){return function(b){for(var A=1;A<arguments.length;A++){var R=arguments[A]!=null?arguments[A]:{};A%2?p(Object(R),!0).forEach(function(L){y(b,L,R[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(R)):p(Object(R)).forEach(function(L){Object.defineProperty(b,L,Object.getOwnPropertyDescriptor(R,L))})}return b}({},a)},revive:function(a){return a}}},X=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(a,l){return!!Array.isArray(a)&&(Object.keys(a).some(function(b){return String(Number.parseInt(b))!==b})&&(l.iterateIn="object",l.addLength=!0),!0)},replace:function(a,l){return l.iterateUnsetNumeric=!0,a},revive:function(a){if(Array.isArray(a))return a;var l=[];return Object.keys(a).forEach(function(b){var A=a[b];l[b]=A}),l}}},{sparseUndefined:{test:function(a,l){return a===void 0&&l.ownKeys===!1},replace:function(a){return 0},revive:function(a){}}}],et={undef:{test:function(a,l){return a===void 0&&(l.ownKeys||!("ownKeys"in l))},replace:function(a){return 0},revive:function(a){return new k.Undefined}}},He={StringObject:{test:function(a){return k.toStringTag(a)==="String"&&o(a)==="object"},replace:function(a){return String(a)},revive:function(a){return new String(a)}},BooleanObject:{test:function(a){return k.toStringTag(a)==="Boolean"&&o(a)==="object"},replace:function(a){return!!a},revive:function(a){return new Boolean(a)}},NumberObject:{test:function(a){return k.toStringTag(a)==="Number"&&o(a)==="object"},replace:function(a){return Number(a)},revive:function(a){return new Number(a)}}},tt=[{nan:{test:function(a){return Number.isNaN(a)},replace:function(a){return"NaN"},revive:function(a){return Number.NaN}}},{infinity:{test:function(a){return a===Number.POSITIVE_INFINITY},replace:function(a){return"Infinity"},revive:function(a){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(a){return a===Number.NEGATIVE_INFINITY},replace:function(a){return"-Infinity"},revive:function(a){return Number.NEGATIVE_INFINITY}}}],st={date:{test:function(a){return k.toStringTag(a)==="Date"},replace:function(a){var l=a.getTime();return Number.isNaN(l)?"NaN":l},revive:function(a){return a==="NaN"?new Date(Number.NaN):new Date(a)}}},Te={regexp:{test:function(a){return k.toStringTag(a)==="RegExp"},replace:function(a){return{source:a.source,flags:(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.sticky?"y":"")+(a.unicode?"u":"")}},revive:function(a){var l=a.source,b=a.flags;return new RegExp(l,b)}}},ht={map:{test:function(a){return k.toStringTag(a)==="Map"},replace:function(a){return f(a.entries())},revive:function(a){return new Map(a)}}},Fe={set:{test:function(a){return k.toStringTag(a)==="Set"},replace:function(a){return f(a.values())},revive:function(a){return new Set(a)}}},me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q=new Uint8Array(256),Me=0;Me<me.length;Me++)Q[me.charCodeAt(Me)]=Me;var V=function(a,l,b){b==null&&(b=a.byteLength);for(var A=new Uint8Array(a,l||0,b),R=A.length,L="",G=0;G<R;G+=3)L+=me[A[G]>>2],L+=me[(3&A[G])<<4|A[G+1]>>4],L+=me[(15&A[G+1])<<2|A[G+2]>>6],L+=me[63&A[G+2]];return R%3==2?L=L.slice(0,-1)+"=":R%3==1&&(L=L.slice(0,-2)+"=="),L},N=function(a){var l,b,A,R,L=a.length,G=.75*a.length,U=0;a[a.length-1]==="="&&(G--,a[a.length-2]==="="&&G--);for(var le=new ArrayBuffer(G),ee=new Uint8Array(le),he=0;he<L;he+=4)l=Q[a.charCodeAt(he)],b=Q[a.charCodeAt(he+1)],A=Q[a.charCodeAt(he+2)],R=Q[a.charCodeAt(he+3)],ee[U++]=l<<2|b>>4,ee[U++]=(15&b)<<4|A>>2,ee[U++]=(3&A)<<6|63&R;return le},ne={arraybuffer:{test:function(a){return k.toStringTag(a)==="ArrayBuffer"},replace:function(a,l){l.buffers||(l.buffers=[]);var b=l.buffers.indexOf(a);return b>-1?{index:b}:(l.buffers.push(a),V(a))},revive:function(a,l){if(l.buffers||(l.buffers=[]),o(a)==="object")return l.buffers[a.index];var b=N(a);return l.buffers.push(b),b}}},Y=typeof self>"u"?gr:self,se={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(h){var a=h,l=Y[a];l&&(se[h.toLowerCase()]={test:function(A){return k.toStringTag(A)===a},replace:function(A,R){var L=A.buffer,G=A.byteOffset,U=A.length;R.buffers||(R.buffers=[]);var le=R.buffers.indexOf(L);return le>-1?{index:le,byteOffset:G,length:U}:(R.buffers.push(L),{encoded:V(L),byteOffset:G,length:U})},revive:function(A,R){R.buffers||(R.buffers=[]);var L,G=A.byteOffset,U=A.length,le=A.encoded,ee=A.index;return"index"in A?L=R.buffers[ee]:(L=N(le),R.buffers.push(L)),new l(L,G,U)}})});var de={dataview:{test:function(a){return k.toStringTag(a)==="DataView"},replace:function(a,l){var b=a.buffer,A=a.byteOffset,R=a.byteLength;l.buffers||(l.buffers=[]);var L=l.buffers.indexOf(b);return L>-1?{index:L,byteOffset:A,byteLength:R}:(l.buffers.push(b),{encoded:V(b),byteOffset:A,byteLength:R})},revive:function(a,l){l.buffers||(l.buffers=[]);var b,A=a.byteOffset,R=a.byteLength,L=a.encoded,G=a.index;return"index"in a?b=l.buffers[G]:(b=N(L),l.buffers.push(b)),new DataView(b,A,R)}}},We={IntlCollator:{test:function(a){return k.hasConstructorOf(a,Intl.Collator)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.Collator(a.locale,a)}},IntlDateTimeFormat:{test:function(a){return k.hasConstructorOf(a,Intl.DateTimeFormat)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.DateTimeFormat(a.locale,a)}},IntlNumberFormat:{test:function(a){return k.hasConstructorOf(a,Intl.NumberFormat)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.NumberFormat(a.locale,a)}}};function Ce(h){for(var a=new Uint8Array(h.length),l=0;l<h.length;l++)a[l]=h.charCodeAt(l);return a.buffer}var qe={file:{test:function(a){return k.toStringTag(a)==="File"},replace:function(a){var l=new XMLHttpRequest;if(l.overrideMimeType("text/plain; charset=x-user-defined"),l.open("GET",URL.createObjectURL(a),!1),l.send(),l.status!==200&&l.status!==0)throw new Error("Bad File access: "+l.status);return{type:a.type,stringContents:l.responseText,name:a.name,lastModified:a.lastModified}},revive:function(a){var l=a.name,b=a.type,A=a.stringContents,R=a.lastModified;return new File([Ce(A)],l,{type:b,lastModified:R})},replaceAsync:function(a){return new k.Promise(function(l,b){var A=new FileReader;A.addEventListener("load",function(){l({type:a.type,stringContents:A.result,name:a.name,lastModified:a.lastModified})}),A.addEventListener("error",function(){b(A.error)}),A.readAsBinaryString(a)})}}},nt={bigint:{test:function(a){return typeof a=="bigint"},replace:function(a){return String(a)},revive:function(a){return BigInt(a)}}},ce={bigintObject:{test:function(a){return o(a)==="object"&&k.hasConstructorOf(a,BigInt)},replace:function(a){return String(a)},revive:function(a){return new Object(BigInt(a))}}},rt={cryptokey:{test:function(a){return k.toStringTag(a)==="CryptoKey"&&a.extractable},replaceAsync:function(a){return new k.Promise(function(l,b){crypto.subtle.exportKey("jwk",a).catch(function(A){b(A)}).then(function(A){l({jwk:A,algorithm:a.algorithm,usages:a.usages})})})},revive:function(a){var l=a.jwk,b=a.algorithm,A=a.usages;return crypto.subtle.importKey("jwk",l,b,!0,A)}}};return[Ae,et,X,He,tt,st,Te,{imagedata:{test:function(a){return k.toStringTag(a)==="ImageData"},replace:function(a){return{array:f(a.data),width:a.width,height:a.height}},revive:function(a){return new ImageData(new Uint8ClampedArray(a.array),a.width,a.height)}}},{imagebitmap:{test:function(a){return k.toStringTag(a)==="ImageBitmap"||a&&a.dataset&&a.dataset.toStringTag==="ImageBitmap"},replace:function(a){var l=document.createElement("canvas");return l.getContext("2d").drawImage(a,0,0),l.toDataURL()},revive:function(a){var l=document.createElement("canvas"),b=l.getContext("2d"),A=document.createElement("img");return A.addEventListener("load",function(){b.drawImage(A,0,0)}),A.src=a,l},reviveAsync:function(a){var l=document.createElement("canvas"),b=l.getContext("2d"),A=document.createElement("img");return A.addEventListener("load",function(){b.drawImage(A,0,0)}),A.src=a,createImageBitmap(l)}}},qe,{file:qe.file,filelist:{test:function(a){return k.toStringTag(a)==="FileList"},replace:function(a){for(var l=[],b=0;b<a.length;b++)l[b]=a.item(b);return l},revive:function(a){return new(function(){function l(){c(this,l),this._files=arguments[0],this.length=this._files.length}return function(A,R,L){return R&&u(A.prototype,R),L&&u(A,L),A}(l,[{key:"item",value:function(A){return this._files[A]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),l}())(a)}}},{blob:{test:function(a){return k.toStringTag(a)==="Blob"},replace:function(a){var l=new XMLHttpRequest;if(l.overrideMimeType("text/plain; charset=x-user-defined"),l.open("GET",URL.createObjectURL(a),!1),l.send(),l.status!==200&&l.status!==0)throw new Error("Bad Blob access: "+l.status);return{type:a.type,stringContents:l.responseText}},revive:function(a){var l=a.type,b=a.stringContents;return new Blob([Ce(b)],{type:l})},replaceAsync:function(a){return new k.Promise(function(l,b){var A=new FileReader;A.addEventListener("load",function(){l({type:a.type,stringContents:A.result})}),A.addEventListener("error",function(){b(A.error)}),A.readAsBinaryString(a)})}}}].concat(typeof Map=="function"?ht:[],typeof Set=="function"?Fe:[],typeof ArrayBuffer=="function"?ne:[],typeof Uint8Array=="function"?se:[],typeof DataView=="function"?de:[],typeof Intl<"u"?We:[],typeof crypto<"u"?rt:[],typeof BigInt<"u"?[nt,ce]:[]).concat({checkDataCloneException:{test:function(a){var l={}.toString.call(a).slice(8,-1);if(["symbol","function"].includes(o(a))||["Arguments","Module","Error","Promise","WeakMap","WeakSet","Event","MessageChannel"].includes(l)||a&&o(a)==="object"&&typeof a.nodeType=="number"&&typeof a.insertBefore=="function")throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}}})})},{}],8:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C};function o(C){return(o=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(F){return typeof F>"u"?"undefined":s(F)}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F>"u"?"undefined":s(F)})(C)}function c(C,F){if(!(C instanceof F))throw new TypeError("Cannot call a class as a function")}function u(C,F){for(var D=0;D<F.length;D++){var j=F[D];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(C,j.key,j)}}function y(C,F,D){return F in C?Object.defineProperty(C,F,{value:D,enumerable:!0,configurable:!0,writable:!0}):C[F]=D,C}function p(C,F){var D=Object.keys(C);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(C);F&&(j=j.filter(function(K){return Object.getOwnPropertyDescriptor(C,K).enumerable})),D.push.apply(D,j)}return D}function f(C){for(var F=1;F<arguments.length;F++){var D=arguments[F]!=null?arguments[F]:{};F%2?p(Object(D),!0).forEach(function(j){y(C,j,D[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(D)):p(Object(D)).forEach(function(j){Object.defineProperty(C,j,Object.getOwnPropertyDescriptor(D,j))})}return C}function d(C,F){return function(j){if(Array.isArray(j))return j}(C)||function(j,K){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(j)))){var k=[],ve=!0,Ae=!1,X=void 0;try{for(var et,He=j[Symbol.iterator]();!(ve=(et=He.next()).done)&&(k.push(et.value),!K||k.length!==K);ve=!0);}catch(tt){Ae=!0,X=tt}finally{try{ve||He.return==null||He.return()}finally{if(Ae)throw X}}return k}}(C,F)||S(C,F)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function g(C){return function(D){if(Array.isArray(D))return m(D)}(C)||function(D){if(typeof Symbol<"u"&&Symbol.iterator in Object(D))return Array.from(D)}(C)||S(C)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function S(C,F){if(C){if(typeof C=="string")return m(C,F);var D=Object.prototype.toString.call(C).slice(8,-1);return D==="Object"&&C.constructor&&(D=C.constructor.name),D==="Map"||D==="Set"?Array.from(C):D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D)?m(C,F):void 0}}function m(C,F){(F==null||F>C.length)&&(F=C.length);for(var D=0,j=new Array(F);D<F;D++)j[D]=C[D];return j}var w=function C(F){c(this,C),this.p=new Promise(F)};w.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(w.prototype[Symbol.toStringTag]="TypesonPromise"),w.prototype.then=function(C,F){var D=this;return new w(function(j,K){D.p.then(function(k){j(C?C(k):k)}).catch(function(k){return F?F(k):Promise.reject(k)}).then(j,K)})},w.prototype.catch=function(C){return this.then(null,C)},w.resolve=function(C){return new w(function(F){F(C)})},w.reject=function(C){return new w(function(F,D){D(C)})},["all","race","allSettled"].forEach(function(C){w[C]=function(F){return new w(function(D,j){Promise[C](F.map(function(K){return K&&K.constructor&&K.constructor.__typeson__type__==="TypesonPromise"?K.p:K})).then(D,j)})}});var _={}.toString,v={}.hasOwnProperty,B=Object.getPrototypeOf,O=v.toString;function x(C,F){return I(C)&&typeof C.then=="function"&&(!F||typeof C.catch=="function")}function T(C){return _.call(C).slice(8,-1)}function E(C,F){if(!C||o(C)!=="object")return!1;var D=B(C);if(!D)return F===null;var j=v.call(D,"constructor")&&D.constructor;return typeof j!="function"?F===null:F===j||F!==null&&O.call(j)===O.call(F)||typeof F=="function"&&typeof j.__typeson__type__=="string"&&j.__typeson__type__===F.__typeson__type__}function P(C){return!(!C||T(C)!=="Object")&&(!B(C)||E(C,Object))}function I(C){return C&&o(C)==="object"}function ue(C){return C.replace(/~/g,"~0").replace(/\./g,"~1")}function Z(C){return C.replace(/~1/g,".").replace(/~0/g,"~")}function we(C,F){if(F==="")return C;var D=F.indexOf(".");if(D>-1){var j=C[Z(F.slice(0,D))];return j===void 0?void 0:we(j,F.slice(D+1))}return C[Z(F)]}function Ee(C,F,D){if(F==="")return D;var j=F.indexOf(".");return j>-1?Ee(C[Z(F.slice(0,j))],F.slice(j+1),D):(C[Z(F)]=D,C)}function z(C,F,D){return D?F?F(C):C:(C&&C.then||(C=Promise.resolve(C)),F?C.then(F):C)}var Le=Object.keys,Ue=Array.isArray,De={}.hasOwnProperty,Ve=["type","replaced","iterateIn","iterateUnsetNumeric"];function Ze(C){return function(){for(var F=[],D=0;D<arguments.length;D++)F[D]=arguments[D];try{return Promise.resolve(C.apply(this,F))}catch(j){return Promise.reject(j)}}}function Dt(C,F){if(C.keypath==="")return-1;var D=C.keypath.match(/\./g)||0,j=F.keypath.match(/\./g)||0;return D&&(D=D.length),j&&(j=j.length),D>j?-1:D<j?1:C.keypath<F.keypath?-1:C.keypath>F.keypath}var Ne=function(){function C(F){c(this,C),this.options=F,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(D,j,K){return j&&u(D.prototype,j),K&&u(D,K),D}(C,[{key:"stringify",value:function(D,j,K,k){k=f(f(f({},this.options),k),{},{stringification:!0});var ve=this.encapsulate(D,null,k);return Ue(ve)?JSON.stringify(ve[0],j,K):ve.then(function(Ae){return JSON.stringify(Ae,j,K)})}},{key:"stringifySync",value:function(D,j,K,k){return this.stringify(D,j,K,f(f({throwOnBadSyncType:!0},k),{},{sync:!0}))}},{key:"stringifyAsync",value:function(D,j,K,k){return this.stringify(D,j,K,f(f({throwOnBadSyncType:!0},k),{},{sync:!1}))}},{key:"parse",value:function(D,j,K){return K=f(f(f({},this.options),K),{},{parse:!0}),this.revive(JSON.parse(D,j),K)}},{key:"parseSync",value:function(D,j,K){return this.parse(D,j,f(f({throwOnBadSyncType:!0},K),{},{sync:!0}))}},{key:"parseAsync",value:function(D,j,K){return this.parse(D,j,f(f({throwOnBadSyncType:!0},K),{},{sync:!1}))}},{key:"specialTypeNames",value:function(D,j){var K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return K.returnTypeNames=!0,this.encapsulate(D,j,K)}},{key:"rootTypeName",value:function(D,j){var K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return K.iterateNone=!0,this.encapsulate(D,j,K)}},{key:"encapsulate",value:function(D,j,K){var k=Ze(function(V,N){return z(Promise.all(N.map(function(ne){return ne[1].p})),function(ne){return z(Promise.all(ne.map(Ze(function(Y){var se=!1,de=[],We=d(N.splice(0,1),1),Ce=d(We[0],7),qe=Ce[0],nt=Ce[2],ce=Ce[3],rt=Ce[4],h=Ce[5],a=Ce[6],l=Q(qe,Y,nt,ce,de,!0,a),b=E(l,w);return function(R,L){var G=R();return G&&G.then?G.then(L):L(G)}(function(){if(qe&&b)return z(l.p,function(A){return rt[h]=A,se=!0,k(V,de)})},function(A){return se?A:(qe?rt[h]=l:V=b?l.p:l,k(V,de))})}))),function(){return V})})}),ve=(K=f(f({sync:!0},this.options),K)).sync,Ae=this,X={},et=[],He=[],tt=[],st=!("cyclic"in K)||K.cyclic,Te=K.encapsulateObserver,ht=Q("",D,st,j||{},tt);function Fe(V){var N=Object.values(X);if(K.iterateNone)return N.length?N[0]:C.getJSONType(V);if(N.length){if(K.returnTypeNames)return g(new Set(N));V&&P(V)&&!De.call(V,"$types")?V.$types=X:V={$:V,$types:{$:X}}}else I(V)&&De.call(V,"$types")&&(V={$:V,$types:!0});return!K.returnTypeNames&&V}function me(V,N,ne){Object.assign(V,N);var Y=Ve.map(function(se){var de=V[se];return delete V[se],de});ne(),Ve.forEach(function(se,de){V[se]=Y[de]})}function Q(V,N,ne,Y,se,de,We){var Ce,qe={},nt=o(N),ce=Te?function(le){var ee=We||Y.type||C.getJSONType(N);Te(Object.assign(le||qe,{keypath:V,value:N,cyclic:ne,stateObj:Y,promisesData:se,resolvingTypesonPromise:de,awaitingTypesonPromise:E(N,w)},{type:ee}))}:null;if(["string","boolean","number","undefined"].includes(nt))return N===void 0||Number.isNaN(N)||N===Number.NEGATIVE_INFINITY||N===Number.POSITIVE_INFINITY?(Ce=Y.replaced?N:Me(V,N,Y,se,!1,de,ce))!==N&&(qe={replaced:Ce}):Ce=N,ce&&ce(),Ce;if(N===null)return ce&&ce(),N;if(ne&&!Y.iterateIn&&!Y.iterateUnsetNumeric&&N&&o(N)==="object"){var rt=et.indexOf(N);if(!(rt<0))return X[V]="#",ce&&ce({cyclicKeypath:He[rt]}),"#"+He[rt];ne===!0&&(et.push(N),He.push(V))}var h,a=P(N),l=Ue(N),b=(a||l)&&(!Ae.plainObjectReplacers.length||Y.replaced)||Y.iterateIn?N:Me(V,N,Y,se,a||l,null,ce);if(b!==N?(Ce=b,qe={replaced:b}):V===""&&E(N,w)?(se.push([V,N,ne,Y,void 0,void 0,Y.type]),Ce=N):l&&Y.iterateIn!=="object"||Y.iterateIn==="array"?(h=new Array(N.length),qe={clone:h}):(["function","symbol"].includes(o(N))||"toJSON"in N||E(N,w)||E(N,Promise)||E(N,ArrayBuffer))&&!a&&Y.iterateIn!=="object"?Ce=N:(h={},Y.addLength&&(h.length=N.length),qe={clone:h}),ce&&ce(),K.iterateNone)return h||Ce;if(!h)return Ce;if(Y.iterateIn){var A=function(ee){var he={ownKeys:De.call(N,ee)};me(Y,he,function(){var ke=V+(V?".":"")+ue(ee),Be=Q(ke,N[ee],!!ne,Y,se,de);E(Be,w)?se.push([ke,Be,!!ne,Y,h,ee,Y.type]):Be!==void 0&&(h[ee]=Be)})};for(var R in N)A(R);ce&&ce({endIterateIn:!0,end:!0})}else Le(N).forEach(function(le){var ee=V+(V?".":"")+ue(le);me(Y,{ownKeys:!0},function(){var he=Q(ee,N[le],!!ne,Y,se,de);E(he,w)?se.push([ee,he,!!ne,Y,h,le,Y.type]):he!==void 0&&(h[le]=he)})}),ce&&ce({endIterateOwn:!0,end:!0});if(Y.iterateUnsetNumeric){for(var L=N.length,G=function(ee){if(!(ee in N)){var he=V+(V?".":"")+ee;me(Y,{ownKeys:!1},function(){var ke=Q(he,void 0,!!ne,Y,se,de);E(ke,w)?se.push([he,ke,!!ne,Y,h,ee,Y.type]):ke!==void 0&&(h[ee]=ke)})}},U=0;U<L;U++)G(U);ce&&ce({endIterateUnsetNumeric:!0,end:!0})}return h}function Me(V,N,ne,Y,se,de,We){for(var Ce=se?Ae.plainObjectReplacers:Ae.nonplainObjectReplacers,qe=Ce.length;qe--;){var nt=Ce[qe];if(nt.test(N,ne)){var ce=nt.type;if(Ae.revivers[ce]){var rt=X[V];X[V]=rt?[ce].concat(rt):ce}return Object.assign(ne,{type:ce,replaced:!0}),!ve&&nt.replaceAsync||nt.replace?(We&&We({replacing:!0}),Q(V,nt[ve||!nt.replaceAsync?"replace":"replaceAsync"](N,ne),st&&"readonly",ne,Y,de,ce)):(We&&We({typeDetected:!0}),Q(V,N,st&&"readonly",ne,Y,de,ce))}}return N}return tt.length?ve&&K.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(k(ht,tt)).then(Fe):!ve&&K.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():K.stringification&&ve?[Fe(ht)]:ve?Fe(ht):Promise.resolve(Fe(ht))}},{key:"encapsulateSync",value:function(D,j,K){return this.encapsulate(D,j,f(f({throwOnBadSyncType:!0},K),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(D,j,K){return this.encapsulate(D,j,f(f({throwOnBadSyncType:!0},K),{},{sync:!1}))}},{key:"revive",value:function(D,j){var K=D&&D.$types;if(!K)return D;if(K===!0)return D.$;var k=(j=f(f({sync:!0},this.options),j)).sync,ve=[],Ae={},X=!0;K.$&&P(K.$)&&(D=D.$,K=K.$,X=!1);var et=this;function He(Fe,me){var Q=d(et.revivers[Fe]||[],1)[0];if(!Q)throw new Error("Unregistered type: "+Fe);return k&&!("revive"in Q)?me:Q[k&&Q.revive?"revive":!k&&Q.reviveAsync?"reviveAsync":"revive"](me,Ae)}var tt=[];function st(Fe){return E(Fe,Nt)?void 0:Fe}var Te,ht=function(){var me=[];if(Object.entries(K).forEach(function(Q){var Me=d(Q,2),V=Me[0],N=Me[1];N!=="#"&&[].concat(N).forEach(function(ne){d(et.revivers[ne]||[null,{}],2)[1].plain&&(me.push({keypath:V,type:ne}),delete K[V])})}),me.length)return me.sort(Dt).reduce(function Q(Me,V){var N=V.keypath,ne=V.type;if(x(Me))return Me.then(function(de){return Q(de,{keypath:N,type:ne})});var Y=we(D,N);if(E(Y=He(ne,Y),w))return Y.then(function(de){var We=Ee(D,N,de);We===de&&(D=We)});var se=Ee(D,N,Y);se===Y&&(D=se)},void 0)}();return E(ht,w)?Te=ht.then(function(){return D}):(Te=function Fe(me,Q,Me,V,N){if(!X||me!=="$types"){var ne=K[me],Y=Ue(Q);if(Y||P(Q)){var se=Y?new Array(Q.length):{};for(Le(Q).forEach(function(h){var a=Fe(me+(me?".":"")+ue(h),Q[h],Me||se,se,h),l=function(A){return E(A,Nt)?se[h]=void 0:A!==void 0&&(se[h]=A),A};E(a,w)?tt.push(a.then(function(b){return l(b)})):l(a)}),Q=se;ve.length;){var de=d(ve[0],4),We=de[0],Ce=de[1],qe=de[2],nt=de[3],ce=we(We,Ce);if(ce===void 0)break;qe[nt]=ce,ve.splice(0,1)}}if(!ne)return Q;if(ne==="#"){var rt=we(Me,Q.slice(1));return rt===void 0&&ve.push([Me,Q.slice(1),V,N]),rt}return[].concat(ne).reduce(function h(a,l){return E(a,w)?a.then(function(b){return h(b,l)}):He(l,a)},Q)}}("",D,null),tt.length&&(Te=w.resolve(Te).then(function(Fe){return w.all([Fe].concat(tt))}).then(function(Fe){return d(Fe,1)[0]}))),x(Te)?k&&j.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():E(Te,w)?Te.p.then(st):Te:!k&&j.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():k?st(Te):Promise.resolve(st(Te))}},{key:"reviveSync",value:function(D,j){return this.revive(D,f(f({throwOnBadSyncType:!0},j),{},{sync:!0}))}},{key:"reviveAsync",value:function(D,j){return this.revive(D,f(f({throwOnBadSyncType:!0},j),{},{sync:!1}))}},{key:"register",value:function(D,j){return j=j||{},[].concat(D).forEach(function K(k){var ve=this;if(Ue(k))return k.map(function(Ae){return K.call(ve,Ae)});k&&Le(k).forEach(function(Ae){if(Ae==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(C.JSON_TYPES.includes(Ae))throw new TypeError("Plain JSON object types are reserved as type names");var X=k[Ae],et=X&&X.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,He=et.filter(function(me){return me.type===Ae});if(He.length&&(et.splice(et.indexOf(He[0]),1),delete this.revivers[Ae],delete this.types[Ae]),typeof X=="function"){var tt=X;X={test:function(Q){return Q&&Q.constructor===tt},replace:function(Q){return f({},Q)},revive:function(Q){return Object.assign(Object.create(tt.prototype),Q)}}}else if(Ue(X)){var st=d(X,3);X={test:st[0],replace:st[1],revive:st[2]}}if(X&&X.test){var Te={type:Ae,test:X.test.bind(X)};X.replace&&(Te.replace=X.replace.bind(X)),X.replaceAsync&&(Te.replaceAsync=X.replaceAsync.bind(X));var ht=typeof j.fallback=="number"?j.fallback:j.fallback?0:Number.POSITIVE_INFINITY;if(X.testPlainObjects?this.plainObjectReplacers.splice(ht,0,Te):this.nonplainObjectReplacers.splice(ht,0,Te),X.revive||X.reviveAsync){var Fe={};X.revive&&(Fe.revive=X.revive.bind(X)),X.reviveAsync&&(Fe.reviveAsync=X.reviveAsync.bind(X)),this.revivers[Ae]=[Fe,{plain:X.testPlainObjects}]}this.types[Ae]=X}},this)},this),this}}]),C}(),Nt=function C(){c(this,C)};Nt.__typeson__type__="TypesonUndefined",Ne.Undefined=Nt,Ne.Promise=w,Ne.isThenable=x,Ne.toStringTag=T,Ne.hasConstructorOf=E,Ne.isObject=I,Ne.isPlainObject=P,Ne.isUserObject=function C(F){if(!F||T(F)!=="Object")return!1;var D=B(F);return!D||E(F,Object)||C(D)},Ne.escapeKeyPathComponent=ue,Ne.unescapeKeyPathComponent=Z,Ne.getByKeyPath=we,Ne.getJSONType=function(F){return F===null?"null":Array.isArray(F)?"array":o(F)},Ne.JSON_TYPES=["null","boolean","number","string","array","object"],r.exports=Ne},{}],9:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m};function o(m,w){return(w&&w.context?w.context:"Value")+" "+m+"."}function c(m){if(m===null)return"Null";switch(typeof m>"u"?"undefined":s(m)){case"undefined":return"Undefined";case"boolean":return"Boolean";case"number":return"Number";case"string":return"String";case"symbol":return"Symbol";case"object":case"function":default:return"Object"}}function u(m){return m>0&&m%1===.5&&!(m&1)||m<0&&m%1===-.5&&(m&1)===1?d(Math.floor(m)):d(Math.round(m))}function y(m){return d(Math.trunc(m))}function p(m){return m<0?-1:1}function f(m,w){var _=m%w;return p(w)!==p(_)?_+w:_}function d(m){return m===0?0:m}function g(m,w){var _=!w.unsigned,v=void 0,B=void 0;m===64?(B=Math.pow(2,53)-1,v=_?-Math.pow(2,53)+1:0):_?(v=-Math.pow(2,m-1),B=Math.pow(2,m-1)-1):(v=0,B=Math.pow(2,m)-1);var O=Math.pow(2,m),x=Math.pow(2,m-1);return function(T,E){E===void 0&&(E={});var P=+T;if(P=d(P),E.enforceRange){if(!Number.isFinite(P))throw new TypeError(o("is not a finite number",E));if(P=y(P),P<v||P>B)throw new TypeError(o("is outside the accepted range of "+v+" to "+B+", inclusive",E));return P}return!Number.isNaN(P)&&E.clamp?(P=Math.min(Math.max(P,v),B),P=u(P),P):!Number.isFinite(P)||P===0?0:(P=y(P),P>=v&&P<=B?P:(P=f(P,O),_&&P>=x?P-O:P))}}i.any=function(m){return m},i.void=function(){},i.boolean=function(m){return!!m},i.byte=g(8,{unsigned:!1}),i.octet=g(8,{unsigned:!0}),i.short=g(16,{unsigned:!1}),i["unsigned short"]=g(16,{unsigned:!0}),i.long=g(32,{unsigned:!1}),i["unsigned long"]=g(32,{unsigned:!0}),i["long long"]=g(64,{unsigned:!1}),i["unsigned long long"]=g(64,{unsigned:!0}),i.double=function(m,w){var _=+m;if(!Number.isFinite(_))throw new TypeError(o("is not a finite floating-point value",w));return _},i["unrestricted double"]=function(m){var w=+m;return w},i.float=function(m,w){var _=+m;if(!Number.isFinite(_))throw new TypeError(o("is not a finite floating-point value",w));if(Object.is(_,-0))return _;var v=Math.fround(_);if(!Number.isFinite(v))throw new TypeError(o("is outside the range of a single-precision floating-point value",w));return v},i["unrestricted float"]=function(m){var w=+m;return isNaN(w)||Object.is(w,-0)?w:Math.fround(w)},i.DOMString=function(m,w){if(w===void 0&&(w={}),w.treatNullAsEmptyString&&m===null)return"";if((typeof m>"u"?"undefined":s(m))==="symbol")throw new TypeError(o("is a symbol, which cannot be converted to a string",w));return String(m)},i.ByteString=function(m,w){for(var _=i.DOMString(m,w),v=void 0,B=0;(v=_.codePointAt(B))!==void 0;++B)if(v>255)throw new TypeError(o("is not a valid ByteString",w));return _},i.USVString=function(m,w){for(var _=i.DOMString(m,w),v=_.length,B=[],O=0;O<v;++O){var x=_.charCodeAt(O);if(x<55296||x>57343)B.push(String.fromCodePoint(x));else if(56320<=x&&x<=57343)B.push(String.fromCodePoint(65533));else if(O===v-1)B.push(String.fromCodePoint(65533));else{var T=_.charCodeAt(O+1);if(56320<=T&&T<=57343){var E=x&1023,P=T&1023;B.push(String.fromCodePoint((2<<15)+(2<<9)*E+P)),++O}else B.push(String.fromCodePoint(65533))}}return B.join("")},i.object=function(m,w){if(c(m)!=="Object")throw new TypeError(o("is not an object",w));return m};function S(m,w){if(typeof m!="function")throw new TypeError(o("is not a function",w));return m}[Error,ArrayBuffer,DataView,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,Float32Array,Float64Array].forEach(function(m){var w=m.name,_=/^[AEIOU]/.test(w)?"an":"a";i[w]=function(v,B){if(!(v instanceof m))throw new TypeError(o("is not "+_+" "+w+" object",B));return v}}),i.ArrayBufferView=function(m,w){if(!ArrayBuffer.isView(m))throw new TypeError(o("is not a view on an ArrayBuffer object",w));return m},i.BufferSource=function(m,w){if(!(ArrayBuffer.isView(m)||m instanceof ArrayBuffer))throw new TypeError(o("is not an ArrayBuffer object or a view on one",w));return m},i.DOMTimeStamp=i["unsigned long long"],i.Function=S,i.VoidFunction=S},{}]},{},[1])(1)})})(ls);var ho=ls.exports;const fo=bs(ho),vt=n=>{if(typeof structuredClone<"u")return structuredClone(n);try{return fo(n)}catch{throw new co}},mn=n=>n.source instanceof bt?n.source:n.source.objectStore,zn=(n,e,t)=>{let r=n!==void 0?n.lower:void 0,i=n!==void 0?n.upper:void 0;for(const s of e)s!==void 0&&(r===void 0||ae(r,s)===1)&&(r=s);for(const s of t)s!==void 0&&(i===void 0||ae(i,s)===-1)&&(i=s);if(r!==void 0&&i!==void 0)return ie.bound(r,i);if(r!==void 0)return ie.lowerBound(r);if(i!==void 0)return ie.upperBound(i)};class In{_gotValue=!1;_position=void 0;_objectStorePosition=void 0;_keyOnly=!1;_key=void 0;_primaryKey=void 0;constructor(e,t,r="next",i,s=!1){this._range=t,this._source=e,this._direction=r,this._request=i,this._keyOnly=s}get source(){return this._source}set source(e){}get request(){return this._request}set request(e){}get direction(){return this._direction}set direction(e){}get key(){return this._key}set key(e){}get primaryKey(){return this._primaryKey}set primaryKey(e){}_iterate(e,t){const r=this.source instanceof bt,i=this.source instanceof bt?this.source._rawObjectStore.records:this.source._rawIndex.records;let s;if(this.direction==="next"){const c=zn(this._range,[e,this._position],[]);for(const u of i.values(c)){const y=e!==void 0?ae(u.key,e):void 0,p=this._position!==void 0?ae(u.key,this._position):void 0;if(!(e!==void 0&&y===-1)){if(t!==void 0){if(y===-1)continue;const f=ae(u.value,t);if(y===0&&f===-1)continue}if(!(this._position!==void 0&&r&&p!==1)&&!(this._position!==void 0&&!r&&(p===-1||p===0&&ae(u.value,this._objectStorePosition)!==1))&&!(this._range!==void 0&&!this._range.includes(u.key))){s=u;break}}}}else if(this.direction==="nextunique"){const c=zn(this._range,[e,this._position],[]);for(const u of i.values(c))if(!(e!==void 0&&ae(u.key,e)===-1)&&!(this._position!==void 0&&ae(u.key,this._position)!==1)&&!(this._range!==void 0&&!this._range.includes(u.key))){s=u;break}}else if(this.direction==="prev"){const c=zn(this._range,[],[e,this._position]);for(const u of i.values(c,"prev")){const y=e!==void 0?ae(u.key,e):void 0,p=this._position!==void 0?ae(u.key,this._position):void 0;if(!(e!==void 0&&y===1)){if(t!==void 0){if(y===1)continue;const f=ae(u.value,t);if(y===0&&f===1)continue}if(!(this._position!==void 0&&r&&p!==-1)&&!(this._position!==void 0&&!r&&(p===1||p===0&&ae(u.value,this._objectStorePosition)!==-1))&&!(this._range!==void 0&&!this._range.includes(u.key))){s=u;break}}}}else if(this.direction==="prevunique"){let c;const u=zn(this._range,[],[e,this._position]);for(const y of i.values(u,"prev"))if(!(e!==void 0&&ae(y.key,e)===1)&&!(this._position!==void 0&&ae(y.key,this._position)!==-1)&&!(this._range!==void 0&&!this._range.includes(y.key))){c=y;break}c&&(s=i.get(c.key))}let o;if(!s)this._key=void 0,r||(this._objectStorePosition=void 0),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=void 0),o=null;else{if(this._position=s.key,r||(this._objectStorePosition=s.value),this._key=s.key,r)this._primaryKey=vt(s.key),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=vt(s.value));else if(this._primaryKey=vt(s.value),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"){if(this.source instanceof bt)throw new Error("This should never happen");const c=this.source.objectStore._rawObjectStore.getValue(s.value);this.value=vt(c)}this._gotValue=!0,o=this}return o}update(e){if(e===void 0)throw new TypeError;const t=mn(this),r=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,i=t.transaction;if(i._state!=="active")throw new St;if(i.mode==="readonly")throw new Tn;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof bt)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue||!this.hasOwnProperty("value"))throw new re;const s=vt(e);if(t.keyPath!==null){let c;try{c=Kn(t.keyPath,s)}catch{}if(ae(c,r)!==0)throw new Ke}const o={key:r,value:s};return i._execRequestAsync({operation:t._rawObjectStore.storeRecord.bind(t._rawObjectStore,o,!1,i._rollbackLog),source:this})}advance(e){if(!Number.isInteger(e)||e<=0)throw new TypeError;const t=mn(this),r=t.transaction;if(r._state!=="active")throw new St;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof bt)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue)throw new re;this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:()=>{let i;for(let s=0;s<e&&(i=this._iterate(),!!i);s++);return i},request:this._request,source:this.source}),this._gotValue=!1}continue(e){const t=mn(this),r=t.transaction;if(r._state!=="active")throw new St;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof bt)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue)throw new re;if(e!==void 0){e=ye(e);const i=ae(e,this._position);if(i<=0&&(this.direction==="next"||this.direction==="nextunique")||i>=0&&(this.direction==="prev"||this.direction==="prevunique"))throw new Ke}this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:this._iterate.bind(this,e),request:this._request,source:this.source}),this._gotValue=!1}continuePrimaryKey(e,t){const r=mn(this),i=r.transaction;if(i._state!=="active")throw new St;if(r._rawObjectStore.deleted)throw new re;if(!(this.source instanceof bt)&&this.source._rawIndex.deleted)throw new re;if(this.source instanceof bt||this.direction!=="next"&&this.direction!=="prev")throw new hr;if(!this._gotValue)throw new re;if(e===void 0||t===void 0)throw new Ke;e=ye(e);const s=ae(e,this._position);if(s===-1&&this.direction==="next"||s===1&&this.direction==="prev")throw new Ke;const o=ae(t,this._objectStorePosition);if(s===0&&(o<=0&&this.direction==="next"||o>=0&&this.direction==="prev"))throw new Ke;this._request&&(this._request.readyState="pending"),i._execRequestAsync({operation:this._iterate.bind(this,e,t),request:this._request,source:this.source}),this._gotValue=!1}delete(){const e=mn(this),t=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,r=e.transaction;if(r._state!=="active")throw new St;if(r.mode==="readonly")throw new Tn;if(e._rawObjectStore.deleted)throw new re;if(!(this.source instanceof bt)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue||!this.hasOwnProperty("value"))throw new re;return r._execRequestAsync({operation:e._rawObjectStore.deleteRecord.bind(e._rawObjectStore,t,r._rollbackLog),source:this})}toString(){return"[object IDBCursor]"}}class hs extends In{value=void 0;constructor(e,t,r,i){super(e,t,r,i)}toString(){return"[object IDBCursorWithValue]"}}const Oi=(n,e)=>n.immediatePropagationStopped||n.eventPhase===n.CAPTURING_PHASE&&e.capture===!1||n.eventPhase===n.BUBBLING_PHASE&&e.capture===!0,Dr=(n,e)=>{n.currentTarget=e;for(const s of e.listeners.slice())n.type!==s.type||Oi(n,s)||s.callback.call(n.currentTarget,n);const r={abort:"onabort",blocked:"onblocked",complete:"oncomplete",error:"onerror",success:"onsuccess",upgradeneeded:"onupgradeneeded",versionchange:"onversionchange"}[n.type];if(r===void 0)throw new Error(`Unknown event type: "${n.type}"`);const i=n.currentTarget[r];if(i){const s={callback:i,capture:!1,type:n.type};Oi(n,s)||s.callback.call(n.currentTarget,n)}};class fi{listeners=[];addEventListener(e,t,r=!1){this.listeners.push({callback:t,capture:r,type:e})}removeEventListener(e,t,r=!1){const i=this.listeners.findIndex(s=>s.type===e&&s.callback===t&&s.capture===r);this.listeners.splice(i,1)}dispatchEvent(e){if(e.dispatched||!e.initialized)throw new re("The object is in an invalid state.");e.isTrusted=!1,e.dispatched=!0,e.target=this,e.eventPhase=e.CAPTURING_PHASE;for(const t of e.eventPath)e.propagationStopped||Dr(e,t);if(e.eventPhase=e.AT_TARGET,e.propagationStopped||Dr(e,e.target),e.bubbles){e.eventPath.reverse(),e.eventPhase=e.BUBBLING_PHASE;for(const t of e.eventPath)e.propagationStopped||Dr(e,t)}return e.dispatched=!1,e.eventPhase=e.NONE,e.currentTarget=null,!e.canceled}}class tn extends fi{_result=null;_error=null;source=null;transaction=null;readyState="pending";onsuccess=null;onerror=null;get error(){if(this.readyState==="pending")throw new re;return this._error}set error(e){this._error=e}get result(){if(this.readyState==="pending")throw new re;return this._result}set result(e){this._result=e}toString(){return"[object IDBRequest]"}}const Pn=(n,e)=>{const r=e==="unsigned long"?4294967295:9007199254740991;if(isNaN(n)||n<0||n>r)throw new TypeError;if(n>=0)return Math.floor(n)};class Je extends Array{contains(e){for(const t of this)if(e===t)return!0;return!1}item(e){return e<0||e>=this.length?null:this[e]}_push(...e){return Array.prototype.push.call(this,...e)}_sort(...e){return Array.prototype.sort.call(this,...e)}}const fr=(n,e=!1)=>{if(n instanceof ie)return n;if(n==null){if(e)throw new Ke;return new ie(void 0,void 0,!1,!1)}const t=ye(n);return ie.only(t)},Yt=n=>{if(n._rawIndex.deleted||n.objectStore._rawObjectStore.deleted)throw new re;if(n.objectStore.transaction._state!=="active")throw new St};class Di{constructor(e,t){this._rawIndex=t,this._name=t.name,this.objectStore=e,this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.unique=t.unique}get name(){return this._name}set name(e){const t=this.objectStore.transaction;if(!t.db._runningVersionchangeTransaction)throw new re;if(t._state!=="active")throw new St;if(this._rawIndex.deleted||this.objectStore._rawObjectStore.deleted)throw new re;if(e=String(e),e===this._name)return;if(this.objectStore.indexNames.contains(e))throw new Gt;const r=this._name,i=[...this.objectStore.indexNames];this._name=e,this._rawIndex.name=e,this.objectStore._indexesCache.delete(r),this.objectStore._indexesCache.set(e,this),this.objectStore._rawObjectStore.rawIndexes.delete(r),this.objectStore._rawObjectStore.rawIndexes.set(e,this._rawIndex),this.objectStore.indexNames=new Je(...Array.from(this.objectStore._rawObjectStore.rawIndexes.keys()).filter(s=>{const o=this.objectStore._rawObjectStore.rawIndexes.get(s);return o&&!o.deleted}).sort()),t._rollbackLog.push(()=>{this._name=r,this._rawIndex.name=r,this.objectStore._indexesCache.delete(e),this.objectStore._indexesCache.set(r,this),this.objectStore._rawObjectStore.rawIndexes.delete(e),this.objectStore._rawObjectStore.rawIndexes.set(r,this._rawIndex),this.objectStore.indexNames=new Je(...i)})}openCursor(e,t){Yt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new tn;r.source=this,r.transaction=this.objectStore.transaction;const i=new hs(this,e,t,r);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}openKeyCursor(e,t){Yt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new tn;r.source=this,r.transaction=this.objectStore.transaction;const i=new In(this,e,t,r,!0);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}get(e){return Yt(this),e instanceof ie||(e=ye(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getValue.bind(this._rawIndex,e),source:this})}getAll(e,t){arguments.length>1&&t!==void 0&&(t=Pn(t,"unsigned long")),Yt(this);const r=fr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllValues.bind(this._rawIndex,r,t),source:this})}getKey(e){return Yt(this),e instanceof ie||(e=ye(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getKey.bind(this._rawIndex,e),source:this})}getAllKeys(e,t){arguments.length>1&&t!==void 0&&(t=Pn(t,"unsigned long")),Yt(this);const r=fr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllKeys.bind(this._rawIndex,r,t),source:this})}count(e){return Yt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e))),this.objectStore.transaction._execRequestAsync({operation:()=>{let t=0;const r=new In(this,e);for(;r._iterate()!==null;)t+=1;return t},source:this})}toString(){return"[object IDBIndex]"}}const po=(n,e)=>{if(Array.isArray(n))throw new Error("The key paths used in this section are always strings and never sequences, since it is not possible to create a object store which has a key generator and also has a key path that is a sequence.");const t=n.split(".");if(t.length===0)throw new Error("Assert: identifiers is not empty");t.pop();for(const r of t){if(typeof e!="object"&&!Array.isArray(e))return!1;if(!e.hasOwnProperty(r))return!0;e=e[r]}return typeof e=="object"||Array.isArray(e)};function dr(n,e){let t=0,r=n.length,i;for(;t<r;)i=t+r>>>1,ae(n[i].key,e)<0?t=i+1:r=i;return t}function fs(n,e){const t=dr(n,e),r=n[t];return r&&ae(r.key,e)===0?t:-1}function yo(n,e){const t=fs(n,e);return n[t]}function ds(n,e){const t=typeof e.lower>"u"?0:dr(n,e.lower),r=typeof e.upper>"u"?n.length-1:dr(n,e.upper);for(let i=t;i<=r;i++){const s=n[i];if(s&&e.includes(s.key))return i}return-1}function mo(n,e){const t=ds(n,e);return n[t]}function bo(n,e){const t=dr(n,e),r=n[t];return r&&ae(r.key,e)>=0?t:-1}class ps{records=[];get(e){return e instanceof ie?mo(this.records,e):yo(this.records,e)}add(e){let t;if(this.records.length===0)t=0;else if(t=bo(this.records,e.key),t===-1)t=this.records.length;else for(;t<this.records.length&&ae(this.records[t].key,e.key)===0&&ae(this.records[t].value,e.value)===-1;)t+=1;this.records.splice(t,0,e)}delete(e){const t=[],r=e instanceof ie;for(;;){const i=r?ds(this.records,e):fs(this.records,e);if(i===-1)break;t.push(this.records[i]),this.records.splice(i,1)}return t}deleteByValue(e){const t=e instanceof ie?e:ie.only(e),r=[];return this.records=this.records.filter(i=>{const s=t.includes(i.value);return s&&r.push(i),!s}),r}clear(){const e=this.records.slice();return this.records=[],e}values(e,t="next"){return{[Symbol.iterator]:()=>{let r;if(t==="next"){if(r=0,e!==void 0&&e.lower!==void 0)for(;this.records[r]!==void 0;){const i=ae(this.records[r].key,e.lower);if(i===1||i===0&&!e.lowerOpen)break;r+=1}}else if(r=this.records.length-1,e!==void 0&&e.upper!==void 0)for(;this.records[r]!==void 0;){const i=ae(this.records[r].key,e.upper);if(i===-1||i===0&&!e.upperOpen)break;r-=1}return{next:()=>{let i,s;if(t==="next"){if(s=this.records[r],i=r>=this.records.length,r+=1,!i&&e!==void 0&&e.upper!==void 0){const o=ae(s.key,e.upper);i=o===1||o===0&&e.upperOpen,i&&(s=void 0)}}else if(s=this.records[r],i=r<0,r-=1,!i&&e!==void 0&&e.lower!==void 0){const o=ae(s.key,e.lower);i=o===-1||o===0&&e.lowerOpen,i&&(s=void 0)}return{done:i,value:s}}}}}}}class vo{deleted=!1;initialized=!1;records=new ps;constructor(e,t,r,i,s){this.rawObjectStore=e,this.name=t,this.keyPath=r,this.multiEntry=i,this.unique=s}getKey(e){const t=this.records.get(e);return t!==void 0?t.value:void 0}getAllKeys(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(vt(i.value)),r.length>=t)break;return r}getValue(e){const t=this.records.get(e);return t!==void 0?this.rawObjectStore.getValue(t.value):void 0}getAllValues(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(this.rawObjectStore.getValue(i.value)),r.length>=t)break;return r}storeRecord(e){let t;try{t=Kn(this.keyPath,e.value)}catch(r){if(r.name==="DataError")return;throw r}if(!this.multiEntry||!Array.isArray(t))try{ye(t)}catch{return}else{const r=[];for(const i of t)if(r.indexOf(i)<0)try{r.push(ye(i))}catch{}t=r}if(!this.multiEntry||!Array.isArray(t)){if(this.unique&&this.records.get(t))throw new Gt}else if(this.unique){for(const r of t)if(this.records.get(r))throw new Gt}if(!this.multiEntry||!Array.isArray(t))this.records.add({key:t,value:e.key});else for(const r of t)this.records.add({key:r,value:e.key})}initialize(e){if(this.initialized)throw new Error("Index already initialized");e._execRequestAsync({operation:()=>{try{for(const t of this.rawObjectStore.records.values())this.storeRecord(t);this.initialized=!0}catch(t){e._abort(t.name)}},source:null})}}const pr=(n,e)=>{if(n!=null&&typeof n!="string"&&n.toString&&(e==="array"||!Array.isArray(n))&&(n=n.toString()),typeof n=="string"){if(n===""&&e!=="string")return;try{const t=/^(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])(?:[\$0-9A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])*$/;if(n.length>=1&&t.test(n))return}catch(t){throw new SyntaxError(t.message)}if(n.indexOf(" ")>=0)throw new SyntaxError("The keypath argument contains an invalid key path (no spaces allowed).")}if(Array.isArray(n)&&n.length>0){if(e)throw new SyntaxError("The keypath argument contains an invalid key path (nested arrays).");for(const t of n)pr(t,"array");return}else if(typeof n=="string"&&n.indexOf(".")>=0){n=n.split(".");for(const t of n)pr(t,"string");return}throw new SyntaxError},ct=n=>{if(n._rawObjectStore.deleted)throw new re;if(n.transaction._state!=="active")throw new St},Fi=(n,e,t)=>{if(ct(n),n.transaction.mode==="readonly")throw new Tn;if(n.keyPath!==null&&t!==void 0)throw new Ke;const r=vt(e);if(n.keyPath!==null){const i=Kn(n.keyPath,r);if(i!==void 0)ye(i);else if(n._rawObjectStore.keyGenerator){if(!po(n.keyPath,r))throw new Ke}else throw new Ke}if(n.keyPath===null&&n._rawObjectStore.keyGenerator===null&&t===void 0)throw new Ke;return t!==void 0&&(t=ye(t)),{key:t,value:r}};class go{_indexesCache=new Map;constructor(e,t){this._rawObjectStore=t,this._name=t.name,this.keyPath=t.keyPath,this.autoIncrement=t.autoIncrement,this.transaction=e,this.indexNames=new Je(...Array.from(t.rawIndexes.keys()).sort())}get name(){return this._name}set name(e){const t=this.transaction;if(!t.db._runningVersionchangeTransaction)throw new re;if(ct(this),e=String(e),e===this._name)return;if(this._rawObjectStore.rawDatabase.rawObjectStores.has(e))throw new Gt;const r=this._name,i=[...t.db.objectStoreNames];this._name=e,this._rawObjectStore.name=e,this.transaction._objectStoresCache.delete(r),this.transaction._objectStoresCache.set(e,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(r),this._rawObjectStore.rawDatabase.rawObjectStores.set(e,this._rawObjectStore),t.db.objectStoreNames=new Je(...Array.from(this._rawObjectStore.rawDatabase.rawObjectStores.keys()).filter(c=>{const u=this._rawObjectStore.rawDatabase.rawObjectStores.get(c);return u&&!u.deleted}).sort());const s=new Set(t._scope),o=[...t.objectStoreNames];this.transaction._scope.delete(r),t._scope.add(e),t.objectStoreNames=new Je(...Array.from(t._scope).sort()),t._rollbackLog.push(()=>{this._name=r,this._rawObjectStore.name=r,this.transaction._objectStoresCache.delete(e),this.transaction._objectStoresCache.set(r,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(e),this._rawObjectStore.rawDatabase.rawObjectStores.set(r,this._rawObjectStore),t.db.objectStoreNames=new Je(...i),t._scope=s,t.objectStoreNames=new Je(...o)})}put(e,t){if(arguments.length===0)throw new TypeError;const r=Fi(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!1,this.transaction._rollbackLog),source:this})}add(e,t){if(arguments.length===0)throw new TypeError;const r=Fi(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!0,this.transaction._rollbackLog),source:this})}delete(e){if(arguments.length===0)throw new TypeError;if(ct(this),this.transaction.mode==="readonly")throw new Tn;return e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.deleteRecord.bind(this._rawObjectStore,e,this.transaction._rollbackLog),source:this})}get(e){if(arguments.length===0)throw new TypeError;return ct(this),e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getValue.bind(this._rawObjectStore,e),source:this})}getAll(e,t){arguments.length>1&&t!==void 0&&(t=Pn(t,"unsigned long")),ct(this);const r=fr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllValues.bind(this._rawObjectStore,r,t),source:this})}getKey(e){if(arguments.length===0)throw new TypeError;return ct(this),e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getKey.bind(this._rawObjectStore,e),source:this})}getAllKeys(e,t){arguments.length>1&&t!==void 0&&(t=Pn(t,"unsigned long")),ct(this);const r=fr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllKeys.bind(this._rawObjectStore,r,t),source:this})}clear(){if(ct(this),this.transaction.mode==="readonly")throw new Tn;return this.transaction._execRequestAsync({operation:this._rawObjectStore.clear.bind(this._rawObjectStore,this.transaction._rollbackLog),source:this})}openCursor(e,t){ct(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new tn;r.source=this,r.transaction=this.transaction;const i=new hs(this,e,t,r);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}openKeyCursor(e,t){ct(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new tn;r.source=this,r.transaction=this.transaction;const i=new In(this,e,t,r,!0);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}createIndex(e,t,r={}){if(arguments.length<2)throw new TypeError;const i=r.multiEntry!==void 0?r.multiEntry:!1,s=r.unique!==void 0?r.unique:!1;if(this.transaction.mode!=="versionchange")throw new re;if(ct(this),this.indexNames.contains(e))throw new Gt;if(pr(t),Array.isArray(t)&&i)throw new hr;const o=[...this.indexNames];this.transaction._rollbackLog.push(()=>{const u=this._rawObjectStore.rawIndexes.get(e);u&&(u.deleted=!0),this.indexNames=new Je(...o),this._rawObjectStore.rawIndexes.delete(e)});const c=new vo(this._rawObjectStore,e,t,i,s);return this.indexNames._push(e),this.indexNames._sort(),this._rawObjectStore.rawIndexes.set(e,c),c.initialize(this.transaction),new Di(this,c)}index(e){if(arguments.length===0)throw new TypeError;if(this._rawObjectStore.deleted||this.transaction._state==="finished")throw new re;const t=this._indexesCache.get(e);if(t!==void 0)return t;const r=this._rawObjectStore.rawIndexes.get(e);if(!this.indexNames.contains(e)||r===void 0)throw new jn;const i=new Di(this,r);return this._indexesCache.set(e,i),i}deleteIndex(e){if(arguments.length===0)throw new TypeError;if(this.transaction.mode!=="versionchange")throw new re;ct(this);const t=this._rawObjectStore.rawIndexes.get(e);if(t===void 0)throw new jn;this.transaction._rollbackLog.push(()=>{t.deleted=!1,this._rawObjectStore.rawIndexes.set(e,t),this.indexNames._push(e),this.indexNames._sort()}),this.indexNames=new Je(...Array.from(this.indexNames).filter(r=>r!==e)),t.deleted=!0,this.transaction._execRequestAsync({operation:()=>{const r=this._rawObjectStore.rawIndexes.get(e);t===r&&this._rawObjectStore.rawIndexes.delete(e)},source:this})}count(e){return ct(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e))),this.transaction._execRequestAsync({operation:()=>{let t=0;const r=new In(this,e);for(;r._iterate()!==null;)t+=1;return t},source:this})}toString(){return"[object IDBObjectStore]"}}const bt=go;class Tt{eventPath=[];NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;propagationStopped=!1;immediatePropagationStopped=!1;canceled=!1;initialized=!0;dispatched=!1;target=null;currentTarget=null;eventPhase=0;defaultPrevented=!1;isTrusted=!1;timeStamp=Date.now();constructor(e,t={}){this.type=e,this.bubbles=t.bubbles!==void 0?t.bubbles:!1,this.cancelable=t.cancelable!==void 0?t.cancelable:!1}preventDefault(){this.cancelable&&(this.canceled=!0)}stopPropagation(){this.propagationStopped=!0}stopImmediatePropagation(){this.propagationStopped=!0,this.immediatePropagationStopped=!0}}function wo(){if(typeof navigator<"u"&&/jsdom/.test(navigator.userAgent)){const n=Node.constructor;return new n("return setImmediate")()}else return}const Et=globalThis.setImmediate||wo()||(n=>setTimeout(n,0));class Ao extends fi{_state="active";_started=!1;_rollbackLog=[];_objectStoresCache=new Map;error=null;onabort=null;oncomplete=null;onerror=null;_requests=[];constructor(e,t,r){super(),this._scope=new Set(e),this.mode=t,this.db=r,this.objectStoreNames=new Je(...Array.from(this._scope).sort())}_abort(e){for(const t of this._rollbackLog.reverse())t();if(e!==null){const t=new Error;t.name=e,this.error=t}for(const{request:t}of this._requests)if(t.readyState!=="done"&&(t.readyState="done",t.source)){t.result=void 0,t.error=new Zr;const r=new Tt("error",{bubbles:!0,cancelable:!0});r.eventPath=[this.db,this],t.dispatchEvent(r)}Et(()=>{const t=new Tt("abort",{bubbles:!0,cancelable:!1});t.eventPath=[this.db],this.dispatchEvent(t)}),this._state="finished"}abort(){if(this._state==="committing"||this._state==="finished")throw new re;this._state="active",this._abort(null)}objectStore(e){if(this._state!=="active")throw new re;const t=this._objectStoresCache.get(e);if(t!==void 0)return t;const r=this.db._rawDatabase.rawObjectStores.get(e);if(!this._scope.has(e)||r===void 0)throw new jn;const i=new bt(this,r);return this._objectStoresCache.set(e,i),i}_execRequestAsync(e){const t=e.source,r=e.operation;let i=e.hasOwnProperty("request")?e.request:null;if(this._state!=="active")throw new St;return i||(t?(i=new tn,i.source=t,i.transaction=t.transaction):i=new tn),this._requests.push({operation:r,request:i}),i}_start(){this._started=!0;let e,t;for(;this._requests.length>0;){const r=this._requests.shift();if(r&&r.request.readyState!=="done"){t=r.request,e=r.operation;break}}if(t&&e){if(!t.source)e();else{let r,i;try{const s=e();t.readyState="done",t.result=s,t.error=void 0,this._state==="inactive"&&(this._state="active"),i=new Tt("success",{bubbles:!1,cancelable:!1})}catch(s){t.readyState="done",t.result=void 0,t.error=s,this._state==="inactive"&&(this._state="active"),i=new Tt("error",{bubbles:!0,cancelable:!0}),r=this._abort.bind(this,s.name)}try{i.eventPath=[this.db,this],t.dispatchEvent(i)}catch(s){throw this._state!=="committing"&&this._abort("AbortError"),s}i.canceled||r&&r()}Et(this._start.bind(this));return}if(this._state!=="finished"&&(this._state="finished",!this.error)){const r=new Tt("complete");this.dispatchEvent(r)}}commit(){if(this._state!=="active")throw new re;this._state="committing"}toString(){return"[object IDBRequest]"}}const Bi=9007199254740992;class _o{num=0;next(){if(this.num>=Bi)throw new Gt;return this.num+=1,this.num}setIfLarger(e){const t=Math.floor(Math.min(e,Bi))-1;t>=this.num&&(this.num=t+1)}}class So{deleted=!1;records=new ps;rawIndexes=new Map;constructor(e,t,r,i){this.rawDatabase=e,this.keyGenerator=i===!0?new _o:null,this.deleted=!1,this.name=t,this.keyPath=r,this.autoIncrement=i}getKey(e){const t=this.records.get(e);return t!==void 0?vt(t.key):void 0}getAllKeys(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(vt(i.key)),r.length>=t)break;return r}getValue(e){const t=this.records.get(e);return t!==void 0?vt(t.value):void 0}getAllValues(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(vt(i.value)),r.length>=t)break;return r}storeRecord(e,t,r){if(this.keyPath!==null){const s=Kn(this.keyPath,e.value);s!==void 0&&(e.key=s)}if(this.keyGenerator!==null&&e.key===void 0){if(r){const s=this.keyGenerator.num;r.push(()=>{this.keyGenerator&&(this.keyGenerator.num=s)})}if(e.key=this.keyGenerator.next(),this.keyPath!==null){if(Array.isArray(this.keyPath))throw new Error("Cannot have an array key path in an object store with a key generator");let s=this.keyPath,o=e.value,c,u=0;for(;u>=0;){if(typeof o!="object")throw new Ke;u=s.indexOf("."),u>=0&&(c=s.slice(0,u),s=s.slice(u+1),o.hasOwnProperty(c)||(o[c]={}),o=o[c])}c=s,o[c]=e.key}}else this.keyGenerator!==null&&typeof e.key=="number"&&this.keyGenerator.setIfLarger(e.key);if(this.records.get(e.key)){if(t)throw new Gt;this.deleteRecord(e.key,r)}this.records.add(e),r&&r.push(()=>{this.deleteRecord(e.key)});for(const s of this.rawIndexes.values())s.initialized&&s.storeRecord(e);return e.key}deleteRecord(e,t){const r=this.records.delete(e);if(t)for(const i of r)t.push(()=>{this.storeRecord(i,!0)});for(const i of this.rawIndexes.values())i.records.deleteByValue(e)}clear(e){const t=this.records.clear();if(e)for(const r of t)e.push(()=>{this.storeRecord(r,!0)});for(const r of this.rawIndexes.values())r.records.clear()}}const xi=n=>{if(!n._runningVersionchangeTransaction)throw new re;const e=n._rawDatabase.transactions.filter(r=>r.mode==="versionchange"),t=e[e.length-1];if(!t||t._state==="finished")throw new re;if(t._state!=="active")throw new St;return t},ys=n=>{n._closePending=!0,n._rawDatabase.transactions.every(t=>t._state==="finished")?(n._closed=!0,n._rawDatabase.connections=n._rawDatabase.connections.filter(t=>n!==t)):Et(()=>{ys(n)})};class Eo extends fi{_closePending=!1;_closed=!1;_runningVersionchangeTransaction=!1;constructor(e){super(),this._rawDatabase=e,this._rawDatabase.connections.push(this),this.name=e.name,this.version=e.version,this.objectStoreNames=new Je(...Array.from(e.rawObjectStores.keys()).sort())}createObjectStore(e,t={}){if(e===void 0)throw new TypeError;const r=xi(this),i=t!==null&&t.keyPath!==void 0?t.keyPath:null,s=t!==null&&t.autoIncrement!==void 0?t.autoIncrement:!1;if(i!==null&&pr(i),this._rawDatabase.rawObjectStores.has(e))throw new Gt;if(s&&(i===""||Array.isArray(i)))throw new hr;const o=[...this.objectStoreNames];r._rollbackLog.push(()=>{const u=this._rawDatabase.rawObjectStores.get(e);u&&(u.deleted=!0),this.objectStoreNames=new Je(...o),r._scope.delete(e),this._rawDatabase.rawObjectStores.delete(e)});const c=new So(this._rawDatabase,e,i,s);return this.objectStoreNames._push(e),this.objectStoreNames._sort(),r._scope.add(e),this._rawDatabase.rawObjectStores.set(e,c),r.objectStoreNames=new Je(...this.objectStoreNames),r.objectStore(e)}deleteObjectStore(e){if(e===void 0)throw new TypeError;const t=xi(this),r=this._rawDatabase.rawObjectStores.get(e);if(r===void 0)throw new jn;this.objectStoreNames=new Je(...Array.from(this.objectStoreNames).filter(i=>i!==e)),t.objectStoreNames=new Je(...this.objectStoreNames),t._rollbackLog.push(()=>{r.deleted=!1,this._rawDatabase.rawObjectStores.set(e,r),this.objectStoreNames._push(e),this.objectStoreNames._sort()}),r.deleted=!0,this._rawDatabase.rawObjectStores.delete(e),t._objectStoresCache.delete(e)}transaction(e,t){if(t=t!==void 0?t:"readonly",t!=="readonly"&&t!=="readwrite"&&t!=="versionchange")throw new TypeError("Invalid mode: "+t);if(this._rawDatabase.transactions.some(s=>s._state==="active"&&s.mode==="versionchange"&&s.db===this))throw new re;if(this._closePending)throw new re;if(Array.isArray(e)||(e=[e]),e.length===0&&t!=="versionchange")throw new hr;for(const s of e)if(!this.objectStoreNames.contains(s))throw new jn("No objectStore named "+s+" in this database");const i=new Ao(e,t,this);return this._rawDatabase.transactions.push(i),this._rawDatabase.processTransactions(),i}close(){ys(this)}toString(){return"[object IDBDatabase]"}}class ji extends tn{onupgradeneeded=null;onblocked=null;toString(){return"[object IDBOpenDBRequest]"}}class hn extends Tt{constructor(e,t={}){super(e),this.newVersion=t.newVersion!==void 0?t.newVersion:null,this.oldVersion=t.oldVersion!==void 0?t.oldVersion:0}toString(){return"[object IDBVersionChangeEvent]"}}class Co{deletePending=!1;transactions=[];rawObjectStores=new Map;connections=[];constructor(e,t){this.name=e,this.version=t,this.processTransactions=this.processTransactions.bind(this)}processTransactions(){Et(()=>{if(!this.transactions.some(t=>t._started&&t._state!=="finished")){const t=this.transactions.find(r=>!r._started&&r._state!=="finished");t&&(t.addEventListener("complete",this.processTransactions),t.addEventListener("abort",this.processTransactions),t._start())}})}}const ms=(n,e,t,r)=>{if(t.some(s=>!s._closed&&!s._closePending)){Et(()=>ms(n,e,t,r));return}n.delete(e),r(null)},Oo=(n,e,t,r)=>{try{const i=n.get(e);if(i===void 0){r(null);return}i.deletePending=!0;const s=i.connections.filter(c=>!c._closed&&!c._closePending);for(const c of s)if(!c._closePending){const u=new hn("versionchange",{newVersion:null,oldVersion:i.version});c.dispatchEvent(u)}const o=s.some(c=>!c._closed&&!c._closePending);if(t&&o){const c=new hn("blocked",{newVersion:null,oldVersion:i.version});t.dispatchEvent(c)}ms(n,e,s,r)}catch(i){r(i)}},Do=(n,e,t,r)=>{n._runningVersionchangeTransaction=!0;const i=n.version,s=n._rawDatabase.connections.filter(u=>n!==u);for(const u of s)if(!u._closed&&!u._closePending){const y=new hn("versionchange",{newVersion:e,oldVersion:i});u.dispatchEvent(y)}if(s.some(u=>!u._closed&&!u._closePending)){const u=new hn("blocked",{newVersion:e,oldVersion:i});t.dispatchEvent(u)}const c=()=>{if(s.some(f=>!f._closed&&!f._closePending)){Et(c);return}n._rawDatabase.version=e,n.version=e;const y=n.transaction(n.objectStoreNames,"versionchange");t.result=n,t.readyState="done",t.transaction=y,y._rollbackLog.push(()=>{n._rawDatabase.version=i,n.version=i});const p=new hn("upgradeneeded",{newVersion:e,oldVersion:i});t.dispatchEvent(p),y.addEventListener("error",()=>{n._runningVersionchangeTransaction=!1}),y.addEventListener("abort",()=>{n._runningVersionchangeTransaction=!1,t.transaction=null,Et(()=>{r(new Zr)})}),y.addEventListener("complete",()=>{n._runningVersionchangeTransaction=!1,t.transaction=null,Et(()=>{n._closePending?r(new Zr):r(null)})})};c()},Fo=(n,e,t,r,i)=>{let s=n.get(e);if(s===void 0&&(s=new Co(e,0),n.set(e,s)),t===void 0&&(t=s.version!==0?s.version:1),s.version>t)return i(new lo);const o=new Eo(s);s.version<t?Do(o,t,r,c=>{if(c)return i(c);i(null,o)}):i(null,o)};class Bo{cmp=ae;_databases=new Map;deleteDatabase(e){const t=new ji;return t.source=null,Et(()=>{const r=this._databases.get(e),i=r!==void 0?r.version:0;Oo(this._databases,e,t,s=>{if(s){t.error=new Error,t.error.name=s.name,t.readyState="done";const c=new Tt("error",{bubbles:!0,cancelable:!0});c.eventPath=[],t.dispatchEvent(c);return}t.result=void 0,t.readyState="done";const o=new hn("success",{newVersion:null,oldVersion:i});t.dispatchEvent(o)})}),t}open(e,t){if(arguments.length>1&&t!==void 0&&(t=Pn(t,"MAX_SAFE_INTEGER")),t===0)throw new TypeError;const r=new ji;return r.source=null,Et(()=>{Fo(this._databases,e,t,r,(i,s)=>{if(i){r.result=void 0,r.readyState="done",r.error=new Error,r.error.name=i.name;const c=new Tt("error",{bubbles:!0,cancelable:!0});c.eventPath=[],r.dispatchEvent(c);return}r.result=s,r.readyState="done";const o=new Tt("success");o.eventPath=[],r.dispatchEvent(o)})}),r}databases(){return new Promise(e=>{const t=[];for(const[r,i]of this._databases)t.push({name:r,version:i.version});e(t)})}toString(){return"[object IDBFactory]"}}const xo=new Bo;class Ti extends Qt{inMemory;ActiveEncounter;Creatures;Tracker;Settings;constructor(e,t){super("ClashDatabase",t),this.inMemory=e;const r=`
        id,
        tokenId,
        initiative,
        currentHp,
        isMonster,
        isActive,
        unitName,
        maxHP,
        armorClass,
        unitType,
        unitSize,
        strScore,
        strSave,
        dexScore,
        dexSave,
        conScore,
        conSave,
        intScore,
        intSave,
        wisScore,
        wisSave,
        chaScore,
        chaSave,
        damageVulnerabilities,
        damageImmunities,
        damageResistances,
        conditionImmunities,
        challengeRating,
        experiencePoints,
        alignment,
        standardActions,
        legendaryActions,
        specialAbilities,
        spellActions,
        reactions,
        spellList,
        senses,
        skills,
        languages,
        speedWalk,
        speedFly,
        speedClimb,
        speedBurrow,
        speedSwim,
        dataSlug
        `,i=r+", favorite",s=i+", ownerId",o=s+", sceneId";this.version(1).stores({ActiveEncounter:r,Creatures:r,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, disableFocus"}),this.version(2).stores({ActiveEncounter:r,Creatures:r,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(3).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(4).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"}),this.version(5).stores({ActiveEncounter:s,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"}),this.version(6).stores({ActiveEncounter:o,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"})}async SaveToCreatureStorage(e){return await gt.Creatures.add(e)}async DeleteFromCreatureStorage(e){return await gt.Creatures.delete(e)}async SaveToActiveList(e){return await gt.ActiveEncounter.add(e)}async DeleteFromActiveList(e){return await gt.ActiveEncounter.delete(e)}Ready(){console.log("Setup is complete.")}}async function To(){return gt||(gt=await jo(),gt)}async function jo(){return new Promise(n=>{let e=window.indexedDB.open("__test");e.onsuccess=async function(){console.log("DB for Clash running - Clearing local cache will remove stored data"),e.result.close(),window.indexedDB.deleteDatabase("__test"),n(new Ti(!1))},e.onerror=async function(){console.warn("IndexDB is disabled, no state will be saved"),window.indexedDB.deleteDatabase("__test"),n(new Ti(!0,{indexedDB:xo,IDBKeyRange:ie}))}})}let gt;class Io{id;tokenId;initiative;currentHP;isMonster;isActive;unitName;maxHP;armorClass;unitType;unitSize;strScore;strSave;dexScore;dexSave;conScore;conSave;intScore;intSave;wisScore;wisSave;chaScore;chaSave;damageVulnerabilities;damageImmunities;damageResistances;conditionImmunities;challengeRating;experiencePoints;alignment;standardActions;legendaryActions;specialAbilities;spellActions;reactions;spellList;senses;languages;speedWalk;speedFly;speedClimb;speedBurrow;speedSwim;dataSlug;favorite;ownerId;sceneId;constructor(e,t,r){this.id=e,this.tokenId=e,this.isActive=0,this.unitName=t??="Default",this.initiative=1,this.currentHP=4,this.maxHP=4,this.armorClass=10,this.speedWalk=30,this.speedBurrow=0,this.speedSwim=0,this.speedClimb=0,this.speedFly=0,this.strScore=10,this.dexScore=10,this.conScore=10,this.intScore=10,this.wisScore=10,this.chaScore=10,this.strSave=2,this.dexSave=2,this.conSave=2,this.intSave=2,this.wisSave=2,this.chaSave=2,this.senses="No unique senses.",this.unitSize="Medium",this.unitType="Humanoid",this.alignment="True Neutral",this.languages="No known languages.",this.damageVulnerabilities="None.",this.damageResistances="None.",this.damageImmunities="None.",this.conditionImmunities="None.",this.challengeRating="0CR.",this.experiencePoints=0,this.standardActions=[],this.specialAbilities=[],this.spellList=[],this.dataSlug="",this.favorite=!1,this.ownerId=r,this.sceneId=""}ImportFromJSON(e){let t=JSON.parse(e);this.SetToModel(t)}async ImportFromDatabase(e){const t=await gt.ActiveEncounter.get(e);if(!t){console.log("Found no UnitInformation for "+e);return}this.SetToModel(t),this.isActive=t.isActive}SetToModel(e,t){this.initiative=e.initiative,this.currentHP=e.maxHP,this.maxHP=e.maxHP,this.isMonster=e.isMonster,this.unitName=e.unitName,this.armorClass=e.armorClass,this.unitType=e.unitType,this.unitSize=e.unitSize,this.strScore=e.strScore,this.strSave=e.strSave,this.dexScore=e.dexScore,this.dexSave=e.dexSave,this.conScore=e.conScore,this.conSave=e.conSave,this.intScore=e.intScore,this.intSave=e.intSave,this.wisScore=e.wisScore,this.wisSave=e.wisSave,this.chaScore=e.chaScore,this.chaSave=e.chaSave,this.damageVulnerabilities=e.damageVulnerabilities,this.damageImmunities=e.damageImmunities,this.damageResistances=e.damageResistances,this.conditionImmunities=e.conditionImmunities,this.challengeRating=e.challengeRating,this.experiencePoints=e.experiencePoints,this.alignment=e.alignment,this.standardActions=e.standardActions,this.legendaryActions=e.legendaryActions,this.specialAbilities=e.specialAbilities,this.spellActions=e.spellActions,this.reactions=e.reactions,this.spellList=e.spellList,this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speedWalk,this.speedFly=e.speedFly,this.speedClimb=e.speedClimb,this.speedBurrow=e.speedBurrow,this.speedSwim=e.speedSwim,this.dataSlug=e.dataSlug,this.favorite=t?e.favorite:!1,this.CheckDefaults()}ImportCustomFormInputs(e){this.unitName=this.GetContent(e,"formUnitName"),this.maxHP=parseFloat(this.GetContent(e,"formMaxHP"))||4,this.currentHP=this.maxHP,this.armorClass=parseFloat(this.GetContent(e,"formArmorClass"))||10,this.unitType=this.GetContent(e,"formUnitType"),this.unitSize=this.GetContent(e,"formUnitSize"),this.alignment=this.GetContent(e,"formAlignment"),this.speedWalk=parseFloat(this.GetContent(e,"formSpeedWalk"))||0,this.speedSwim=parseFloat(this.GetContent(e,"formSpeedSwim"))||0,this.speedClimb=parseFloat(this.GetContent(e,"formSpeedClimb"))||0,this.speedFly=parseFloat(this.GetContent(e,"formSpeedFly"))||0,this.speedBurrow=parseFloat(this.GetContent(e,"formSpeedBurrow"))||0,this.strScore=parseFloat(this.GetContent(e,"formStrScore"))||1,this.dexScore=parseFloat(this.GetContent(e,"formDexScore"))||1,this.conScore=parseFloat(this.GetContent(e,"formConScore"))||1,this.intScore=parseFloat(this.GetContent(e,"formIntScore"))||1,this.wisScore=parseFloat(this.GetContent(e,"formWisScore"))||1,this.chaScore=parseFloat(this.GetContent(e,"formChaScore"))||1,this.strSave=parseFloat(this.GetContent(e,"formStrSave"))||0,this.dexSave=parseFloat(this.GetContent(e,"formDexSave"))||0,this.conSave=parseFloat(this.GetContent(e,"formConSave"))||0,this.intSave=parseFloat(this.GetContent(e,"formIntSave"))||0,this.wisSave=parseFloat(this.GetContent(e,"formWisSave"))||0,this.chaSave=parseFloat(this.GetContent(e,"formChaSave"))||0,this.senses=this.GetContent(e,"formSenses"),this.languages=this.GetContent(e,"formLanguages"),this.challengeRating=this.GetContent(e,"formChallengeRating"),this.experiencePoints=parseFloat(this.GetContent(e,"formEXP"))||0,this.damageImmunities=this.GetContent(e,"formImmune"),this.damageResistances=this.GetContent(e,"formResist"),this.damageVulnerabilities=this.GetContent(e,"formVulnerable"),this.conditionImmunities=this.GetContent(e,"formConditions");const t=e.querySelectorAll("#formAttackCollection > #formAttackContainer");this.standardActions=[],t.forEach(c=>{const u=c.querySelector("#formAttackName")?.textContent,y=c.querySelector("#formAttackDesc")?.textContent;if(u&&y){let p={name:u,desc:y};this.standardActions?.push(p)}});const r=e.querySelectorAll("#formReactionCollection > #formReactionContainer");this.reactions=[],r.forEach(c=>{const u=c.querySelector("#formReactionName")?.textContent,y=c.querySelector("#formReactionDesc")?.textContent;if(u&&y){let p={name:u,desc:y};this.reactions?.push(p)}});const i=e.querySelectorAll("#formLegendaryCollection > #formLegendaryContainer");this.legendaryActions=[],i.forEach(c=>{const u=c.querySelector("#formLegendaryName")?.textContent,y=c.querySelector("#formLegendaryDesc")?.textContent;if(u&&y){let p={name:u,desc:y};this.legendaryActions?.push(p)}});const s=e.querySelectorAll("#formAbilityCollection > #formAbilityContainer");this.specialAbilities=[],s.forEach(c=>{const u=c.querySelector("#formAbilityName")?.textContent,y=c.querySelector("#formAbilityDesc")?.textContent;if(u&&y){let p={name:u,desc:y};this.specialAbilities?.push(p)}});const o=e.querySelectorAll("#formSpellCollection > #formSpellContainer");this.spellActions=[],o.forEach(c=>{const u=c.querySelector("#formSpellName")?.textContent,y=c.querySelector("#formSpellDesc")?.textContent;if(u&&y){let p={name:u,desc:y};this.spellActions?.push(p)}}),this.CheckDefaults()}CheckDefaults(){this.unitName??="Nameless",this.maxHP??=4,this.currentHP??=this.maxHP,this.armorClass??=10,this.dataSlug??="Unknown",this.unitType??="Humanoid",this.unitSize??="Medium",this.alignment??="True Neutral",this.speedWalk??=30,this.speedSwim??=0,this.speedClimb??=0,this.speedFly??=0,this.speedBurrow??=0,this.strScore??=10,this.dexScore??=10,this.conScore??=10,this.intScore??=10,this.wisScore??=10,this.chaScore??=10,this.strSave??=Math.floor((Number(this.strScore)-10)/2),this.dexSave??=Math.floor((Number(this.dexScore)-10)/2),this.conSave??=Math.floor((Number(this.conScore)-10)/2),this.intSave??=Math.floor((Number(this.intScore)-10)/2),this.wisSave??=Math.floor((Number(this.wisScore)-10)/2),this.chaSave??=Math.floor((Number(this.chaScore)-10)/2),this.senses??="No unique senses.",this.languages??="No known languages.",this.challengeRating??="0CR.",this.experiencePoints??=0,this.damageImmunities??="None.",this.damageResistances??="None.",this.damageVulnerabilities??="None.",this.conditionImmunities??="None."}GetContent(e,t){return e.getElementById(t).textContent}async ImportOpen5eResponse(e){this.unitName=e.name,this.maxHP=e.hit_points,this.armorClass=e.armor_class,this.unitType=e.type,this.unitSize=e.size,this.strScore=e.strength,this.strSave=e.strength_save,this.dexScore=e.dexterity,this.dexSave=e.dexterity_save,this.conScore=e.constitution,this.conSave=e.constitution_save,this.intScore=e.intelligence,this.intSave=e.intelligence_save,this.wisScore=e.wisdom,this.wisSave=e.wisdom_save,this.chaScore=e.charisma,this.chaSave=e.charisma_save,this.damageVulnerabilities=e.damage_vulnerabilities,this.damageImmunities=e.damage_immunities,this.damageResistances=e.damage_resistances,this.conditionImmunities=e.condition_immunities,this.challengeRating=e.challenge_rating,this.experiencePoints=0,this.alignment=e.alignment,this.standardActions=e.actions,this.legendaryActions=e.legendary_actions,this.specialAbilities=e.special_abilities,this.reactions=e.reactions,this.spellList=e.spell_list,this.spellList!=null&&this.spellList?.length>0&&(this.spellActions=await this.ConvertSpellListtoSpellAction(this.spellList)),this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speed?.walk,this.speedFly=e.speed?.fly,this.speedClimb=e.speed?.walk,this.speedBurrow=e.speed?.burrow,this.speedSwim=e.speed?.swim,this.CheckDefaults()}async ConvertSpellListtoSpellAction(e){const t=[];for(var r=0,i;i=e[r];r++)await fetch(i).then(function(s){return s.json()}).then(function(s){let o={name:s.name,desc:s.desc};t.push(o)});return t}async SaveToDB(e){return this.sceneId=e,await gt.ActiveEncounter.put(this)}async SaveToCreatureStorage(){return await gt.Creatures.add(this)}}function Po(){let n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t==="x"?r:r&3|8).toString(16)})}function ko(n,e){const t=new Set(n),r=new Set(e),i=[];for(const s of n)r.has(s)||i.push(s);for(const s of e)t.has(s)||i.push(s);return i}function Ro(n,e){const t=parseInt(n.substring(1,3),16),r=parseInt(n.substring(3,5),16),i=parseInt(n.substring(5,7),16);return`rgba(${t}, ${r}, ${i}, ${e})`}function No(n,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),r=t.matches?"dark":"light",i=t.matches?"light":"dark";for(var s=0;s<e.styleSheets.length;s++)for(var o=0;o<e.styleSheets[s].cssRules.length;o++){let c=e.styleSheets[s].cssRules[o];c&&c.media&&c.media.mediaText.includes("prefers-color-scheme")&&(n.mode=="LIGHT"?(c.media.appendMedium(`(prefers-color-scheme: ${r})`),c.media.mediaText.includes(i)&&c.media.deleteMedium(`(prefers-color-scheme: ${i})`)):n.mode=="DARK"&&(c.media.appendMedium(`(prefers-color-scheme: ${i})`),c.media.mediaText.includes(r)&&c.media.deleteMedium(`(prefers-color-scheme: ${r})`)))}}export{ko as F,Po as G,Ro as H,No as S,Io as U,gt as d,To as g,uo as t};
