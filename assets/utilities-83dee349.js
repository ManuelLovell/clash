(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var et=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Wo{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return et(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECt",{items:e})})}getName(){return et(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return et(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return et(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return et(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return et(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return et(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return et(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:r}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return r.indexOf(e)===-1})}getConnectionId(){return et(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=r=>{e(r.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var Bt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Yo{constructor(e){this.messageBus=e}reset(){return Bt(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return Bt(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return Bt(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return Bt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return Bt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return Bt(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return Bt(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function zo(n){return typeof n.id=="string"}var ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hi={exports:{}},Tn=typeof Reflect=="object"?Reflect:null,ms=Tn&&typeof Tn.apply=="function"?Tn.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Br;Tn&&typeof Tn.ownKeys=="function"?Br=Tn.ownKeys:Object.getOwnPropertySymbols?Br=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Br=function(e){return Object.getOwnPropertyNames(e)};function Jo(n){console&&console.warn&&console.warn(n)}var Xs=Number.isNaN||function(e){return e!==e};function me(){me.init.call(this)}Hi.exports=me;Hi.exports.once=ta;me.EventEmitter=me;me.prototype._events=void 0;me.prototype._eventsCount=0;me.prototype._maxListeners=void 0;var vs=10;function Xr(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(me,"defaultMaxListeners",{enumerable:!0,get:function(){return vs},set:function(n){if(typeof n!="number"||n<0||Xs(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");vs=n}});me.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};me.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Xs(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Js(n){return n._maxListeners===void 0?me.defaultMaxListeners:n._maxListeners}me.prototype.getMaxListeners=function(){return Js(this)};me.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var u=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw u.context=o,u}var a=s[e];if(a===void 0)return!1;if(typeof a=="function")ms(a,this,t);else for(var d=a.length,c=no(a,d),r=0;r<d;++r)ms(c[r],this,t);return!0};function Qs(n,e,t,r){var i,s,o;if(Xr(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),i=Js(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=n,u.type=e,u.count=o.length,Jo(u)}return n}me.prototype.addListener=function(e,t){return Qs(this,e,t,!1)};me.prototype.on=me.prototype.addListener;me.prototype.prependListener=function(e,t){return Qs(this,e,t,!0)};function Qo(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zs(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=Qo.bind(r);return i.listener=t,r.wrapFn=i,i}me.prototype.once=function(e,t){return Xr(t),this.on(e,Zs(this,e,t)),this};me.prototype.prependOnceListener=function(e,t){return Xr(t),this.prependListener(e,Zs(this,e,t)),this};me.prototype.removeListener=function(e,t){var r,i,s,o,u;if(Xr(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){u=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Zo(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,u||t)}return this};me.prototype.off=me.prototype.removeListener;me.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function eo(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?ea(i):no(i,i.length)}me.prototype.listeners=function(e){return eo(this,e,!0)};me.prototype.rawListeners=function(e){return eo(this,e,!1)};me.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):to.call(n,e)};me.prototype.listenerCount=to;function to(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}me.prototype.eventNames=function(){return this._eventsCount>0?Br(this._events):[]};function no(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function Zo(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function ea(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function ta(n,e){return new Promise(function(t,r){function i(o){n.removeListener(e,s),r(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}ro(n,e,s,{once:!0}),e!=="error"&&na(n,i,{once:!0})})}function na(n,e,t){typeof n.on=="function"&&ro(n,"error",e,t)}function ro(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var ra=Hi.exports;let fr;const ia=new Uint8Array(16);function sa(){if(!fr&&(fr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fr(ia)}const Ve=[];for(let n=0;n<256;++n)Ve.push((n+256).toString(16).slice(1));function oa(n,e=0){return(Ve[n[e+0]]+Ve[n[e+1]]+Ve[n[e+2]]+Ve[n[e+3]]+"-"+Ve[n[e+4]]+Ve[n[e+5]]+"-"+Ve[n[e+6]]+Ve[n[e+7]]+"-"+Ve[n[e+8]]+Ve[n[e+9]]+"-"+Ve[n[e+10]]+Ve[n[e+11]]+Ve[n[e+12]]+Ve[n[e+13]]+Ve[n[e+14]]+Ve[n[e+15]]).toLowerCase()}const aa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gs={randomUUID:aa};function io(n,e,t){if(gs.randomUUID&&!e&&!n)return gs.randomUUID();n=n||{};const r=n.random||(n.rng||sa)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return oa(r)}class ua extends ra.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=r=>{const i=r.data;if(r.origin===this.targetOrigin&&zo(i)){if(i.id==="OBR_READY"){this.ready=!0;const s=i.data;this.ref=s.ref,this.userId=s.userId}this.emit(i.id,i.data)}},this.send=(r,i,s)=>{var o;if(!this.ref)throw Error("Unable to send message: not ready");(o=window.parent)===null||o===void 0||o.postMessage({id:r,data:i,ref:this.ref,nonce:s},this.targetOrigin)},this.sendAsync=(r,i,s=5e3)=>{const o=`_${io()}`;return this.send(r,i,o),Promise.race([new Promise((u,a)=>{const d=this;function c(f){d.off(`${r}_RESPONSE${o}`,c),d.off(`${r}_ERROR${o}`,h),u(f)}function h(f){d.off(`${r}_RESPONSE${o}`,c),d.off(`${r}_ERROR${o}`,h),a(f)}this.on(`${r}_RESPONSE${o}`,c),this.on(`${r}_ERROR${o}`,h)}),new Promise((u,a)=>window.setTimeout(()=>a(new Error(`Message ${r} took longer than ${s}ms to get a result`)),s))])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var _s=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class ca{constructor(e){this.messageBus=e}show(e,t){return _s(this,void 0,void 0,function*(){const{id:r}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return r})}close(e){return _s(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var An=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class la{constructor(e){this.messageBus=e}getColor(){return An(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return An(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return An(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return An(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return An(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return An(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=r=>{e(r.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var tt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class ha{constructor(e){this.messageBus=e}getDpi(){return tt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return tt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return tt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return tt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return tt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return tt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return tt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,r){return tt(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:r});return i})}getDistance(e,t){return tt(this,void 0,void 0,function*(){const{distance:r}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return r})}onChange(e){const t=r=>{e(r.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var pr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class da{constructor(e){this.messageBus=e}undo(){return pr(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return pr(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return pr(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return pr(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function He(n){for(var e=arguments.length,t=Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function yn(n){return!!n&&!!n[vt]}function Qt(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var i=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===ba}(n)||Array.isArray(n)||!!n[Vn]||!!(!((e=n.constructor)===null||e===void 0)&&e[Vn])||Jr(n)||Qr(n))}function Fn(n,e,t){t===void 0&&(t=!1),Zt(n)===0?(t?Object.keys:Zi)(n).forEach(function(r){t&&typeof r=="symbol"||e(r,n[r],n)}):n.forEach(function(r,i){return e(i,r,n)})}function Zt(n){var e=n[vt];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:Jr(n)?2:Qr(n)?3:0}function zn(n,e){return Zt(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function Cr(n,e){return Zt(n)===2?n.get(e):n[e]}function so(n,e,t){var r=Zt(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function fa(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function Jr(n){return ga&&n instanceof Map}function Qr(n){return _a&&n instanceof Set}function un(n){return n.o||n.t}function Wi(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=Aa(n);delete e[vt];for(var t=Zi(e),r=0;r<t.length;r++){var i=t[r],s=e[i];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function Yi(n,e){return e===void 0&&(e=!1),zi(n)||yn(n)||!Qt(n)||(Zt(n)>1&&(n.set=n.add=n.clear=n.delete=pa),Object.freeze(n),e&&Fn(n,function(t,r){return Yi(r,!0)},!0)),n}function pa(){He(2)}function zi(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function Nt(n){var e=gi[n];return e||He(18,n),e}function ya(n,e){gi[n]||(gi[n]=e)}function bs(){return Xn}function ri(n,e){e&&(Nt("Patches"),n.u=[],n.s=[],n.v=e)}function jr(n){yi(n),n.p.forEach(ma),n.p=null}function yi(n){n===Xn&&(Xn=n.l)}function As(n){return Xn={p:[],l:Xn,h:n,m:!0,_:0}}function ma(n){var e=n[vt];e.i===0||e.i===1?e.j():e.g=!0}function ii(n,e){e._=e.p.length;var t=e.p[0],r=n!==void 0&&n!==t;return e.h.O||Nt("ES5").S(e,n,r),r?(t[vt].P&&(jr(e),He(4)),Qt(n)&&(n=Pr(e,n),e.l||kr(e,n)),e.u&&Nt("Patches").M(t[vt].t,n,e.u,e.s)):n=Pr(e,t,[]),jr(e),e.u&&e.v(e.u,e.s),n!==Qi?n:void 0}function Pr(n,e,t){if(zi(e))return e;var r=e[vt];if(!r)return Fn(e,function(u,a){return Es(n,r,e,u,a,t)},!0),e;if(r.A!==n)return e;if(!r.P)return kr(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=Wi(r.k):r.o,s=i,o=!1;r.i===3&&(s=new Set(i),i.clear(),o=!0),Fn(s,function(u,a){return Es(n,r,i,u,a,t,o)}),kr(n,i,!1),t&&n.u&&Nt("Patches").N(r,t,n.u,n.s)}return r.o}function Es(n,e,t,r,i,s,o){if(yn(i)){var u=Pr(n,i,s&&e&&e.i!==3&&!zn(e.R,r)?s.concat(r):void 0);if(so(t,r,u),!yn(u))return;n.m=!1}else o&&t.add(i);if(Qt(i)&&!zi(i)){if(!n.h.D&&n._<1)return;Pr(n,i),e&&e.A.l||kr(n,i)}}function kr(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&Yi(e,t)}function si(n,e){var t=n[vt];return(t?un(t):n)[e]}function ws(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=Object.getPrototypeOf(t)}}function mi(n){n.P||(n.P=!0,n.l&&mi(n.l))}function oi(n){n.o||(n.o=Wi(n.t))}function vi(n,e,t){var r=Jr(e)?Nt("MapSet").F(e,t):Qr(e)?Nt("MapSet").T(e,t):n.O?function(i,s){var o=Array.isArray(i),u={i:o?1:0,A:s?s.A:bs(),P:!1,I:!1,R:{},l:s,t:i,k:null,o:null,j:null,C:!1},a=u,d=_i;o&&(a=[u],d=Ln);var c=Proxy.revocable(a,d),h=c.revoke,f=c.proxy;return u.k=f,u.j=h,f}(e,t):Nt("ES5").J(e,t);return(t?t.A:bs()).p.push(r),r}function va(n){return yn(n)||He(22,n),function e(t){if(!Qt(t))return t;var r,i=t[vt],s=Zt(t);if(i){if(!i.P&&(i.i<4||!Nt("ES5").K(i)))return i.t;i.I=!0,r=Os(t,s),i.I=!1}else r=Os(t,s);return Fn(r,function(o,u){i&&Cr(i.t,o)===u||so(r,o,e(u))}),s===3?new Set(r):r}(n)}function Os(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return Wi(n)}function Xi(){function n(r){if(!Qt(r))return r;if(Array.isArray(r))return r.map(n);if(Jr(r))return new Map(Array.from(r.entries()).map(function(o){return[o[0],n(o[1])]}));if(Qr(r))return new Set(Array.from(r).map(n));var i=Object.create(Object.getPrototypeOf(r));for(var s in r)i[s]=n(r[s]);return zn(r,Vn)&&(i[Vn]=r[Vn]),i}function e(r){return yn(r)?n(r):r}var t="add";ya("Patches",{$:function(r,i){return i.forEach(function(s){for(var o=s.path,u=s.op,a=r,d=0;d<o.length-1;d++){var c=Zt(a),h=o[d];typeof h!="string"&&typeof h!="number"&&(h=""+h),c!==0&&c!==1||h!=="__proto__"&&h!=="constructor"||He(24),typeof a=="function"&&h==="prototype"&&He(24),typeof(a=Cr(a,h))!="object"&&He(15,o.join("/"))}var f=Zt(a),v=n(s.value),A=o[o.length-1];switch(u){case"replace":switch(f){case 2:return a.set(A,v);case 3:He(16);default:return a[A]=v}case t:switch(f){case 1:return A==="-"?a.push(v):a.splice(A,0,v);case 2:return a.set(A,v);case 3:return a.add(v);default:return a[A]=v}case"remove":switch(f){case 1:return a.splice(A,1);case 2:return a.delete(A);case 3:return a.delete(s.value);default:return delete a[A]}default:He(17,u)}}),r},N:function(r,i,s,o){switch(r.i){case 0:case 4:case 2:return function(u,a,d,c){var h=u.t,f=u.o;Fn(u.R,function(v,A){var m=Cr(h,v),b=Cr(f,v),E=A?zn(h,v)?"replace":t:"remove";if(m!==b||E!=="replace"){var _=a.concat(v);d.push(E==="remove"?{op:E,path:_}:{op:E,path:_,value:b}),c.push(E===t?{op:"remove",path:_}:E==="remove"?{op:t,path:_,value:e(m)}:{op:"replace",path:_,value:e(m)})}})}(r,i,s,o);case 5:case 1:return function(u,a,d,c){var h=u.t,f=u.R,v=u.o;if(v.length<h.length){var A=[v,h];h=A[0],v=A[1];var m=[c,d];d=m[0],c=m[1]}for(var b=0;b<h.length;b++)if(f[b]&&v[b]!==h[b]){var E=a.concat([b]);d.push({op:"replace",path:E,value:e(v[b])}),c.push({op:"replace",path:E,value:e(h[b])})}for(var _=h.length;_<v.length;_++){var C=a.concat([_]);d.push({op:t,path:C,value:e(v[_])})}h.length<v.length&&c.push({op:"replace",path:a.concat(["length"]),value:h.length})}(r,i,s,o);case 3:return function(u,a,d,c){var h=u.t,f=u.o,v=0;h.forEach(function(A){if(!f.has(A)){var m=a.concat([v]);d.push({op:"remove",path:m,value:A}),c.unshift({op:t,path:m,value:A})}v++}),v=0,f.forEach(function(A){if(!h.has(A)){var m=a.concat([v]);d.push({op:t,path:m,value:A}),c.unshift({op:"remove",path:m,value:A})}v++})}(r,i,s,o)}},M:function(r,i,s,o){s.push({op:"replace",path:[],value:i===Qi?void 0:i}),o.push({op:"replace",path:[],value:r})}})}var Ss,Xn,Ji=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",ga=typeof Map<"u",_a=typeof Set<"u",Bs=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Qi=Ji?Symbol.for("immer-nothing"):((Ss={})["immer-nothing"]=!0,Ss),Vn=Ji?Symbol.for("immer-draftable"):"__$immer_draftable",vt=Ji?Symbol.for("immer-state"):"__$immer_state",ba=""+Object.prototype.constructor,Zi=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Aa=Object.getOwnPropertyDescriptors||function(n){var e={};return Zi(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},gi={},_i={get:function(n,e){if(e===vt)return n;var t=un(n);if(!zn(t,e))return function(i,s,o){var u,a=ws(s,o);return a?"value"in a?a.value:(u=a.get)===null||u===void 0?void 0:u.call(i.k):void 0}(n,t,e);var r=t[e];return n.I||!Qt(r)?r:r===si(n.t,e)?(oi(n),n.o[e]=vi(n.A.h,r,n)):r},has:function(n,e){return e in un(n)},ownKeys:function(n){return Reflect.ownKeys(un(n))},set:function(n,e,t){var r=ws(un(n),e);if(r?.set)return r.set.call(n.k,t),!0;if(!n.P){var i=si(un(n),e),s=i?.[vt];if(s&&s.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(fa(t,i)&&(t!==void 0||zn(n.t,e)))return!0;oi(n),mi(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return si(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,oi(n),mi(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=un(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty:function(){He(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){He(12)}},Ln={};Fn(_i,function(n,e){Ln[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Ln.deleteProperty=function(n,e){return Ln.set.call(this,n,e,void 0)},Ln.set=function(n,e,t){return _i.set.call(this,n[0],e,t,n[0])};var Ea=function(){function n(t){var r=this;this.O=Bs,this.D=!0,this.produce=function(i,s,o){if(typeof i=="function"&&typeof s!="function"){var u=s;s=i;var a=r;return function(m){var b=this;m===void 0&&(m=u);for(var E=arguments.length,_=Array(E>1?E-1:0),C=1;C<E;C++)_[C-1]=arguments[C];return a.produce(m,function(T){var x;return(x=s).call.apply(x,[b,T].concat(_))})}}var d;if(typeof s!="function"&&He(6),o!==void 0&&typeof o!="function"&&He(7),Qt(i)){var c=As(r),h=vi(r,i,void 0),f=!0;try{d=s(h),f=!1}finally{f?jr(c):yi(c)}return typeof Promise<"u"&&d instanceof Promise?d.then(function(m){return ri(c,o),ii(m,c)},function(m){throw jr(c),m}):(ri(c,o),ii(d,c))}if(!i||typeof i!="object"){if((d=s(i))===void 0&&(d=i),d===Qi&&(d=void 0),r.D&&Yi(d,!0),o){var v=[],A=[];Nt("Patches").M(i,d,v,A),o(v,A)}return d}He(21,i)},this.produceWithPatches=function(i,s){if(typeof i=="function")return function(d){for(var c=arguments.length,h=Array(c>1?c-1:0),f=1;f<c;f++)h[f-1]=arguments[f];return r.produceWithPatches(d,function(v){return i.apply(void 0,[v].concat(h))})};var o,u,a=r.produce(i,s,function(d,c){o=d,u=c});return typeof Promise<"u"&&a instanceof Promise?a.then(function(d){return[d,o,u]}):[a,o,u]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){Qt(t)||He(8),yn(t)&&(t=va(t));var r=As(this),i=vi(this,t,void 0);return i[vt].C=!0,yi(r),i},e.finishDraft=function(t,r){var i=t&&t[vt],s=i.A;return ri(s,r),ii(void 0,s)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!Bs&&He(20),this.O=t},e.applyPatches=function(t,r){var i;for(i=r.length-1;i>=0;i--){var s=r[i];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}i>-1&&(r=r.slice(i+1));var o=Nt("Patches").$;return yn(t)?o(t,r):this.produce(t,function(u){return o(u,r)})},n}(),gt=new Ea;gt.produce;var es=gt.produceWithPatches.bind(gt);gt.setAutoFreeze.bind(gt);gt.setUseProxies.bind(gt);gt.applyPatches.bind(gt);gt.createDraft.bind(gt);gt.finishDraft.bind(gt);var En=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};Xi();class wa{constructor(e){this.messageBus=e}getItems(e){return En(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t){return En(this,void 0,void 0,function*(){let r;this.isItemArray(e)?r=e:r=yield this.getItems(e);const[i,s]=es(r,t),o=i.map(u=>({id:u.id,type:u.type}));for(const u of s){const[a,d]=u.path;typeof a=="number"&&typeof d=="string"&&(o[a][d]=i[a][d])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:o})})}addItems(e){return En(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return En(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return En(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return En(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=r=>{e(r.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var wn=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};Xi();class Oa{constructor(e){this.messageBus=e}getItems(e){return wn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,r){return wn(this,void 0,void 0,function*(){const i=yield this.getItems(e),[s,o]=es(i,t),u=s.map(a=>({id:a.id,type:a.type}));for(const a of o){const[d,c]=a.path;typeof d=="number"&&typeof c=="string"&&(u[d][c]=s[d][c])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:u,fastUpdate:r})})}addItems(e){return wn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return wn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return wn(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return wn(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=r=>{e(r.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var ai=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Sa{constructor(e){this.messageBus=e,this.grid=new ha(e),this.fog=new la(e),this.history=new da(e),this.items=new wa(e),this.local=new Oa(e)}isReady(){return ai(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=r=>{e(r.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return ai(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return ai(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=r=>{e(r.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function Gn(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:e.icon.startsWith("http")?e.icon:`${window.location.origin}${e.icon}`}))}function oo(n){return Object.assign(Object.assign({},n),{url:n.url.startsWith("http")?n.url:`${window.location.origin}${n.url}`})}var Cs=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Ba{constructor(e){this.contextMenus={},this.handleClick=t=>{const r=this.contextMenus[t.id];r&&r.onClick(t.context,t.elementId)},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Cs(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:Gn(e.icons)}),this.contextMenus[e.id]=e})}remove(e){return Cs(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var Rt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Ca{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const r=this.tools[t.id];if(r)if(r.onClick){const i=r.onClick(t.context,t.elementId);Promise.resolve(i).then(s=>{s&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var r;const i=this.toolActions[t.id];i&&((r=i.onClick)===null||r===void 0||r.call(i,t.context,t.elementId))},this.handleToolModeClick=t=>{const r=this.toolModes[t.id];if(r)if(r.onClick){const i=r.onClick(t.context,t.elementId);Promise.resolve(i).then(s=>{s&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const r=this.toolModes[t.id];if(r)if(r.onToolClick){const i=r.onToolClick(t.context,t.event);Promise.resolve(i).then(s=>{s&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const r=this.toolModes[t.id];if(r)if(r.onToolDoubleClick){const i=r.onToolDoubleClick(t.context,t.event);Promise.resolve(i).then(s=>{s&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolDown)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolMove=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolMove)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolUp=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolUp)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolDragStart)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolDragMove)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolDragEnd)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onToolDragCancel)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeKeyDown=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onKeyDown)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeKeyUp=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onKeyUp)===null||r===void 0||r.call(i,t.context,t.event))},this.handleToolModeActivate=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onActivate)===null||r===void 0||r.call(i,t.context))},this.handleToolModeDeactivate=t=>{var r;const i=this.toolModes[t.id];i&&((r=i.onDeactivate)===null||r===void 0||r.call(i,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:Gn(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return Rt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:Gn(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:Gn(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return Rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var On=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Ta{constructor(e){this.messageBus=e}open(e){return On(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},oo(e)))})}close(e){return On(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return On(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return On(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return On(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return On(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var Ts=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Da{constructor(e){this.messageBus=e}open(e){return Ts(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},oo(e)))})}close(e){return Ts(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var nt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class xa{constructor(e){this.messageBus=e}getWidth(){return nt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return nt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return nt(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return nt(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return nt(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return nt(this,void 0,void 0,function*(){const t=Gn([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return nt(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return nt(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=r=>{e(r.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Ra=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};Xi();class Ia{constructor(e){this.messageBus=e}startItemInteraction(e){return Ra(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e});let r=e;return[o=>{const[u,a]=es(r,o);return r=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:t,patches:a}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:t})}]})}}var Fa=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class Na{constructor(e){this.messageBus=e}getPlayers(){return Fa(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=r=>{e(r.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var ui=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class ja{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return ui(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return ui(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return ui(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=r=>{e(r.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=r=>{e(r.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var Pa=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{d(r.next(c))}catch(h){o(h)}}function a(c){try{d(r.throw(c))}catch(h){o(h)}}function d(c){c.done?s(c.value):i(c.value).then(u,a)}d((r=r.apply(n,e||[])).next())})};class ka{constructor(e){this.messageBus=e}getTheme(){return Pa(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=r=>{e(r.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}class ao{constructor(e){this._item={createdUserId:e.id,id:io(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:e.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(e){return this._item.createdUserId=e,this.self()}id(e){return this._item.id=e,this.self()}name(e){return this._item.name=e,this.self()}lastModified(e){return this._item.lastModified=e,this.self()}zIndex(e){return this._item.zIndex=e,this.self()}lastModifiedUserId(e){return this._item.lastModifiedUserId=e,this.self()}locked(e){return this._item.locked=e,this.self()}metadata(e){return this._item.metadata=e,this.self()}position(e){return this._item.position=e,this.self()}rotation(e){return this._item.rotation=e,this.self()}scale(e){return this._item.scale=e,this.self()}visible(e){return this._item.visible=e,this.self()}attachedTo(e){return this._item.attachedTo=e,this.self()}layer(e){return this._item.layer=e,this.self()}disableHit(e){return this._item.disableHit=e,this.self()}disableAutoZIndex(e){return this._item.disableAutoZIndex=e,this.self()}disableAttachmentBehavior(e){return this._item.disableAttachmentBehavior=e,this.self()}self(){return this}}class Ma extends ao{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}style(e){return this._style=e,this.self()}backgroundColor(e){return this._style.backgroundColor=e,this.self()}backgroundOpacity(e){return this._style.backgroundOpacity=e,this.self()}cornerRadius(e){return this._style.cornerRadius=e,this.self()}pointerWidth(e){return this._style.pointerWidth=e,this.self()}pointerHeight(e){return this._style.pointerHeight=e,this.self()}pointerDirection(e){return this._style.pointerDirection=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class La extends ao{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}richText(e){return this._text.richText=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}textType(e){return this._text.type=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}const Ka=typeof atob=="function",ts=typeof Buffer=="function",Ds=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Ua="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Va=Array.prototype.slice.call(Ua),yr=(n=>{let e={};return n.forEach((t,r)=>e[t]=r),e})(Va),Ga=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,cn=String.fromCharCode.bind(String),xs=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),uo=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),$a=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,qa=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return cn((t>>>10)+55296)+cn((t&1023)+56320);case 3:return cn((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return cn((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Ha=n=>n.replace($a,qa),Wa=n=>{if(n=n.replace(/\s+/g,""),!Ga.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",r,i;for(let s=0;s<n.length;)e=yr[n.charAt(s++)]<<18|yr[n.charAt(s++)]<<12|(r=yr[n.charAt(s++)])<<6|(i=yr[n.charAt(s++)]),t+=r===64?cn(e>>16&255):i===64?cn(e>>16&255,e>>8&255):cn(e>>16&255,e>>8&255,e&255);return t},co=Ka?n=>atob(uo(n)):ts?n=>Buffer.from(n,"base64").toString("binary"):Wa,Ya=ts?n=>xs(Buffer.from(n,"base64")):n=>xs(co(n).split("").map(e=>e.charCodeAt(0))),za=ts?n=>Buffer.from(n,"base64").toString("utf8"):Ds?n=>Ds.decode(Ya(n)):n=>Ha(co(n)),Xa=n=>uo(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),Ja=n=>za(Xa(n));function Qa(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",r="";if(e){const s=Ja(e).split(" ");s.length===2&&(t=s[0],r=s[1])}return{origin:t,roomId:r}}var Rs;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(Rs||(Rs={}));const bi=Qa(),ze=new ua(bi.origin,bi.roomId),Za=new Yo(ze),ns=new Wo(ze),eu=new Na(ze),tu=new ca(ze),nu=new Sa(ze),ru=new Ba(ze),iu=new Ca(ze),su=new Ta(ze),ou=new Da(ze),au=new xa(ze),uu=new Ia(ze),cu=new ja(ze),lu=new ka(ze),Sc={onReady:n=>{ze.ready?n():ze.once("OBR_READY",()=>n())},get isReady(){return ze.ready},viewport:Za,player:ns,party:eu,notification:tu,scene:nu,contextMenu:ru,tool:iu,popover:su,modal:ou,action:au,interaction:uu,room:cu,theme:lu,isAvailable:!!bi.origin};function Bc(){return new Ma(ns)}function Cc(){return new La(ns)}class Tc{static EXTENSIONID="com.battle-system.clash";static MOBILEWIDTH=495;static EXTENSIONSUBMENUID="com.battle-system.clash-submenu";static EXTENSIONSCENEID="com.battle-system.clash-scene";static EXTENSIONLOGID="com.battle-system.clash-chatlog";static TURNTRACKER="47d6b2c4-cd17-11ed-afa1-0242ac120002";static SETTINGSID="0be56e49-9551-40c1-8847-e620470c33dc";static MULTISHEETID="999999999";static LABEL="56d6b2c4-cd17-11ed-afa1-0242ac120002";static DICENOTATION=/(\d+)[dD](\d+)(.*)$/i;static DICEMODIFIER=/([+-])(\d+)/;static PARENTHESESMATCH=/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g;static PLUSMATCH=/\s(\+\d+)\s/g}const Oe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,je=Object.keys,Ye=Array.isArray;function st(n,e){return typeof e!="object"||je(e).forEach(function(t){n[t]=e[t]}),n}typeof Promise>"u"||Oe.Promise||(Oe.Promise=Promise);const Jn=Object.getPrototypeOf,hu={}.hasOwnProperty;function _t(n,e){return hu.call(n,e)}function Nn(n,e){typeof e=="function"&&(e=e(Jn(n))),(typeof Reflect>"u"?je:Reflect.ownKeys)(e).forEach(t=>{qt(n,t,e[t])})}const lo=Object.defineProperty;function qt(n,e,t,r){lo(n,e,st(t&&_t(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function Dn(n){return{from:function(e){return n.prototype=Object.create(e.prototype),qt(n.prototype,"constructor",n),{extend:Nn.bind(null,n.prototype)}}}}const du=Object.getOwnPropertyDescriptor;function rs(n,e){let t;return du(n,e)||(t=Jn(n))&&rs(t,e)}const fu=[].slice;function Mr(n,e,t){return fu.call(n,e,t)}function ho(n,e){return e(n)}function Kn(n){if(!n)throw new Error("Assertion Failed")}function fo(n){Oe.setImmediate?setImmediate(n):setTimeout(n,0)}function po(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function Ht(n,e){if(_t(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=Ht(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var u=n[e.substr(0,o)];return u===void 0?void 0:Ht(u,e.substr(o+1))}}function Dt(n,e,t){if(n&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){Kn(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)Dt(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),u=e.substr(s+1);if(u==="")t===void 0?Ye(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var a=n[o];a&&_t(n,o)||(a=n[o]={}),Dt(a,u,t)}}else t===void 0?Ye(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function yo(n){var e={};for(var t in n)_t(n,t)&&(e[t]=n[t]);return e}const pu=[].concat;function mo(n){return pu.apply([],n)}const vo="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(mo([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>Oe[n]),yu=vo.map(n=>Oe[n]);po(vo,n=>[n,!0]);let Jt=null;function ar(n){Jt=typeof WeakMap<"u"&&new WeakMap;const e=Ai(n);return Jt=null,e}function Ai(n){if(!n||typeof n!="object")return n;let e=Jt&&Jt.get(n);if(e)return e;if(Ye(n)){e=[],Jt&&Jt.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(Ai(n[t]))}else if(yu.indexOf(n.constructor)>=0)e=n;else{const s=Jn(n);for(var i in e=s===Object.prototype?{}:Object.create(s),Jt&&Jt.set(n,e),n)_t(n,i)&&(e[i]=Ai(n[i]))}return e}const{toString:mu}={};function Ei(n){return mu.call(n).slice(8,-1)}const wi=typeof Symbol<"u"?Symbol.iterator:"@@iterator",vu=typeof wi=="symbol"?function(n){var e;return n!=null&&(e=n[wi])&&e.apply(n)}:function(){return null},Cn={};function Vt(n){var e,t,r,i;if(arguments.length===1){if(Ye(n))return n.slice();if(this===Cn&&typeof n=="string")return[n];if(i=vu(n)){for(t=[];!(r=i.next()).done;)t.push(r.value);return t}if(n==null)return[n];if(typeof(e=n.length)=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}const is=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function go(n,e){Pt=n,_o=e}var _o=()=>!0;const gu=!new Error("").stack;function _n(){if(gu)try{throw _n.arguments,new Error}catch(n){return n}return new Error}function Oi(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(_o).map(r=>`
`+r).join("")):""}var bo=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ss=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(bo),_u={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function xn(n,e){this._e=_n(),this.name=n,this.message=e}function Ao(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function Lr(n,e,t,r){this._e=_n(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=Ao(n,e)}function $n(n,e){this._e=_n(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=Ao(n,e)}Dn(xn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Oi(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Dn(Lr).from(xn),Dn($n).from(xn);var os=ss.reduce((n,e)=>(n[e]=e+"Error",n),{});const bu=xn;var W=ss.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=_n(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=_u[e]||t,this.inner=null)}return Dn(r).from(bu),n[e]=r,n},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var Is=bo.reduce((n,e)=>(n[e+"Error"]=W[e],n),{}),Tr=ss.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=W[e]),n),{});function ge(){}function Qn(n){return n}function Au(n,e){return n==null||n===Qn?e:function(t){return e(n(t))}}function mn(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function Eu(n,e){return n===ge?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?mn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?mn(i,this.onerror):i),s!==void 0?s:t}}function wu(n,e){return n===ge?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?mn(t,this.onsuccess):t),r&&(this.onerror=this.onerror?mn(r,this.onerror):r)}}function Ou(n,e){return n===ge?e:function(t){var r=n.apply(this,arguments);st(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?mn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?mn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:st(r,o)}}function Su(n,e){return n===ge?e:function(){return e.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function as(n,e){return n===ge?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Tr.ModifyError=Lr,Tr.DexieError=xn,Tr.BulkError=$n;var Zn={};const[Si,Kr,Bi]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,Jn(n),n];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Jn(e),n]})(),Eo=Kr&&Kr.then,Dr=Si&&Si.constructor,us=!!Bi;var Ci=!1,Bu=Bi?()=>{Bi.then(mr)}:Oe.setImmediate?setImmediate.bind(null,mr):Oe.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{mr(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(mr,0)},qn=function(n,e){Un.push([n,e]),Ur&&(Bu(),Ur=!1)},Ti=!0,Ur=!0,dn=[],xr=[],Di=null,xi=Qn,Rn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ns,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{Ns(n[0],n[1])}catch{}})}},$=Rn,Un=[],fn=0,Rr=[];function K(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ge,this._lib=!1;var e=this._PSD=$;if(Pt&&(this._stackHolder=_n(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==Zn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ii(this,this._value))}this._state=null,this._value=null,++e.ref,Oo(this,n)}const Ri={get:function(){var n=$,e=Vr;function t(r,i){var s=!n.global&&(n!==$||e!==Vr);const o=s&&!Wt();var u=new K((a,d)=>{cs(this,new wo(Gr(r,n,s,o),Gr(i,n,s,o),a,d,n))});return Pt&&Co(u,this),u}return t.prototype=Zn,t},set:function(n){qt(this,"then",n&&n.prototype===Zn?Ri:{get:function(){return n},set:Ri.set})}};function wo(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}function Oo(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&ur();t&&typeof t.then=="function"?Oo(n,(i,s)=>{t instanceof K?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,So(n)),r&&cr()}},Ii.bind(null,n))}catch(t){Ii(n,t)}}function Ii(n,e){if(xr.push(e),n._state===null){var t=n._lib&&ur();e=xi(e),n._state=!1,n._value=e,Pt&&e!==null&&typeof e=="object"&&!e._promise&&function(r,i,s){try{r.apply(null,s)}catch(o){i&&i(o)}}(()=>{var r=rs(e,"stack");e._promise=n,qt(e,"stack",{get:()=>Ci?r&&(r.get?r.get.apply(e):r.value):n.stack})}),function(r){dn.some(i=>i._value===r._value)||dn.push(r)}(n),So(n),t&&cr()}}function So(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)cs(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),fn===0&&(++fn,qn(()=>{--fn==0&&ls()},[]))}function cs(n,e){if(n._state!==null){var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++fn,qn(Cu,[t,n,e])}else n._listeners.push(e)}function Cu(n,e,t){try{Di=e;var r,i=e._value;e._state?r=n(i):(xr.length&&(xr=[]),r=n(i),xr.indexOf(i)===-1&&function(s){for(var o=dn.length;o;)if(dn[--o]._value===s._value)return void dn.splice(o,1)}(e)),t.resolve(r)}catch(s){t.reject(s)}finally{Di=null,--fn==0&&ls(),--t.psd.ref||t.psd.finalize()}}function Bo(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i,s,o=n._value;o!=null?(i=o.name||"Error",s=o.message||o,r=Oi(o,0)):(i=o,s=""),e.push(i+(s?": "+s:"")+r)}return Pt&&((r=Oi(n._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),n._prev&&Bo(n._prev,e,t)),e}function Co(n,e){var t=e?e._numPrev+1:0;t<100&&(n._prev=e,n._numPrev=t)}function mr(){ur()&&cr()}function ur(){var n=Ti;return Ti=!1,Ur=!1,n}function cr(){var n,e,t;do for(;Un.length>0;)for(n=Un,Un=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(Un.length>0);Ti=!0,Ur=!0}function ls(){var n=dn;dn=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Rr.slice(0),t=e.length;t;)e[--t]()}function vr(n){return new K(Zn,!1,n)}function Ce(n,e){var t=$;return function(){var r=ur(),i=$;try{return tn(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{tn(i,!1),r&&cr()}}}Nn(K.prototype,{then:Ri,_then:function(n,e){cs(this,new wo(null,null,n,e,$))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):vr(r)):this.then(null,r=>r&&r.name===e?t(r):vr(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),vr(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ci=!0;var n=Bo(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{Ci=!1}}},timeout:function(n,e){return n<1/0?new K((t,r)=>{var i=setTimeout(()=>r(new W.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&qt(K.prototype,Symbol.toStringTag,"Dexie.Promise"),Rn.env=To(),Nn(K,{all:function(){var n=Vt.apply(null,arguments).map(gr);return new K(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>K.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof K)return n;if(n&&typeof n.then=="function")return new K((t,r)=>{n.then(t,r)});var e=new K(Zn,!0,n);return Co(e,Di),e},reject:vr,race:function(){var n=Vt.apply(null,arguments).map(gr);return new K((e,t)=>{n.map(r=>K.resolve(r).then(e,t))})},PSD:{get:()=>$,set:n=>$=n},totalEchoes:{get:()=>Vr},newPSD:en,usePSD:Pn,scheduler:{get:()=>qn,set:n=>{qn=n}},rejectionMapper:{get:()=>xi,set:n=>{xi=n}},follow:(n,e)=>new K((t,r)=>en((i,s)=>{var o=$;o.unhandleds=[],o.onunhandled=s,o.finalize=mn(function(){(function(u){function a(){u(),Rr.splice(Rr.indexOf(a),1)}Rr.push(a),++fn,qn(()=>{--fn==0&&ls()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))}),Dr&&(Dr.allSettled&&qt(K,"allSettled",function(){const n=Vt.apply(null,arguments).map(gr);return new K(e=>{n.length===0&&e([]);let t=n.length;const r=new Array(t);n.forEach((i,s)=>K.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),Dr.any&&typeof AggregateError<"u"&&qt(K,"any",function(){const n=Vt.apply(null,arguments).map(gr);return new K((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length;const i=new Array(r);n.forEach((s,o)=>K.resolve(s).then(u=>e(u),u=>{i[o]=u,--r||t(new AggregateError(i))}))})}));const We={awaits:0,echoes:0,id:0};var Tu=0,Ir=[],ci=0,Vr=0,Du=0;function en(n,e,t,r){var i=$,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Du;var o=Rn.env;s.env=us?{Promise:K,PromiseProp:{value:K,configurable:!0,writable:!0},all:K.all,race:K.race,allSettled:K.allSettled,any:K.any,resolve:K.resolve,reject:K.reject,nthen:Fs(o.nthen,s),gthen:Fs(o.gthen,s)}:{},e&&st(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=Pn(s,n,t,r);return s.ref===0&&s.finalize(),u}function jn(){return We.id||(We.id=++Tu),++We.awaits,We.echoes+=100,We.id}function Wt(){return!!We.awaits&&(--We.awaits==0&&(We.id=0),We.echoes=100*We.awaits,!0)}function gr(n){return We.echoes&&n&&n.constructor===Dr?(jn(),n.then(e=>(Wt(),e),e=>(Wt(),ke(e)))):n}function xu(n){++Vr,We.echoes&&--We.echoes!=0||(We.echoes=We.id=0),Ir.push($),tn(n,!0)}function Ru(){var n=Ir[Ir.length-1];Ir.pop(),tn(n,!1)}function tn(n,e){var t=$;if((e?!We.echoes||ci++&&n===$:!ci||--ci&&n===$)||Do(e?xu.bind(null,n):Ru),n!==$&&($=n,t===Rn&&(Rn.env=To()),us)){var r=Rn.env.Promise,i=n.env;Kr.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(Oe,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function To(){var n=Oe.Promise;return us?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Oe,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:Kr.then,gthen:n.prototype.then}:{}}function Pn(n,e,t,r,i){var s=$;try{return tn(n,!0),e(t,r,i)}finally{tn(s,!1)}}function Do(n){Eo.call(Si,n)}function Gr(n,e,t,r){return typeof n!="function"?n:function(){var i=$;t&&jn(),tn(e,!0);try{return n.apply(this,arguments)}finally{tn(i,!1),r&&Do(Wt)}}}function Fs(n,e){return function(t,r){return n.call(this,Gr(t,e),Gr(r,e))}}(""+Eo).indexOf("[native code]")===-1&&(jn=Wt=ge);function Ns(n,e){var t;try{t=e.onuncatched(n)}catch{}if(t!==!1)try{var r,i={promise:e,reason:n};if(Oe.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),st(r,i)):Oe.CustomEvent&&st(r=new CustomEvent("unhandledrejection",{detail:i}),i),r&&Oe.dispatchEvent&&(dispatchEvent(r),!Oe.PromiseRejectionEvent&&Oe.onunhandledrejection))try{Oe.onunhandledrejection(r)}catch{}Pt&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var ke=K.reject;function Fi(n,e,t,r){if(n.idbdb&&(n._state.openComplete||$.letThrough||n._vip)){var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===os.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Fi(n,e,t,r))):ke(s)}return i._promise(e,(s,o)=>en(()=>($.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(n._state.openComplete)return ke(new W.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return ke(new W.DatabaseClosed);n.open().catch(ge)}return n._state.dbReadyPromise.then(()=>Fi(n,e,t,r))}const ln=String.fromCharCode(65535),Kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Hn=[],Zr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Iu=Zr,Fu=Zr,xo=n=>!/(dexie\.js|dexie\.min\.js)/.test(n);function vn(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}const Ro={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function _r(n){return typeof n!="string"||/\./.test(n)?e=>e:e=>(e[n]===void 0&&n in e&&delete(e=ar(e))[n],e)}class Nu{_trans(e,t,r){const i=this._tx||$.trans,s=this.name;function o(a,d,c){if(!c.schema[s])throw new W.NotFound("Table "+s+" not part of transaction");return t(c.idbtrans,c)}const u=ur();try{return i&&i.db===this.db?i===$.trans?i._promise(e,o,r):en(()=>i._promise(e,o,r),{trans:i,transless:$.transless||$}):Fi(this.db,e,[this.name],o)}finally{u&&cr()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ye(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=je(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(d=>d.compound&&t.every(c=>d.keyPath.indexOf(c)>=0)&&d.keyPath.every(c=>t.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==ln)return this.where(r.name).equals(r.keyPath.map(d=>e[d]));!r&&Pt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(d,c){try{return s.cmp(d,c)===0}catch{return!1}}const[u,a]=t.reduce(([d,c],h)=>{const f=i[h],v=e[h];return[d||f,d||!f?vn(c,f&&f.multi?A=>{const m=Ht(A,h);return Ye(m)&&m.some(b=>o(v,b))}:A=>o(v,Ht(A,h))):c]},[null,null]);return u?this.where(u.name).equals(e[u.keyPath]).filter(a):r?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ye(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=r=>{if(!r)return r;const i=Object.create(e.prototype);for(var s in r)if(_t(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass(function(e){st(this,e)})}add(e,t){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=_r(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?K.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Dt(e,i,o)}catch{}return o})}update(e,t){if(typeof e!="object"||Ye(e))return this.where(":id").equals(e).modify(t);{const r=Ht(e,this.schema.primKey.keyPath);if(r===void 0)return ke(new W.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?je(t).forEach(i=>{Dt(e,i,t[i])}):t(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=_r(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?K.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Dt(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?K.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Ro})).then(e=>e.numFailures?K.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){const i=Array.isArray(t)?t:void 0,s=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:u,keyPath:a}=this.schema.primKey;if(a&&i)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let c=a&&u?e.map(_r(a)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:v,failures:A})=>{if(h===0)return s?f:v;throw new $n(`${this.name}.bulkAdd(): ${h} of ${d} operations failed`,A)})})}bulkPut(e,t,r){const i=Array.isArray(t)?t:void 0,s=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:u,keyPath:a}=this.schema.primKey;if(a&&i)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let c=a&&u?e.map(_r(a)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:v,failures:A})=>{if(h===0)return s?f:v;throw new $n(`${this.name}.bulkPut(): ${h} of ${d} operations failed`,A)})})}bulkDelete(e){const t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new $n(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}}function Wn(n){var e={},t=function(u,a){if(a){for(var d=arguments.length,c=new Array(d-1);--d;)c[d-1]=arguments[d];return e[u].subscribe.apply(null,c),n}if(typeof u=="string")return e[u]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(u,a,d){if(typeof u=="object")return o(u);a||(a=Su),d||(d=ge);var c={subscribers:[],fire:d,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=a(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(a,d)}};return e[u]=t[u]=c,c}function o(u){je(u).forEach(function(a){var d=u[a];if(Ye(d))s(a,u[a][0],u[a][1]);else{if(d!=="asap")throw new W.InvalidArgument("Invalid event config");var c=s(a,Qn,function(){for(var h=arguments.length,f=new Array(h);h--;)f[h]=arguments[h];c.subscribers.forEach(function(v){fo(function(){v.apply(null,f)})})})}})}}function kn(n,e){return Dn(e).from({prototype:n}),e}function Sn(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function li(n,e){n.filter=vn(n.filter,e)}function hi(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>vn(r(),e()):e,n.justLimit=t&&!r}function Fr(n,e){if(n.isPrimKey)return e.primaryKey;const t=e.getIndexByKeyPath(n.index);if(!t)throw new W.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function js(n,e,t){const r=Fr(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function br(n,e,t,r){const i=n.replayFilter?vn(n.filter,n.replayFilter()):n.filter;if(n.or){const s={},o=(u,a,d)=>{if(!i||i(a,d,f=>a.stop(f),f=>a.fail(f))){var c=a.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),_t(s,h)||(s[h]=!0,e(u,a,d))}};return Promise.all([n.or._iterate(o,t),Ps(js(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}return Ps(js(n,r,t),vn(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function Ps(n,e,t,r){var i=Ce(r?(s,o,u)=>t(r(s),o,u):t);return n.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();e&&!e(s,u=>o=u,u=>{s.stop(u),o=ge},u=>{s.fail(u),o=ge})||i(s.value,s,u=>o=u),o()})})}function it(n,e){try{const t=ks(n),r=ks(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return function(i,s){const o=i.length,u=s.length,a=o<u?o:u;for(let d=0;d<a;++d)if(i[d]!==s[d])return i[d]<s[d]?-1:1;return o===u?0:o<u?-1:1}(Ms(n),Ms(e));case"Array":return function(i,s){const o=i.length,u=s.length,a=o<u?o:u;for(let d=0;d<a;++d){const c=it(i[d],s[d]);if(c!==0)return c}return o===u?0:o<u?-1:1}(n,e)}}catch{}return NaN}function ks(n){const e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";const t=Ei(n);return t==="ArrayBuffer"?"binary":t}function Ms(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class ju{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,ke.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,ke.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=vn(t.algorithm,e)}_iterate(e,t){return br(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&st(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>br(t,e,r,t.table.core))}count(e){return this._read(t=>{const r=this._ctx,i=r.table.core;if(Sn(r,!0))return i.count({trans:t,query:{index:Fr(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return br(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){const r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(d,c){return c?o(d[r[c]],c-1):d[i]}var u=this._ctx.dir==="next"?1:-1;function a(d,c){var h=o(d,s),f=o(c,s);return h<f?-u:h>f?u:0}return this.toArray(function(d){return d.sort(a)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&Sn(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=Fr(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return br(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Sn(t)?hi(t,()=>{var r=e;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):hi(t,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),hi(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return li(this._ctx,function(r,i,s){return!e(r.value)||(i(s),t)}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return li(this._ctx,function(i){return e(i.value)}),t=this._ctx,r=e,t.isMatch=vn(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&Sn(t,!0)&&t.limit>0)return this._read(i=>{var s=Fr(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return li(this._ctx,function(i){var s=i.primaryKey.toString(),o=_t(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=je(e),o=s.length;i=function(m){for(var b=!1,E=0;E<o;++E){var _=s[E],C=e[_];Ht(m,_)!==C&&(Dt(m,_,C),b=!0)}return b}}const u=t.table.core,{outbound:a,extractKey:d}=u.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[];let f=0;const v=[],A=(m,b)=>{const{failures:E,numFailures:_}=b;f+=m-_;for(let C of je(E))h.push(E[C])};return this.clone().primaryKeys().then(m=>{const b=E=>{const _=Math.min(c,m.length-E);return u.getMany({trans:r,keys:m.slice(E,E+_),cache:"immutable"}).then(C=>{const T=[],x=[],R=a?[]:null,O=[];for(let M=0;M<_;++M){const Z=C[M],se={value:ar(Z),primKey:m[E+M]};i.call(se,se.value,se)!==!1&&(se.value==null?O.push(m[E+M]):a||it(d(Z),d(se.value))===0?(x.push(se.value),a&&R.push(m[E+M])):(O.push(m[E+M]),T.push(se.value)))}const F=Sn(t)&&t.limit===1/0&&(typeof e!="function"||e===di)&&{index:t.index,range:t.range};return Promise.resolve(T.length>0&&u.mutate({trans:r,type:"add",values:T}).then(M=>{for(let Z in M.failures)O.splice(parseInt(Z),1);A(T.length,M)})).then(()=>(x.length>0||F&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:R,values:x,criteria:F,changeSpec:typeof e!="function"&&e}).then(M=>A(x.length,M))).then(()=>(O.length>0||F&&e===di)&&u.mutate({trans:r,type:"delete",keys:O,criteria:F}).then(M=>A(O.length,M))).then(()=>m.length>E+_&&b(E+c))})};return b(0).then(()=>{if(h.length>0)throw new Lr("Error modifying one or more objects",h,f,v);return m.length})})})}delete(){var e=this._ctx,t=e.range;return Sn(e)&&(e.isPrimKey&&!Fu||t.type===3)?this._write(r=>{const{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:u,lastResult:a,results:d,numFailures:c})=>{if(c)throw new Lr("Could not delete some values",Object.keys(u).map(h=>u[h]),o-c);return o-c}))}):this.modify(di)}}const di=(n,e)=>e.value=null;function Pu(n,e){return n<e?-1:n===e?0:1}function ku(n,e){return n>e?-1:n===e?0:1}function yt(n,e,t){var r=n instanceof Fo?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function Bn(n){return new n.Collection(n,()=>Io("")).limit(0)}function Mu(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),u=-1,a=0;a<o;++a){var d=e[a];if(d!==r[a])return i(n[a],t[a])<0?n.substr(0,a)+t[a]+t.substr(a+1):i(n[a],r[a])<0?n.substr(0,a)+r[a]+t.substr(a+1):u>=0?n.substr(0,u)+e[u]+t.substr(u+1):null;i(n[a],d)<0&&(u=a)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):u<0?null:n.substr(0,u)+r[u]+t.substr(u+1)}function Ar(n,e,t,r){var i,s,o,u,a,d,c,h=t.length;if(!t.every(m=>typeof m=="string"))return yt(n,"String expected.");function f(m){i=function(E){return E==="next"?_=>_.toUpperCase():_=>_.toLowerCase()}(m),s=function(E){return E==="next"?_=>_.toLowerCase():_=>_.toUpperCase()}(m),o=m==="next"?Pu:ku;var b=t.map(function(E){return{lower:s(E),upper:i(E)}}).sort(function(E,_){return o(E.lower,_.lower)});u=b.map(function(E){return E.upper}),a=b.map(function(E){return E.lower}),d=m,c=m==="next"?"":r}f("next");var v=new n.Collection(n,()=>Xt(u[0],a[h-1]+r));v._ondirectionchange=function(m){f(m)};var A=0;return v._addAlgorithm(function(m,b,E){var _=m.key;if(typeof _!="string")return!1;var C=s(_);if(e(C,a,A))return!0;for(var T=null,x=A;x<h;++x){var R=Mu(_,C,u[x],a[x],o,d);R===null&&T===null?A=x+1:(T===null||o(T,R)>0)&&(T=R)}return b(T!==null?function(){m.continue(T+c)}:E),!1}),v}function Xt(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function Io(n){return{type:1,lower:n,upper:n}}class Fo{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&(!r||!i)?Bn(this):new this.Collection(this,()=>Xt(e,t,!r,!i))}catch{return yt(this,Kt)}}equals(e){return e==null?yt(this,Kt):new this.Collection(this,()=>Io(e))}above(e){return e==null?yt(this,Kt):new this.Collection(this,()=>Xt(e,void 0,!0))}aboveOrEqual(e){return e==null?yt(this,Kt):new this.Collection(this,()=>Xt(e,void 0,!1))}below(e){return e==null?yt(this,Kt):new this.Collection(this,()=>Xt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?yt(this,Kt):new this.Collection(this,()=>Xt(void 0,e))}startsWith(e){return typeof e!="string"?yt(this,"String expected."):this.between(e,e+ln,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ar(this,(t,r)=>t.indexOf(r[0])===0,[e],ln)}equalsIgnoreCase(e){return Ar(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=Vt.apply(Cn,arguments);return e.length===0?Bn(this):Ar(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Vt.apply(Cn,arguments);return e.length===0?Bn(this):Ar(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,ln)}anyOf(){const e=Vt.apply(Cn,arguments);let t=this._cmp;try{e.sort(t)}catch{return yt(this,Kt)}if(e.length===0)return Bn(this);const r=new this.Collection(this,()=>Xt(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,u)=>{const a=s.key;for(;t(a,e[i])>0;)if(++i,i===e.length)return o(u),!1;return t(a,e[i])===0||(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[-(1/0),e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Vt.apply(Cn,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return yt(this,Kt)}const t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[-(1/0),i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,u=this._max;if(e.length===0)return Bn(this);if(!e.every(_=>_[0]!==void 0&&_[1]!==void 0&&i(_[0],_[1])<=0))return yt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);const a=!t||t.includeLowers!==!1,d=t&&t.includeUppers===!0;let c,h=i;function f(_,C){return h(_[0],C[0])}try{c=e.reduce(function(_,C){let T=0,x=_.length;for(;T<x;++T){const R=_[T];if(r(C[0],R[1])<0&&r(C[1],R[0])>0){R[0]=o(R[0],C[0]),R[1]=u(R[1],C[1]);break}}return T===x&&_.push(C),_},[]),c.sort(f)}catch{return yt(this,Kt)}let v=0;const A=d?_=>i(_,c[v][1])>0:_=>i(_,c[v][1])>=0,m=a?_=>s(_,c[v][0])>0:_=>s(_,c[v][0])>=0;let b=A;const E=new this.Collection(this,()=>Xt(c[0][0],c[c.length-1][1],!a,!d));return E._ondirectionchange=_=>{_==="next"?(b=A,h=i):(b=m,h=s),c.sort(f)},E._addAlgorithm((_,C,T)=>{for(var x=_.key;b(x);)if(++v,v===c.length)return C(T),!1;return!!function(R){return!A(R)&&!m(R)}(x)||(this._cmp(x,c[v][1])===0||this._cmp(x,c[v][0])===0||C(()=>{h===i?_.continue(c[v][0]):_.continue(c[v][1])}),!1)}),E}startsWithAnyOf(){const e=Vt.apply(Cn,arguments);return e.every(t=>typeof t=="string")?e.length===0?Bn(this):this.inAnyRange(e.map(t=>[t,t+ln])):yt(this,"startsWithAnyOf() only works with strings")}}function It(n){return Ce(function(e){return er(e),n(e.target.error),!1})}function er(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const nn=Wn(null,"storagemutated");class Lu{_lock(){return Kn(!$.global),++this._reculock,this._reculock!==1||$.global||($.lockOwnerFor=this),this}_unlock(){if(Kn(!$.global),--this._reculock==0)for($.global||($.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Pn(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&$.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(Kn(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new W.DatabaseClosed(r);case"MissingAPIError":throw new W.MissingAPI(r.message,r);default:throw new W.OpenFailed(r)}if(!this.active)throw new W.TransactionInactive;return Kn(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ce(i=>{er(i),this._reject(e.error)}),e.onabort=Ce(i=>{er(i),this.active&&this._reject(new W.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=Ce(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&nn.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return ke(new W.ReadOnly("Transaction is readonly"));if(!this.active)return ke(new W.TransactionInactive);if(this._locked())return new K((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},$])});if(r)return en(()=>{var s=new K((o,u)=>{this._lock();const a=t(o,u,this);a&&a.then&&a.then(o,u)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new K((s,o)=>{var u=t(s,o,this);u&&u.then&&u.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=K.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new K((o,u)=>{r.then(a=>t._waitingQueue.push(Ce(o.bind(null,a))),a=>t._waitingQueue.push(Ce(u.bind(null,a)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(_t(t,e))return t[e];const r=this.schema[e];if(!r)throw new W.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}}function Ni(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+No(e)}}function No(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function jo(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:po(t,r=>[r.name,r])}}let tr=n=>{try{return n.only([[]]),tr=()=>[[]],[[]]}catch{return tr=()=>ln,ln}};function ji(n){return n==null?()=>{}:typeof n=="string"?function(e){return e.split(".").length===1?t=>t[e]:t=>Ht(t,e)}(n):e=>Ht(e,n)}function Ls(n){return[].slice.call(n)}let Ku=0;function Yn(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Uu(n,e,t){function r(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:d,upper:c,lowerOpen:h,upperOpen:f}=a;return d===void 0?c===void 0?null:e.upperBound(c,!!f):c===void 0?e.lowerBound(d,!!h):e.bound(d,c,!!h,!!f)}const{schema:i,hasGetAll:s}=function(a,d){const c=Ls(a.objectStoreNames);return{schema:{name:a.name,tables:c.map(h=>d.objectStore(h)).map(h=>{const{keyPath:f,autoIncrement:v}=h,A=Ye(f),m=f==null,b={},E={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:A,keyPath:f,autoIncrement:v,unique:!0,extractKey:ji(f)},indexes:Ls(h.indexNames).map(_=>h.index(_)).map(_=>{const{name:C,unique:T,multiEntry:x,keyPath:R}=_,O={name:C,compound:Ye(R),keyPath:R,unique:T,multiEntry:x,extractKey:ji(R)};return b[Yn(R)]=O,O}),getIndexByKeyPath:_=>b[Yn(_)]};return b[":id"]=E.primaryKey,f!=null&&(b[Yn(f)]=E.primaryKey),E})},hasGetAll:c.length>0&&"getAll"in d.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,t),o=i.tables.map(a=>function(d){const c=d.name;return{name:c,schema:d,mutate:function({trans:h,type:f,keys:v,values:A,range:m}){return new Promise((b,E)=>{b=Ce(b);const _=h.objectStore(c),C=_.keyPath==null,T=f==="put"||f==="add";if(!T&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:x}=v||A||{length:1};if(v&&A&&v.length!==A.length)throw new Error("Given keys array must have same length as given values array.");if(x===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let R;const O=[],F=[];let M=0;const Z=Ae=>{++M,er(Ae)};if(f==="deleteRange"){if(m.type===4)return b({numFailures:M,failures:F,results:[],lastResult:void 0});m.type===3?O.push(R=_.clear()):O.push(R=_.delete(r(m)))}else{const[Ae,Se]=T?C?[A,v]:[A,null]:[v,null];if(T)for(let z=0;z<x;++z)O.push(R=Se&&Se[z]!==void 0?_[f](Ae[z],Se[z]):_[f](Ae[z])),R.onerror=Z;else for(let z=0;z<x;++z)O.push(R=_[f](Ae[z])),R.onerror=Z}const se=Ae=>{const Se=Ae.target.result;O.forEach((z,Ge)=>z.error!=null&&(F[Ge]=z.error)),b({numFailures:M,failures:F,results:f==="delete"?v:O.map(z=>z.result),lastResult:Se})};R.onerror=Ae=>{Z(Ae),se(Ae)},R.onsuccess=se})},getMany:({trans:h,keys:f})=>new Promise((v,A)=>{v=Ce(v);const m=h.objectStore(c),b=f.length,E=new Array(b);let _,C=0,T=0;const x=O=>{const F=O.target;E[F._pos]=F.result,++T===C&&v(E)},R=It(A);for(let O=0;O<b;++O)f[O]!=null&&(_=m.get(f[O]),_._pos=O,_.onsuccess=x,_.onerror=R,++C);C===0&&v(E)}),get:({trans:h,key:f})=>new Promise((v,A)=>{v=Ce(v);const m=h.objectStore(c).get(f);m.onsuccess=b=>v(b.target.result),m.onerror=It(A)}),query:function(h){return f=>new Promise((v,A)=>{v=Ce(v);const{trans:m,values:b,limit:E,query:_}=f,C=E===1/0?void 0:E,{index:T,range:x}=_,R=m.objectStore(c),O=T.isPrimaryKey?R:R.index(T.name),F=r(x);if(E===0)return v({result:[]});if(h){const M=b?O.getAll(F,C):O.getAllKeys(F,C);M.onsuccess=Z=>v({result:Z.target.result}),M.onerror=It(A)}else{let M=0;const Z=b||!("openKeyCursor"in O)?O.openCursor(F):O.openKeyCursor(F),se=[];Z.onsuccess=Ae=>{const Se=Z.result;return Se?(se.push(b?Se.value:Se.primaryKey),++M===E?v({result:se}):void Se.continue()):v({result:se})},Z.onerror=It(A)}})}(s),openCursor:function({trans:h,values:f,query:v,reverse:A,unique:m}){return new Promise((b,E)=>{b=Ce(b);const{index:_,range:C}=v,T=h.objectStore(c),x=_.isPrimaryKey?T:T.index(_.name),R=A?m?"prevunique":"prev":m?"nextunique":"next",O=f||!("openKeyCursor"in x)?x.openCursor(r(C),R):x.openKeyCursor(r(C),R);O.onerror=It(E),O.onsuccess=Ce(F=>{const M=O.result;if(!M)return void b(null);M.___id=++Ku,M.done=!1;const Z=M.continue.bind(M);let se=M.continuePrimaryKey;se&&(se=se.bind(M));const Ae=M.advance.bind(M),Se=()=>{throw new Error("Cursor not stopped")};M.trans=h,M.stop=M.continue=M.continuePrimaryKey=M.advance=()=>{throw new Error("Cursor not started")},M.fail=Ce(E),M.next=function(){let z=1;return this.start(()=>z--?this.continue():this.stop()).then(()=>this)},M.start=z=>{const Ge=new Promise((Te,qe)=>{Te=Ce(Te),O.onerror=It(qe),M.fail=qe,M.stop=ot=>{M.stop=M.continue=M.continuePrimaryKey=M.advance=Se,Te(ot)}}),$e=()=>{if(O.result)try{z()}catch(Te){M.fail(Te)}else M.done=!0,M.start=()=>{throw new Error("Cursor behind last entry")},M.stop()};return O.onsuccess=Ce(Te=>{O.onsuccess=$e,$e()}),M.continue=Z,M.continuePrimaryKey=se,M.advance=Ae,$e(),Ge},b(M)},E)})},count({query:h,trans:f}){const{index:v,range:A}=h;return new Promise((m,b)=>{const E=f.objectStore(c),_=v.isPrimaryKey?E:E.index(v.name),C=r(A),T=C?_.count(C):_.count();T.onsuccess=Ce(x=>m(x.target.result)),T.onerror=It(b)})}}}(a)),u={};return o.forEach(a=>u[a.name]=a),{stack:"dbcore",transaction:n.transaction.bind(n),table(a){if(!u[a])throw new Error(`Table '${a}' not found`);return u[a]},MIN_KEY:-1/0,MAX_KEY:tr(e),schema:i}}function Pi({_novip:n},e){const t=e.db,r=function(i,s,{IDBKeyRange:o,indexedDB:u},a){return{dbcore:function(c,h){return h.reduce((f,{create:v})=>({...f,...v(f)}),c)}(Uu(s,o,a),i.dbcore)}}(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{const s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function $r({_novip:n},e,t,r){t.forEach(i=>{const s=r[i];e.forEach(o=>{const u=rs(o,i);(!u||"value"in u&&u.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?qt(o,i,{get(){return this.table(i)},set(a){lo(this,i,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function ki({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function Vu(n,e){return n._cfg.version-e._cfg.version}function Gu(n,e,t,r){const i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);const o=s._reject.bind(s),u=$.transless||$;en(()=>{$.trans=s,$.transless=u,e===0?(je(i).forEach(a=>{fi(t,a,i[a].primKey,i[a].indexes)}),Pi(n,t),K.follow(()=>n.on.populate.fire(s)).catch(o)):function({_novip:a},d,c,h){const f=[],v=a._versions;let A=a._dbSchema=Li(a,a.idbdb,h),m=!1;function b(){return f.length?K.resolve(f.shift()(c.idbtrans)).then(b):K.resolve()}return v.filter(E=>E._cfg.version>=d).forEach(E=>{f.push(()=>{const _=A,C=E._cfg.dbschema;Ki(a,_,h),Ki(a,C,h),A=a._dbSchema=C;const T=Po(_,C);T.add.forEach(R=>{fi(h,R[0],R[1].primKey,R[1].indexes)}),T.change.forEach(R=>{if(R.recreate)throw new W.Upgrade("Not yet support for changing primary key");{const O=h.objectStore(R.name);R.add.forEach(F=>Mi(O,F)),R.change.forEach(F=>{O.deleteIndex(F.name),Mi(O,F)}),R.del.forEach(F=>O.deleteIndex(F))}});const x=E._cfg.contentUpgrade;if(x&&E._cfg.version>d){Pi(a,h),c._memoizedTables={},m=!0;let R=yo(C);T.del.forEach(Z=>{R[Z]=_[Z]}),ki(a,[a.Transaction.prototype]),$r(a,[a.Transaction.prototype],je(R),R),c.schema=R;const O=is(x);let F;O&&jn();const M=K.follow(()=>{if(F=x(c),F&&O){var Z=Wt.bind(null,null);F.then(Z,Z)}});return F&&typeof F.then=="function"?K.resolve(F):M.then(()=>F)}}),f.push(_=>{(!m||!Iu)&&function(C,T){[].slice.call(T.db.objectStoreNames).forEach(x=>C[x]==null&&T.db.deleteObjectStore(x))}(E._cfg.dbschema,_),ki(a,[a.Transaction.prototype]),$r(a,[a.Transaction.prototype],a._storeNames,a._dbSchema),c.schema=a._dbSchema})}),b().then(()=>{var E,_;_=h,je(E=A).forEach(C=>{_.db.objectStoreNames.contains(C)||fi(_,C,E[C].primKey,E[C].indexes)})})}(n,e,s,t).catch(o)})}function Po(n,e){const t={del:[],add:[],change:[]};let r;for(r in n)e[r]||t.del.push(r);for(r in e){const i=n[r],s=e[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Zr)o.recreate=!0,t.change.push(o);else{const u=i.idxByName,a=s.idxByName;let d;for(d in u)a[d]||o.del.push(d);for(d in a){const c=u[d],h=a[d];c?c.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}else t.add.push([r,s])}return t}function fi(n,e,t,r){const i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Mi(i,s)),i}function Mi(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Li(n,e,t){const r={};return Mr(e.objectStoreNames,0).forEach(i=>{const s=t.objectStore(i);let o=s.keyPath;const u=Ni(No(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),a=[];for(let c=0;c<s.indexNames.length;++c){const h=s.index(s.indexNames[c]);o=h.keyPath;var d=Ni(h.name,o,!!h.unique,!!h.multiEntry,!1,o&&typeof o!="string",!1);a.push(d)}r[i]=jo(i,u,a)}),r}function Ki({_novip:n},e,t){const r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let u=0;u<o.indexNames.length;++u){const a=o.indexNames[u],d=o.index(a).keyPath,c=typeof d=="string"?d:"["+Mr(d).join("+")+"]";if(e[s]){const h=e[s].idxByName[c];h&&(h.name=a,delete e[s].idxByName[c],e[s].idxByName[a]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Oe.WorkerGlobalScope&&Oe instanceof Oe.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class $u{_parseStoresSpec(e,t){je(e).forEach(r=>{if(e[r]!==null){var i=e[r].split(",").map((o,u)=>{const a=(o=o.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Ni(a,d||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),Ye(d),u===0)}),s=i.shift();if(s.multi)throw new W.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),t[r]=jo(r,s,i)}})}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?st(this._cfg.storesSource,e):e;const r=t._versions,i={};let s={};return r.forEach(o=>{st(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,ki(t,[t._allTables,t,t.Transaction.prototype]),$r(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],je(s),s),t._storeNames=je(s),this}upgrade(e){return this._cfg.contentUpgrade=as(this._cfg.contentUpgrade||ge,e),this}}function hs(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new pn("__dbnames",{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function ds(n){return n&&typeof n.databases=="function"}function Ui(n){return en(function(){return $.letThrough=!0,n()})}function qu(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var t=function(){return indexedDB.databases().finally(e)};n=setInterval(t,100),t()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function Hu(n){const e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?ke(e.dbOpenError):n);Pt&&(e.openCanceller._stackHolder=_n()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new W.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,u=!1;return K.race([r,(typeof navigator>"u"?K.resolve():qu()).then(()=>new K((a,d)=>{if(i(),!t)throw new W.MissingAPI;const c=n.name,h=e.autoSchema?t.open(c):t.open(c,Math.round(10*n.verno));if(!h)throw new W.MissingAPI;h.onerror=It(d),h.onblocked=Ce(n._fireOnBlocked),h.onupgradeneeded=Ce(f=>{if(o=h.transaction,e.autoSchema&&!n._options.allowEmptyDB){h.onerror=er,o.abort(),h.result.close();const A=t.deleteDatabase(c);A.onsuccess=A.onerror=Ce(()=>{d(new W.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=It(d);var v=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;u=v<1,n._novip.idbdb=h.result,Gu(n,v/10,o,d)}},d),h.onsuccess=Ce(()=>{o=null;const f=n._novip.idbdb=h.result,v=Mr(f.objectStoreNames);if(v.length>0)try{const m=f.transaction((A=v).length===1?A[0]:A,"readonly");e.autoSchema?function({_novip:b},E,_){b.verno=E.version/10;const C=b._dbSchema=Li(0,E,_);b._storeNames=Mr(E.objectStoreNames,0),$r(b,[b._allTables],je(C),C)}(n,f,m):(Ki(n,n._dbSchema,m),function(b,E){const _=Po(Li(0,b.idbdb,E),b._dbSchema);return!(_.add.length||_.change.some(C=>C.add.length||C.change.length))}(n,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Pi(n,m)}catch{}var A;Hn.push(n),f.onversionchange=Ce(m=>{e.vcFired=!0,n.on("versionchange").fire(m)}),f.onclose=Ce(m=>{n.on("close").fire(m)}),u&&function({indexedDB:m,IDBKeyRange:b},E){!ds(m)&&E!=="__dbnames"&&hs(m,b).put({name:E}).catch(ge)}(n._deps,c),a()},d)}))]).then(()=>(i(),e.onReadyBeingFired=[],K.resolve(Ui(()=>n.on.ready.fire(n.vip))).then(function a(){if(e.onReadyBeingFired.length>0){let d=e.onReadyBeingFired.reduce(as,ge);return e.onReadyBeingFired=[],K.resolve(Ui(()=>d(n.vip))).then(a)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(a=>{e.dbOpenError=a;try{o&&o.abort()}catch{}return r===e.openCanceller&&n._close(),ke(a)}).finally(()=>{e.openComplete=!0,s()})}function Vi(n){var e=s=>n.next(s),t=i(e),r=i(s=>n.throw(s));function i(s){return o=>{var u=s(o),a=u.value;return u.done?a:a&&typeof a.then=="function"?a.then(t,r):Ye(a)?Promise.all(a).then(t,r):t(a)}}return i(e)()}function Wu(n,e,t){var r=arguments.length;if(r<2)throw new W.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=mo(i);return[n,s,t]}function ko(n,e,t,r,i){return K.resolve().then(()=>{const s=$.transless||$,o=n._createTransaction(e,t,n._dbSchema,r),u={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(h){return h.name===os.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>ko(n,e,t,null,i))):ke(h)}const a=is(i);let d;a&&jn();const c=K.follow(()=>{if(d=i.call(o,o),d)if(a){var h=Wt.bind(null,null);d.then(h,h)}else typeof d.next=="function"&&typeof d.throw=="function"&&(d=Vi(d))},u);return(d&&typeof d.then=="function"?K.resolve(d).then(h=>o.active?h:ke(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>d)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),ke(h)))})}function Er(n,e,t){const r=Ye(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}const Yu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(e){const t=n.table(e),{schema:r}=t,i={},s=[];function o(c,h,f){const v=Yn(c),A=i[v]=i[v]||[],m=c==null?0:typeof c=="string"?1:c.length,b=h>0,E={...f,isVirtual:b,keyTail:h,keyLength:m,extractKey:ji(c),unique:!b&&f.unique};return A.push(E),E.isPrimaryKey||s.push(E),m>1&&o(m===2?c[0]:c.slice(0,m-1),h+1,f),A.sort((_,C)=>_.keyTail-C.keyTail),E}const u=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[u];for(const c of r.indexes)o(c.keyPath,0,c);function a(c){const h=c.query.index;return h.isVirtual?{...c,query:{index:h,range:(f=c.query.range,v=h.keyTail,{type:f.type===1?2:f.type,lower:Er(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,v),lowerOpen:!0,upper:Er(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,v),upperOpen:!0})}}:c;var f,v}return{...t,schema:{...r,primaryKey:u,indexes:s,getIndexByKeyPath:function(c){const h=i[Yn(c)];return h&&h[0]}},count:c=>t.count(a(c)),query:c=>t.query(a(c)),openCursor(c){const{keyTail:h,isVirtual:f,keyLength:v}=c.query.index;return f?t.openCursor(a(c)).then(A=>A&&function(m){return Object.create(m,{continue:{value:function(E){E!=null?m.continue(Er(E,c.reverse?n.MAX_KEY:n.MIN_KEY,h)):c.unique?m.continue(m.key.slice(0,v).concat(c.reverse?n.MIN_KEY:n.MAX_KEY,h)):m.continue()}},continuePrimaryKey:{value(E,_){m.continuePrimaryKey(Er(E,n.MAX_KEY,h),_)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const E=m.key;return v===1?E[0]:E.slice(0,v)}},value:{get:()=>m.value}})}(A)):t.openCursor(c)}}}}}};function fs(n,e,t,r){return t=t||{},r=r||"",je(n).forEach(i=>{if(_t(e,i)){var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const u=Ei(s);u!==Ei(o)?t[r+i]=e[i]:u==="Object"?fs(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}else t[r+i]=void 0}),je(e).forEach(i=>{_t(n,i)||(t[r+i]=e[i])}),t}const zu={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){const t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){const o=$.trans,{deleting:u,creating:a,updating:d}=o.table(e).hook;switch(s.type){case"add":if(a.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(a.fire===ge&&d.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(u.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(u.fire===ge)break;return o._promise("readwrite",()=>function(f){return h(f.trans,f.range,1e4)}(s),!0)}return t.mutate(s);function c(f){const v=$.trans,A=f.keys||function(m,b){return b.type==="delete"?b.keys:b.keys||b.values.map(m.extractKey)}(r,f);if(!A)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:A}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(m,b,E){return b.type==="add"?Promise.resolve([]):m.getMany({trans:b.trans,keys:E,cache:"immutable"})}(t,f,A).then(m=>{const b=A.map((E,_)=>{const C=m[_],T={onerror:null,onsuccess:null};if(f.type==="delete")u.fire.call(T,E,C,v);else if(f.type==="add"||C===void 0){const x=a.fire.call(T,E,f.values[_],v);E==null&&x!=null&&(E=x,f.keys[_]=E,r.outbound||Dt(f.values[_],r.keyPath,E))}else{const x=fs(C,f.values[_]),R=d.fire.call(T,x,E,C,v);if(R){const O=f.values[_];Object.keys(R).forEach(F=>{_t(O,F)?O[F]=R[F]:Dt(O,F,R[F])})}}return T});return t.mutate(f).then(({failures:E,results:_,numFailures:C,lastResult:T})=>{for(let x=0;x<A.length;++x){const R=_?_[x]:A[x],O=b[x];R==null?O.onerror&&O.onerror(E[x]):O.onsuccess&&O.onsuccess(f.type==="put"&&m[x]?f.values[x]:R)}return{failures:E,results:_,numFailures:C,lastResult:T}}).catch(E=>(b.forEach(_=>_.onerror&&_.onerror(E)),Promise.reject(E)))})}function h(f,v,A){return t.query({trans:f,values:!1,query:{index:r,range:v},limit:A}).then(({result:m})=>c({type:"delete",keys:m,trans:f}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):m.length<A?{failures:[],numFailures:0,lastResult:void 0}:h(f,{...v,lower:m[m.length-1],lowerOpen:!0},A)))}}}}})};function Mo(n,e,t){try{if(!e||e.keys.length<n.length)return null;const r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)it(e.keys[i],n[s])===0&&(r.push(t?ar(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch{return null}}const Xu={stack:"dbcore",level:-1,create:n=>({table:e=>{const t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);const i=Mo(r.keys,r.trans._cache,r.cache==="clone");return i?K.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?ar(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function ps(n){return!("from"in n)}const Ut=function(n,e){if(!this){const t=new Ut;return n&&"d"in n&&st(t,n),t}st(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0})};function nr(n,e,t){const r=it(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(ps(n))return st(n,{from:e,to:t,d:1});const i=n.l,s=n.r;if(it(t,n.from)<0)return i?nr(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},Ks(n);if(it(e,n.to)>0)return s?nr(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},Ks(n);it(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),it(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);const o=!n.r;i&&!n.l&&qr(n,i),s&&o&&qr(n,s)}function qr(n,e){ps(e)||function t(r,{from:i,to:s,l:o,r:u}){nr(r,i,s),o&&t(r,o),u&&t(r,u)}(n,e)}function Ju(n,e){const t=Gi(e);let r=t.next();if(r.done)return!1;let i=r.value;const s=Gi(n);let o=s.next(i.from),u=o.value;for(;!r.done&&!o.done;){if(it(u.from,i.to)<=0&&it(u.to,i.from)>=0)return!0;it(i.from,u.from)<0?i=(r=t.next(u.from)).value:u=(o=s.next(i.from)).value}return!1}function Gi(n){let e=ps(n)?null:{s:0,n};return{next(t){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&it(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||it(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Ks(n){var e,t;const r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...n},u=n[i];n.from=u.from,n.to=u.to,n[i]=u[i],o[i]=u[s],n[s]=o,o.d=Us(o)}n.d=Us(n)}function Us({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}Nn(Ut.prototype,{add(n){return qr(this,n),this},addKey(n){return nr(this,n,n),this},addKeys(n){return n.forEach(e=>nr(this,e,e)),this},[wi](){return Gi(this)}});const Qu={stack:"dbcore",level:0,create:n=>{const e=n.schema.name,t=new Ut(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{const i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:u,outbound:a}=o,d={...i,mutate:f=>{const v=f.trans,A=v.mutatedParts||(v.mutatedParts={}),m=R=>{const O=`idb://${e}/${r}/${R}`;return A[O]||(A[O]=new Ut)},b=m(""),E=m(":dels"),{type:_}=f;let[C,T]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const x=f.trans._cache;return i.mutate(f).then(R=>{if(Ye(C)){_!=="delete"&&(C=R.results),b.addKeys(C);const O=Mo(C,x);O||_==="add"||E.addKeys(C),(O||T)&&function(F,M,Z,se){function Ae(Se){const z=F(Se.name||"");function Ge(Te){return Te!=null?Se.extractKey(Te):null}const $e=Te=>Se.multiEntry&&Ye(Te)?Te.forEach(qe=>z.addKey(qe)):z.addKey(Te);(Z||se).forEach((Te,qe)=>{const ot=Z&&Ge(Z[qe]),Mt=se&&Ge(se[qe]);it(ot,Mt)!==0&&(ot!=null&&$e(ot),Mt!=null&&$e(Mt))})}M.indexes.forEach(Ae)}(m,s,O,T)}else if(C){const O={from:C.lower,to:C.upper};E.add(O),b.add(O)}else b.add(t),E.add(t),s.indexes.forEach(O=>m(O.name).add(t));return R})}},c=({query:{index:f,range:v}})=>{var A,m;return[f,new Ut((A=v.lower)!==null&&A!==void 0?A:n.MIN_KEY,(m=v.upper)!==null&&m!==void 0?m:n.MAX_KEY)]},h={get:f=>[o,new Ut(f.key)],getMany:f=>[o,new Ut().addKeys(f.keys)],count:c,query:c,openCursor:c};return je(h).forEach(f=>{d[f]=function(v){const{subscr:A}=$;if(A){const m=T=>{const x=`idb://${e}/${r}/${T}`;return A[x]||(A[x]=new Ut)},b=m(""),E=m(":dels"),[_,C]=h[f](v);if(m(_.name||"").add(C),!_.isPrimaryKey){if(f!=="count"){const T=f==="query"&&a&&v.values&&i.query({...v,values:!1});return i[f].apply(this,arguments).then(x=>{if(f==="query"){if(a&&v.values)return T.then(({result:O})=>(b.addKeys(O),x));const R=v.values?x.result.map(u):x.result;v.values?b.addKeys(R):E.addKeys(R)}else if(f==="openCursor"){const R=x,O=v.values;return R&&Object.create(R,{key:{get:()=>(E.addKey(R.primaryKey),R.key)},primaryKey:{get(){const F=R.primaryKey;return E.addKey(F),F}},value:{get:()=>(O&&b.addKey(R.primaryKey),R.value)}})}return x})}E.add(t)}}return i[f].apply(this,arguments)}}),d}}}};class pn{constructor(e,t){this._middlewares={},this.verno=0;const r=pn.dependencies;this._options=t={addons:pn.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ge,dbReadyPromise:null,cancelOpen:ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new K(u=>{s.dbReadyResolve=u}),s.openCanceller=new K((u,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Wn(this,"populate","blocked","versionchange","close",{ready:[as,ge]}),this.on.ready.subscribe=ho(this.on.ready.subscribe,u=>(a,d)=>{pn.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||K.resolve().then(a),d&&u(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),d&&u(a);else{u(a);const h=this;d||u(function f(){h.on.ready.unsubscribe(a),h.on.ready.unsubscribe(f)})}})}),this.Collection=(o=this,kn(ju.prototype,function(u,a){this.db=o;let d=Ro,c=null;if(a)try{d=a()}catch(A){c=A}const h=u._ctx,f=h.table,v=f.hook.reading.fire;this._ctx={table:f,index:h.index,isPrimKey:!h.index||f.schema.primKey.keyPath&&h.index===f.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:h.or,valueMapper:v!==Qn?v:null}})),this.Table=function(u){return kn(Nu.prototype,function(a,d,c){this.db=u,this._tx=c,this.name=a,this.schema=d,this.hook=u._allTables[a]?u._allTables[a].hook:Wn(null,{creating:[Eu,ge],reading:[Au,Qn],updating:[Ou,ge],deleting:[wu,ge]})})}(this),this.Transaction=function(u){return kn(Lu.prototype,function(a,d,c,h,f){this.db=u,this.mode=a,this.storeNames=d,this.schema=c,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Wn(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new K((v,A)=>{this._resolve=v,this._reject=A}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},v=>{var A=this.active;return this.active=!1,this.on.error.fire(v),this.parent?this.parent._reject(v):A&&this.idbtrans&&this.idbtrans.abort(),ke(v)})})}(this),this.Version=function(u){return kn($u.prototype,function(a){this.db=u,this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(u){return kn(Fo.prototype,function(a,d,c){this.db=u,this._ctx={table:a,index:d===":id"?null:d,or:c};const h=u._deps.indexedDB;if(!h)throw new W.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(f,v)=>h.cmp(v,f),this._max=(f,v)=>h.cmp(f,v)>0?f:v,this._min=(f,v)=>h.cmp(f,v)<0?f:v,this._IDBKeyRange=u._deps.IDBKeyRange})}(this),this.on("versionchange",u=>{u.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",u=>{!u.newVersion||u.newVersion<u.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${u.oldVersion/10}`)}),this._maxKey=tr(t.IDBKeyRange),this._createTransaction=(u,a,d,c)=>new this.Transaction(u,a,d,this._options.chromeTransactionDurability,c),this._fireOnBlocked=u=>{this.on("blocked").fire(u),Hn.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(u))},this.use(Yu),this.use(zu),this.use(Qu),this.use(Xu),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(u=>u(this))}version(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(Vu),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||$.letThrough||this._vip)?e():new K((t,r)=>{if(this._state.openComplete)return r(new W.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new W.DatabaseClosed);this.open().catch(ge)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r??10,name:i}),s.sort((o,u)=>o.level-u.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:!!t&&i.name!==t)),this}open(){return Hu(this)}_close(){const e=this._state,t=Hn.indexOf(this);if(t>=0&&Hn.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new K(r=>{e.dbReadyResolve=r}),e.openCanceller=new K((r,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new W.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new K((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Ce(()=>{(function({indexedDB:u,IDBKeyRange:a},d){!ds(u)&&d!=="__dbnames"&&hs(u,a).delete(d).catch(ge)})(this._deps,this.name),r()}),o.onerror=It(i),o.onblocked=this._fireOnBlocked};if(e)throw new W.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return je(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Wu.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=$.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const s=e.indexOf("?")!==-1;let o,u;e=e.replace("!","").replace("?","");try{if(u=t.map(d=>{var c=d instanceof this.Table?d.name:d;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e==="readonly")o="readonly";else{if(e!="rw"&&e!="readwrite")throw new W.InvalidArgument("Invalid transaction mode: "+e);o="readwrite"}if(i){if(i.mode==="readonly"&&o==="readwrite"){if(!s)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&u.forEach(d=>{if(i&&i.storeNames.indexOf(d)===-1){if(!s)throw new W.SubTransaction("Table "+d+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(d){return i?i._promise(null,(c,h)=>{h(d)}):ke(d)}const a=ko.bind(null,this,o,u,i,r);return i?i._promise(o,a,"lock"):$.trans?Pn($.transless,()=>this._whenReady(a)):this._whenReady(a)}table(e){if(!_t(this._allTables,e))throw new W.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Zu=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ec{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})}[Zu](){return this}}function Lo(n,e){return je(e).forEach(t=>{qr(n[t]||(n[t]=new Ut),e[t])}),n}function tc(n){return new ec(e=>{const t=is(n);let r=!1,i={},s={};const o={get closed(){return r},unsubscribe:()=>{r=!0,nn.storagemutated.unsubscribe(c)}};e.start&&e.start(o);let u=!1,a=!1;function d(){return je(s).some(f=>i[f]&&Ju(i[f],s[f]))}const c=f=>{Lo(i,f),d()&&h()},h=()=>{if(u||r)return;i={};const f={},v=function(A){t&&jn();const m=()=>en(n,{subscr:A,trans:null}),b=$.trans?Pn($.transless,m):m();return t&&b.then(Wt,Wt),b}(f);a||(nn("storagemutated",c),a=!0),u=!0,Promise.resolve(v).then(A=>{u=!1,r||(d()?h():(i={},s=f,e.next&&e.next(A)))},A=>{u=!1,e.error&&e.error(A),o.unsubscribe()})};return h(),o})}let $i;try{$i={indexedDB:Oe.indexedDB||Oe.mozIndexedDB||Oe.webkitIndexedDB||Oe.msIndexedDB,IDBKeyRange:Oe.IDBKeyRange||Oe.webkitIDBKeyRange}}catch{$i={indexedDB:null,IDBKeyRange:null}}const on=pn;function Nr(n){let e=$t;try{$t=!0,nn.storagemutated.fire(n)}finally{$t=e}}Nn(on,{...Tr,delete:n=>new on(n,{addons:[]}).delete(),exists:n=>new on(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:e,IDBKeyRange:t}){return ds(e)?Promise.resolve(e.databases()).then(r=>r.map(i=>i.name).filter(i=>i!=="__dbnames")):hs(e,t).toCollection().primaryKeys()}(on.dependencies).then(n)}catch{return ke(new W.MissingAPI)}},defineClass:()=>function(n){st(this,n)},ignoreTransaction:n=>$.trans?Pn($.transless,n):n(),vip:Ui,async:function(n){return function(){try{var e=Vi(n.apply(this,arguments));return e&&typeof e.then=="function"?e:K.resolve(e)}catch(t){return ke(t)}}},spawn:function(n,e,t){try{var r=Vi(n.apply(t,e||[]));return r&&typeof r.then=="function"?r:K.resolve(r)}catch(i){return ke(i)}},currentTransaction:{get:()=>$.trans||null},waitFor:function(n,e){const t=K.resolve(typeof n=="function"?on.ignoreTransaction(n):n).timeout(e||6e4);return $.trans?$.trans.waitFor(t):t},Promise:K,debug:{get:()=>Pt,set:n=>{go(n,n==="dexie"?()=>!0:xo)}},derive:Dn,extend:st,props:Nn,override:ho,Events:Wn,on:nn,liveQuery:tc,extendObservabilitySet:Lo,getByKeyPath:Ht,setByKeyPath:Dt,delByKeyPath:function(n,e){typeof e=="string"?Dt(n,e,void 0):"length"in e&&[].map.call(e,function(t){Dt(n,t,void 0)})},shallowClone:yo,deepClone:ar,getObjectDiff:fs,cmp:it,asap:fo,minKey:-(1/0),addons:[],connections:Hn,errnames:os,dependencies:$i,semVer:"3.2.3",version:"3.2.3".split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,2*t))}),on.maxKey=tr(on.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(nn("storagemutated",n=>{if(!$t){let e;Zr?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,n)):e=new CustomEvent("x-storagemutated-1",{detail:n}),$t=!0,dispatchEvent(e),$t=!1}}),addEventListener("x-storagemutated-1",({detail:n})=>{$t||Nr(n)}));let $t=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel("x-storagemutated-1");typeof n.unref=="function"&&n.unref(),nn("storagemutated",e=>{$t||n.postMessage(e)}),n.onmessage=e=>{e.data&&Nr(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){nn("storagemutated",e=>{try{$t||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:"x-storagemutated-1",changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key==="x-storagemutated-1"){const t=JSON.parse(e.newValue);t&&Nr(t.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:e}){e&&e.type==="x-storagemutated-1"&&Nr(e.changedParts)})}K.rejectionMapper=function(n,e){if(!n||n instanceof xn||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Is[n.name])return n;var t=new Is[n.name](e||n.message,n);return"stack"in n&&qt(t,"stack",{get:function(){return this.inner.stack}}),t},go(Pt,xo);const kt={AbortError:"A request was aborted, for example through a call to IDBTransaction.abort.",ConstraintError:"A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.",DataCloneError:"The data being stored could not be cloned by the internal structured cloning algorithm.",DataError:"Data provided to an operation does not meet requirements.",InvalidAccessError:"An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.",InvalidStateError:"An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.",NotFoundError:"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",ReadOnlyError:'The mutating operation was attempted in a "readonly" transaction.',TransactionInactiveError:"A request was placed against a transaction which is currently not active, or which is finished.",VersionError:"An attempt was made to open a database using a lower version than the existing version."};class qi extends Error{constructor(e=kt.AbortError){super(),this.name="AbortError",this.message=e}}class rn extends Error{constructor(e=kt.ConstraintError){super(),this.name="ConstraintError",this.message=e}}class nc extends Error{constructor(e=kt.DataCloneError){super(),this.name="DataCloneError",this.message=e}}class Le extends Error{constructor(e=kt.DataError){super(),this.name="DataError",this.message=e}}class Hr extends Error{constructor(e=kt.InvalidAccessError){super(),this.name="InvalidAccessError",this.message=e}}class re extends Error{constructor(e=kt.InvalidStateError){super(),this.name="InvalidStateError",this.message=e}}class rr extends Error{constructor(e=kt.NotFoundError){super(),this.name="NotFoundError",this.message=e}}class ir extends Error{constructor(e=kt.ReadOnlyError){super(),this.name="ReadOnlyError",this.message=e}}class Ft extends Error{constructor(e=kt.TransactionInactiveError){super(),this.name="TransactionInactiveError",this.message=e}}class rc extends Error{constructor(e=kt.VersionError){super(),this.name="VersionError",this.message=e}}const ye=(n,e)=>{if(typeof n=="number"){if(isNaN(n))throw new Le;return n}else if(n instanceof Date){const t=n.valueOf();if(isNaN(t))throw new Le;return new Date(t)}else{if(typeof n=="string")return n;if(n instanceof ArrayBuffer||typeof ArrayBuffer<"u"&&ArrayBuffer.isView&&ArrayBuffer.isView(n))return n instanceof ArrayBuffer?new Uint8Array(n).buffer:new Uint8Array(n.buffer).buffer;if(Array.isArray(n)){if(e===void 0)e=new Set;else if(e.has(n))throw new Le;e.add(n);const t=[];for(let r=0;r<n.length;r++){if(!n.hasOwnProperty(r))throw new Le;const s=n[r],o=ye(s,e);t.push(o)}return t}else throw new Le}},Vs=n=>{if(typeof n=="number")return"Number";if(n instanceof Date)return"Date";if(Array.isArray(n))return"Array";if(typeof n=="string")return"String";if(n instanceof ArrayBuffer)return"Binary";throw new Le},ue=(n,e)=>{if(e===void 0)throw new TypeError;n=ye(n),e=ye(e);const t=Vs(n),r=Vs(e);if(t!==r)return t==="Array"||t==="Binary"&&(r==="String"||r==="Date"||r==="Number")||t==="String"&&(r==="Date"||r==="Number")||t==="Date"&&r==="Number"?1:-1;if(t==="Binary"&&(n=new Uint8Array(n),e=new Uint8Array(e)),t==="Array"||t==="Binary"){const i=Math.min(n.length,e.length);for(let s=0;s<i;s++){const o=ue(n[s],e[s]);if(o!==0)return o}return n.length>e.length?1:n.length<e.length?-1:0}if(t==="Date"){if(n.getTime()===e.getTime())return 0}else if(n===e)return 0;return n>e?1:-1};class ie{static only(e){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(e,e,!1,!1)}static lowerBound(e,t=!1){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(e,void 0,t,!0)}static upperBound(e,t=!1){if(arguments.length===0)throw new TypeError;return e=ye(e),new ie(void 0,e,!0,t)}static bound(e,t,r=!1,i=!1){if(arguments.length<2)throw new TypeError;const s=ue(e,t);if(s===1||s===0&&(r||i))throw new Le;return e=ye(e),t=ye(t),new ie(e,t,r,i)}constructor(e,t,r,i){this.lower=e,this.upper=t,this.lowerOpen=r,this.upperOpen=i}includes(e){if(arguments.length===0)throw new TypeError;if(e=ye(e),this.lower!==void 0){const t=ue(this.lower,e);if(t===1||t===0&&this.lowerOpen)return!1}if(this.upper!==void 0){const t=ue(this.upper,e);if(t===-1||t===0&&this.upperOpen)return!1}return!0}toString(){return"[object IDBKeyRange]"}}const lr=(n,e)=>{if(Array.isArray(n)){const i=[];for(let s of n)s!=null&&typeof s!="string"&&s.toString&&(s=s.toString()),i.push(ye(lr(s,e)));return i}if(n==="")return e;let t=n,r=e;for(;t!==null;){let i;const s=t.indexOf(".");if(s>=0?(i=t.slice(0,s),t=t.slice(s+1)):(i=t,t=null),r==null||!r.hasOwnProperty(i))return;r=r[i]}return r};function wr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ko={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(r,i,s){function o(d,c){if(!i[d]){if(!r[d]){var h=typeof wr=="function"&&wr;if(!c&&h)return h(d,!0);if(u)return u(d,!0);var f=new Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f}var v=i[d]={exports:{}};r[d][0].call(v.exports,function(A){var m=r[d][1][A];return o(m||A)},v,v.exports,t,r,i,s)}return i[d].exports}for(var u=typeof wr=="function"&&wr,a=0;a<s.length;a++)o(s[a]);return o}return t}()({1:[function(t,r,i){var s=t("domexception"),o=t("typeson"),u=t("typeson-registry/dist/presets/structured-cloning-throwing"),a=typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:typeof ni<"u"?ni:Function("return this;")();a.DOMException||(a.DOMException=s);var d=new o().register(u);function c(h){return d.revive(d.encapsulate(h))}r.exports=c},{domexception:5,typeson:8,"typeson-registry/dist/presets/structured-cloning-throwing":7}],2:[function(t,r,i){var s=function(){function c(h,f){var v=[],A=!0,m=!1,b=void 0;try{for(var E=h[Symbol.iterator](),_;!(A=(_=E.next()).done)&&(v.push(_.value),!(f&&v.length===f));A=!0);}catch(C){m=!0,b=C}finally{try{!A&&E.return&&E.return()}finally{if(m)throw b}}return v}return function(h,f){if(Array.isArray(h))return h;if(Symbol.iterator in Object(h))return c(h,f);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function c(h,f){for(var v=0;v<f.length;v++){var A=f[v];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(h,A.key,A)}}return function(h,f,v){return f&&c(h.prototype,f),v&&c(h,v),h}}();function u(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function")}var a=t("./legacy-error-codes.json"),d=t("./utils.js");i.implementation=function(){function c(h){var f=s(h,2),v=f[0],A=f[1];u(this,c),this.name=A,this.message=v}return o(c,[{key:"code",get:function(){return a[this.name]||0}}]),c}(),i.init=function(c){if(Error.captureStackTrace){var h=d.wrapperForImpl(c);Error.captureStackTrace(h,h.constructor)}}},{"./legacy-error-codes.json":4,"./utils.js":6}],3:[function(t,r,i){var s=t("webidl-conversions"),o=t("./utils.js"),u=o.implSymbol;function a(){for(var h=[],f=0;f<arguments.length&&f<2;++f)h[f]=arguments[f];h[0]!==void 0?h[0]=s.DOMString(h[0],{context:"Failed to construct 'DOMException': parameter 1"}):h[0]="",h[1]!==void 0?h[1]=s.DOMString(h[1],{context:"Failed to construct 'DOMException': parameter 2"}):h[1]="Error",d.setup(this,h)}Object.defineProperty(a,"prototype",{value:a.prototype,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"name",{get:function(){return this[u].name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"message",{get:function(){return this[u].message},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"code",{get:function(){return this[u].code},enumerable:!0,configurable:!0}),Object.defineProperty(a,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(a.prototype,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(a,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(a.prototype,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(a,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(a.prototype,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(a,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(a.prototype,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(a,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(a.prototype,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(a,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(a.prototype,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(a,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(a.prototype,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(a,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(a.prototype,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(a,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(a.prototype,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(a,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(a.prototype,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(a,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(a.prototype,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(a,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(a.prototype,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(a,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(a.prototype,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(a,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(a.prototype,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(a,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(a.prototype,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(a,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(a.prototype,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(a,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(a.prototype,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(a,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(a.prototype,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(a,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(a.prototype,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(a,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(a.prototype,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(a,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(a.prototype,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(a,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(a.prototype,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(a,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(a.prototype,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(a,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(a.prototype,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(a,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(a.prototype,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(a.prototype,Symbol.toStringTag,{value:"DOMException",writable:!1,enumerable:!1,configurable:!0});var d={mixedInto:[],is:function(f){if(f){if(f[u]instanceof c.implementation)return!0;for(var v=0;v<r.exports.mixedInto.length;++v)if(f instanceof r.exports.mixedInto[v])return!0}return!1},isImpl:function(f){if(f){if(f instanceof c.implementation)return!0;for(var v=o.wrapperForImpl(f),A=0;A<r.exports.mixedInto.length;++A)if(v instanceof r.exports.mixedInto[A])return!0}return!1},convert:function(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},A=v.context,m=A===void 0?"The provided value":A;if(r.exports.is(f))return o.implForWrapper(f);throw new TypeError(m+" is not of type 'DOMException'.")},create:function(f,v){var A=Object.create(a.prototype);return this.setup(A,f,v),A},createImpl:function(f,v){var A=Object.create(a.prototype);return this.setup(A,f,v),o.implForWrapper(A)},_internalSetup:function(f){},setup:function(f,v,A){A||(A={}),A.wrapper=f,this._internalSetup(f),Object.defineProperty(f,u,{value:new c.implementation(v,A),writable:!1,enumerable:!1,configurable:!0}),f[u][o.wrapperSymbol]=f,c.init&&c.init(f[u],A)},interface:a,expose:{Window:{DOMException:a},Worker:{DOMException:a}}};r.exports=d;var c=t(".//DOMException-impl.js")},{".//DOMException-impl.js":2,"./utils.js":6,"webidl-conversions":9}],4:[function(t,r,i){r.exports={IndexSizeError:1,DOMStringSizeError:2,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoDataAllowedError:6,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,ValidationError:16,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25}},{}],5:[function(t,r,i){r.exports=t("./DOMException").interface,Object.setPrototypeOf(r.exports.prototype,Error.prototype)},{"./DOMException":3}],6:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T};function o(T){return(typeof T>"u"?"undefined":s(T))==="object"&&T!==null||typeof T=="function"}function u(T){return Object.getPrototypeOf(T)===Buffer.prototype?T:T instanceof ArrayBuffer?Buffer.from(T):Buffer.from(T.buffer,T.byteOffset,T.byteLength)}function a(T){return Buffer.from(u(T))}function d(T,x){for(var R=Object.getOwnPropertyNames(x),O=0;O<R.length;++O)R[O]in T||Object.defineProperty(T,R[O],Object.getOwnPropertyDescriptor(x,R[O]))}var c=Symbol("wrapper"),h=Symbol("impl"),f=Symbol("SameObject caches");function v(T,x,R){return T[f]||(T[f]=Object.create(null)),x in T[f]||(T[f][x]=R()),T[f][x]}function A(T){return T?T[c]:null}function m(T){return T?T[h]:null}function b(T){var x=A(T);return x||T}function E(T){var x=m(T);return x||T}var _=Symbol("internal"),C=Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()));r.exports={isObject:o,getReferenceToBytes:u,getCopyToBytes:a,mixin:d,wrapperSymbol:c,implSymbol:h,getSameObject:v,wrapperForImpl:A,implForWrapper:m,tryWrapperForImpl:b,tryImplForWrapper:E,iterInternalSymbol:_,IteratorPrototype:C}},{}],7:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};(function(o,u){(typeof i>"u"?"undefined":s(i))=="object"&&typeof r<"u"?r.exports=u():((o=typeof globalThis<"u"?globalThis:o||self).Typeson=o.Typeson||{},o.Typeson.presets=o.Typeson.presets||{},o.Typeson.presets.structuredCloningThrowing=u())})(void 0,function(){function o(y){return(o=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(l){return typeof l>"u"?"undefined":s(l)}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l>"u"?"undefined":s(l)})(y)}function u(y,l){if(!(y instanceof l))throw new TypeError("Cannot call a class as a function")}function a(y,l){for(var p=0;p<l.length;p++){var g=l[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}function d(y,l,p){return l in y?Object.defineProperty(y,l,{value:p,enumerable:!0,configurable:!0,writable:!0}):y[l]=p,y}function c(y,l){var p=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);l&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(y,w).enumerable})),p.push.apply(p,g)}return p}function h(y){return function(p){if(Array.isArray(p))return f(p)}(y)||function(p){if(typeof Symbol<"u"&&Symbol.iterator in Object(p))return Array.from(p)}(y)||function(p,g){if(p){if(typeof p=="string")return f(p,g);var w=Object.prototype.toString.call(p).slice(8,-1);if(w==="Object"&&p.constructor&&(w=p.constructor.name),w==="Map"||w==="Set")return Array.from(p);if(w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return f(p,g)}}(y)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function f(y,l){(l==null||l>y.length)&&(l=y.length);for(var p=0,g=new Array(l);p<l;p++)g[p]=y[p];return g}function v(y){return(v=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(p){return typeof p>"u"?"undefined":s(p)}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p>"u"?"undefined":s(p)})(y)}function A(y,l){if(!(y instanceof l))throw new TypeError("Cannot call a class as a function")}function m(y,l){for(var p=0;p<l.length;p++){var g=l[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}function b(y,l,p){return l in y?Object.defineProperty(y,l,{value:p,enumerable:!0,configurable:!0,writable:!0}):y[l]=p,y}function E(y,l){var p=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);l&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(y,w).enumerable})),p.push.apply(p,g)}return p}function _(y){for(var l=1;l<arguments.length;l++){var p=arguments[l]!=null?arguments[l]:{};l%2?E(Object(p),!0).forEach(function(g){b(y,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(p)):E(Object(p)).forEach(function(g){Object.defineProperty(y,g,Object.getOwnPropertyDescriptor(p,g))})}return y}function C(y,l){return function(g){if(Array.isArray(g))return g}(y)||function(g,w){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(g)))){var j=[],U=!0,q=!1,V=void 0;try{for(var le,ee=g[Symbol.iterator]();!(U=(le=ee.next()).done)&&(j.push(le.value),!w||j.length!==w);U=!0);}catch(he){q=!0,V=he}finally{try{U||ee.return==null||ee.return()}finally{if(q)throw V}}return j}}(y,l)||x(y,l)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function T(y){return function(p){if(Array.isArray(p))return R(p)}(y)||function(p){if(typeof Symbol<"u"&&Symbol.iterator in Object(p))return Array.from(p)}(y)||x(y)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function x(y,l){if(y){if(typeof y=="string")return R(y,l);var p=Object.prototype.toString.call(y).slice(8,-1);return p==="Object"&&y.constructor&&(p=y.constructor.name),p==="Map"||p==="Set"?Array.from(y):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?R(y,l):void 0}}function R(y,l){(l==null||l>y.length)&&(l=y.length);for(var p=0,g=new Array(l);p<l;p++)g[p]=y[p];return g}var O=function y(l){A(this,y),this.p=new Promise(l)};O.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(O.prototype[Symbol.toStringTag]="TypesonPromise"),O.prototype.then=function(y,l){var p=this;return new O(function(g,w){p.p.then(function(j){g(y?y(j):j)}).catch(function(j){return l?l(j):Promise.reject(j)}).then(g,w)})},O.prototype.catch=function(y){return this.then(null,y)},O.resolve=function(y){return new O(function(l){l(y)})},O.reject=function(y){return new O(function(l,p){p(y)})},["all","race"].forEach(function(y){O[y]=function(l){return new O(function(p,g){Promise[y](l.map(function(w){return w&&w.constructor&&w.constructor.__typeson__type__==="TypesonPromise"?w.p:w})).then(p,g)})}});var F={}.toString,M={}.hasOwnProperty,Z=Object.getPrototypeOf,se=M.toString;function Ae(y,l){return $e(y)&&typeof y.then=="function"&&(!l||typeof y.catch=="function")}function Se(y){return F.call(y).slice(8,-1)}function z(y,l){if(!y||v(y)!=="object")return!1;var p=Z(y);if(!p)return l===null;var g=M.call(p,"constructor")&&p.constructor;return typeof g!="function"?l===null:l===g||l!==null&&se.call(g)===se.call(l)||typeof l=="function"&&typeof g.__typeson__type__=="string"&&g.__typeson__type__===l.__typeson__type__}function Ge(y){return!(!y||Se(y)!=="Object")&&(!Z(y)||z(y,Object))}function $e(y){return y&&v(y)==="object"}function Te(y){return y.replace(/~/g,"~0").replace(/\./g,"~1")}function qe(y){return y.replace(/~1/g,".").replace(/~0/g,"~")}function ot(y,l){if(l==="")return y;var p=l.indexOf(".");if(p>-1){var g=y[qe(l.slice(0,p))];return g===void 0?void 0:ot(g,l.slice(p+1))}return y[qe(l)]}function Mt(y,l,p){if(l==="")return p;var g=l.indexOf(".");return g>-1?Mt(y[qe(l.slice(0,g))],l.slice(g+1),p):(y[qe(l)]=p,y)}function Me(y,l,p){return p?l?l(y):y:(y&&y.then||(y=Promise.resolve(y)),l?y.then(l):y)}var Yt=Object.keys,S=Array.isArray,D={}.hasOwnProperty,B=["type","replaced","iterateIn","iterateUnsetNumeric"];function I(y){return function(){for(var l=[],p=0;p<arguments.length;p++)l[p]=arguments[p];try{return Promise.resolve(y.apply(this,l))}catch(g){return Promise.reject(g)}}}function k(y,l){if(y.keypath==="")return-1;var p=y.keypath.match(/\./g)||0,g=l.keypath.match(/\./g)||0;return p&&(p=p.length),g&&(g=g.length),p>g?-1:p<g?1:y.keypath<l.keypath?-1:y.keypath>l.keypath}var N=function(){function y(l){A(this,y),this.options=l,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(p,g,w){return g&&m(p.prototype,g),w&&m(p,w),p}(y,[{key:"stringify",value:function(p,g,w,j){j=_(_(_({},this.options),j),{},{stringification:!0});var U=this.encapsulate(p,null,j);return S(U)?JSON.stringify(U[0],g,w):U.then(function(q){return JSON.stringify(q,g,w)})}},{key:"stringifySync",value:function(p,g,w,j){return this.stringify(p,g,w,_(_({throwOnBadSyncType:!0},j),{},{sync:!0}))}},{key:"stringifyAsync",value:function(p,g,w,j){return this.stringify(p,g,w,_(_({throwOnBadSyncType:!0},j),{},{sync:!1}))}},{key:"parse",value:function(p,g,w){return w=_(_(_({},this.options),w),{},{parse:!0}),this.revive(JSON.parse(p,g),w)}},{key:"parseSync",value:function(p,g,w){return this.parse(p,g,_(_({throwOnBadSyncType:!0},w),{},{sync:!0}))}},{key:"parseAsync",value:function(p,g,w){return this.parse(p,g,_(_({throwOnBadSyncType:!0},w),{},{sync:!1}))}},{key:"specialTypeNames",value:function(p,g){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return w.returnTypeNames=!0,this.encapsulate(p,g,w)}},{key:"rootTypeName",value:function(p,g){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return w.iterateNone=!0,this.encapsulate(p,g,w)}},{key:"encapsulate",value:function(p,g,w){var j=I(function(H,L){return Me(Promise.all(L.map(function(ae){return ae[1].p})),function(ae){return Me(Promise.all(ae.map(I(function(X){var de=!1,be=[],ft=C(L.splice(0,1),1),Ie=C(ft[0],7),ht=Ie[0],Et=Ie[2],pe=Ie[3],wt=Ie[4],we=Ie[5],pt=Ie[6],Qe=te(ht,X,Et,pe,be,!0,pt),Ot=z(Qe,O);return function(ei,hr){var bn=ei();return bn&&bn.then?bn.then(hr):hr(bn)}(function(){if(ht&&Ot)return Me(Qe.p,function(St){return wt[we]=St,de=!0,j(H,be)})},function(St){return de?St:(ht?wt[we]=Qe:H=Ot?Qe.p:Qe,j(H,be))})}))),function(){return H})})}),U=(w=_(_({sync:!0},this.options),w)).sync,q=this,V={},le=[],ee=[],he=[],Pe=!("cyclic"in w)||w.cyclic,xe=w.encapsulateObserver,xt=te("",p,Pe,g||{},he);function Re(H){var L=Object.values(V);if(w.iterateNone)return L.length?L[0]:y.getJSONType(H);if(L.length){if(w.returnTypeNames)return T(new Set(L));H&&Ge(H)&&!D.call(H,"$types")?H.$types=V:H={$:H,$types:{$:V}}}else $e(H)&&D.call(H,"$types")&&(H={$:H,$types:!0});return!w.returnTypeNames&&H}function Ne(H,L,ae){Object.assign(H,L);var X=B.map(function(de){var be=H[de];return delete H[de],be});ae(),B.forEach(function(de,be){H[de]=X[be]})}function te(H,L,ae,X,de,be,ft){var Ie,ht={},Et=v(L),pe=xe?function(zt){var Ze=ft||X.type||y.getJSONType(L);xe(Object.assign(zt||ht,{keypath:H,value:L,cyclic:ae,stateObj:X,promisesData:de,resolvingTypesonPromise:be,awaitingTypesonPromise:z(L,O)},{type:Ze}))}:null;if(["string","boolean","number","undefined"].includes(Et))return L===void 0||Number.isNaN(L)||L===Number.NEGATIVE_INFINITY||L===Number.POSITIVE_INFINITY?(Ie=X.replaced?L:At(H,L,X,de,!1,be,pe))!==L&&(ht={replaced:Ie}):Ie=L,pe&&pe(),Ie;if(L===null)return pe&&pe(),L;if(ae&&!X.iterateIn&&!X.iterateUnsetNumeric&&L&&v(L)==="object"){var wt=le.indexOf(L);if(!(wt<0))return V[H]="#",pe&&pe({cyclicKeypath:ee[wt]}),"#"+ee[wt];ae===!0&&(le.push(L),ee.push(H))}var we,pt=Ge(L),Qe=S(L),Ot=(pt||Qe)&&(!q.plainObjectReplacers.length||X.replaced)||X.iterateIn?L:At(H,L,X,de,pt||Qe,null,pe);if(Ot!==L?(Ie=Ot,ht={replaced:Ot}):H===""&&z(L,O)?(de.push([H,L,ae,X,void 0,void 0,X.type]),Ie=L):Qe&&X.iterateIn!=="object"||X.iterateIn==="array"?(we=new Array(L.length),ht={clone:we}):(["function","symbol"].includes(v(L))||"toJSON"in L||z(L,O)||z(L,Promise)||z(L,ArrayBuffer))&&!pt&&X.iterateIn!=="object"?Ie=L:(we={},X.addLength&&(we.length=L.length),ht={clone:we}),pe&&pe(),w.iterateNone)return we||Ie;if(!we)return Ie;if(X.iterateIn){var St=function(Ze){var Lt={ownKeys:D.call(L,Ze)};Ne(X,Lt,function(){var sn=H+(H?".":"")+Te(Ze),dr=te(sn,L[Ze],!!ae,X,de,be);z(dr,O)?de.push([sn,dr,!!ae,X,we,Ze,X.type]):dr!==void 0&&(we[Ze]=dr)})};for(var ei in L)St(ei);pe&&pe({endIterateIn:!0,end:!0})}else Yt(L).forEach(function(zt){var Ze=H+(H?".":"")+Te(zt);Ne(X,{ownKeys:!0},function(){var Lt=te(Ze,L[zt],!!ae,X,de,be);z(Lt,O)?de.push([Ze,Lt,!!ae,X,we,zt,X.type]):Lt!==void 0&&(we[zt]=Lt)})}),pe&&pe({endIterateOwn:!0,end:!0});if(X.iterateUnsetNumeric){for(var hr=L.length,bn=function(Ze){if(!(Ze in L)){var Lt=H+(H?".":"")+Ze;Ne(X,{ownKeys:!1},function(){var sn=te(Lt,void 0,!!ae,X,de,be);z(sn,O)?de.push([Lt,sn,!!ae,X,we,Ze,X.type]):sn!==void 0&&(we[Ze]=sn)})}},ti=0;ti<hr;ti++)bn(ti);pe&&pe({endIterateUnsetNumeric:!0,end:!0})}return we}function At(H,L,ae,X,de,be,ft){for(var Ie=de?q.plainObjectReplacers:q.nonplainObjectReplacers,ht=Ie.length;ht--;){var Et=Ie[ht];if(Et.test(L,ae)){var pe=Et.type;if(q.revivers[pe]){var wt=V[H];V[H]=wt?[pe].concat(wt):pe}return Object.assign(ae,{type:pe,replaced:!0}),!U&&Et.replaceAsync||Et.replace?(ft&&ft({replacing:!0}),te(H,Et[U||!Et.replaceAsync?"replace":"replaceAsync"](L,ae),Pe&&"readonly",ae,X,be,pe)):(ft&&ft({typeDetected:!0}),te(H,L,Pe&&"readonly",ae,X,be,pe))}}return L}return he.length?U&&w.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(j(xt,he)).then(Re):!U&&w.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():w.stringification&&U?[Re(xt)]:U?Re(xt):Promise.resolve(Re(xt))}},{key:"encapsulateSync",value:function(p,g,w){return this.encapsulate(p,g,_(_({throwOnBadSyncType:!0},w),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(p,g,w){return this.encapsulate(p,g,_(_({throwOnBadSyncType:!0},w),{},{sync:!1}))}},{key:"revive",value:function(p,g){var w=p&&p.$types;if(!w)return p;if(w===!0)return p.$;var j=(g=_(_({sync:!0},this.options),g)).sync,U=[],q={},V=!0;w.$&&Ge(w.$)&&(p=p.$,w=w.$,V=!1);var le=this;function ee(Re,Ne){var te=C(le.revivers[Re]||[],1)[0];if(!te)throw new Error("Unregistered type: "+Re);return j&&!("revive"in te)?Ne:te[j&&te.revive?"revive":!j&&te.reviveAsync?"reviveAsync":"revive"](Ne,q)}var he=[];function Pe(Re){return z(Re,_e)?void 0:Re}var xe,xt=function(){var Ne=[];if(Object.entries(w).forEach(function(te){var At=C(te,2),H=At[0],L=At[1];L!=="#"&&[].concat(L).forEach(function(ae){C(le.revivers[ae]||[null,{}],2)[1].plain&&(Ne.push({keypath:H,type:ae}),delete w[H])})}),Ne.length)return Ne.sort(k).reduce(function te(At,H){var L=H.keypath,ae=H.type;if(Ae(At))return At.then(function(be){return te(be,{keypath:L,type:ae})});var X=ot(p,L);if(z(X=ee(ae,X),O))return X.then(function(be){var ft=Mt(p,L,be);ft===be&&(p=ft)});var de=Mt(p,L,X);de===X&&(p=de)},void 0)}();return z(xt,O)?xe=xt.then(function(){return p}):(xe=function Re(Ne,te,At,H,L){if(!V||Ne!=="$types"){var ae=w[Ne],X=S(te);if(X||Ge(te)){var de=X?new Array(te.length):{};for(Yt(te).forEach(function(we){var pt=Re(Ne+(Ne?".":"")+Te(we),te[we],At||de,de,we),Qe=function(St){return z(St,_e)?de[we]=void 0:St!==void 0&&(de[we]=St),St};z(pt,O)?he.push(pt.then(function(Ot){return Qe(Ot)})):Qe(pt)}),te=de;U.length;){var be=C(U[0],4),ft=be[0],Ie=be[1],ht=be[2],Et=be[3],pe=ot(ft,Ie);if(pe===void 0)break;ht[Et]=pe,U.splice(0,1)}}if(!ae)return te;if(ae==="#"){var wt=ot(At,te.slice(1));return wt===void 0&&U.push([At,te.slice(1),H,L]),wt}return[].concat(ae).reduce(function we(pt,Qe){return z(pt,O)?pt.then(function(Ot){return we(Ot,Qe)}):ee(Qe,pt)},te)}}("",p,null),he.length&&(xe=O.resolve(xe).then(function(Re){return O.all([Re].concat(he))}).then(function(Re){return C(Re,1)[0]}))),Ae(xe)?j&&g.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():z(xe,O)?xe.p.then(Pe):xe:!j&&g.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():j?Pe(xe):Promise.resolve(Pe(xe))}},{key:"reviveSync",value:function(p,g){return this.revive(p,_(_({throwOnBadSyncType:!0},g),{},{sync:!0}))}},{key:"reviveAsync",value:function(p,g){return this.revive(p,_(_({throwOnBadSyncType:!0},g),{},{sync:!1}))}},{key:"register",value:function(p,g){return g=g||{},[].concat(p).forEach(function w(j){var U=this;if(S(j))return j.map(function(q){return w.call(U,q)});j&&Yt(j).forEach(function(q){if(q==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(y.JSON_TYPES.includes(q))throw new TypeError("Plain JSON object types are reserved as type names");var V=j[q],le=V&&V.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,ee=le.filter(function(Ne){return Ne.type===q});if(ee.length&&(le.splice(le.indexOf(ee[0]),1),delete this.revivers[q],delete this.types[q]),typeof V=="function"){var he=V;V={test:function(te){return te&&te.constructor===he},replace:function(te){return _({},te)},revive:function(te){return Object.assign(Object.create(he.prototype),te)}}}else if(S(V)){var Pe=C(V,3);V={test:Pe[0],replace:Pe[1],revive:Pe[2]}}if(V&&V.test){var xe={type:q,test:V.test.bind(V)};V.replace&&(xe.replace=V.replace.bind(V)),V.replaceAsync&&(xe.replaceAsync=V.replaceAsync.bind(V));var xt=typeof g.fallback=="number"?g.fallback:g.fallback?0:Number.POSITIVE_INFINITY;if(V.testPlainObjects?this.plainObjectReplacers.splice(xt,0,xe):this.nonplainObjectReplacers.splice(xt,0,xe),V.revive||V.reviveAsync){var Re={};V.revive&&(Re.revive=V.revive.bind(V)),V.reviveAsync&&(Re.reviveAsync=V.reviveAsync.bind(V)),this.revivers[q]=[Re,{plain:V.testPlainObjects}]}this.types[q]=V}},this)},this),this}}]),y}(),_e=function y(){A(this,y)};_e.__typeson__type__="TypesonUndefined",N.Undefined=_e,N.Promise=O,N.isThenable=Ae,N.toStringTag=Se,N.hasConstructorOf=z,N.isObject=$e,N.isPlainObject=Ge,N.isUserObject=function y(l){if(!l||Se(l)!=="Object")return!1;var p=Z(l);return!p||z(l,Object)||y(p)},N.escapeKeyPathComponent=Te,N.unescapeKeyPathComponent=qe,N.getByKeyPath=ot,N.getJSONType=function(l){return l===null?"null":Array.isArray(l)?"array":v(l)},N.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Ee={userObject:{test:function(l,p){return N.isUserObject(l)},replace:function(l){return function(g){for(var w=1;w<arguments.length;w++){var j=arguments[w]!=null?arguments[w]:{};w%2?c(Object(j),!0).forEach(function(U){d(g,U,j[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(j)):c(Object(j)).forEach(function(U){Object.defineProperty(g,U,Object.getOwnPropertyDescriptor(j,U))})}return g}({},l)},revive:function(l){return l}}},J=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(l,p){return!!Array.isArray(l)&&(Object.keys(l).some(function(g){return String(Number.parseInt(g))!==g})&&(p.iterateIn="object",p.addLength=!0),!0)},replace:function(l,p){return p.iterateUnsetNumeric=!0,l},revive:function(l){if(Array.isArray(l))return l;var p=[];return Object.keys(l).forEach(function(g){var w=l[g];p[g]=w}),p}}},{sparseUndefined:{test:function(l,p){return l===void 0&&p.ownKeys===!1},replace:function(l){return 0},revive:function(l){}}}],at={undef:{test:function(l,p){return l===void 0&&(p.ownKeys||!("ownKeys"in p))},replace:function(l){return 0},revive:function(l){return new N.Undefined}}},Xe={StringObject:{test:function(l){return N.toStringTag(l)==="String"&&o(l)==="object"},replace:function(l){return String(l)},revive:function(l){return new String(l)}},BooleanObject:{test:function(l){return N.toStringTag(l)==="Boolean"&&o(l)==="object"},replace:function(l){return!!l},revive:function(l){return new Boolean(l)}},NumberObject:{test:function(l){return N.toStringTag(l)==="Number"&&o(l)==="object"},replace:function(l){return Number(l)},revive:function(l){return new Number(l)}}},ut=[{nan:{test:function(l){return Number.isNaN(l)},replace:function(l){return"NaN"},revive:function(l){return Number.NaN}}},{infinity:{test:function(l){return l===Number.POSITIVE_INFINITY},replace:function(l){return"Infinity"},revive:function(l){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(l){return l===Number.NEGATIVE_INFINITY},replace:function(l){return"-Infinity"},revive:function(l){return Number.NEGATIVE_INFINITY}}}],dt={date:{test:function(l){return N.toStringTag(l)==="Date"},replace:function(l){var p=l.getTime();return Number.isNaN(p)?"NaN":p},revive:function(l){return l==="NaN"?new Date(Number.NaN):new Date(l)}}},Fe={regexp:{test:function(l){return N.toStringTag(l)==="RegExp"},replace:function(l){return{source:l.source,flags:(l.global?"g":"")+(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.sticky?"y":"")+(l.unicode?"u":"")}},revive:function(l){var p=l.source,g=l.flags;return new RegExp(p,g)}}},bt={map:{test:function(l){return N.toStringTag(l)==="Map"},replace:function(l){return h(l.entries())},revive:function(l){return new Map(l)}}},De={set:{test:function(l){return N.toStringTag(l)==="Set"},replace:function(l){return h(l.values())},revive:function(l){return new Set(l)}}},ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q=new Uint8Array(256),Ke=0;Ke<ve.length;Ke++)Q[ve.charCodeAt(Ke)]=Ke;var G=function(l,p,g){g==null&&(g=l.byteLength);for(var w=new Uint8Array(l,p||0,g),j=w.length,U="",q=0;q<j;q+=3)U+=ve[w[q]>>2],U+=ve[(3&w[q])<<4|w[q+1]>>4],U+=ve[(15&w[q+1])<<2|w[q+2]>>6],U+=ve[63&w[q+2]];return j%3==2?U=U.slice(0,-1)+"=":j%3==1&&(U=U.slice(0,-2)+"=="),U},P=function(l){var p,g,w,j,U=l.length,q=.75*l.length,V=0;l[l.length-1]==="="&&(q--,l[l.length-2]==="="&&q--);for(var le=new ArrayBuffer(q),ee=new Uint8Array(le),he=0;he<U;he+=4)p=Q[l.charCodeAt(he)],g=Q[l.charCodeAt(he+1)],w=Q[l.charCodeAt(he+2)],j=Q[l.charCodeAt(he+3)],ee[V++]=p<<2|g>>4,ee[V++]=(15&g)<<4|w>>2,ee[V++]=(3&w)<<6|63&j;return le},ne={arraybuffer:{test:function(l){return N.toStringTag(l)==="ArrayBuffer"},replace:function(l,p){p.buffers||(p.buffers=[]);var g=p.buffers.indexOf(l);return g>-1?{index:g}:(p.buffers.push(l),G(l))},revive:function(l,p){if(p.buffers||(p.buffers=[]),o(l)==="object")return p.buffers[l.index];var g=P(l);return p.buffers.push(g),g}}},Y=typeof self>"u"?ni:self,oe={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(y){var l=y,p=Y[l];p&&(oe[y.toLowerCase()]={test:function(w){return N.toStringTag(w)===l},replace:function(w,j){var U=w.buffer,q=w.byteOffset,V=w.length;j.buffers||(j.buffers=[]);var le=j.buffers.indexOf(U);return le>-1?{index:le,byteOffset:q,length:V}:(j.buffers.push(U),{encoded:G(U),byteOffset:q,length:V})},revive:function(w,j){j.buffers||(j.buffers=[]);var U,q=w.byteOffset,V=w.length,le=w.encoded,ee=w.index;return"index"in w?U=j.buffers[ee]:(U=P(le),j.buffers.push(U)),new p(U,q,V)}})});var fe={dataview:{test:function(l){return N.toStringTag(l)==="DataView"},replace:function(l,p){var g=l.buffer,w=l.byteOffset,j=l.byteLength;p.buffers||(p.buffers=[]);var U=p.buffers.indexOf(g);return U>-1?{index:U,byteOffset:w,byteLength:j}:(p.buffers.push(g),{encoded:G(g),byteOffset:w,byteLength:j})},revive:function(l,p){p.buffers||(p.buffers=[]);var g,w=l.byteOffset,j=l.byteLength,U=l.encoded,q=l.index;return"index"in l?g=p.buffers[q]:(g=P(U),p.buffers.push(g)),new DataView(g,w,j)}}},Je={IntlCollator:{test:function(l){return N.hasConstructorOf(l,Intl.Collator)},replace:function(l){return l.resolvedOptions()},revive:function(l){return new Intl.Collator(l.locale,l)}},IntlDateTimeFormat:{test:function(l){return N.hasConstructorOf(l,Intl.DateTimeFormat)},replace:function(l){return l.resolvedOptions()},revive:function(l){return new Intl.DateTimeFormat(l.locale,l)}},IntlNumberFormat:{test:function(l){return N.hasConstructorOf(l,Intl.NumberFormat)},replace:function(l){return l.resolvedOptions()},revive:function(l){return new Intl.NumberFormat(l.locale,l)}}};function Be(y){for(var l=new Uint8Array(y.length),p=0;p<y.length;p++)l[p]=y.charCodeAt(p);return l.buffer}var Ue={file:{test:function(l){return N.toStringTag(l)==="File"},replace:function(l){var p=new XMLHttpRequest;if(p.overrideMimeType("text/plain; charset=x-user-defined"),p.open("GET",URL.createObjectURL(l),!1),p.send(),p.status!==200&&p.status!==0)throw new Error("Bad File access: "+p.status);return{type:l.type,stringContents:p.responseText,name:l.name,lastModified:l.lastModified}},revive:function(l){var p=l.name,g=l.type,w=l.stringContents,j=l.lastModified;return new File([Be(w)],p,{type:g,lastModified:j})},replaceAsync:function(l){return new N.Promise(function(p,g){var w=new FileReader;w.addEventListener("load",function(){p({type:l.type,stringContents:w.result,name:l.name,lastModified:l.lastModified})}),w.addEventListener("error",function(){g(w.error)}),w.readAsBinaryString(l)})}}},ct={bigint:{test:function(l){return typeof l=="bigint"},replace:function(l){return String(l)},revive:function(l){return BigInt(l)}}},ce={bigintObject:{test:function(l){return o(l)==="object"&&N.hasConstructorOf(l,BigInt)},replace:function(l){return String(l)},revive:function(l){return new Object(BigInt(l))}}},lt={cryptokey:{test:function(l){return N.toStringTag(l)==="CryptoKey"&&l.extractable},replaceAsync:function(l){return new N.Promise(function(p,g){crypto.subtle.exportKey("jwk",l).catch(function(w){g(w)}).then(function(w){p({jwk:w,algorithm:l.algorithm,usages:l.usages})})})},revive:function(l){var p=l.jwk,g=l.algorithm,w=l.usages;return crypto.subtle.importKey("jwk",p,g,!0,w)}}};return[Ee,at,J,Xe,ut,dt,Fe,{imagedata:{test:function(l){return N.toStringTag(l)==="ImageData"},replace:function(l){return{array:h(l.data),width:l.width,height:l.height}},revive:function(l){return new ImageData(new Uint8ClampedArray(l.array),l.width,l.height)}}},{imagebitmap:{test:function(l){return N.toStringTag(l)==="ImageBitmap"||l&&l.dataset&&l.dataset.toStringTag==="ImageBitmap"},replace:function(l){var p=document.createElement("canvas");return p.getContext("2d").drawImage(l,0,0),p.toDataURL()},revive:function(l){var p=document.createElement("canvas"),g=p.getContext("2d"),w=document.createElement("img");return w.addEventListener("load",function(){g.drawImage(w,0,0)}),w.src=l,p},reviveAsync:function(l){var p=document.createElement("canvas"),g=p.getContext("2d"),w=document.createElement("img");return w.addEventListener("load",function(){g.drawImage(w,0,0)}),w.src=l,createImageBitmap(p)}}},Ue,{file:Ue.file,filelist:{test:function(l){return N.toStringTag(l)==="FileList"},replace:function(l){for(var p=[],g=0;g<l.length;g++)p[g]=l.item(g);return p},revive:function(l){return new(function(){function p(){u(this,p),this._files=arguments[0],this.length=this._files.length}return function(w,j,U){return j&&a(w.prototype,j),U&&a(w,U),w}(p,[{key:"item",value:function(w){return this._files[w]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),p}())(l)}}},{blob:{test:function(l){return N.toStringTag(l)==="Blob"},replace:function(l){var p=new XMLHttpRequest;if(p.overrideMimeType("text/plain; charset=x-user-defined"),p.open("GET",URL.createObjectURL(l),!1),p.send(),p.status!==200&&p.status!==0)throw new Error("Bad Blob access: "+p.status);return{type:l.type,stringContents:p.responseText}},revive:function(l){var p=l.type,g=l.stringContents;return new Blob([Be(g)],{type:p})},replaceAsync:function(l){return new N.Promise(function(p,g){var w=new FileReader;w.addEventListener("load",function(){p({type:l.type,stringContents:w.result})}),w.addEventListener("error",function(){g(w.error)}),w.readAsBinaryString(l)})}}}].concat(typeof Map=="function"?bt:[],typeof Set=="function"?De:[],typeof ArrayBuffer=="function"?ne:[],typeof Uint8Array=="function"?oe:[],typeof DataView=="function"?fe:[],typeof Intl<"u"?Je:[],typeof crypto<"u"?lt:[],typeof BigInt<"u"?[ct,ce]:[]).concat({checkDataCloneException:{test:function(l){var p={}.toString.call(l).slice(8,-1);if(["symbol","function"].includes(o(l))||["Arguments","Module","Error","Promise","WeakMap","WeakSet","Event","MessageChannel"].includes(p)||l&&o(l)==="object"&&typeof l.nodeType=="number"&&typeof l.insertBefore=="function")throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}}})})},{}],8:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S};function o(S){return(o=typeof Symbol=="function"&&s(Symbol.iterator)=="symbol"?function(D){return typeof D>"u"?"undefined":s(D)}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D>"u"?"undefined":s(D)})(S)}function u(S,D){if(!(S instanceof D))throw new TypeError("Cannot call a class as a function")}function a(S,D){for(var B=0;B<D.length;B++){var I=D[B];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(S,I.key,I)}}function d(S,D,B){return D in S?Object.defineProperty(S,D,{value:B,enumerable:!0,configurable:!0,writable:!0}):S[D]=B,S}function c(S,D){var B=Object.keys(S);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(S);D&&(I=I.filter(function(k){return Object.getOwnPropertyDescriptor(S,k).enumerable})),B.push.apply(B,I)}return B}function h(S){for(var D=1;D<arguments.length;D++){var B=arguments[D]!=null?arguments[D]:{};D%2?c(Object(B),!0).forEach(function(I){d(S,I,B[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(B)):c(Object(B)).forEach(function(I){Object.defineProperty(S,I,Object.getOwnPropertyDescriptor(B,I))})}return S}function f(S,D){return function(I){if(Array.isArray(I))return I}(S)||function(I,k){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(I)))){var N=[],_e=!0,Ee=!1,J=void 0;try{for(var at,Xe=I[Symbol.iterator]();!(_e=(at=Xe.next()).done)&&(N.push(at.value),!k||N.length!==k);_e=!0);}catch(ut){Ee=!0,J=ut}finally{try{_e||Xe.return==null||Xe.return()}finally{if(Ee)throw J}}return N}}(S,D)||A(S,D)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function v(S){return function(B){if(Array.isArray(B))return m(B)}(S)||function(B){if(typeof Symbol<"u"&&Symbol.iterator in Object(B))return Array.from(B)}(S)||A(S)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function A(S,D){if(S){if(typeof S=="string")return m(S,D);var B=Object.prototype.toString.call(S).slice(8,-1);return B==="Object"&&S.constructor&&(B=S.constructor.name),B==="Map"||B==="Set"?Array.from(S):B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B)?m(S,D):void 0}}function m(S,D){(D==null||D>S.length)&&(D=S.length);for(var B=0,I=new Array(D);B<D;B++)I[B]=S[B];return I}var b=function S(D){u(this,S),this.p=new Promise(D)};b.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(b.prototype[Symbol.toStringTag]="TypesonPromise"),b.prototype.then=function(S,D){var B=this;return new b(function(I,k){B.p.then(function(N){I(S?S(N):N)}).catch(function(N){return D?D(N):Promise.reject(N)}).then(I,k)})},b.prototype.catch=function(S){return this.then(null,S)},b.resolve=function(S){return new b(function(D){D(S)})},b.reject=function(S){return new b(function(D,B){B(S)})},["all","race","allSettled"].forEach(function(S){b[S]=function(D){return new b(function(B,I){Promise[S](D.map(function(k){return k&&k.constructor&&k.constructor.__typeson__type__==="TypesonPromise"?k.p:k})).then(B,I)})}});var E={}.toString,_={}.hasOwnProperty,C=Object.getPrototypeOf,T=_.toString;function x(S,D){return M(S)&&typeof S.then=="function"&&(!D||typeof S.catch=="function")}function R(S){return E.call(S).slice(8,-1)}function O(S,D){if(!S||o(S)!=="object")return!1;var B=C(S);if(!B)return D===null;var I=_.call(B,"constructor")&&B.constructor;return typeof I!="function"?D===null:D===I||D!==null&&T.call(I)===T.call(D)||typeof D=="function"&&typeof I.__typeson__type__=="string"&&I.__typeson__type__===D.__typeson__type__}function F(S){return!(!S||R(S)!=="Object")&&(!C(S)||O(S,Object))}function M(S){return S&&o(S)==="object"}function Z(S){return S.replace(/~/g,"~0").replace(/\./g,"~1")}function se(S){return S.replace(/~1/g,".").replace(/~0/g,"~")}function Ae(S,D){if(D==="")return S;var B=D.indexOf(".");if(B>-1){var I=S[se(D.slice(0,B))];return I===void 0?void 0:Ae(I,D.slice(B+1))}return S[se(D)]}function Se(S,D,B){if(D==="")return B;var I=D.indexOf(".");return I>-1?Se(S[se(D.slice(0,I))],D.slice(I+1),B):(S[se(D)]=B,S)}function z(S,D,B){return B?D?D(S):S:(S&&S.then||(S=Promise.resolve(S)),D?S.then(D):S)}var Ge=Object.keys,$e=Array.isArray,Te={}.hasOwnProperty,qe=["type","replaced","iterateIn","iterateUnsetNumeric"];function ot(S){return function(){for(var D=[],B=0;B<arguments.length;B++)D[B]=arguments[B];try{return Promise.resolve(S.apply(this,D))}catch(I){return Promise.reject(I)}}}function Mt(S,D){if(S.keypath==="")return-1;var B=S.keypath.match(/\./g)||0,I=D.keypath.match(/\./g)||0;return B&&(B=B.length),I&&(I=I.length),B>I?-1:B<I?1:S.keypath<D.keypath?-1:S.keypath>D.keypath}var Me=function(){function S(D){u(this,S),this.options=D,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(B,I,k){return I&&a(B.prototype,I),k&&a(B,k),B}(S,[{key:"stringify",value:function(B,I,k,N){N=h(h(h({},this.options),N),{},{stringification:!0});var _e=this.encapsulate(B,null,N);return $e(_e)?JSON.stringify(_e[0],I,k):_e.then(function(Ee){return JSON.stringify(Ee,I,k)})}},{key:"stringifySync",value:function(B,I,k,N){return this.stringify(B,I,k,h(h({throwOnBadSyncType:!0},N),{},{sync:!0}))}},{key:"stringifyAsync",value:function(B,I,k,N){return this.stringify(B,I,k,h(h({throwOnBadSyncType:!0},N),{},{sync:!1}))}},{key:"parse",value:function(B,I,k){return k=h(h(h({},this.options),k),{},{parse:!0}),this.revive(JSON.parse(B,I),k)}},{key:"parseSync",value:function(B,I,k){return this.parse(B,I,h(h({throwOnBadSyncType:!0},k),{},{sync:!0}))}},{key:"parseAsync",value:function(B,I,k){return this.parse(B,I,h(h({throwOnBadSyncType:!0},k),{},{sync:!1}))}},{key:"specialTypeNames",value:function(B,I){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return k.returnTypeNames=!0,this.encapsulate(B,I,k)}},{key:"rootTypeName",value:function(B,I){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return k.iterateNone=!0,this.encapsulate(B,I,k)}},{key:"encapsulate",value:function(B,I,k){var N=ot(function(G,P){return z(Promise.all(P.map(function(ne){return ne[1].p})),function(ne){return z(Promise.all(ne.map(ot(function(Y){var oe=!1,fe=[],Je=f(P.splice(0,1),1),Be=f(Je[0],7),Ue=Be[0],ct=Be[2],ce=Be[3],lt=Be[4],y=Be[5],l=Be[6],p=Q(Ue,Y,ct,ce,fe,!0,l),g=O(p,b);return function(j,U){var q=j();return q&&q.then?q.then(U):U(q)}(function(){if(Ue&&g)return z(p.p,function(w){return lt[y]=w,oe=!0,N(G,fe)})},function(w){return oe?w:(Ue?lt[y]=p:G=g?p.p:p,N(G,fe))})}))),function(){return G})})}),_e=(k=h(h({sync:!0},this.options),k)).sync,Ee=this,J={},at=[],Xe=[],ut=[],dt=!("cyclic"in k)||k.cyclic,Fe=k.encapsulateObserver,bt=Q("",B,dt,I||{},ut);function De(G){var P=Object.values(J);if(k.iterateNone)return P.length?P[0]:S.getJSONType(G);if(P.length){if(k.returnTypeNames)return v(new Set(P));G&&F(G)&&!Te.call(G,"$types")?G.$types=J:G={$:G,$types:{$:J}}}else M(G)&&Te.call(G,"$types")&&(G={$:G,$types:!0});return!k.returnTypeNames&&G}function ve(G,P,ne){Object.assign(G,P);var Y=qe.map(function(oe){var fe=G[oe];return delete G[oe],fe});ne(),qe.forEach(function(oe,fe){G[oe]=Y[fe]})}function Q(G,P,ne,Y,oe,fe,Je){var Be,Ue={},ct=o(P),ce=Fe?function(le){var ee=Je||Y.type||S.getJSONType(P);Fe(Object.assign(le||Ue,{keypath:G,value:P,cyclic:ne,stateObj:Y,promisesData:oe,resolvingTypesonPromise:fe,awaitingTypesonPromise:O(P,b)},{type:ee}))}:null;if(["string","boolean","number","undefined"].includes(ct))return P===void 0||Number.isNaN(P)||P===Number.NEGATIVE_INFINITY||P===Number.POSITIVE_INFINITY?(Be=Y.replaced?P:Ke(G,P,Y,oe,!1,fe,ce))!==P&&(Ue={replaced:Be}):Be=P,ce&&ce(),Be;if(P===null)return ce&&ce(),P;if(ne&&!Y.iterateIn&&!Y.iterateUnsetNumeric&&P&&o(P)==="object"){var lt=at.indexOf(P);if(!(lt<0))return J[G]="#",ce&&ce({cyclicKeypath:Xe[lt]}),"#"+Xe[lt];ne===!0&&(at.push(P),Xe.push(G))}var y,l=F(P),p=$e(P),g=(l||p)&&(!Ee.plainObjectReplacers.length||Y.replaced)||Y.iterateIn?P:Ke(G,P,Y,oe,l||p,null,ce);if(g!==P?(Be=g,Ue={replaced:g}):G===""&&O(P,b)?(oe.push([G,P,ne,Y,void 0,void 0,Y.type]),Be=P):p&&Y.iterateIn!=="object"||Y.iterateIn==="array"?(y=new Array(P.length),Ue={clone:y}):(["function","symbol"].includes(o(P))||"toJSON"in P||O(P,b)||O(P,Promise)||O(P,ArrayBuffer))&&!l&&Y.iterateIn!=="object"?Be=P:(y={},Y.addLength&&(y.length=P.length),Ue={clone:y}),ce&&ce(),k.iterateNone)return y||Be;if(!y)return Be;if(Y.iterateIn){var w=function(ee){var he={ownKeys:Te.call(P,ee)};ve(Y,he,function(){var Pe=G+(G?".":"")+Z(ee),xe=Q(Pe,P[ee],!!ne,Y,oe,fe);O(xe,b)?oe.push([Pe,xe,!!ne,Y,y,ee,Y.type]):xe!==void 0&&(y[ee]=xe)})};for(var j in P)w(j);ce&&ce({endIterateIn:!0,end:!0})}else Ge(P).forEach(function(le){var ee=G+(G?".":"")+Z(le);ve(Y,{ownKeys:!0},function(){var he=Q(ee,P[le],!!ne,Y,oe,fe);O(he,b)?oe.push([ee,he,!!ne,Y,y,le,Y.type]):he!==void 0&&(y[le]=he)})}),ce&&ce({endIterateOwn:!0,end:!0});if(Y.iterateUnsetNumeric){for(var U=P.length,q=function(ee){if(!(ee in P)){var he=G+(G?".":"")+ee;ve(Y,{ownKeys:!1},function(){var Pe=Q(he,void 0,!!ne,Y,oe,fe);O(Pe,b)?oe.push([he,Pe,!!ne,Y,y,ee,Y.type]):Pe!==void 0&&(y[ee]=Pe)})}},V=0;V<U;V++)q(V);ce&&ce({endIterateUnsetNumeric:!0,end:!0})}return y}function Ke(G,P,ne,Y,oe,fe,Je){for(var Be=oe?Ee.plainObjectReplacers:Ee.nonplainObjectReplacers,Ue=Be.length;Ue--;){var ct=Be[Ue];if(ct.test(P,ne)){var ce=ct.type;if(Ee.revivers[ce]){var lt=J[G];J[G]=lt?[ce].concat(lt):ce}return Object.assign(ne,{type:ce,replaced:!0}),!_e&&ct.replaceAsync||ct.replace?(Je&&Je({replacing:!0}),Q(G,ct[_e||!ct.replaceAsync?"replace":"replaceAsync"](P,ne),dt&&"readonly",ne,Y,fe,ce)):(Je&&Je({typeDetected:!0}),Q(G,P,dt&&"readonly",ne,Y,fe,ce))}}return P}return ut.length?_e&&k.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(N(bt,ut)).then(De):!_e&&k.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():k.stringification&&_e?[De(bt)]:_e?De(bt):Promise.resolve(De(bt))}},{key:"encapsulateSync",value:function(B,I,k){return this.encapsulate(B,I,h(h({throwOnBadSyncType:!0},k),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(B,I,k){return this.encapsulate(B,I,h(h({throwOnBadSyncType:!0},k),{},{sync:!1}))}},{key:"revive",value:function(B,I){var k=B&&B.$types;if(!k)return B;if(k===!0)return B.$;var N=(I=h(h({sync:!0},this.options),I)).sync,_e=[],Ee={},J=!0;k.$&&F(k.$)&&(B=B.$,k=k.$,J=!1);var at=this;function Xe(De,ve){var Q=f(at.revivers[De]||[],1)[0];if(!Q)throw new Error("Unregistered type: "+De);return N&&!("revive"in Q)?ve:Q[N&&Q.revive?"revive":!N&&Q.reviveAsync?"reviveAsync":"revive"](ve,Ee)}var ut=[];function dt(De){return O(De,Yt)?void 0:De}var Fe,bt=function(){var ve=[];if(Object.entries(k).forEach(function(Q){var Ke=f(Q,2),G=Ke[0],P=Ke[1];P!=="#"&&[].concat(P).forEach(function(ne){f(at.revivers[ne]||[null,{}],2)[1].plain&&(ve.push({keypath:G,type:ne}),delete k[G])})}),ve.length)return ve.sort(Mt).reduce(function Q(Ke,G){var P=G.keypath,ne=G.type;if(x(Ke))return Ke.then(function(fe){return Q(fe,{keypath:P,type:ne})});var Y=Ae(B,P);if(O(Y=Xe(ne,Y),b))return Y.then(function(fe){var Je=Se(B,P,fe);Je===fe&&(B=Je)});var oe=Se(B,P,Y);oe===Y&&(B=oe)},void 0)}();return O(bt,b)?Fe=bt.then(function(){return B}):(Fe=function De(ve,Q,Ke,G,P){if(!J||ve!=="$types"){var ne=k[ve],Y=$e(Q);if(Y||F(Q)){var oe=Y?new Array(Q.length):{};for(Ge(Q).forEach(function(y){var l=De(ve+(ve?".":"")+Z(y),Q[y],Ke||oe,oe,y),p=function(w){return O(w,Yt)?oe[y]=void 0:w!==void 0&&(oe[y]=w),w};O(l,b)?ut.push(l.then(function(g){return p(g)})):p(l)}),Q=oe;_e.length;){var fe=f(_e[0],4),Je=fe[0],Be=fe[1],Ue=fe[2],ct=fe[3],ce=Ae(Je,Be);if(ce===void 0)break;Ue[ct]=ce,_e.splice(0,1)}}if(!ne)return Q;if(ne==="#"){var lt=Ae(Ke,Q.slice(1));return lt===void 0&&_e.push([Ke,Q.slice(1),G,P]),lt}return[].concat(ne).reduce(function y(l,p){return O(l,b)?l.then(function(g){return y(g,p)}):Xe(p,l)},Q)}}("",B,null),ut.length&&(Fe=b.resolve(Fe).then(function(De){return b.all([De].concat(ut))}).then(function(De){return f(De,1)[0]}))),x(Fe)?N&&I.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():O(Fe,b)?Fe.p.then(dt):Fe:!N&&I.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():N?dt(Fe):Promise.resolve(dt(Fe))}},{key:"reviveSync",value:function(B,I){return this.revive(B,h(h({throwOnBadSyncType:!0},I),{},{sync:!0}))}},{key:"reviveAsync",value:function(B,I){return this.revive(B,h(h({throwOnBadSyncType:!0},I),{},{sync:!1}))}},{key:"register",value:function(B,I){return I=I||{},[].concat(B).forEach(function k(N){var _e=this;if($e(N))return N.map(function(Ee){return k.call(_e,Ee)});N&&Ge(N).forEach(function(Ee){if(Ee==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(S.JSON_TYPES.includes(Ee))throw new TypeError("Plain JSON object types are reserved as type names");var J=N[Ee],at=J&&J.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,Xe=at.filter(function(ve){return ve.type===Ee});if(Xe.length&&(at.splice(at.indexOf(Xe[0]),1),delete this.revivers[Ee],delete this.types[Ee]),typeof J=="function"){var ut=J;J={test:function(Q){return Q&&Q.constructor===ut},replace:function(Q){return h({},Q)},revive:function(Q){return Object.assign(Object.create(ut.prototype),Q)}}}else if($e(J)){var dt=f(J,3);J={test:dt[0],replace:dt[1],revive:dt[2]}}if(J&&J.test){var Fe={type:Ee,test:J.test.bind(J)};J.replace&&(Fe.replace=J.replace.bind(J)),J.replaceAsync&&(Fe.replaceAsync=J.replaceAsync.bind(J));var bt=typeof I.fallback=="number"?I.fallback:I.fallback?0:Number.POSITIVE_INFINITY;if(J.testPlainObjects?this.plainObjectReplacers.splice(bt,0,Fe):this.nonplainObjectReplacers.splice(bt,0,Fe),J.revive||J.reviveAsync){var De={};J.revive&&(De.revive=J.revive.bind(J)),J.reviveAsync&&(De.reviveAsync=J.reviveAsync.bind(J)),this.revivers[Ee]=[De,{plain:J.testPlainObjects}]}this.types[Ee]=J}},this)},this),this}}]),S}(),Yt=function S(){u(this,S)};Yt.__typeson__type__="TypesonUndefined",Me.Undefined=Yt,Me.Promise=b,Me.isThenable=x,Me.toStringTag=R,Me.hasConstructorOf=O,Me.isObject=M,Me.isPlainObject=F,Me.isUserObject=function S(D){if(!D||R(D)!=="Object")return!1;var B=C(D);return!B||O(D,Object)||S(B)},Me.escapeKeyPathComponent=Z,Me.unescapeKeyPathComponent=se,Me.getByKeyPath=Ae,Me.getJSONType=function(D){return D===null?"null":Array.isArray(D)?"array":o(D)},Me.JSON_TYPES=["null","boolean","number","string","array","object"],r.exports=Me},{}],9:[function(t,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m};function o(m,b){return(b&&b.context?b.context:"Value")+" "+m+"."}function u(m){if(m===null)return"Null";switch(typeof m>"u"?"undefined":s(m)){case"undefined":return"Undefined";case"boolean":return"Boolean";case"number":return"Number";case"string":return"String";case"symbol":return"Symbol";case"object":case"function":default:return"Object"}}function a(m){return m>0&&m%1===.5&&!(m&1)||m<0&&m%1===-.5&&(m&1)===1?f(Math.floor(m)):f(Math.round(m))}function d(m){return f(Math.trunc(m))}function c(m){return m<0?-1:1}function h(m,b){var E=m%b;return c(b)!==c(E)?E+b:E}function f(m){return m===0?0:m}function v(m,b){var E=!b.unsigned,_=void 0,C=void 0;m===64?(C=Math.pow(2,53)-1,_=E?-Math.pow(2,53)+1:0):E?(_=-Math.pow(2,m-1),C=Math.pow(2,m-1)-1):(_=0,C=Math.pow(2,m)-1);var T=Math.pow(2,m),x=Math.pow(2,m-1);return function(R,O){O===void 0&&(O={});var F=+R;if(F=f(F),O.enforceRange){if(!Number.isFinite(F))throw new TypeError(o("is not a finite number",O));if(F=d(F),F<_||F>C)throw new TypeError(o("is outside the accepted range of "+_+" to "+C+", inclusive",O));return F}return!Number.isNaN(F)&&O.clamp?(F=Math.min(Math.max(F,_),C),F=a(F),F):!Number.isFinite(F)||F===0?0:(F=d(F),F>=_&&F<=C?F:(F=h(F,T),E&&F>=x?F-T:F))}}i.any=function(m){return m},i.void=function(){},i.boolean=function(m){return!!m},i.byte=v(8,{unsigned:!1}),i.octet=v(8,{unsigned:!0}),i.short=v(16,{unsigned:!1}),i["unsigned short"]=v(16,{unsigned:!0}),i.long=v(32,{unsigned:!1}),i["unsigned long"]=v(32,{unsigned:!0}),i["long long"]=v(64,{unsigned:!1}),i["unsigned long long"]=v(64,{unsigned:!0}),i.double=function(m,b){var E=+m;if(!Number.isFinite(E))throw new TypeError(o("is not a finite floating-point value",b));return E},i["unrestricted double"]=function(m){var b=+m;return b},i.float=function(m,b){var E=+m;if(!Number.isFinite(E))throw new TypeError(o("is not a finite floating-point value",b));if(Object.is(E,-0))return E;var _=Math.fround(E);if(!Number.isFinite(_))throw new TypeError(o("is outside the range of a single-precision floating-point value",b));return _},i["unrestricted float"]=function(m){var b=+m;return isNaN(b)||Object.is(b,-0)?b:Math.fround(b)},i.DOMString=function(m,b){if(b===void 0&&(b={}),b.treatNullAsEmptyString&&m===null)return"";if((typeof m>"u"?"undefined":s(m))==="symbol")throw new TypeError(o("is a symbol, which cannot be converted to a string",b));return String(m)},i.ByteString=function(m,b){for(var E=i.DOMString(m,b),_=void 0,C=0;(_=E.codePointAt(C))!==void 0;++C)if(_>255)throw new TypeError(o("is not a valid ByteString",b));return E},i.USVString=function(m,b){for(var E=i.DOMString(m,b),_=E.length,C=[],T=0;T<_;++T){var x=E.charCodeAt(T);if(x<55296||x>57343)C.push(String.fromCodePoint(x));else if(56320<=x&&x<=57343)C.push(String.fromCodePoint(65533));else if(T===_-1)C.push(String.fromCodePoint(65533));else{var R=E.charCodeAt(T+1);if(56320<=R&&R<=57343){var O=x&1023,F=R&1023;C.push(String.fromCodePoint((2<<15)+(2<<9)*O+F)),++T}else C.push(String.fromCodePoint(65533))}}return C.join("")},i.object=function(m,b){if(u(m)!=="Object")throw new TypeError(o("is not an object",b));return m};function A(m,b){if(typeof m!="function")throw new TypeError(o("is not a function",b));return m}[Error,ArrayBuffer,DataView,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,Float32Array,Float64Array].forEach(function(m){var b=m.name,E=/^[AEIOU]/.test(b)?"an":"a";i[b]=function(_,C){if(!(_ instanceof m))throw new TypeError(o("is not "+E+" "+b+" object",C));return _}}),i.ArrayBufferView=function(m,b){if(!ArrayBuffer.isView(m))throw new TypeError(o("is not a view on an ArrayBuffer object",b));return m},i.BufferSource=function(m,b){if(!(ArrayBuffer.isView(m)||m instanceof ArrayBuffer))throw new TypeError(o("is not an ArrayBuffer object or a view on one",b));return m},i.DOMTimeStamp=i["unsigned long long"],i.Function=A,i.VoidFunction=A},{}]},{},[1])(1)})})(Ko);var ic=Ko.exports;const sc=Xo(ic),Tt=n=>{if(typeof structuredClone<"u")return structuredClone(n);try{return sc(n)}catch{throw new nc}},Mn=n=>n.source instanceof Ct?n.source:n.source.objectStore,Or=(n,e,t)=>{let r=n!==void 0?n.lower:void 0,i=n!==void 0?n.upper:void 0;for(const s of e)s!==void 0&&(r===void 0||ue(r,s)===1)&&(r=s);for(const s of t)s!==void 0&&(i===void 0||ue(i,s)===-1)&&(i=s);if(r!==void 0&&i!==void 0)return ie.bound(r,i);if(r!==void 0)return ie.lowerBound(r);if(i!==void 0)return ie.upperBound(i)};class sr{_gotValue=!1;_position=void 0;_objectStorePosition=void 0;_keyOnly=!1;_key=void 0;_primaryKey=void 0;constructor(e,t,r="next",i,s=!1){this._range=t,this._source=e,this._direction=r,this._request=i,this._keyOnly=s}get source(){return this._source}set source(e){}get request(){return this._request}set request(e){}get direction(){return this._direction}set direction(e){}get key(){return this._key}set key(e){}get primaryKey(){return this._primaryKey}set primaryKey(e){}_iterate(e,t){const r=this.source instanceof Ct,i=this.source instanceof Ct?this.source._rawObjectStore.records:this.source._rawIndex.records;let s;if(this.direction==="next"){const u=Or(this._range,[e,this._position],[]);for(const a of i.values(u)){const d=e!==void 0?ue(a.key,e):void 0,c=this._position!==void 0?ue(a.key,this._position):void 0;if(!(e!==void 0&&d===-1)){if(t!==void 0){if(d===-1)continue;const h=ue(a.value,t);if(d===0&&h===-1)continue}if(!(this._position!==void 0&&r&&c!==1)&&!(this._position!==void 0&&!r&&(c===-1||c===0&&ue(a.value,this._objectStorePosition)!==1))&&!(this._range!==void 0&&!this._range.includes(a.key))){s=a;break}}}}else if(this.direction==="nextunique"){const u=Or(this._range,[e,this._position],[]);for(const a of i.values(u))if(!(e!==void 0&&ue(a.key,e)===-1)&&!(this._position!==void 0&&ue(a.key,this._position)!==1)&&!(this._range!==void 0&&!this._range.includes(a.key))){s=a;break}}else if(this.direction==="prev"){const u=Or(this._range,[],[e,this._position]);for(const a of i.values(u,"prev")){const d=e!==void 0?ue(a.key,e):void 0,c=this._position!==void 0?ue(a.key,this._position):void 0;if(!(e!==void 0&&d===1)){if(t!==void 0){if(d===1)continue;const h=ue(a.value,t);if(d===0&&h===1)continue}if(!(this._position!==void 0&&r&&c!==-1)&&!(this._position!==void 0&&!r&&(c===1||c===0&&ue(a.value,this._objectStorePosition)!==-1))&&!(this._range!==void 0&&!this._range.includes(a.key))){s=a;break}}}}else if(this.direction==="prevunique"){let u;const a=Or(this._range,[],[e,this._position]);for(const d of i.values(a,"prev"))if(!(e!==void 0&&ue(d.key,e)===1)&&!(this._position!==void 0&&ue(d.key,this._position)!==-1)&&!(this._range!==void 0&&!this._range.includes(d.key))){u=d;break}u&&(s=i.get(u.key))}let o;if(!s)this._key=void 0,r||(this._objectStorePosition=void 0),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=void 0),o=null;else{if(this._position=s.key,r||(this._objectStorePosition=s.value),this._key=s.key,r)this._primaryKey=Tt(s.key),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"&&(this.value=Tt(s.value));else if(this._primaryKey=Tt(s.value),!this._keyOnly&&this.toString()==="[object IDBCursorWithValue]"){if(this.source instanceof Ct)throw new Error("This should never happen");const u=this.source.objectStore._rawObjectStore.getValue(s.value);this.value=Tt(u)}this._gotValue=!0,o=this}return o}update(e){if(e===void 0)throw new TypeError;const t=Mn(this),r=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,i=t.transaction;if(i._state!=="active")throw new Ft;if(i.mode==="readonly")throw new ir;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof Ct)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue||!this.hasOwnProperty("value"))throw new re;const s=Tt(e);if(t.keyPath!==null){let u;try{u=lr(t.keyPath,s)}catch{}if(ue(u,r)!==0)throw new Le}const o={key:r,value:s};return i._execRequestAsync({operation:t._rawObjectStore.storeRecord.bind(t._rawObjectStore,o,!1,i._rollbackLog),source:this})}advance(e){if(!Number.isInteger(e)||e<=0)throw new TypeError;const t=Mn(this),r=t.transaction;if(r._state!=="active")throw new Ft;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof Ct)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue)throw new re;this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:()=>{let i;for(let s=0;s<e&&(i=this._iterate(),!!i);s++);return i},request:this._request,source:this.source}),this._gotValue=!1}continue(e){const t=Mn(this),r=t.transaction;if(r._state!=="active")throw new Ft;if(t._rawObjectStore.deleted)throw new re;if(!(this.source instanceof Ct)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue)throw new re;if(e!==void 0){e=ye(e);const i=ue(e,this._position);if(i<=0&&(this.direction==="next"||this.direction==="nextunique")||i>=0&&(this.direction==="prev"||this.direction==="prevunique"))throw new Le}this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:this._iterate.bind(this,e),request:this._request,source:this.source}),this._gotValue=!1}continuePrimaryKey(e,t){const r=Mn(this),i=r.transaction;if(i._state!=="active")throw new Ft;if(r._rawObjectStore.deleted)throw new re;if(!(this.source instanceof Ct)&&this.source._rawIndex.deleted)throw new re;if(this.source instanceof Ct||this.direction!=="next"&&this.direction!=="prev")throw new Hr;if(!this._gotValue)throw new re;if(e===void 0||t===void 0)throw new Le;e=ye(e);const s=ue(e,this._position);if(s===-1&&this.direction==="next"||s===1&&this.direction==="prev")throw new Le;const o=ue(t,this._objectStorePosition);if(s===0&&(o<=0&&this.direction==="next"||o>=0&&this.direction==="prev"))throw new Le;this._request&&(this._request.readyState="pending"),i._execRequestAsync({operation:this._iterate.bind(this,e,t),request:this._request,source:this.source}),this._gotValue=!1}delete(){const e=Mn(this),t=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,r=e.transaction;if(r._state!=="active")throw new Ft;if(r.mode==="readonly")throw new ir;if(e._rawObjectStore.deleted)throw new re;if(!(this.source instanceof Ct)&&this.source._rawIndex.deleted)throw new re;if(!this._gotValue||!this.hasOwnProperty("value"))throw new re;return r._execRequestAsync({operation:e._rawObjectStore.deleteRecord.bind(e._rawObjectStore,t,r._rollbackLog),source:this})}toString(){return"[object IDBCursor]"}}class Uo extends sr{value=void 0;constructor(e,t,r,i){super(e,t,r,i)}toString(){return"[object IDBCursorWithValue]"}}const Gs=(n,e)=>n.immediatePropagationStopped||n.eventPhase===n.CAPTURING_PHASE&&e.capture===!1||n.eventPhase===n.BUBBLING_PHASE&&e.capture===!0,pi=(n,e)=>{n.currentTarget=e;for(const s of e.listeners.slice())n.type!==s.type||Gs(n,s)||s.callback.call(n.currentTarget,n);const r={abort:"onabort",blocked:"onblocked",complete:"oncomplete",error:"onerror",success:"onsuccess",upgradeneeded:"onupgradeneeded",versionchange:"onversionchange"}[n.type];if(r===void 0)throw new Error(`Unknown event type: "${n.type}"`);const i=n.currentTarget[r];if(i){const s={callback:i,capture:!1,type:n.type};Gs(n,s)||s.callback.call(n.currentTarget,n)}};class ys{listeners=[];addEventListener(e,t,r=!1){this.listeners.push({callback:t,capture:r,type:e})}removeEventListener(e,t,r=!1){const i=this.listeners.findIndex(s=>s.type===e&&s.callback===t&&s.capture===r);this.listeners.splice(i,1)}dispatchEvent(e){if(e.dispatched||!e.initialized)throw new re("The object is in an invalid state.");e.isTrusted=!1,e.dispatched=!0,e.target=this,e.eventPhase=e.CAPTURING_PHASE;for(const t of e.eventPath)e.propagationStopped||pi(e,t);if(e.eventPhase=e.AT_TARGET,e.propagationStopped||pi(e,e.target),e.bubbles){e.eventPath.reverse(),e.eventPhase=e.BUBBLING_PHASE;for(const t of e.eventPath)e.propagationStopped||pi(e,t)}return e.dispatched=!1,e.eventPhase=e.NONE,e.currentTarget=null,!e.canceled}}class gn extends ys{_result=null;_error=null;source=null;transaction=null;readyState="pending";onsuccess=null;onerror=null;get error(){if(this.readyState==="pending")throw new re;return this._error}set error(e){this._error=e}get result(){if(this.readyState==="pending")throw new re;return this._result}set result(e){this._result=e}toString(){return"[object IDBRequest]"}}const or=(n,e)=>{const r=e==="unsigned long"?4294967295:9007199254740991;if(isNaN(n)||n<0||n>r)throw new TypeError;if(n>=0)return Math.floor(n)};class rt extends Array{contains(e){for(const t of this)if(e===t)return!0;return!1}item(e){return e<0||e>=this.length?null:this[e]}_push(...e){return Array.prototype.push.call(this,...e)}_sort(...e){return Array.prototype.sort.call(this,...e)}}const Wr=(n,e=!1)=>{if(n instanceof ie)return n;if(n==null){if(e)throw new Le;return new ie(void 0,void 0,!1,!1)}const t=ye(n);return ie.only(t)},an=n=>{if(n._rawIndex.deleted||n.objectStore._rawObjectStore.deleted)throw new re;if(n.objectStore.transaction._state!=="active")throw new Ft};class $s{constructor(e,t){this._rawIndex=t,this._name=t.name,this.objectStore=e,this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.unique=t.unique}get name(){return this._name}set name(e){const t=this.objectStore.transaction;if(!t.db._runningVersionchangeTransaction)throw new re;if(t._state!=="active")throw new Ft;if(this._rawIndex.deleted||this.objectStore._rawObjectStore.deleted)throw new re;if(e=String(e),e===this._name)return;if(this.objectStore.indexNames.contains(e))throw new rn;const r=this._name,i=[...this.objectStore.indexNames];this._name=e,this._rawIndex.name=e,this.objectStore._indexesCache.delete(r),this.objectStore._indexesCache.set(e,this),this.objectStore._rawObjectStore.rawIndexes.delete(r),this.objectStore._rawObjectStore.rawIndexes.set(e,this._rawIndex),this.objectStore.indexNames=new rt(...Array.from(this.objectStore._rawObjectStore.rawIndexes.keys()).filter(s=>{const o=this.objectStore._rawObjectStore.rawIndexes.get(s);return o&&!o.deleted}).sort()),t._rollbackLog.push(()=>{this._name=r,this._rawIndex.name=r,this.objectStore._indexesCache.delete(e),this.objectStore._indexesCache.set(r,this),this.objectStore._rawObjectStore.rawIndexes.delete(e),this.objectStore._rawObjectStore.rawIndexes.set(r,this._rawIndex),this.objectStore.indexNames=new rt(...i)})}openCursor(e,t){an(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new gn;r.source=this,r.transaction=this.objectStore.transaction;const i=new Uo(this,e,t,r);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}openKeyCursor(e,t){an(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new gn;r.source=this,r.transaction=this.objectStore.transaction;const i=new sr(this,e,t,r,!0);return this.objectStore.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}get(e){return an(this),e instanceof ie||(e=ye(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getValue.bind(this._rawIndex,e),source:this})}getAll(e,t){arguments.length>1&&t!==void 0&&(t=or(t,"unsigned long")),an(this);const r=Wr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllValues.bind(this._rawIndex,r,t),source:this})}getKey(e){return an(this),e instanceof ie||(e=ye(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getKey.bind(this._rawIndex,e),source:this})}getAllKeys(e,t){arguments.length>1&&t!==void 0&&(t=or(t,"unsigned long")),an(this);const r=Wr(e);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllKeys.bind(this._rawIndex,r,t),source:this})}count(e){return an(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e))),this.objectStore.transaction._execRequestAsync({operation:()=>{let t=0;const r=new sr(this,e);for(;r._iterate()!==null;)t+=1;return t},source:this})}toString(){return"[object IDBIndex]"}}const oc=(n,e)=>{if(Array.isArray(n))throw new Error("The key paths used in this section are always strings and never sequences, since it is not possible to create a object store which has a key generator and also has a key path that is a sequence.");const t=n.split(".");if(t.length===0)throw new Error("Assert: identifiers is not empty");t.pop();for(const r of t){if(typeof e!="object"&&!Array.isArray(e))return!1;if(!e.hasOwnProperty(r))return!0;e=e[r]}return typeof e=="object"||Array.isArray(e)};function Yr(n,e){let t=0,r=n.length,i;for(;t<r;)i=t+r>>>1,ue(n[i].key,e)<0?t=i+1:r=i;return t}function Vo(n,e){const t=Yr(n,e),r=n[t];return r&&ue(r.key,e)===0?t:-1}function ac(n,e){const t=Vo(n,e);return n[t]}function Go(n,e){const t=typeof e.lower>"u"?0:Yr(n,e.lower),r=typeof e.upper>"u"?n.length-1:Yr(n,e.upper);for(let i=t;i<=r;i++){const s=n[i];if(s&&e.includes(s.key))return i}return-1}function uc(n,e){const t=Go(n,e);return n[t]}function cc(n,e){const t=Yr(n,e),r=n[t];return r&&ue(r.key,e)>=0?t:-1}class $o{records=[];get(e){return e instanceof ie?uc(this.records,e):ac(this.records,e)}add(e){let t;if(this.records.length===0)t=0;else if(t=cc(this.records,e.key),t===-1)t=this.records.length;else for(;t<this.records.length&&ue(this.records[t].key,e.key)===0&&ue(this.records[t].value,e.value)===-1;)t+=1;this.records.splice(t,0,e)}delete(e){const t=[],r=e instanceof ie;for(;;){const i=r?Go(this.records,e):Vo(this.records,e);if(i===-1)break;t.push(this.records[i]),this.records.splice(i,1)}return t}deleteByValue(e){const t=e instanceof ie?e:ie.only(e),r=[];return this.records=this.records.filter(i=>{const s=t.includes(i.value);return s&&r.push(i),!s}),r}clear(){const e=this.records.slice();return this.records=[],e}values(e,t="next"){return{[Symbol.iterator]:()=>{let r;if(t==="next"){if(r=0,e!==void 0&&e.lower!==void 0)for(;this.records[r]!==void 0;){const i=ue(this.records[r].key,e.lower);if(i===1||i===0&&!e.lowerOpen)break;r+=1}}else if(r=this.records.length-1,e!==void 0&&e.upper!==void 0)for(;this.records[r]!==void 0;){const i=ue(this.records[r].key,e.upper);if(i===-1||i===0&&!e.upperOpen)break;r-=1}return{next:()=>{let i,s;if(t==="next"){if(s=this.records[r],i=r>=this.records.length,r+=1,!i&&e!==void 0&&e.upper!==void 0){const o=ue(s.key,e.upper);i=o===1||o===0&&e.upperOpen,i&&(s=void 0)}}else if(s=this.records[r],i=r<0,r-=1,!i&&e!==void 0&&e.lower!==void 0){const o=ue(s.key,e.lower);i=o===-1||o===0&&e.lowerOpen,i&&(s=void 0)}return{done:i,value:s}}}}}}}class lc{deleted=!1;initialized=!1;records=new $o;constructor(e,t,r,i,s){this.rawObjectStore=e,this.name=t,this.keyPath=r,this.multiEntry=i,this.unique=s}getKey(e){const t=this.records.get(e);return t!==void 0?t.value:void 0}getAllKeys(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(Tt(i.value)),r.length>=t)break;return r}getValue(e){const t=this.records.get(e);return t!==void 0?this.rawObjectStore.getValue(t.value):void 0}getAllValues(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(this.rawObjectStore.getValue(i.value)),r.length>=t)break;return r}storeRecord(e){let t;try{t=lr(this.keyPath,e.value)}catch(r){if(r.name==="DataError")return;throw r}if(!this.multiEntry||!Array.isArray(t))try{ye(t)}catch{return}else{const r=[];for(const i of t)if(r.indexOf(i)<0)try{r.push(ye(i))}catch{}t=r}if(!this.multiEntry||!Array.isArray(t)){if(this.unique&&this.records.get(t))throw new rn}else if(this.unique){for(const r of t)if(this.records.get(r))throw new rn}if(!this.multiEntry||!Array.isArray(t))this.records.add({key:t,value:e.key});else for(const r of t)this.records.add({key:r,value:e.key})}initialize(e){if(this.initialized)throw new Error("Index already initialized");e._execRequestAsync({operation:()=>{try{for(const t of this.rawObjectStore.records.values())this.storeRecord(t);this.initialized=!0}catch(t){e._abort(t.name)}},source:null})}}const zr=(n,e)=>{if(n!=null&&typeof n!="string"&&n.toString&&(e==="array"||!Array.isArray(n))&&(n=n.toString()),typeof n=="string"){if(n===""&&e!=="string")return;try{const t=/^(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])(?:[\$0-9A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])*$/;if(n.length>=1&&t.test(n))return}catch(t){throw new SyntaxError(t.message)}if(n.indexOf(" ")>=0)throw new SyntaxError("The keypath argument contains an invalid key path (no spaces allowed).")}if(Array.isArray(n)&&n.length>0){if(e)throw new SyntaxError("The keypath argument contains an invalid key path (nested arrays).");for(const t of n)zr(t,"array");return}else if(typeof n=="string"&&n.indexOf(".")>=0){n=n.split(".");for(const t of n)zr(t,"string");return}throw new SyntaxError},mt=n=>{if(n._rawObjectStore.deleted)throw new re;if(n.transaction._state!=="active")throw new Ft},qs=(n,e,t)=>{if(mt(n),n.transaction.mode==="readonly")throw new ir;if(n.keyPath!==null&&t!==void 0)throw new Le;const r=Tt(e);if(n.keyPath!==null){const i=lr(n.keyPath,r);if(i!==void 0)ye(i);else if(n._rawObjectStore.keyGenerator){if(!oc(n.keyPath,r))throw new Le}else throw new Le}if(n.keyPath===null&&n._rawObjectStore.keyGenerator===null&&t===void 0)throw new Le;return t!==void 0&&(t=ye(t)),{key:t,value:r}};class hc{_indexesCache=new Map;constructor(e,t){this._rawObjectStore=t,this._name=t.name,this.keyPath=t.keyPath,this.autoIncrement=t.autoIncrement,this.transaction=e,this.indexNames=new rt(...Array.from(t.rawIndexes.keys()).sort())}get name(){return this._name}set name(e){const t=this.transaction;if(!t.db._runningVersionchangeTransaction)throw new re;if(mt(this),e=String(e),e===this._name)return;if(this._rawObjectStore.rawDatabase.rawObjectStores.has(e))throw new rn;const r=this._name,i=[...t.db.objectStoreNames];this._name=e,this._rawObjectStore.name=e,this.transaction._objectStoresCache.delete(r),this.transaction._objectStoresCache.set(e,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(r),this._rawObjectStore.rawDatabase.rawObjectStores.set(e,this._rawObjectStore),t.db.objectStoreNames=new rt(...Array.from(this._rawObjectStore.rawDatabase.rawObjectStores.keys()).filter(u=>{const a=this._rawObjectStore.rawDatabase.rawObjectStores.get(u);return a&&!a.deleted}).sort());const s=new Set(t._scope),o=[...t.objectStoreNames];this.transaction._scope.delete(r),t._scope.add(e),t.objectStoreNames=new rt(...Array.from(t._scope).sort()),t._rollbackLog.push(()=>{this._name=r,this._rawObjectStore.name=r,this.transaction._objectStoresCache.delete(e),this.transaction._objectStoresCache.set(r,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(e),this._rawObjectStore.rawDatabase.rawObjectStores.set(r,this._rawObjectStore),t.db.objectStoreNames=new rt(...i),t._scope=s,t.objectStoreNames=new rt(...o)})}put(e,t){if(arguments.length===0)throw new TypeError;const r=qs(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!1,this.transaction._rollbackLog),source:this})}add(e,t){if(arguments.length===0)throw new TypeError;const r=qs(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!0,this.transaction._rollbackLog),source:this})}delete(e){if(arguments.length===0)throw new TypeError;if(mt(this),this.transaction.mode==="readonly")throw new ir;return e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.deleteRecord.bind(this._rawObjectStore,e,this.transaction._rollbackLog),source:this})}get(e){if(arguments.length===0)throw new TypeError;return mt(this),e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getValue.bind(this._rawObjectStore,e),source:this})}getAll(e,t){arguments.length>1&&t!==void 0&&(t=or(t,"unsigned long")),mt(this);const r=Wr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllValues.bind(this._rawObjectStore,r,t),source:this})}getKey(e){if(arguments.length===0)throw new TypeError;return mt(this),e instanceof ie||(e=ye(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getKey.bind(this._rawObjectStore,e),source:this})}getAllKeys(e,t){arguments.length>1&&t!==void 0&&(t=or(t,"unsigned long")),mt(this);const r=Wr(e);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllKeys.bind(this._rawObjectStore,r,t),source:this})}clear(){if(mt(this),this.transaction.mode==="readonly")throw new ir;return this.transaction._execRequestAsync({operation:this._rawObjectStore.clear.bind(this._rawObjectStore,this.transaction._rollbackLog),source:this})}openCursor(e,t){mt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new gn;r.source=this,r.transaction=this.transaction;const i=new Uo(this,e,t,r);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}openKeyCursor(e,t){mt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e)));const r=new gn;r.source=this,r.transaction=this.transaction;const i=new sr(this,e,t,r,!0);return this.transaction._execRequestAsync({operation:i._iterate.bind(i),request:r,source:this})}createIndex(e,t,r={}){if(arguments.length<2)throw new TypeError;const i=r.multiEntry!==void 0?r.multiEntry:!1,s=r.unique!==void 0?r.unique:!1;if(this.transaction.mode!=="versionchange")throw new re;if(mt(this),this.indexNames.contains(e))throw new rn;if(zr(t),Array.isArray(t)&&i)throw new Hr;const o=[...this.indexNames];this.transaction._rollbackLog.push(()=>{const a=this._rawObjectStore.rawIndexes.get(e);a&&(a.deleted=!0),this.indexNames=new rt(...o),this._rawObjectStore.rawIndexes.delete(e)});const u=new lc(this._rawObjectStore,e,t,i,s);return this.indexNames._push(e),this.indexNames._sort(),this._rawObjectStore.rawIndexes.set(e,u),u.initialize(this.transaction),new $s(this,u)}index(e){if(arguments.length===0)throw new TypeError;if(this._rawObjectStore.deleted||this.transaction._state==="finished")throw new re;const t=this._indexesCache.get(e);if(t!==void 0)return t;const r=this._rawObjectStore.rawIndexes.get(e);if(!this.indexNames.contains(e)||r===void 0)throw new rr;const i=new $s(this,r);return this._indexesCache.set(e,i),i}deleteIndex(e){if(arguments.length===0)throw new TypeError;if(this.transaction.mode!=="versionchange")throw new re;mt(this);const t=this._rawObjectStore.rawIndexes.get(e);if(t===void 0)throw new rr;this.transaction._rollbackLog.push(()=>{t.deleted=!1,this._rawObjectStore.rawIndexes.set(e,t),this.indexNames._push(e),this.indexNames._sort()}),this.indexNames=new rt(...Array.from(this.indexNames).filter(r=>r!==e)),t.deleted=!0,this.transaction._execRequestAsync({operation:()=>{const r=this._rawObjectStore.rawIndexes.get(e);t===r&&this._rawObjectStore.rawIndexes.delete(e)},source:this})}count(e){return mt(this),e===null&&(e=void 0),e!==void 0&&!(e instanceof ie)&&(e=ie.only(ye(e))),this.transaction._execRequestAsync({operation:()=>{let t=0;const r=new sr(this,e);for(;r._iterate()!==null;)t+=1;return t},source:this})}toString(){return"[object IDBObjectStore]"}}const Ct=hc;class Gt{eventPath=[];NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;propagationStopped=!1;immediatePropagationStopped=!1;canceled=!1;initialized=!0;dispatched=!1;target=null;currentTarget=null;eventPhase=0;defaultPrevented=!1;isTrusted=!1;timeStamp=Date.now();constructor(e,t={}){this.type=e,this.bubbles=t.bubbles!==void 0?t.bubbles:!1,this.cancelable=t.cancelable!==void 0?t.cancelable:!1}preventDefault(){this.cancelable&&(this.canceled=!0)}stopPropagation(){this.propagationStopped=!0}stopImmediatePropagation(){this.propagationStopped=!0,this.immediatePropagationStopped=!0}}function dc(){if(typeof navigator<"u"&&/jsdom/.test(navigator.userAgent)){const n=Node.constructor;return new n("return setImmediate")()}else return}const jt=globalThis.setImmediate||dc()||(n=>setTimeout(n,0));class fc extends ys{_state="active";_started=!1;_rollbackLog=[];_objectStoresCache=new Map;error=null;onabort=null;oncomplete=null;onerror=null;_requests=[];constructor(e,t,r){super(),this._scope=new Set(e),this.mode=t,this.db=r,this.objectStoreNames=new rt(...Array.from(this._scope).sort())}_abort(e){for(const t of this._rollbackLog.reverse())t();if(e!==null){const t=new Error;t.name=e,this.error=t}for(const{request:t}of this._requests)if(t.readyState!=="done"&&(t.readyState="done",t.source)){t.result=void 0,t.error=new qi;const r=new Gt("error",{bubbles:!0,cancelable:!0});r.eventPath=[this.db,this],t.dispatchEvent(r)}jt(()=>{const t=new Gt("abort",{bubbles:!0,cancelable:!1});t.eventPath=[this.db],this.dispatchEvent(t)}),this._state="finished"}abort(){if(this._state==="committing"||this._state==="finished")throw new re;this._state="active",this._abort(null)}objectStore(e){if(this._state!=="active")throw new re;const t=this._objectStoresCache.get(e);if(t!==void 0)return t;const r=this.db._rawDatabase.rawObjectStores.get(e);if(!this._scope.has(e)||r===void 0)throw new rr;const i=new Ct(this,r);return this._objectStoresCache.set(e,i),i}_execRequestAsync(e){const t=e.source,r=e.operation;let i=e.hasOwnProperty("request")?e.request:null;if(this._state!=="active")throw new Ft;return i||(t?(i=new gn,i.source=t,i.transaction=t.transaction):i=new gn),this._requests.push({operation:r,request:i}),i}_start(){this._started=!0;let e,t;for(;this._requests.length>0;){const r=this._requests.shift();if(r&&r.request.readyState!=="done"){t=r.request,e=r.operation;break}}if(t&&e){if(!t.source)e();else{let r,i;try{const s=e();t.readyState="done",t.result=s,t.error=void 0,this._state==="inactive"&&(this._state="active"),i=new Gt("success",{bubbles:!1,cancelable:!1})}catch(s){t.readyState="done",t.result=void 0,t.error=s,this._state==="inactive"&&(this._state="active"),i=new Gt("error",{bubbles:!0,cancelable:!0}),r=this._abort.bind(this,s.name)}try{i.eventPath=[this.db,this],t.dispatchEvent(i)}catch(s){throw this._state!=="committing"&&this._abort("AbortError"),s}i.canceled||r&&r()}jt(this._start.bind(this));return}if(this._state!=="finished"&&(this._state="finished",!this.error)){const r=new Gt("complete");this.dispatchEvent(r)}}commit(){if(this._state!=="active")throw new re;this._state="committing"}toString(){return"[object IDBRequest]"}}const Hs=9007199254740992;class pc{num=0;next(){if(this.num>=Hs)throw new rn;return this.num+=1,this.num}setIfLarger(e){const t=Math.floor(Math.min(e,Hs))-1;t>=this.num&&(this.num=t+1)}}class yc{deleted=!1;records=new $o;rawIndexes=new Map;constructor(e,t,r,i){this.rawDatabase=e,this.keyGenerator=i===!0?new pc:null,this.deleted=!1,this.name=t,this.keyPath=r,this.autoIncrement=i}getKey(e){const t=this.records.get(e);return t!==void 0?Tt(t.key):void 0}getAllKeys(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(Tt(i.key)),r.length>=t)break;return r}getValue(e){const t=this.records.get(e);return t!==void 0?Tt(t.value):void 0}getAllValues(e,t){(t===void 0||t===0)&&(t=1/0);const r=[];for(const i of this.records.values(e))if(r.push(Tt(i.value)),r.length>=t)break;return r}storeRecord(e,t,r){if(this.keyPath!==null){const s=lr(this.keyPath,e.value);s!==void 0&&(e.key=s)}if(this.keyGenerator!==null&&e.key===void 0){if(r){const s=this.keyGenerator.num;r.push(()=>{this.keyGenerator&&(this.keyGenerator.num=s)})}if(e.key=this.keyGenerator.next(),this.keyPath!==null){if(Array.isArray(this.keyPath))throw new Error("Cannot have an array key path in an object store with a key generator");let s=this.keyPath,o=e.value,u,a=0;for(;a>=0;){if(typeof o!="object")throw new Le;a=s.indexOf("."),a>=0&&(u=s.slice(0,a),s=s.slice(a+1),o.hasOwnProperty(u)||(o[u]={}),o=o[u])}u=s,o[u]=e.key}}else this.keyGenerator!==null&&typeof e.key=="number"&&this.keyGenerator.setIfLarger(e.key);if(this.records.get(e.key)){if(t)throw new rn;this.deleteRecord(e.key,r)}this.records.add(e),r&&r.push(()=>{this.deleteRecord(e.key)});for(const s of this.rawIndexes.values())s.initialized&&s.storeRecord(e);return e.key}deleteRecord(e,t){const r=this.records.delete(e);if(t)for(const i of r)t.push(()=>{this.storeRecord(i,!0)});for(const i of this.rawIndexes.values())i.records.deleteByValue(e)}clear(e){const t=this.records.clear();if(e)for(const r of t)e.push(()=>{this.storeRecord(r,!0)});for(const r of this.rawIndexes.values())r.records.clear()}}const Ws=n=>{if(!n._runningVersionchangeTransaction)throw new re;const e=n._rawDatabase.transactions.filter(r=>r.mode==="versionchange"),t=e[e.length-1];if(!t||t._state==="finished")throw new re;if(t._state!=="active")throw new Ft;return t},qo=n=>{n._closePending=!0,n._rawDatabase.transactions.every(t=>t._state==="finished")?(n._closed=!0,n._rawDatabase.connections=n._rawDatabase.connections.filter(t=>n!==t)):jt(()=>{qo(n)})};class mc extends ys{_closePending=!1;_closed=!1;_runningVersionchangeTransaction=!1;constructor(e){super(),this._rawDatabase=e,this._rawDatabase.connections.push(this),this.name=e.name,this.version=e.version,this.objectStoreNames=new rt(...Array.from(e.rawObjectStores.keys()).sort())}createObjectStore(e,t={}){if(e===void 0)throw new TypeError;const r=Ws(this),i=t!==null&&t.keyPath!==void 0?t.keyPath:null,s=t!==null&&t.autoIncrement!==void 0?t.autoIncrement:!1;if(i!==null&&zr(i),this._rawDatabase.rawObjectStores.has(e))throw new rn;if(s&&(i===""||Array.isArray(i)))throw new Hr;const o=[...this.objectStoreNames];r._rollbackLog.push(()=>{const a=this._rawDatabase.rawObjectStores.get(e);a&&(a.deleted=!0),this.objectStoreNames=new rt(...o),r._scope.delete(e),this._rawDatabase.rawObjectStores.delete(e)});const u=new yc(this._rawDatabase,e,i,s);return this.objectStoreNames._push(e),this.objectStoreNames._sort(),r._scope.add(e),this._rawDatabase.rawObjectStores.set(e,u),r.objectStoreNames=new rt(...this.objectStoreNames),r.objectStore(e)}deleteObjectStore(e){if(e===void 0)throw new TypeError;const t=Ws(this),r=this._rawDatabase.rawObjectStores.get(e);if(r===void 0)throw new rr;this.objectStoreNames=new rt(...Array.from(this.objectStoreNames).filter(i=>i!==e)),t.objectStoreNames=new rt(...this.objectStoreNames),t._rollbackLog.push(()=>{r.deleted=!1,this._rawDatabase.rawObjectStores.set(e,r),this.objectStoreNames._push(e),this.objectStoreNames._sort()}),r.deleted=!0,this._rawDatabase.rawObjectStores.delete(e),t._objectStoresCache.delete(e)}transaction(e,t){if(t=t!==void 0?t:"readonly",t!=="readonly"&&t!=="readwrite"&&t!=="versionchange")throw new TypeError("Invalid mode: "+t);if(this._rawDatabase.transactions.some(s=>s._state==="active"&&s.mode==="versionchange"&&s.db===this))throw new re;if(this._closePending)throw new re;if(Array.isArray(e)||(e=[e]),e.length===0&&t!=="versionchange")throw new Hr;for(const s of e)if(!this.objectStoreNames.contains(s))throw new rr("No objectStore named "+s+" in this database");const i=new fc(e,t,this);return this._rawDatabase.transactions.push(i),this._rawDatabase.processTransactions(),i}close(){qo(this)}toString(){return"[object IDBDatabase]"}}class Ys extends gn{onupgradeneeded=null;onblocked=null;toString(){return"[object IDBOpenDBRequest]"}}class In extends Gt{constructor(e,t={}){super(e),this.newVersion=t.newVersion!==void 0?t.newVersion:null,this.oldVersion=t.oldVersion!==void 0?t.oldVersion:0}toString(){return"[object IDBVersionChangeEvent]"}}class vc{deletePending=!1;transactions=[];rawObjectStores=new Map;connections=[];constructor(e,t){this.name=e,this.version=t,this.processTransactions=this.processTransactions.bind(this)}processTransactions(){jt(()=>{if(!this.transactions.some(t=>t._started&&t._state!=="finished")){const t=this.transactions.find(r=>!r._started&&r._state!=="finished");t&&(t.addEventListener("complete",this.processTransactions),t.addEventListener("abort",this.processTransactions),t._start())}})}}const Ho=(n,e,t,r)=>{if(t.some(s=>!s._closed&&!s._closePending)){jt(()=>Ho(n,e,t,r));return}n.delete(e),r(null)},gc=(n,e,t,r)=>{try{const i=n.get(e);if(i===void 0){r(null);return}i.deletePending=!0;const s=i.connections.filter(u=>!u._closed&&!u._closePending);for(const u of s)if(!u._closePending){const a=new In("versionchange",{newVersion:null,oldVersion:i.version});u.dispatchEvent(a)}const o=s.some(u=>!u._closed&&!u._closePending);if(t&&o){const u=new In("blocked",{newVersion:null,oldVersion:i.version});t.dispatchEvent(u)}Ho(n,e,s,r)}catch(i){r(i)}},_c=(n,e,t,r)=>{n._runningVersionchangeTransaction=!0;const i=n.version,s=n._rawDatabase.connections.filter(a=>n!==a);for(const a of s)if(!a._closed&&!a._closePending){const d=new In("versionchange",{newVersion:e,oldVersion:i});a.dispatchEvent(d)}if(s.some(a=>!a._closed&&!a._closePending)){const a=new In("blocked",{newVersion:e,oldVersion:i});t.dispatchEvent(a)}const u=()=>{if(s.some(h=>!h._closed&&!h._closePending)){jt(u);return}n._rawDatabase.version=e,n.version=e;const d=n.transaction(n.objectStoreNames,"versionchange");t.result=n,t.readyState="done",t.transaction=d,d._rollbackLog.push(()=>{n._rawDatabase.version=i,n.version=i});const c=new In("upgradeneeded",{newVersion:e,oldVersion:i});t.dispatchEvent(c),d.addEventListener("error",()=>{n._runningVersionchangeTransaction=!1}),d.addEventListener("abort",()=>{n._runningVersionchangeTransaction=!1,t.transaction=null,jt(()=>{r(new qi)})}),d.addEventListener("complete",()=>{n._runningVersionchangeTransaction=!1,t.transaction=null,jt(()=>{n._closePending?r(new qi):r(null)})})};u()},bc=(n,e,t,r,i)=>{let s=n.get(e);if(s===void 0&&(s=new vc(e,0),n.set(e,s)),t===void 0&&(t=s.version!==0?s.version:1),s.version>t)return i(new rc);const o=new mc(s);s.version<t?_c(o,t,r,u=>{if(u)return i(u);i(null,o)}):i(null,o)};class Ac{cmp=ue;_databases=new Map;deleteDatabase(e){const t=new Ys;return t.source=null,jt(()=>{const r=this._databases.get(e),i=r!==void 0?r.version:0;gc(this._databases,e,t,s=>{if(s){t.error=new Error,t.error.name=s.name,t.readyState="done";const u=new Gt("error",{bubbles:!0,cancelable:!0});u.eventPath=[],t.dispatchEvent(u);return}t.result=void 0,t.readyState="done";const o=new In("success",{newVersion:null,oldVersion:i});t.dispatchEvent(o)})}),t}open(e,t){if(arguments.length>1&&t!==void 0&&(t=or(t,"MAX_SAFE_INTEGER")),t===0)throw new TypeError;const r=new Ys;return r.source=null,jt(()=>{bc(this._databases,e,t,r,(i,s)=>{if(i){r.result=void 0,r.readyState="done",r.error=new Error,r.error.name=i.name;const u=new Gt("error",{bubbles:!0,cancelable:!0});u.eventPath=[],r.dispatchEvent(u);return}r.result=s,r.readyState="done";const o=new Gt("success");o.eventPath=[],r.dispatchEvent(o)})}),r}databases(){return new Promise(e=>{const t=[];for(const[r,i]of this._databases)t.push({name:r,version:i.version});e(t)})}toString(){return"[object IDBFactory]"}}const Ec=new Ac;class zs extends pn{inMemory;ActiveEncounter;Creatures;Tracker;Settings;constructor(e,t){super("ClashDatabase",t),this.inMemory=e;const r=`
        id,
        tokenId,
        initiative,
        currentHp,
        isMonster,
        isActive,
        unitName,
        maxHP,
        armorClass,
        unitType,
        unitSize,
        strScore,
        strSave,
        dexScore,
        dexSave,
        conScore,
        conSave,
        intScore,
        intSave,
        wisScore,
        wisSave,
        chaScore,
        chaSave,
        damageVulnerabilities,
        damageImmunities,
        damageResistances,
        conditionImmunities,
        challengeRating,
        experiencePoints,
        alignment,
        standardActions,
        legendaryActions,
        specialAbilities,
        spellActions,
        reactions,
        spellList,
        senses,
        skills,
        languages,
        speedWalk,
        speedFly,
        speedClimb,
        speedBurrow,
        speedSwim,
        dataSlug
        `,i=r+", favorite",s=i+", ownerId";this.version(1).stores({ActiveEncounter:r,Creatures:r,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, disableFocus"}),this.version(2).stores({ActiveEncounter:r,Creatures:r,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(3).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList"}),this.version(4).stores({ActiveEncounter:i,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"}),this.version(5).stores({ActiveEncounter:s,Creatures:i,Tracker:"id, currentTurn, currentRound",Settings:"id, gmHideHp, gmHideAll, gmDisableLabel, gmTurnText, disableFocus, gmReverseList, gmRumbleLog"})}async SaveToCreatureStorage(e){return await hn.Creatures.add(e)}async DeleteFromCreatureStorage(e){return await hn.Creatures.delete(e)}async SaveToActiveList(e){return await hn.ActiveEncounter.add(e)}async DeleteFromActiveList(e){return await hn.ActiveEncounter.delete(e)}Ready(){console.log("Setup is complete.")}}let Sr;async function wc(){return Sr||(Sr=await Oc(),Sr)}async function Oc(){return new Promise(n=>{let e=window.indexedDB.open("__test");e.onsuccess=async function(){console.log("DB for Clash running - Clearing local cache will remove stored data"),e.result.close(),window.indexedDB.deleteDatabase("__test"),n(new zs(!1))},e.onerror=async function(){console.warn("IndexDB is disabled, no state will be saved"),window.indexedDB.deleteDatabase("__test"),n(new zs(!0,{indexedDB:Ec,IDBKeyRange:ie}))}})}const hn=await wc();class Dc{id;tokenId;initiative;currentHP;isMonster;isActive;unitName;maxHP;armorClass;unitType;unitSize;strScore;strSave;dexScore;dexSave;conScore;conSave;intScore;intSave;wisScore;wisSave;chaScore;chaSave;damageVulnerabilities;damageImmunities;damageResistances;conditionImmunities;challengeRating;experiencePoints;alignment;standardActions;legendaryActions;specialAbilities;spellActions;reactions;spellList;senses;languages;speedWalk;speedFly;speedClimb;speedBurrow;speedSwim;dataSlug;favorite;ownerId;constructor(e,t,r){this.id=e,this.tokenId=e,this.isActive=0,this.unitName=t??="Default",this.initiative=1,this.currentHP=4,this.maxHP=4,this.armorClass=10,this.speedWalk=30,this.speedBurrow=0,this.speedSwim=0,this.speedClimb=0,this.speedFly=0,this.strScore=10,this.dexScore=10,this.conScore=10,this.intScore=10,this.wisScore=10,this.chaScore=10,this.strSave=2,this.dexSave=2,this.conSave=2,this.intSave=2,this.wisSave=2,this.chaSave=2,this.senses="No unique senses.",this.unitSize="Medium",this.unitType="Humanoid",this.alignment="True Neutral",this.languages="No known languages.",this.damageVulnerabilities="None.",this.damageResistances="None.",this.damageImmunities="None.",this.conditionImmunities="None.",this.challengeRating="0CR.",this.experiencePoints=0,this.standardActions=[],this.specialAbilities=[],this.spellList=[],this.dataSlug="",this.favorite=!1,this.ownerId=r}ImportFromJSON(e){let t=JSON.parse(e);this.SetToModel(t)}async ImportFromDatabase(e){const t=await hn.ActiveEncounter.get(e);if(!t){console.log("Found no UnitInformation for "+e);return}this.SetToModel(t),this.isActive=t.isActive}SetToModel(e,t){this.initiative=e.initiative,this.currentHP=e.maxHP,this.maxHP=e.maxHP,this.isMonster=e.isMonster,this.unitName=e.unitName,this.armorClass=e.armorClass,this.unitType=e.unitType,this.unitSize=e.unitSize,this.strScore=e.strScore,this.strSave=e.strSave,this.dexScore=e.dexScore,this.dexSave=e.dexSave,this.conScore=e.conScore,this.conSave=e.conSave,this.intScore=e.intScore,this.intSave=e.intSave,this.wisScore=e.wisScore,this.wisSave=e.wisSave,this.chaScore=e.chaScore,this.chaSave=e.chaSave,this.damageVulnerabilities=e.damageVulnerabilities,this.damageImmunities=e.damageImmunities,this.damageResistances=e.damageResistances,this.conditionImmunities=e.conditionImmunities,this.challengeRating=e.challengeRating,this.experiencePoints=e.experiencePoints,this.alignment=e.alignment,this.standardActions=e.standardActions,this.legendaryActions=e.legendaryActions,this.specialAbilities=e.specialAbilities,this.spellActions=e.spellActions,this.reactions=e.reactions,this.spellList=e.spellList,this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speedWalk,this.speedFly=e.speedFly,this.speedClimb=e.speedClimb,this.speedBurrow=e.speedBurrow,this.speedSwim=e.speedSwim,this.dataSlug=e.dataSlug,this.favorite=t?e.favorite:!1,this.CheckDefaults()}ImportCustomFormInputs(e){this.unitName=this.GetContent(e,"formUnitName"),this.maxHP=parseFloat(this.GetContent(e,"formMaxHP"))||4,this.currentHP=this.maxHP,this.armorClass=parseFloat(this.GetContent(e,"formArmorClass"))||10,this.unitType=this.GetContent(e,"formUnitType"),this.unitSize=this.GetContent(e,"formUnitSize"),this.alignment=this.GetContent(e,"formAlignment"),this.speedWalk=parseFloat(this.GetContent(e,"formSpeedWalk"))||0,this.speedSwim=parseFloat(this.GetContent(e,"formSpeedSwim"))||0,this.speedClimb=parseFloat(this.GetContent(e,"formSpeedClimb"))||0,this.speedFly=parseFloat(this.GetContent(e,"formSpeedFly"))||0,this.speedBurrow=parseFloat(this.GetContent(e,"formSpeedBurrow"))||0,this.strScore=parseFloat(this.GetContent(e,"formStrScore"))||1,this.dexScore=parseFloat(this.GetContent(e,"formDexScore"))||1,this.conScore=parseFloat(this.GetContent(e,"formConScore"))||1,this.intScore=parseFloat(this.GetContent(e,"formIntScore"))||1,this.wisScore=parseFloat(this.GetContent(e,"formWisScore"))||1,this.chaScore=parseFloat(this.GetContent(e,"formChaScore"))||1,this.strSave=parseFloat(this.GetContent(e,"formStrSave"))||0,this.dexSave=parseFloat(this.GetContent(e,"formDexSave"))||0,this.conSave=parseFloat(this.GetContent(e,"formConSave"))||0,this.intSave=parseFloat(this.GetContent(e,"formIntSave"))||0,this.wisSave=parseFloat(this.GetContent(e,"formWisSave"))||0,this.chaSave=parseFloat(this.GetContent(e,"formChaSave"))||0,this.senses=this.GetContent(e,"formSenses"),this.languages=this.GetContent(e,"formLanguages"),this.challengeRating=this.GetContent(e,"formChallengeRating"),this.experiencePoints=parseFloat(this.GetContent(e,"formEXP"))||0,this.damageImmunities=this.GetContent(e,"formImmune"),this.damageResistances=this.GetContent(e,"formResist"),this.damageVulnerabilities=this.GetContent(e,"formVulnerable"),this.conditionImmunities=this.GetContent(e,"formConditions");const t=e.querySelectorAll("#formAttackCollection > #formAttackContainer");this.standardActions=[],t.forEach(u=>{const a=u.querySelector("#formAttackName")?.textContent,d=u.querySelector("#formAttackDesc")?.textContent;if(a&&d){let c={name:a,desc:d};this.standardActions?.push(c)}});const r=e.querySelectorAll("#formReactionCollection > #formReactionContainer");this.reactions=[],r.forEach(u=>{const a=u.querySelector("#formReactionName")?.textContent,d=u.querySelector("#formReactionDesc")?.textContent;if(a&&d){let c={name:a,desc:d};this.reactions?.push(c)}});const i=e.querySelectorAll("#formLegendaryCollection > #formLegendaryContainer");this.legendaryActions=[],i.forEach(u=>{const a=u.querySelector("#formLegendaryName")?.textContent,d=u.querySelector("#formLegendaryDesc")?.textContent;if(a&&d){let c={name:a,desc:d};this.legendaryActions?.push(c)}});const s=e.querySelectorAll("#formAbilityCollection > #formAbilityContainer");this.specialAbilities=[],s.forEach(u=>{const a=u.querySelector("#formAbilityName")?.textContent,d=u.querySelector("#formAbilityDesc")?.textContent;if(a&&d){let c={name:a,desc:d};this.specialAbilities?.push(c)}});const o=e.querySelectorAll("#formSpellCollection > #formSpellContainer");this.spellActions=[],o.forEach(u=>{const a=u.querySelector("#formSpellName")?.textContent,d=u.querySelector("#formSpellDesc")?.textContent;if(a&&d){let c={name:a,desc:d};this.spellActions?.push(c)}}),this.CheckDefaults()}CheckDefaults(){this.unitName??="Nameless",this.maxHP??=4,this.currentHP??=this.maxHP,this.armorClass??=10,this.dataSlug??="Unknown",this.unitType??="Humanoid",this.unitSize??="Medium",this.alignment??="True Neutral",this.speedWalk??=30,this.speedSwim??=0,this.speedClimb??=0,this.speedFly??=0,this.speedBurrow??=0,this.strScore??=10,this.dexScore??=10,this.conScore??=10,this.intScore??=10,this.wisScore??=10,this.chaScore??=10,this.strSave??=Math.floor((Number(this.strScore)-10)/2),this.dexSave??=Math.floor((Number(this.dexScore)-10)/2),this.conSave??=Math.floor((Number(this.conScore)-10)/2),this.intSave??=Math.floor((Number(this.intScore)-10)/2),this.wisSave??=Math.floor((Number(this.wisScore)-10)/2),this.chaSave??=Math.floor((Number(this.chaScore)-10)/2),this.senses??="No unique senses.",this.languages??="No known languages.",this.challengeRating??="0CR.",this.experiencePoints??=0,this.damageImmunities??="None.",this.damageResistances??="None.",this.damageVulnerabilities??="None.",this.conditionImmunities??="None."}GetContent(e,t){return e.getElementById(t).textContent}async ImportOpen5eResponse(e){this.unitName=e.name,this.maxHP=e.hit_points,this.armorClass=e.armor_class,this.unitType=e.type,this.unitSize=e.size,this.strScore=e.strength,this.strSave=e.strength_save,this.dexScore=e.dexterity,this.dexSave=e.dexterity_save,this.conScore=e.constitution,this.conSave=e.constitution_save,this.intScore=e.intelligence,this.intSave=e.intelligence_save,this.wisScore=e.wisdom,this.wisSave=e.wisdom_save,this.chaScore=e.charisma,this.chaSave=e.charisma_save,this.damageVulnerabilities=e.damage_vulnerabilities,this.damageImmunities=e.damage_immunities,this.damageResistances=e.damage_resistances,this.conditionImmunities=e.condition_immunities,this.challengeRating=e.challenge_rating,this.experiencePoints=0,this.alignment=e.alignment,this.standardActions=e.actions,this.legendaryActions=e.legendary_actions,this.specialAbilities=e.special_abilities,this.reactions=e.reactions,this.spellList=e.spell_list,this.spellList!=null&&this.spellList?.length>0&&(this.spellActions=await this.ConvertSpellListtoSpellAction(this.spellList)),this.senses=e.senses,this.languages=e.languages,this.speedWalk=e.speed?.walk,this.speedFly=e.speed?.fly,this.speedClimb=e.speed?.walk,this.speedBurrow=e.speed?.burrow,this.speedSwim=e.speed?.swim,this.CheckDefaults()}async ConvertSpellListtoSpellAction(e){const t=[];for(var r=0,i;i=e[r];r++)await fetch(i).then(function(s){return s.json()}).then(function(s){let o={name:s.name,desc:s.desc};t.push(o)});return t}async SaveToDB(){return await hn.ActiveEncounter.add(this)}async SaveToCreatureStorage(){return await hn.Creatures.add(this)}}function xc(){let n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t==="x"?r:r&3|8).toString(16)})}function Rc(n){const t=new Date,r=new Date(n);return t-r>2e3}function Ic(n,e){const t=parseInt(n.substring(1,3),16),r=parseInt(n.substring(3,5),16),i=parseInt(n.substring(5,7),16);return`rgba(${t}, ${r}, ${i}, ${e})`}function Fc(n,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),r=t.matches?"dark":"light",i=t.matches?"light":"dark";for(var s=0;s<e.styleSheets.length;s++)for(var o=0;o<e.styleSheets[s].cssRules.length;o++){let u=e.styleSheets[s].cssRules[o];u&&u.media&&u.media.mediaText.includes("prefers-color-scheme")&&(n.mode=="LIGHT"?(u.media.appendMedium(`(prefers-color-scheme: ${r})`),u.media.mediaText.includes(i)&&u.media.deleteMedium(`(prefers-color-scheme: ${i})`)):n.mode=="DARK"&&(u.media.appendMedium(`(prefers-color-scheme: ${i})`),u.media.mediaText.includes(r)&&u.media.deleteMedium(`(prefers-color-scheme: ${r})`)))}}export{Tc as C,xc as G,Ic as H,Rc as I,Sc as O,Fc as S,Dc as U,tc as W,Cc as a,Bc as b,hn as d};
